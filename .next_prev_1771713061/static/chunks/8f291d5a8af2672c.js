(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46557,e=>{"use strict";var t=e.i(43476),a=e.i(71645),l=e.i(55436),r=e.i(87130),n=e.i(37727),s=e.i(75254);let i=(0,s.default)("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);var o=e.i(43531),d=e.i(95468),c=e.i(78894),u=e.i(88712);let m=(0,s.default)("columns-3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);var p=e.i(64659);let x=(0,s.default)("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var h=e.i(7233),b=e.i(83086),g=e.i(58377),f=e.i(27735),v=e.i(88653),w=e.i(46932),j=e.i(18566),N=e.i(19455),y=e.i(93479),k=e.i(37822),C=e.i(55146),S=e.i(32171),z=e.i(82943),M=e.i(75378),$=e.i(34288),D=e.i(30747),T=e.i(45060),E=e.i(10059),I=e.i(54498);let R=[{id:"comercial",label:"Leads",stages:[{id:"lead-in",label:"Lead-In",slaHours:48},{id:"contato-feito",label:"Contato Feito",slaHours:72},{id:"reuniao-agendada",label:"Reuniao Agendada",slaHours:120},{id:"proposta-enviada",label:"Proposta Enviada",slaHours:96},{id:"negociacao",label:"Negociacao",slaHours:168},{id:"fechamento",label:"Fechamento",slaHours:48}]},{id:"indicacao",label:"Indicacao",stages:[{id:"lead-in",label:"Lead-In",slaHours:24},{id:"contato-feito",label:"Contato Feito",slaHours:48},{id:"proposta-enviada",label:"Proposta Enviada",slaHours:72},{id:"fechamento",label:"Fechamento",slaHours:48}]}],A={"lead-in":[],"contato-feito":[{field:"clientName",label:"Nome do contato"}],"reuniao-agendada":[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"}],"proposta-enviada":[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"},{field:"value",label:"Valor da proposta"}],negociacao:[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"},{field:"value",label:"Valor da proposta"},{field:"monthlyValue",label:"Valor mensal"}],fechamento:[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"},{field:"value",label:"Valor da proposta"},{field:"monthlyValue",label:"Valor mensal"}]},L={hot:{icon:(0,t.jsx)(g.Flame,{className:"h-3.5 w-3.5"}),label:"Quente",colorClass:"text-status-danger"},warm:{icon:(0,t.jsx)(E.Thermometer,{className:"h-3.5 w-3.5"}),label:"Morno",colorClass:"text-status-warning"},cold:{icon:(0,t.jsx)(I.Snowflake,{className:"h-3.5 w-3.5"}),label:"Frio",colorClass:"text-status-info"}},P=[{id:"default",label:"Padrao",bg:"bg-brand",hex:"#1d4ed8"},{id:"blue",label:"Azul",bg:"bg-blue-500",hex:"#3b82f6"},{id:"cyan",label:"Ciano",bg:"bg-cyan-500",hex:"#06b6d4"},{id:"green",label:"Verde",bg:"bg-emerald-500",hex:"#10b981"},{id:"yellow",label:"Amarelo",bg:"bg-amber-400",hex:"#fbbf24"},{id:"orange",label:"Laranja",bg:"bg-orange-500",hex:"#f97316"},{id:"red",label:"Vermelho",bg:"bg-red-500",hex:"#ef4444"},{id:"pink",label:"Rosa",bg:"bg-pink-500",hex:"#ec4899"},{id:"gray",label:"Cinza",bg:"bg-zinc-400",hex:"#a1a1aa"}],_="flow-stage-customizations";function F(e){if(!e)return{status:"ok",label:"",detailLabel:"SLA nao definido"};let t=new Date,a=new Date(e).getTime()-t.getTime();if(a<=0){let e=Math.floor(Math.abs(a)/36e5),t=Math.floor(e/24),l=t>0?`${t}d ${e%24}h`:`${e}h`;return{status:"breached",label:"Estourado",detailLabel:`SLA estourado ha ${l}`}}let l=a/36e5,r=Math.floor(l/24),n=Math.floor(l%24),s=r>0?`${r}d ${n}h`:`${n}h`;return l<=12?{status:"near",label:s,detailLabel:`SLA vence em ${s} — atencao!`}:{status:"ok",label:s,detailLabel:`SLA restante: ${s}`}}function O(e,t){let a=$.PIPELINE_STAGE_ORDER.indexOf(e.stage);if($.PIPELINE_STAGE_ORDER.indexOf(t)<a)return{missing:[],isRegression:!0};let l=A[t]||[],r=[];for(let t of l){let a=e[t.field];null==a||""===a?r.push(t.label):"number"==typeof a&&a<=0&&r.push(t.label)}return{missing:r,isRegression:!1}}function B(e,t,a){return Math.min(Math.max(e,t),a)}function H(e,t,a){return e<t+96?-Math.ceil((1-B(e-t,0,96)/96)*22):e>a-96?Math.ceil((1-B(a-e,0,96)/96)*22):0}var V=e.i(41071),U=e.i(23934),Y=e.i(46897),q=e.i(40270),K=e.i(59208),X=e.i(87486),Q=e.i(46798);function G(e){let t=new Date(e),a=Math.floor(Math.max(0,new Date().getTime()-t.getTime())/36e5);if(a<1)return"<1h";if(a<24)return`${a}h`;let l=Math.floor(a/24);if(l<30)return`${l}d`;let r=Math.floor(l/30);return`${Math.max(1,r)}m`}function J({opportunity:e,temp:l,isDragging:r,isUpdating:n,isHighlighted:s,canMove:i=!0,canEdit:o=!0,canCreateActivity:u=!0,onOpen:m,onDragStart:p,onDragEnd:x,inlineFeedback:h,onTagClick:b}){var g,f;let{openDrawer:v,openModal:w}=(0,S.useUIStore)(),j=(0,a.useRef)(!1),N=F(e.slaDeadline),y=function(e){switch(e){case"ok":return{dot:"bg-status-success",border:"border-l-brand",text:"text-zinc-400"};case"near":return{dot:"bg-status-warning",border:"border-l-status-warning",text:"text-status-warning"};case"breached":return{dot:"bg-status-danger",border:"border-l-status-danger",text:"text-status-danger"}}}(N.status),k=(g=N.status,f=l.label,"breached"===g?{label:"Critica",className:"border-red-200 bg-red-50 text-red-700"}:"Quente"===f||e.value>=2e4?{label:"Alta",className:"border-amber-200 bg-amber-50 text-amber-700"}:{label:"Normal",className:"border-zinc-200 bg-zinc-50 text-zinc-600"}),z=e.tags[0]??"Sem segmento",M=(0,a.useCallback)(e=>{j.current=!0,p(e)},[p]),D=(0,a.useCallback)(()=>{setTimeout(()=>{j.current=!1},0),x()},[x]),E=(0,a.useCallback)(()=>{j.current||m()},[m]);return(0,t.jsxs)("div",{className:`group relative rounded-[22px] border border-zinc-200/90 border-l-[3px] ${y.border} bg-white p-4 shadow-[var(--shadow-bento-sm)] transition-all duration-300 hover:-translate-y-[1.5px] hover:shadow-[0_8px_24px_-10px_rgba(0,0,0,0.08)] focus-within:ring-2 focus-within:ring-brand/40 active:scale-[0.98] ${r?"cursor-grabbing shadow-[0_14px_30px_-18px_rgba(15,23,42,0.38)] scale-[1.02]":i?"cursor-grab":"cursor-pointer"} ${n?"opacity-60 saturate-50 pointer-events-none":""} ${s?"ring-2 ring-emerald-300/70":""}`,onClick:E,draggable:i,onDragStart:M,onDragEnd:D,tabIndex:0,role:"button","aria-roledescription":"card arrastavel","aria-label":`${e.title}, ${(0,$.formatCurrencyBRL)(e.value)}, prioridade ${k.label}`,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),m())},children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"min-w-0 flex-1 truncate font-heading text-[17px] font-semibold text-zinc-950",children:e.title}),(0,t.jsx)("span",{className:`inline-flex h-6 shrink-0 items-center rounded-full border px-2.5 text-[11px] font-semibold ${k.className}`,children:k.label}),(0,t.jsxs)(C.DropdownMenu,{children:[(0,t.jsx)(C.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-lg text-zinc-400 opacity-0 transition-opacity hover:bg-zinc-100 hover:text-zinc-600 group-hover:opacity-100 focus:opacity-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand",onClick:e=>e.stopPropagation(),onPointerDown:e=>e.stopPropagation(),"aria-label":"Acoes da oportunidade",children:(0,t.jsx)(V.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(C.DropdownMenuContent,{align:"end",className:"rounded-[var(--radius-bento-card)]",onClick:e=>e.stopPropagation(),onCloseAutoFocus:e=>e.preventDefault(),children:[(0,t.jsx)(C.DropdownMenuItem,{disabled:!o,onClick:e=>{e.stopPropagation(),m()},children:"Editar"}),(0,t.jsx)(C.DropdownMenuItem,{disabled:!u,onClick:t=>{t.stopPropagation(),v("new-activity",{opportunityId:e.id})},children:"Nova atividade"}),(0,t.jsx)(C.DropdownMenuSeparator,{}),(0,t.jsx)(C.DropdownMenuItem,{disabled:!o,className:"text-status-success",onClick:t=>{t.stopPropagation(),w("win-opportunity",{opportunityId:e.id})},children:"Marcar como Ganho"}),(0,t.jsx)(C.DropdownMenuItem,{disabled:!o,className:"text-status-danger",onClick:t=>{t.stopPropagation(),w("lose-opportunity",{opportunityId:e.id})},children:"Marcar como Perdido"})]})]})]}),(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between gap-2",children:[(0,t.jsx)("span",{className:"font-heading text-[20px] font-bold tracking-tight text-zinc-950",children:e.value>0?(0,$.formatCurrencyBRL)(e.value):"Sem valor"}),(0,t.jsxs)("span",{className:`inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[11px] font-semibold ${function(e){switch(e){case"Quente":return"border-red-200 bg-red-50 text-red-700";case"Morno":return"border-amber-200 bg-amber-50 text-amber-700";case"Frio":return"border-sky-200 bg-sky-50 text-sky-700";default:return"border-zinc-200 bg-zinc-50 text-zinc-600"}}(l.label)}`,children:[l.icon,l.label]})]}),(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between gap-2 text-[12px] text-zinc-600",children:[(0,t.jsxs)("span",{className:"inline-flex min-w-0 flex-1 items-center gap-1.5 truncate",children:[(0,t.jsx)(Y.MapPin,{className:"h-3.5 w-3.5 shrink-0 text-zinc-400"}),e.neighborhood||"Sem localizacao"]}),(0,t.jsxs)("span",{className:(0,T.cn)("inline-flex shrink-0 items-center gap-1 rounded-full border border-zinc-200 bg-zinc-50 px-2.5 py-1 text-[11px] font-medium text-zinc-600 transition-colors",b&&"Sem segmento"!==z&&"cursor-pointer hover:bg-zinc-100 hover:text-zinc-900"),onClick:e=>{b&&"Sem segmento"!==z&&(e.stopPropagation(),b(z))},children:[(0,t.jsx)(q.Tags,{className:"h-3 w-3"}),z]})]}),(0,t.jsxs)("div",{className:"mt-2.5 grid grid-cols-2 gap-2 text-[11px] text-zinc-500",children:[(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,t.jsx)(U.Clock3,{className:"h-3.5 w-3.5 shrink-0 text-zinc-400"}),"Ultima atividade ",G(e.updatedAt)]}),(0,t.jsxs)("span",{className:"inline-flex items-center justify-end gap-1.5 text-right",children:[(0,t.jsx)(K.CalendarClock,{className:"h-3.5 w-3.5 shrink-0 text-zinc-400"}),"No pipeline ha ",G(e.createdAt)]})]}),(0,t.jsxs)("div",{className:"mt-2.5 flex items-center justify-between gap-2",children:[(0,t.jsxs)("span",{className:`inline-flex min-w-0 items-center gap-1.5 rounded-full border px-2.5 py-1 text-[11px] font-semibold ${"breached"===N.status?"border-red-200 bg-red-50 text-red-700":"near"===N.status?"border-amber-200 bg-amber-50 text-amber-700":"border-zinc-200 bg-zinc-50 text-zinc-600"}`,children:["breached"===N.status?(0,t.jsx)(c.AlertTriangle,{className:"h-3.5 w-3.5"}):(0,t.jsx)(U.Clock3,{className:"h-3.5 w-3.5"}),"breached"===N.status?"Estourado":`SLA ${N.label||"ok"}`]}),(0,t.jsxs)(Q.Tooltip,{children:[(0,t.jsx)(Q.TooltipTrigger,{asChild:!0,children:(0,t.jsx)("span",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-zinc-900 font-heading text-[10px] font-semibold text-white",children:e.responsibleName.split(" ").filter(Boolean).map(e=>e[0]).slice(0,2).join("").toUpperCase()})}),(0,t.jsx)(Q.TooltipContent,{children:e.responsibleName})]})]}),e.tags.length>0&&(0,t.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-1.5",children:[e.tags.slice(0,2).map((e,a)=>(0,t.jsx)(X.Badge,{variant:"secondary",className:(0,T.cn)("shrink-0 rounded-full border border-zinc-200 bg-zinc-50 px-2 py-0.5 font-body text-[10px] text-zinc-600 transition-colors",b&&"cursor-pointer hover:bg-zinc-100 hover:text-zinc-900"),onClick:t=>{b&&(t.stopPropagation(),b(e))},children:e},a)),e.tags.length>2&&(0,t.jsxs)(Q.Tooltip,{children:[(0,t.jsx)(Q.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(X.Badge,{variant:"secondary",className:"shrink-0 rounded-full border border-zinc-200 bg-zinc-50 px-2 py-0.5 font-body text-[10px] text-zinc-600",children:["+",e.tags.length-2]})}),(0,t.jsx)(Q.TooltipContent,{children:e.tags.slice(2).join(", ")})]})]}),h?(0,t.jsx)("div",{className:`mt-3 rounded-xl border px-2.5 py-2 text-[11px] ${"error"===h.tone?"border-red-200 bg-red-50 text-red-700":"warning"===h.tone?"border-amber-200 bg-amber-50 text-amber-700":"border-emerald-200 bg-emerald-50 text-emerald-700"}`,role:"error"===h.tone?"alert":"status",children:(0,t.jsxs)("div",{className:"flex items-start gap-1.5",children:["success"===h.tone?(0,t.jsx)(d.CheckCircle2,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}):(0,t.jsx)(c.AlertTriangle,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{children:h.message}),h.actionLabel&&h.onAction?(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),h.onAction?.()},className:"mt-1 font-semibold underline underline-offset-2",children:h.actionLabel}):null]})]})}):null,(0,t.jsx)("span",{className:"sr-only",children:N.detailLabel})]})}var W=e.i(2747);function Z({stageCount:e}){return(0,t.jsxs)("div",{className:"flex h-[calc(100vh-64px)] flex-col overflow-hidden",children:[(0,t.jsx)("div",{className:"shrink-0 space-y-3 pb-4",children:(0,t.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(W.Skeleton,{className:"h-7 w-52"}),(0,t.jsx)(W.Skeleton,{className:"h-4 w-72"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(W.Skeleton,{className:"h-9 w-[180px] rounded-full"}),(0,t.jsx)(W.Skeleton,{className:"h-9 w-20 rounded-full"}),(0,t.jsx)(W.Skeleton,{className:"h-9 w-16 rounded-full"}),(0,t.jsx)(W.Skeleton,{className:"h-9 w-28 rounded-full"})]})]})}),(0,t.jsx)("div",{className:"flex flex-1 gap-3 overflow-hidden px-7 pb-2",children:Array.from({length:e}).map((e,a)=>(0,t.jsxs)("div",{className:"flex w-[320px] shrink-0 flex-col rounded-[var(--radius-bento-card)] bg-zinc-50/80 p-3",children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(W.Skeleton,{className:"h-2.5 w-2.5 rounded-full"}),(0,t.jsx)(W.Skeleton,{className:"h-4 w-24"}),(0,t.jsx)(W.Skeleton,{className:"h-4 w-6 rounded-md"})]}),(0,t.jsx)(W.Skeleton,{className:"h-4 w-16"})]}),Array.from({length:2-a%2}).map((e,a)=>(0,t.jsxs)("div",{className:"mb-2 rounded-[var(--radius-bento-card)] border border-zinc-200 bg-white p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(W.Skeleton,{className:"h-4 w-32"}),(0,t.jsx)(W.Skeleton,{className:"h-4 w-4 rounded"})]}),(0,t.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,t.jsx)(W.Skeleton,{className:"h-3 w-28"}),(0,t.jsx)(W.Skeleton,{className:"h-6 w-6 rounded-full"})]}),(0,t.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,t.jsx)(W.Skeleton,{className:"h-4 w-20"}),(0,t.jsx)(W.Skeleton,{className:"h-3 w-12"})]})]},a))]},a))})]})}var ee=e.i(34682);let et="flow:filters-applied",ea={"lead-in":9,"contato-feito":8,"reuniao-agendada":7,"proposta-enviada":7,negociacao:6,fechamento:5};function el(e){return new Date(e.updatedAt).getTime()<Date.now()-432e6}function er(){return{responsible:[],stage:[],temperature:[],tags:[],dateStart:"",dateEnd:"",valueMin:"",valueMax:"",overdue:!1,stale:!1,risk:!1}}function en(e){return e.replace(/-/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function es(){let{openDrawer:e,openModal:s}=(0,S.useUIStore)(),{user:E,permissions:I}=(0,z.useAuthStore)(),A=(0,M.useOpportunityStore)(e=>e.opportunities),V=(0,M.useOpportunityStore)(e=>e.replaceOpportunities),U=(0,j.useRouter)(),Y=(0,j.useSearchParams)(),q=E?.id??null,K=I?.canCreateOpportunity??!1,X=I?.canEditOpportunity??!1,Q=I?.canCreateActivity??!1,G=I?.canManageSettings??!1,W=I?.canViewAllUnits??!1,[es,ei]=(0,a.useState)("comercial"),[eo,ed]=(0,a.useState)(null),[ec,eu]=(0,a.useState)(null),em=(0,a.useMemo)(()=>{let e=A.filter(e=>"open"===e.status);return W||!q?e:e.filter(e=>e.responsibleId===q)},[W,A,q]);(0,a.useEffect)(()=>{let e=Y.get("opportunityId");if(!e)return;let t=em.find(t=>t.id===e),a=null;t?s("lead-card",{id:e,opportunitySnapshot:t}):a=window.setTimeout(()=>{eu({tone:"error",message:"Não foi possível abrir o card. Oportunidade não encontrada no escopo atual."})},0);let l=new URLSearchParams(Y.toString());l.delete("opportunityId");let r=l.toString();return U.replace(r?`/pipes?${r}`:"/pipes",{scroll:!1}),()=>{a&&window.clearTimeout(a)}},[s,em,U,Y]);let[ep,ex]=(0,a.useState)(!0),[eh,eb]=(0,a.useState)(""),[eg,ef]=(0,a.useState)(""),[ev,ew]=(0,a.useState)(!1),[ej,eN]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=Y.get("filter")??Y.get("filters");if(!e)return;let t=e.split(",").map(e=>e.trim()).filter(Boolean),a=window.requestAnimationFrame(()=>{eN(e=>{let a=e??er(),l={...a,overdue:!1,stale:!1,risk:!1};for(let e of t)"sla_overdue"===e&&(l.overdue=!0),("sla_risk"===e||"risk"===e)&&(l.risk=!0),("stale"===e||"stalled"===e||"no_activity"===e)&&(l.stale=!0);return a.overdue===l.overdue&&a.stale===l.stale&&!!a.risk==!!l.risk?e??l:l})});return()=>window.cancelAnimationFrame(a)},[Y]);let ey=(0,a.useRef)(null),ek=(0,a.useRef)(null),eC=(0,a.useRef)(null),eS=R.find(e=>e.id===es)??R[0],ez=(0,a.useMemo)(()=>eS.stages.map(e=>e.id),[eS]),eM=(0,a.useMemo)(()=>{let e=Y.get("stage")??Y.get("stageId");return e&&ez.includes(e)?e:null},[Y,ez]),e$=(0,a.useMemo)(()=>eM?eS.stages.filter(e=>e.id===eM):eS.stages,[eS,eM]),eD=(0,a.useMemo)(()=>eM?[eM]:ez,[eM,ez]),eT=(0,a.useCallback)(e=>{let t="function"==typeof e?e(em):e,a=new Set(em.map(e=>e.id)),l=new Map(t.map(e=>[e.id,e])),r=A.map(e=>a.has(e.id)?l.get(e.id)??e:e);for(let e of t)A.some(t=>t.id===e.id)||r.push(e);V(r)},[em,V,A]),eE=(0,a.useCallback)(e=>{eC.current&&(eC.current.textContent=e)},[]);(0,a.useEffect)(()=>{let e=window.setTimeout(()=>ex(!1),600);return()=>window.clearTimeout(e)},[]),(0,a.useEffect)(()=>{let e=e=>{if(e.detail?.context!=="pipes")return;e.detail?.filters&&eN(e.detail.filters);let t=Number(e.detail?.count??0);Number.isFinite(t)&&t>=0&&eu({tone:"success",message:t>0?`${t} filtro(s) aplicado(s) no pipeline.`:"Filtros aplicados. Nenhum critério ativo."})};return window.addEventListener(et,e),()=>window.removeEventListener(et,e)},[]),(0,a.useEffect)(()=>{if(!ec)return;let e=window.setTimeout(()=>eu(null),2200);return()=>window.clearTimeout(e)},[ec]),(0,a.useEffect)(()=>{let e=window.setTimeout(()=>{eb(eg)},250);return()=>window.clearTimeout(e)},[eg]);let eI=(0,a.useMemo)(()=>eh.toLowerCase().trim(),[eh]),eR=(0,a.useMemo)(()=>em.filter(e=>eD.includes(e.stage)),[eD,em]),eA=(0,a.useMemo)(()=>0===eR.length?1e4:eR.reduce((e,t)=>e+t.value,0)/eR.length,[eR]),eL=(0,a.useCallback)(e=>(0,$.calculateTemperature)(e,eA),[eA]),eP=(0,a.useCallback)(e=>L[eL(e)],[eL]),e_=(0,a.useMemo)(()=>{let e={"lead-in":[],"contato-feito":[],"reuniao-agendada":[],"proposta-enviada":[],negociacao:[],fechamento:[]};for(let t of em){if(!eD.includes(t.stage))continue;if(eI){let e=t.title.toLowerCase().includes(eI)||t.clientName.toLowerCase().includes(eI)||t.tags.some(e=>e.toLowerCase().includes(eI)),a=eI.replace(/\D/g,""),l=a.length>0&&String(t.value).includes(a);if(!e&&!l)continue}let a=eL(t);if(ej){if(ej.temperature?.length>0&&!ej.temperature.includes(a)||ej.responsible?.length>0&&!ej.responsible.includes(t.responsibleId)||ej.tags?.length>0&&!ej.tags.some(e=>t.tags.includes(e))||ej.overdue&&"breached"!==F(t.slaDeadline).status||ej.risk&&!function(e){if(!e.slaDeadline)return!1;let t=(new Date(e.slaDeadline).getTime()-Date.now())/36e5;return t>0&&t<=24}(t)||ej.stale&&!el(t)||ej.stage?.length>0&&!ej.stage.includes(t.stage))continue;let e=(t.expectedCloseDate??t.updatedAt).slice(0,10);if(ej.dateStart&&e<ej.dateStart||ej.dateEnd&&e>ej.dateEnd)continue;let l=Number(ej.valueMin||0);if(Number.isFinite(l)&&l>0&&t.value<l)continue;let r=Number(ej.valueMax||0);if(Number.isFinite(r)&&r>0&&t.value>r)continue}e[t.stage].push(t)}return e},[em,eD,eI,eL,ej]),eF=(0,a.useMemo)(()=>{let e=Object.values(e_).flat();return{totalCards:e.length,boardTotal:e.reduce((e,t)=>e+t.value,0),overdueCards:e.filter(e=>"breached"===F(e.slaDeadline).status).length,staleCards:e.filter(e=>el(e)).length}},[e_]),eO=(0,a.useMemo)(()=>ej?ej.responsible.length+ej.stage.length+ej.temperature.length+ej.tags.length+ +!!ej.dateStart+ +!!ej.dateEnd+ +!!ej.valueMin+ +!!ej.valueMax+ +!!ej.overdue+ +!!ej.stale+ +!!ej.risk+ +!!eM:+!!eM,[ej,eM]),eB=(0,a.useCallback)(()=>{ef(""),eb(""),ew(!1)},[]),eH=(0,a.useCallback)(e=>{let t=new URLSearchParams(Y.toString());"all"===e?t.delete("stage"):t.set("stage",e),t.delete("stageId");let a=t.toString();U.replace(a?`/pipes?${a}`:"/pipes",{scroll:!1})},[U,Y]),eV=(0,a.useCallback)(()=>{eN(null),eu({tone:"info",message:"Filtros do pipeline limpos."}),window.dispatchEvent(new CustomEvent("flow:filters-clear",{detail:{context:"pipes"}})),ef(""),eb(""),ew(!1);let e=new URLSearchParams(Y.toString());e.delete("filter"),e.delete("filters"),e.delete("stage"),e.delete("stageId");let t=e.toString();U.replace(t?`/pipes?${t}`:"/pipes",{scroll:!1})},[U,Y]),eU=(0,a.useCallback)(e=>{eN(t=>{let a=t??er(),l={...a,[e]:!a[e]};return window.dispatchEvent(new CustomEvent("flow:filters-update",{detail:{context:"pipes",filters:l}})),l})},[]),eY=(0,a.useCallback)(e=>{ei(e),eg&&eB(),eH("all")},[eB,eg,eH]),eq=(0,a.useMemo)(()=>[{id:"pipeline-total",label:`Pipeline: ${(0,$.formatCurrencyBRL)(eF.boardTotal)}`,icon:(0,t.jsx)(u.CircleDollarSign,{className:"h-3.5 w-3.5"}),tone:"info"},{id:"stages-visible",label:`Etapas: ${e$.length}`,icon:(0,t.jsx)(m,{className:"h-3.5 w-3.5"}),tone:"neutral"},{id:"cards-total",label:`Cards: ${eF.totalCards}`,icon:(0,t.jsx)(r.Filter,{className:"h-3.5 w-3.5"}),tone:"neutral"},{id:"cards-overdue",label:`Estourados: ${eF.overdueCards}`,icon:(0,t.jsx)(g.Flame,{className:"h-3.5 w-3.5"}),tone:ej?.overdue?"danger":"neutral",onClick:()=>eU("overdue")},{id:"cards-stale",label:`Sem atividade: ${eF.staleCards}`,icon:(0,t.jsx)(f.TimerReset,{className:"h-3.5 w-3.5"}),tone:ej?.stale?"warning":"neutral",onClick:()=>eU("stale")}],[eF.boardTotal,eF.overdueCards,eF.staleCards,eF.totalCards,e$.length,ej,eU]),eK=(0,a.useMemo)(()=>{let e=[];if(ej){let t=e=>{eN(e),window.dispatchEvent(new CustomEvent("flow:filters-update",{detail:{context:"pipes",filters:e}}))};if(ej.temperature?.length>0&&e.push({id:"temp",label:`Temperatura: ${ej.temperature.map(e=>"hot"===e?"Quente":"warm"===e?"Morna":"Fria").join(", ")}`,onRemove:()=>t({...ej,temperature:[]})}),ej.responsible?.length>0&&e.push({id:"owner",label:`Donos: ${ej.responsible.length}`,onRemove:()=>t({...ej,responsible:[]})}),ej.tags?.length>0&&e.push({id:"segment",label:`Tags: ${ej.tags.join(", ")}`,onRemove:()=>t({...ej,tags:[]})}),ej.stage?.length>0&&e.push({id:"stage-filters",label:`Etapas: ${ej.stage.length}`,onRemove:()=>t({...ej,stage:[]})}),(ej.dateStart||ej.dateEnd)&&e.push({id:"period",label:`Periodo: ${ej.dateStart||"..."} ate ${ej.dateEnd||"..."}`,onRemove:()=>t({...ej,dateStart:"",dateEnd:""})}),ej.valueMin||ej.valueMax){let a=ej.valueMin?(0,$.formatCurrencyBRL)(Number(ej.valueMin)):"...",l=ej.valueMax?(0,$.formatCurrencyBRL)(Number(ej.valueMax)):"...";e.push({id:"value-range",label:`Valor: ${a} ate ${l}`,onRemove:()=>t({...ej,valueMin:"",valueMax:""})})}ej.overdue&&e.push({id:"overdue",label:"Somente estourados",onRemove:()=>t({...ej,overdue:!1})}),ej.risk&&e.push({id:"risk",label:"Somente em risco",onRemove:()=>t({...ej,risk:!1})}),ej.stale&&e.push({id:"stale",label:"Somente sem atividade",onRemove:()=>t({...ej,stale:!1})})}return eM&&e.push({id:"stage",label:`Etapa: ${eS.stages.find(e=>e.id===eM)?.label??en(eM)}`,onRemove:()=>eH("all")}),e},[ej,eM,eS.stages,eH]);(0,a.useEffect)(()=>{if(!eI)return;let e=Object.values(e_).reduce((e,t)=>e+t.length,0);eE(`${e} cards encontrados para "${eh}"`)},[eE,eI,e_,eh]);let{draggingCardId:eX,draggingOpportunity:eQ,dragOverStage:eG,dropIndicator:eJ,columnError:eW,setColumnError:eZ,successFeedback:e0,updatingCardId:e1,recentlyMovedCardId:e2,handleDragStart:e5,handleDragOver:e3,handleDragLeave:e4,handleDrop:e7,handleDragEnd:e6}=function({localOpportunities:e,setLocalOpportunities:t,activeFunnel:l,announce:r,canMoveCards:n=!0}){let[s,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[c,u]=(0,a.useState)(null),[m,p]=(0,a.useState)(null),[x,h]=(0,a.useState)(null),[b,g]=(0,a.useState)(null),[f,v]=(0,a.useState)(null),[w,j]=(0,a.useState)(null),[N,y]=(0,a.useState)(null),k=(0,a.useRef)(null),C=(0,a.useRef)(null),S=(0,a.useRef)([]),z=(0,a.useRef)(null),M=(0,a.useCallback)(()=>{null!==C.current&&(window.cancelAnimationFrame(C.current),C.current=null),z.current=null},[]),D=(0,a.useCallback)((e,t)=>{let a=window.setTimeout(()=>{S.current=S.current.filter(e=>e!==a),e()},t);S.current.push(a)},[]),T=(0,a.useCallback)(()=>{let e=()=>{let t=z.current;if(!t){C.current=null;return}let{clientX:a,clientY:l,horizontalContainer:r,verticalContainer:n}=t,s=!1;if(n){let e=n.getBoundingClientRect(),t=H(l,e.top,e.bottom);0!==t&&(n.scrollTop+=t,s=!0)}if(r){let e=r.getBoundingClientRect(),t=H(a,e.left,e.right);0!==t&&(r.scrollLeft+=t,s=!0)}if(s||null!==z.current){C.current=window.requestAnimationFrame(e);return}C.current=null};e()},[]);(0,a.useEffect)(()=>()=>{M(),S.current.forEach(e=>window.clearTimeout(e)),S.current=[]},[M]);let E=(0,a.useCallback)((e,t)=>{if(!n){e.preventDefault(),r("Voce nao tem permissao para mover oportunidades.");return}i(t.id),d(t.stage),u(t),k.current=t,z.current=null,e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",t.id),document.body.style.cursor="grabbing",r(`Arrastando card ${t.title}. Solte em uma etapa para mover.`)},[r,n]),I=(0,a.useCallback)((e,t)=>{if(!n)return;e.preventDefault(),e.dataTransfer.dropEffect="move",p(t);let a=e.currentTarget.querySelectorAll("[data-card-index]"),l=a.length;for(let t=0;t<a.length;t++){let r=a[t].getBoundingClientRect(),n=r.top+r.height/2;if(e.clientY<n){l=t;break}}h({stage:t,index:l});let r=e.currentTarget,s=r.closest("[data-pipe-column-scroll]"),i=r.closest("[data-pipe-board-scroll]");z.current={clientX:e.clientX,clientY:e.clientY,horizontalContainer:i,verticalContainer:s},null===C.current&&(C.current=window.requestAnimationFrame(T))},[n,T]),R=(0,a.useCallback)(e=>{let t=e.relatedTarget;t&&!e.currentTarget.contains(t)&&(p(null),h(null))},[]),A=(0,a.useCallback)((a,s)=>{if(!n){a.preventDefault(),r("Voce nao tem permissao para mover oportunidades.");return}a.preventDefault(),p(null),h(null),g(null),document.body.style.cursor="",M();let o=k.current;if(o){j(o.id);try{let a=l.stages.map(e=>e.id),n=e.filter(e=>e.stage===o.stage).findIndex(e=>e.id===o.id),c=x?.stage===s?x.index:e.filter(e=>e.stage===s).length;if(o.stage===s&&n>-1&&n<c&&(c-=1),o.stage===s&&n>-1&&c===n){i(null),d(null),k.current=null,j(null);return}let{missing:m,isRegression:p}=O(o,s),h=l.stages.find(e=>e.id===s),b=h?.label??s.replace(/-/g," ");if(m.length>0){g({stage:s,tone:"error",cardId:o.id,missingFields:m,targetStage:s,message:`Para mover para ${b}, preencha: ${m.join(", ")}.`}),r(`Aviso: campos pendentes — ${m.join(", ")}`),i(null),d(null),u(null),k.current=null,j(null),D(()=>g(null),4200);return}if(p){let e=l.stages.find(e=>e.id===o.stage)?.label??o.stage;g({stage:s,tone:"warning",message:`Card retrocedido de ${e} para ${b}`}),r(`Aviso: card retrocedido de ${e} para ${b}`),D(()=>g(null),4e3)}let f=h?(0,$.calculateSlaDeadline)(h.slaHours):void 0;t(e=>{let t=e.findIndex(e=>e.id===o.id);if(-1===t)return e;let l=e[t],r=e.filter(e=>e.id!==l.id),n=r.filter(e=>e.stage===s),i=B(c,0,n.length),d={...l,stage:s,updatedAt:new Date().toISOString(),slaDeadline:f},u=r.length;if(0===n.length)u=function(e,t,a){let l=a.indexOf(t);if(-1===l)return e.length;for(let t=l-1;t>=0;t-=1){let l=a[t];for(let t=e.length-1;t>=0;t-=1)if(e[t].stage===l)return t+1}for(let t=l+1;t<a.length;t+=1){let l=a[t],r=e.findIndex(e=>e.stage===l);if(-1!==r)return r}return e.length}(r,s,a);else if(i>=n.length){let e=n[n.length-1].id,t=r.findIndex(t=>t.id===e);u=-1===t?r.length:t+1}else{let e=n[i].id,t=r.findIndex(t=>t.id===e);u=-1===t?r.length:t}let m=[...r];return m.splice(u,0,d),m}),o.stage===s?(v({stage:s,message:`${o.title} reordenado na etapa.`,cardId:o.id}),r(`Card ${o.title} reordenado dentro da etapa.`),D(()=>v(null),1800)):p?(v({stage:s,message:`${o.title} retrocedido para ${b}.`,cardId:o.id}),D(()=>v(null),2300)):(v({stage:s,message:`${o.title} movido para ${b} agora.`,cardId:o.id}),r(`Card ${o.title} movido com sucesso para ${b}`),D(()=>v(null),2500)),y(o.id),D(()=>y(e=>e===o.id?null:e),2600),D(()=>j(e=>e===o.id?null:e),850)}finally{i(null),d(null),u(null),k.current=null,document.body.style.cursor=""}}},[l,r,n,x,e,D,t,M]);return{draggingCardId:s,draggingCardStage:o,draggingOpportunity:c,dragOverStage:m,dropIndicator:x,columnError:b,setColumnError:g,successFeedback:f,updatingCardId:w,recentlyMovedCardId:N,handleDragStart:E,handleDragOver:I,handleDragLeave:R,handleDrop:A,handleDragEnd:(0,a.useCallback)(()=>{i(null),d(null),u(null),p(null),h(null),k.current=null,document.body.style.cursor="",M()},[M])}}({localOpportunities:em,setLocalOpportunities:eT,activeFunnel:eS,announce:eE,canMoveCards:X}),{stageCustomizations:e8,renamingStage:e9,renameValue:te,renameError:tt,setRenameValue:ta,renameInputRef:tl,startRename:tr,confirmRename:tn,cancelRename:ts,setStageColor:ti,getStageColor:to}=function(){let[e,t]=(0,a.useState)(()=>(function(){try{let e=localStorage.getItem(_);return e?JSON.parse(e):{}}catch{try{localStorage.removeItem(_)}catch{}return{}}})()),[l,r]=(0,a.useState)(null),[n,s]=(0,a.useState)(""),[i,o]=(0,a.useState)(null),d=(0,a.useRef)(null);(0,a.useEffect)(()=>{try{localStorage.setItem(_,JSON.stringify(e))}catch{}},[e]);let c=(0,a.useCallback)((e,t)=>{r(e),s(t),o(null),setTimeout(()=>d.current?.focus(),50)},[]),u=(0,a.useCallback)(()=>{if(!l)return;let e=n.trim();if(e.length<2){o(`M\xednimo 2 caracteres`),d.current?.focus();return}if(e.length>30){o(`M\xe1ximo 30 caracteres`),d.current?.focus();return}t(t=>({...t,[l]:{...t[l],label:e}})),r(null),s(""),o(null)},[l,n]),m=(0,a.useCallback)(()=>{r(null),s(""),o(null)},[]),p=(0,a.useCallback)((e,a)=>{t(t=>({...t,[e]:{...t[e],colorId:a}}))},[]),x=(0,a.useCallback)(t=>{let a=e[t]?.colorId||"default";return P.find(e=>e.id===a)??P[0]},[e]);return{stageCustomizations:e,renamingStage:l,renameValue:n,renameError:i,setRenameValue:s,renameInputRef:d,startRename:c,confirmRename:u,cancelRename:m,setStageColor:p,getStageColor:x}}(),td=(0,a.useCallback)(e=>{if(!eQ||eG!==e)return null;let t=eS.stages.find(t=>t.id===e)?.label??en(e),a=O(eQ,e);if(a.missing.length>0)return{tone:"error",message:`Bloqueado: faltam ${a.missing.join(", ")} para mover para ${t}.`};if(a.isRegression)return{tone:"warning",message:`Retrocesso detectado. Solte para mover para ${t}.`};let l=e_[e]||[],r=ea[e]??7,n=eQ.stage!==e?l.length+1:l.length;return n>r?{tone:"warning",message:`WIP excedido (${n}/${r}). Solte para mover para ${t}.`}:{tone:"success",message:`Solte para mover para ${t}.`}},[eS.stages,eG,eQ,e_]),tc=(0,a.useCallback)(()=>{if(!eW?.cardId)return;let e=em.find(e=>e.id===eW.cardId);s("lead-card",{id:eW.cardId,focusFields:eW.missingFields,pendingStage:eW.targetStage,initialTab:"empresa",opportunitySnapshot:e})},[eW,s,em]);return((0,a.useEffect)(()=>{function e(e){if((e.metaKey||e.ctrlKey)&&"k"===e.key.toLowerCase()){e.preventDefault(),window.setTimeout(()=>ey.current?.focus(),50);return}"Escape"===e.key&&(ew(!1),ey.current?.blur(),ek.current?.blur())}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,a.useEffect)(()=>{if(!ev)return;let e=window.setTimeout(()=>{ek.current?.focus()},50);return()=>window.clearTimeout(e)},[ev]),ep)?(0,t.jsx)(Z,{stageCount:e$.length}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{ref:eC,role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only"}),(0,t.jsxs)(w.motion.div,{initial:"hidden",animate:"show",variants:D.screenContainer,className:"flex h-[calc(100dvh-2rem)] min-h-0 w-full max-w-full flex-col gap-4",children:[(0,t.jsx)(w.motion.div,{variants:D.sectionEnter,className:"shrink-0",children:(0,t.jsx)(ee.ModuleCommandHeader,{title:eS.label,titleAccessory:(0,t.jsxs)(C.DropdownMenu,{children:[(0,t.jsx)(C.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)("button",{type:"button","aria-label":"Trocar funil",className:"premium-shine inline-flex h-8 w-8 items-center justify-center rounded-full border border-zinc-200 bg-white/90 text-zinc-500 transition-all duration-120 hover:-translate-y-px hover:bg-zinc-100 hover:text-zinc-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300",children:(0,t.jsx)(p.ChevronDown,{className:"h-4 w-4"})})}),(0,t.jsxs)(C.DropdownMenuContent,{align:"start",className:"w-[270px] rounded-[16px] border-zinc-200 bg-white/95 p-1.5 shadow-[0_18px_30px_-24px_rgba(15,23,42,0.45)]",children:[(0,t.jsxs)("div",{className:"px-2.5 pb-2 pt-1.5",children:[(0,t.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-[0.08em] text-zinc-500",children:"Selecionar funil"}),(0,t.jsx)("p",{className:"mt-0.5 text-xs text-zinc-500",children:"Troque o contexto do board e mantenha o foco operacional."})]}),R.map(e=>(0,t.jsxs)(C.DropdownMenuItem,{onClick:()=>eY(e.id),className:"h-9 rounded-xl px-2.5 font-medium text-zinc-700",children:[(0,t.jsx)("span",{className:"truncate",children:e.label}),e.id===es?(0,t.jsx)(o.Check,{className:"h-3.5 w-3.5 text-brand"}):null]},e.id))]})]}),description:"Mesa de controle do pipeline comercial com prioridade operacional clara.",chips:eq,actionsClassName:"gap-2.5 p-2",actions:[(0,t.jsxs)("div",{className:"relative hidden w-[min(38vw,360px)] md:block",children:[(0,t.jsx)(l.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-zinc-400"}),(0,t.jsx)(y.Input,{ref:ey,value:eg,onChange:e=>ef(e.target.value),placeholder:"Buscar atividade, cliente, valor ou segmento",className:"h-10 rounded-full border-zinc-200 pl-9 pr-16 font-body text-sm"}),(0,t.jsx)("span",{className:"pointer-events-none absolute right-8 top-1/2 hidden -translate-y-1/2 rounded-md border border-zinc-200 bg-zinc-50 px-1.5 py-0.5 text-[10px] font-medium text-zinc-500 lg:inline-flex",children:"Ctrl K"}),eg?(0,t.jsx)("button",{type:"button",onClick:eB,className:"absolute right-2.5 top-1/2 -translate-y-1/2 rounded-full p-1 text-zinc-400 transition-colors hover:bg-zinc-100 hover:text-zinc-600","aria-label":"Limpar busca",children:(0,t.jsx)(n.X,{className:"h-3.5 w-3.5"})}):null]},"search"),(0,t.jsxs)(k.Popover,{open:ev,onOpenChange:ew,children:[(0,t.jsx)(k.PopoverTrigger,{asChild:!0,children:(0,t.jsx)(N.Button,{variant:"outline",size:"sm",className:"h-10 rounded-full px-3 md:hidden",children:(0,t.jsx)(l.Search,{className:"h-3.5 w-3.5"})})}),(0,t.jsx)(k.PopoverContent,{align:"end",side:"bottom",sideOffset:8,className:"w-[min(92vw,360px)] rounded-[16px] border-zinc-200 bg-white p-2",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(l.Search,{className:"absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-zinc-400"}),(0,t.jsx)(y.Input,{ref:ek,value:eg,onChange:e=>ef(e.target.value),placeholder:"Buscar cards...",className:"h-10 w-full rounded-full pl-8 pr-8 font-body text-sm"}),eg?(0,t.jsx)("button",{type:"button",onClick:eB,className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600","aria-label":"Limpar busca",children:(0,t.jsx)(n.X,{className:"h-3.5 w-3.5"})}):null]})})]},"mobile-search"),(0,t.jsxs)(N.Button,{variant:"outline",size:"sm",className:"h-10 rounded-full px-4",onClick:()=>e("filters"),children:[(0,t.jsx)(r.Filter,{className:"h-4 w-4"}),"Filtros",eO>0?(0,t.jsx)("span",{className:"ml-1.5 flex h-5 w-5 items-center justify-center rounded-[7px] bg-zinc-100 text-[10px] font-bold text-zinc-900 border border-zinc-200",children:eO}):null]},"filters"),(0,t.jsxs)(C.DropdownMenu,{children:[(0,t.jsx)(C.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(N.Button,{size:"sm",className:"h-10 rounded-full px-5",disabled:!K,children:[(0,t.jsx)(h.Plus,{className:"h-4 w-4"}),"Novo"]})}),(0,t.jsxs)(C.DropdownMenuContent,{align:"end",className:"w-[220px] rounded-[16px]",children:[(0,t.jsxs)(C.DropdownMenuItem,{onClick:()=>e("new-opportunity"),disabled:!K,children:[(0,t.jsx)(h.Plus,{className:"h-4 w-4"}),"Novo card"]}),(0,t.jsxs)(C.DropdownMenuItem,{onClick:()=>e("new-opportunity",{source:"captura-rapida"}),disabled:!K,children:[(0,t.jsx)(b.Sparkles,{className:"h-4 w-4"}),"Capturar lead"]})]})]},"new-card")],children:eK.length>0?(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",role:"group","aria-label":"Filtros ativos",children:[eK.map(e=>(0,t.jsxs)("span",{className:"inline-flex h-[28px] items-center gap-1 rounded-full border border-zinc-200/80 bg-white/70 pl-2.5 pr-1 text-[11.5px] font-medium text-zinc-700 shadow-(--shadow-premium-soft)",children:[(0,t.jsx)("span",{className:"truncate max-w-[140px] sm:max-w-[200px]",children:e.label}),(0,t.jsx)("button",{type:"button",onClick:e.onRemove,className:"ml-1 flex h-5 w-5 shrink-0 items-center justify-center rounded-full text-zinc-400 transition-colors hover:bg-zinc-200 hover:text-zinc-900 focus:outline-none","aria-label":`Remover filtro ${e.label}`,children:(0,t.jsx)(n.X,{className:"h-3 w-3"})})]},e.id)),(0,t.jsx)("button",{type:"button",onClick:eV,className:"ml-2 flex h-[26px] items-center justify-center text-[11.5px] font-semibold text-zinc-500 underline decoration-zinc-300 underline-offset-2 transition-colors hover:text-zinc-900",children:"Limpar tudo"})]}):null})}),ec?(0,t.jsx)("div",{className:(0,T.cn)("shrink-0 rounded-[14px] border px-3.5 py-2 text-xs font-medium","error"===ec.tone?"border-red-200 bg-red-50 text-red-700":"info"===ec.tone?"border-sky-200 bg-sky-50 text-sky-700":"border-emerald-200 bg-emerald-50 text-emerald-700"),role:"status",children:ec.message}):null,(0,t.jsxs)("div",{className:"premium-ambient premium-grain relative flex min-h-0 min-w-0 flex-1 flex-col overflow-hidden rounded-[22px] border border-zinc-200/70 bg-white/72 p-3 shadow-(--shadow-premium-soft) backdrop-blur-sm md:p-4",role:"region","aria-label":"Pipeline de vendas arrastavel",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between px-1 text-[11px] text-zinc-500 md:hidden",children:[(0,t.jsx)("span",{children:"Deslize para ver as etapas"}),(0,t.jsxs)("span",{children:[e$.length," colunas"]})]}),(0,t.jsx)("div",{"data-pipe-board-scroll":!0,className:"flex min-w-0 flex-1 gap-4 overflow-x-auto scroll-smooth px-1 pb-1 md:gap-5 md:px-2",style:{scrollSnapType:"x proximity"},children:e$.map((a,l)=>{let r,u,m=!!eI||eO>0,p=e_[a.id]||[],b=e8[a.id]?.label||a.label,g=to(a.id),f=p.reduce((e,t)=>e+t.value,0),j=eG===a.id,y=eW?.stage===a.id?eW:null,C=e0?.stage===a.id?e0:null,S=td(a.id),z=p.filter(e=>"breached"===F(e.slaDeadline).status).length,M=ea[a.id]??7,E=p.length>M;return(0,t.jsxs)(w.motion.div,{custom:l,variants:D.listItemReveal,className:(0,T.cn)("group/col flex w-[min(88vw,372px)] shrink-0 flex-col rounded-[22px] border transition-all duration-200 sm:w-[352px]",j?"border-brand/70 bg-brand/5 ring-2 ring-brand/26 shadow-[0_18px_30px_-22px_rgba(37,99,235,0.52)]":"border-zinc-200/80 bg-white/88"),style:{scrollSnapAlign:"start"},onDragOver:e=>e3(e,a.id),onDragLeave:e4,onDrop:e=>e7(e,a.id),role:"list","aria-label":`Etapa ${b}, ${p.length} cards, total ${(0,$.formatCurrencyBRL)(f)}`,children:[(0,t.jsxs)("div",{className:"sticky top-0 z-10 rounded-t-[22px] bg-inherit px-3.5 pb-3 pt-3 backdrop-blur-sm",children:[(0,t.jsx)("div",{className:"mb-2 h-1 w-full rounded-full bg-zinc-200/70",children:(0,t.jsx)("div",{className:(0,T.cn)("h-1 rounded-full",g.bg)})}),(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[G?(0,t.jsxs)(k.Popover,{open:eo===a.id,onOpenChange:e=>ed(e?a.id:null),children:[(0,t.jsx)(k.PopoverTrigger,{asChild:!0,children:(0,t.jsx)("button",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-lg border border-zinc-200 bg-white text-zinc-400 shadow-sm transition-all hover:bg-zinc-50 hover:text-zinc-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand","aria-label":`Personalizar etapa ${b}`,children:(0,t.jsx)(x,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(k.PopoverContent,{align:"start",className:"w-auto rounded-[16px] p-3",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center gap-1.5 text-[11px] font-medium text-zinc-600",children:[(0,t.jsx)(i,{className:"h-3 w-3"}),"Cor da etapa"]}),(0,t.jsx)("div",{className:"grid grid-cols-5 gap-1.5",children:P.map(e=>{let l=(e8[a.id]?.colorId||"default")===e.id;return(0,t.jsx)("button",{onClick:()=>{ti(a.id,e.id),ed(null)},className:(0,T.cn)("flex h-6 w-6 items-center justify-center rounded-full transition-all",e.bg,l?"ring-2 ring-zinc-900 ring-offset-2":"hover:ring-2 hover:ring-zinc-300 hover:ring-offset-1"),title:e.label,"aria-label":e.label,children:l?(0,t.jsx)(o.Check,{className:"h-3 w-3 text-white"}):null},e.id)})})]})]}):null,e9===a.id&&G?(0,t.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,t.jsx)("input",{ref:tl,value:te,maxLength:30,onChange:e=>ta(e.target.value),onBlur:tn,onKeyDown:e=>{"Enter"===e.key&&tn(),"Escape"===e.key&&ts()},className:(0,T.cn)("min-w-0 w-full truncate rounded-md border bg-white px-1.5 py-0.5 font-heading text-[14px] font-semibold text-zinc-900 outline-none focus:ring-1",tt?"border-red-400 focus:border-red-400 focus:ring-red-300":"border-zinc-300 focus:border-brand focus:ring-brand"),"aria-label":"Renomear etapa","aria-invalid":!!tt}),tt?(0,t.jsx)("span",{className:"mt-0.5 text-[10px] font-medium text-red-600",role:"alert",children:tt}):null]}):G?(0,t.jsx)("button",{onClick:()=>tr(a.id,b),className:"truncate font-heading text-[15px] font-semibold text-zinc-900 transition-colors hover:text-brand",title:"Clique para renomear",children:b}):(0,t.jsx)("span",{className:"truncate font-heading text-[15px] font-semibold text-zinc-900",children:b}),(0,t.jsx)("span",{className:"shrink-0 rounded-md bg-zinc-200/80 px-1.5 py-0.5 font-body text-[11px] font-semibold text-zinc-700",children:p.length})]}),(0,t.jsx)("span",{className:"shrink-0 text-[11px] font-semibold text-zinc-500",children:(0,$.formatCurrencyBRL)(f)})]}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-1.5",children:[(0,t.jsxs)("span",{className:"rounded-full border border-zinc-200 bg-zinc-50 px-2 py-1 text-[10px] font-semibold text-zinc-600",children:["SLA ",a.slaHours,"h"]}),(0,t.jsxs)("span",{className:(0,T.cn)("rounded-full border px-2 py-1 text-[10px] font-semibold",E?"border-amber-200 bg-amber-50 text-amber-700":"border-emerald-200 bg-emerald-50 text-emerald-700"),children:["WIP ",p.length,"/",M]}),(0,t.jsxs)("span",{className:(0,T.cn)("rounded-full border px-2 py-1 text-[10px] font-semibold",z>0?"border-red-200 bg-red-50 text-red-700":"border-zinc-200 bg-zinc-50 text-zinc-600"),children:["Estourados ",z]})]}),S?(0,t.jsx)("div",{className:(0,T.cn)("mt-2 rounded-[14px] border px-2.5 py-2 text-[11px] font-medium","error"===S.tone?"border-red-200 bg-red-50 text-red-700":"warning"===S.tone?"border-amber-200 bg-amber-50 text-amber-700":"border-emerald-200 bg-emerald-50 text-emerald-700"),role:"status",children:S.message}):null,y?(0,t.jsx)("div",{className:(0,T.cn)("mt-2 rounded-[14px] border px-2.5 py-2","warning"===y.tone?"border-amber-200 bg-amber-50 text-amber-700":"border-red-200 bg-red-50 text-red-700"),role:"alert",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(c.AlertTriangle,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("p",{className:"text-[11px] font-medium leading-relaxed",children:y.message}),y.missingFields?.length?(0,t.jsx)("button",{type:"button",onClick:tc,className:"mt-1 text-[11px] font-semibold underline underline-offset-2",children:"Preencher agora"}):null]}),(0,t.jsx)("button",{onClick:()=>eZ(null),className:"rounded-md p-1 transition hover:bg-black/5 focus:outline-none focus-visible:ring-2","aria-label":"Fechar aviso",children:(0,t.jsx)(n.X,{className:"h-3.5 w-3.5"})})]})}):null,C?(0,t.jsx)("div",{className:"mt-2 rounded-[14px] border border-emerald-200 bg-emerald-50 px-2.5 py-2 text-emerald-700",role:"status",children:(0,t.jsxs)("div",{className:"flex items-start gap-1.5",children:[(0,t.jsx)(d.CheckCircle2,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,t.jsx)("span",{className:"text-[11px] font-medium leading-relaxed",children:C.message})]})}):null]}),(0,t.jsx)("div",{"data-pipe-column-scroll":!0,className:"flex-1 overflow-y-auto px-3.5 pb-3.5",onDragOver:e=>e3(e,a.id),onDrop:e=>e7(e,a.id),children:p.length>0||j?(0,t.jsx)("div",{className:"space-y-3",children:(u=(r=!!(eX&&eJ?.stage===a.id))?Math.min(eJ?.index??0,p.length):-1,(0,t.jsxs)(v.AnimatePresence,{initial:!1,children:[p.flatMap((e,l)=>{let n=[],i=eX===e.id,o=y?.cardId===e.id?{tone:"error"===y.tone?"error":"warning",message:y.message,actionLabel:y.missingFields?.length?"Preencher agora":void 0,onAction:y.missingFields?.length?tc:void 0}:C?.cardId===e.id?{tone:"success",message:C.message}:null;return r&&u===l&&n.push((0,t.jsx)(w.motion.div,{layout:!0,initial:{opacity:0,scaleY:.82,height:0},animate:{opacity:1,scaleY:1,height:190},exit:{opacity:0,scaleY:.82,height:0},transition:{duration:.18,ease:[.22,1,.36,1]},className:"rounded-[22px] border border-dashed border-brand/45 bg-brand/5 shadow-[inset_0_0_0_1px_rgba(37,99,235,0.16)]"},`drop-placeholder-${a.id}-${l}`)),n.push((0,t.jsx)(w.motion.div,{layout:!0,"data-card-index":l,animate:{x:y?.cardId===e.id?[-5,5,-4,4,-2,2,0]:0},transition:{x:{duration:.4,ease:"easeInOut"},layout:{duration:.22,ease:[.22,1,.36,1]}},className:(0,T.cn)("transition-[transform,opacity,filter] duration-180 ease-out",i?"scale-[0.985] opacity-30 saturate-50":""),children:(0,t.jsx)(J,{opportunity:e,temp:eP(e),isDragging:i,isUpdating:e1===e.id,isHighlighted:e2===e.id,canMove:X,canEdit:X,canCreateActivity:Q,inlineFeedback:o,onTagClick:e=>{ef(e),eb(e),window.scrollTo({top:0,behavior:"smooth"}),ey.current?.focus()},onOpen:()=>s("lead-card",{id:e.id,opportunitySnapshot:e}),onDragStart:t=>e5(t,e),onDragEnd:e6})},e.id)),l===p.length-1&&r&&u>=p.length&&n.push((0,t.jsx)(w.motion.div,{layout:!0,initial:{opacity:0,scaleY:.82,height:0},animate:{opacity:1,scaleY:1,height:190},exit:{opacity:0,scaleY:.82,height:0},transition:{duration:.18,ease:[.22,1,.36,1]},className:"rounded-[22px] border border-dashed border-brand/45 bg-brand/5 shadow-[inset_0_0_0_1px_rgba(37,99,235,0.16)]"},`drop-placeholder-${a.id}-end`)),n}),0===p.length&&j?(0,t.jsx)(w.motion.div,{layout:!0,initial:{opacity:0,scaleY:.82,height:0},animate:{opacity:1,scaleY:1,height:190},exit:{opacity:0,scaleY:.82,height:0},transition:{duration:.18,ease:[.22,1,.36,1]},className:"rounded-[22px] border border-dashed border-brand/45 bg-brand/5 shadow-[inset_0_0_0_1px_rgba(37,99,235,0.16)]"},`drop-placeholder-empty-${a.id}`):null]}))}):(0,t.jsxs)("div",{className:"mt-1 flex min-h-[180px] flex-col items-center justify-center rounded-[16px] border-2 border-dashed border-zinc-200 bg-zinc-50/40 px-4 text-center",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-zinc-700",children:m?"Zero resultados no filtro":"Sem cards nesta etapa"}),(0,t.jsx)("p",{className:"mt-1 text-[11px] leading-relaxed text-zinc-500",children:m?"Tente limpar a busca ou os filtros ativos acima.":"Crie um novo card aqui ou mova um card de outra coluna."}),(0,t.jsx)("div",{className:"mt-3 flex flex-wrap items-center justify-center gap-2",children:(0,t.jsxs)(N.Button,{size:"sm",className:"h-8 rounded-full px-3 text-xs",onClick:()=>e("new-opportunity",{initialStage:a.id}),disabled:!K,children:[(0,t.jsx)(h.Plus,{className:"h-3.5 w-3.5"}),"Criar card nesta etapa"]})})]})})]},a.id)})})]})]})]})}function ei(){return(0,t.jsx)("div",{className:"premium-ambient min-h-[calc(100vh-72px)] p-6",children:(0,t.jsx)(Z,{stageCount:R[0].stages.length})})}function eo(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)(ei,{}),children:(0,t.jsx)(es,{})})}e.s(["default",()=>eo],46557)}]);