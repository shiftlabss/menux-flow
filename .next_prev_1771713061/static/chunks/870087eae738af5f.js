(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92228,e=>{"use strict";var t=e.i(43476),i=e.i(71645),a=e.i(46932),n=e.i(18566),s=e.i(2747),r=e.i(78894),l=e.i(87316),o=e.i(64659),d=e.i(73264),c=e.i(51737),u=e.i(75254);let m=(0,u.default)("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);var p=e.i(19455),x=e.i(55146),h=e.i(34682),g=e.i(45060);let f=(0,e.i(68834).create)(e=>({period:"today",context:"me",setPeriod:t=>e({period:t}),setContext:t=>e({context:t})}));function b(e,t){let i,a=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999);switch(e){case"today":i=new Date(t.getFullYear(),t.getMonth(),t.getDate());break;case"7d":i=new Date(t.getFullYear(),t.getMonth(),t.getDate()-7);break;case"30d":i=new Date(t.getFullYear(),t.getMonth(),t.getDate()-30);break;case"quarter":{let e=3*Math.floor(t.getMonth()/3);i=new Date(t.getFullYear(),e,1)}}return{start:i,end:a}}var v=e.i(82943),j=e.i(75378),y=e.i(31288),w=e.i(42308),N=e.i(34288),k=e.i(62889);function z(){let e=(0,j.useOpportunityStore)(e=>e.opportunities),t=(0,y.useActivityStore)(e=>e.activities),a=(0,v.useAuthStore)(e=>e.user),n=f(e=>e.period),s=f(e=>e.context),r=(0,w.useNow)(),l=a?.id??"",o=a?.role??"comercial";return(0,i.useMemo)(()=>{let{start:i,end:a}=b(n,r),d="me"===s?(0,k.filterByUser)(e,l,o):e,c="me"===s?(0,k.filterByUser)(t,l,o):t,u=d.filter(e=>"open"===e.status);return{filteredOpportunities:d.filter(e=>{if("open"===e.status)return!0;let t=new Date(e.updatedAt);return t>=i&&t<=a}),filteredActivities:c.map(e=>({...e,effectiveStatus:(0,N.getEffectiveActivityStatus)(e,r)})).filter(e=>{if("pending"===e.effectiveStatus||"overdue"===e.effectiveStatus)return!0;let t=new Date(e.dueDate);return t>=i&&t<=a}),openOpportunities:u,now:r,period:n,context:s,userId:l,userRole:o}},[e,t,n,s,r,l,o])}let A={today:"Hoje","7d":"7 dias","30d":"30 dias",quarter:"Trimestre"};function S(){let e,a,u,b,j,y,w,k=(0,n.useRouter)(),S=(0,n.usePathname)(),{period:T,setPeriod:C}=f(),{user:I,isLoading:D}=(0,v.useAuthStore)(),[M,$]=(0,i.useState)(!1),{filteredActivities:P,openOpportunities:_,now:E}=z(),R=I?.name?.trim().split(" ")[0]??"Admin",V=P.filter(e=>"overdue"===e.effectiveStatus).length,L=_.filter(e=>e.slaDeadline&&new Date(e.slaDeadline)<E),F=L.length,B=L.reduce((e,t)=>e+(t.value||0),0),O=!Number.isFinite(V)||!Number.isFinite(F)||!Number.isFinite(B),q=[V>0?{id:"overdue",value:`${V}`,label:"atrasadas",icon:r.AlertTriangle,tone:"danger"}:null,F>0?{id:"sla",value:`${F}`,label:"SLAs estourados",icon:c.ShieldAlert,tone:"warning"}:null,B>0?{id:"risk",value:(0,N.formatCurrencyBRL)(B),label:"valor em risco",icon:m,tone:"info"}:null].filter(e=>!!e).slice(0,3),H=`${(e=new Intl.DateTimeFormat("pt-BR",{weekday:"short",day:"2-digit",month:"short",timeZone:"America/Sao_Paulo"}).formatToParts(E),a=e.find(e=>"weekday"===e.type)?.value??"",u=e.find(e=>"day"===e.type)?.value??"",b=e.find(e=>"month"===e.type)?.value??"",j=a.replaceAll(".","").trim(),y=b.replaceAll(".","").trim(),w=j.charAt(0).toUpperCase()+j.slice(1),`${w}, ${u} ${y}`)} \xb7 Ol\xe1, ${R}`,G=O?[]:q.map(e=>{let i=e.icon;return{id:e.id,label:`${e.value} ${e.label}`,icon:(0,t.jsx)(i,{className:"h-3.5 w-3.5"}),tone:"danger"===e.tone?"danger":"warning"===e.tone?"warning":"info",onClick:()=>(e=>{if("overdue"===e)return void k.push("/activities?status=overdue");let t="sla"===e?"dashboard-execution":"dashboard-funnel",i=document.getElementById(t);i?i.scrollIntoView({behavior:"smooth",block:"start"}):"/dashboard"!==S&&k.push(`/dashboard#${t}`)})(e.id)}}),U={id:"dashboard-empty",label:"Sem dados do dia · Ver pipeline",icon:(0,t.jsx)(d.LayoutGrid,{className:"h-3.5 w-3.5 text-zinc-500"}),onClick:()=>k.push("/pipes"),tone:"neutral"},K=(0,t.jsx)("div",{className:(0,g.cn)("flex w-full flex-wrap items-center justify-end gap-2",D&&"pointer-events-none opacity-60"),children:(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsxs)(p.Button,{variant:"outline",className:"premium-shine h-8 gap-1.5 rounded-full border-zinc-200 bg-white/90 px-3 text-sm font-medium hover:bg-zinc-100/80 active:scale-[0.99]",children:[(0,t.jsx)(d.LayoutGrid,{className:"h-3.5 w-3.5 text-zinc-500"}),A[T],(0,t.jsx)(o.ChevronDown,{className:"h-3.5 w-3.5 text-zinc-400"})]})}),(0,t.jsx)(x.DropdownMenuContent,{align:"end",className:"w-40 rounded-xl",children:Object.keys(A).map(e=>(0,t.jsxs)(x.DropdownMenuItem,{onClick:()=>C(e),className:"gap-2",children:[T===e?(0,t.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-brand"}):null,(0,t.jsx)("span",{className:T===e?"font-medium":"",children:A[e]})]},e))})]})});return(0,t.jsxs)(h.ModuleCommandHeader,{title:"Dashboard",description:"Raio X do comercial",sticky:!0,actions:K,meta:(0,t.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,t.jsx)(l.Calendar,{className:"h-3.5 w-3.5"}),H]}),chips:G,fallbackChip:U,className:"premium-panel",children:[D?(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsx)(s.Skeleton,{className:"h-8 w-[110px] rounded-full"}),(0,t.jsx)(s.Skeleton,{className:"h-8 w-[128px] rounded-full"}),(0,t.jsx)(s.Skeleton,{className:"h-8 w-[142px] rounded-full"})]}):null,O?(0,t.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-full border border-red-200 bg-red-50/90 px-3 py-1.5 text-xs text-red-700",children:[(0,t.jsx)(r.AlertTriangle,{className:"h-3.5 w-3.5"}),"Falha ao carregar indicadores.",(0,t.jsx)("button",{type:"button",onClick:()=>{$(!0),k.refresh(),window.setTimeout(()=>$(!1),220)},className:"font-semibold underline underline-offset-4",children:M?"Tentando...":"Tentar novamente"})]}):null]})}class T{constructor(e){this.stop=()=>this.runAll("stop"),this.animations=e.filter(Boolean)}get finished(){return Promise.all(this.animations.map(e=>e.finished))}getAll(e){return this.animations[0][e]}setAll(e,t){for(let i=0;i<this.animations.length;i++)this.animations[i][e]=t}attachTimeline(e){let t=this.animations.map(t=>t.attachTimeline(e));return()=>{t.forEach((e,t)=>{e&&e(),this.animations[t].stop()})}}get time(){return this.getAll("time")}set time(e){this.setAll("time",e)}get speed(){return this.getAll("speed")}set speed(e){this.setAll("speed",e)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return C(this.animations,"duration")}get iterationDuration(){return C(this.animations,"iterationDuration")}runAll(e){this.animations.forEach(t=>t[e]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function C(e,t){let i=0;for(let a=0;a<e.length;a++){let n=e[a][t];null!==n&&n>i&&(i=n)}return i}class I extends T{then(e,t){return this.finished.finally(e).then(()=>{})}}var D=e.i(33887),M=e.i(86427),$=e.i(73431),P=e.i(83411),_=e.i(15923),E=e.i(97307),R=e.i(21748),V=e.i(15932),L=e.i(83920),F=e.i(63074),B=e.i(65566),O=e.i(93544);function q(e,t){var i;let a;return(0,O.isEasingArray)(e)?e[i=e.length,((t-0)%(a=i-0)+a)%a+0]:e}var H=e.i(49652);function G(e){return"object"==typeof e&&!Array.isArray(e)}function U(e,t,i,a){return null==e?[]:"string"==typeof e&&G(t)?(0,H.resolveElements)(e,i,a):e instanceof NodeList?Array.from(e):Array.isArray(e)?e.filter(e=>null!=e):[e]}function K(e,t,i,a){return"number"==typeof t?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):"<"===t?i:t.startsWith("<")?Math.max(0,i+parseFloat(t.slice(1))):a.get(t)??e}var Y=e.i(706);function W(e,t){return e.at!==t.at?e.at-t.at:null===e.value?1:null===t.value?-1:0}function X(e,t){return t.has(e)||t.set(e,{}),t.get(e)}function Q(e,t){return t[e]||(t[e]=[]),t[e]}let Z=e=>"number"==typeof e,J=e=>e.every(Z);var ee=e.i(68705),et=e.i(72094),ei=e.i(72323),ea=e.i(89026),en=e.i(36331),es=e.i(75737),er=e.i(86783),el=e.i(30162),eo=e.i(17218);class ed extends eo.VisualElement{constructor(){super(...arguments),this.type="object"}readValueFromInstance(e,t){if(t in e){let i=e[t];if("string"==typeof i||"number"==typeof i)return i}}getBaseTargetFromProps(){}removeValueFromRenderState(e,t){delete t.output[e]}measureInstanceViewportBox(){return(0,el.createBox)()}build(e,t){Object.assign(e.output,t)}renderInstance(e,{output:t}){Object.assign(e,t)}sortInstanceNodePosition(){return 0}}function ec(e){let t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},i=(0,ea.isSVGElement)(e)&&!(0,en.isSVGSVGElement)(e)?new es.SVGVisualElement(t):new er.HTMLVisualElement(t);i.mount(e),et.visualElementStore.set(e,i)}function eu(e){let t=new ed({presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}});t.mount(e),et.visualElementStore.set(e,t)}function em(e,t,i,a){let n=[];if((0,P.isMotionValue)(e)||"number"==typeof e||"string"==typeof e&&!G(t))n.push((0,ee.animateSingleValue)(e,G(t)&&t.default||t,i&&i.default||i));else{if(null==e)return n;let s=U(e,t,a),r=s.length;(0,B.invariant)(!!r,"No valid elements provided.","no-valid-elements");for(let e=0;e<r;e++){let a=s[e],l=a instanceof Element?ec:eu;et.visualElementStore.has(a)||l(a);let o=et.visualElementStore.get(a),d={...i};"delay"in d&&"function"==typeof d.delay&&(d.delay=d.delay(e,r)),n.push(...(0,ei.animateTarget)(o,{...t,transition:d},{}))}}return n}let ep=function(e={}){let{scope:t,reduceMotion:i}=e;return function(e,a,n){var s;let r,l=[];if(Array.isArray(e)&&e.some(Array.isArray)){let n;s=void 0!==i?{reduceMotion:i,...a}:a,n=[],(function(e,{defaultTransition:t={},...i}={},a,n){let s=t.duration||.3,r=new Map,l=new Map,o={},d=new Map,c=0,u=0,m=0;for(let i=0;i<e.length;i++){let r=e[i];if("string"==typeof r){d.set(r,u);continue}if(!Array.isArray(r)){d.set(r.name,K(u,r.at,c,d));continue}let[h,g,f={}]=r;void 0!==f.at&&(u=K(u,f.at,c,d));let b=0,v=(e,i,a,r=0,l=0)=>{var o;let d=Array.isArray(o=e)?o:[o],{delay:c=0,times:p=(0,_.defaultOffset)(d),type:x=t.type||"keyframes",repeat:h,repeatType:g,repeatDelay:f=0,...v}=i,{ease:j=t.ease||"easeOut",duration:y}=i,w="function"==typeof c?c(r,l):c,N=d.length,k=(0,E.isGenerator)(x)?x:n?.[x||"keyframes"];if(N<=2&&k){let e=100;2===N&&J(d)&&(e=Math.abs(d[1]-d[0]));let i={...t,...v};void 0!==y&&(i.duration=(0,F.secondsToMilliseconds)(y));let a=(0,R.createGeneratorEasing)(i,e,k);j=a.ease,y=a.duration}y??(y=s);let z=u+w;1===p.length&&0===p[0]&&(p[1]=1);let A=p.length-d.length;if(A>0&&(0,V.fillOffset)(p,A),1===d.length&&d.unshift(null),h){(0,B.invariant)(h<20,"Repeat count too high, must be less than 20","repeat-count-high");y*=h+1;let e=[...d],t=[...p],i=[...j=Array.isArray(j)?[...j]:[j]];for(let a=0;a<h;a++){d.push(...e);for(let n=0;n<e.length;n++)p.push(t[n]+(a+1)),j.push(0===n?"linear":q(i,n-1))}for(let e=0;e<p.length;e++)p[e]=p[e]/(h+1)}let S=z+y;!function(e,t,i,a,n,s){for(let t=0;t<e.length;t++){let i=e[t];i.at>n&&i.at<s&&((0,D.removeItem)(e,i),t--)}for(let r=0;r<t.length;r++)e.push({value:t[r],at:(0,Y.mixNumber)(n,s,a[r]),easing:q(i,r)})}(a,d,j,p,z,S),b=Math.max(w+y,b),m=Math.max(S,m)};if((0,P.isMotionValue)(h))v(g,f,Q("default",X(h,l)));else{let e=U(h,g,a,o),t=e.length;for(let i=0;i<t;i++){let a=X(e[i],l);for(let e in g){var p,x;v(g[e],(p=f,x=e,p&&p[x]?{...p,...p[x]}:{...p}),Q(e,a),i,t)}}}c=u,u+=b}return l.forEach((e,a)=>{for(let n in e){let s=e[n];s.sort(W);let l=[],o=[],d=[];for(let e=0;e<s.length;e++){let{at:t,value:i,easing:a}=s[e];l.push(i),o.push((0,L.progress)(0,m,t)),d.push(a||"easeOut")}0!==o[0]&&(o.unshift(0),l.unshift(l[0]),d.unshift("easeInOut")),1!==o[o.length-1]&&(o.push(1),l.push(null)),r.has(a)||r.set(a,{keyframes:{},transition:{}});let c=r.get(a);c.keyframes[n]=l;let{type:u,...p}=t;c.transition[n]={...p,duration:m,ease:d,times:o,...i}}}),r})(e.map(e=>{if(Array.isArray(e)&&"function"==typeof e[0]){let t=e[0],i=(0,M.motionValue)(0);return(i.on("change",t),1===e.length)?[i,[0,1]]:2===e.length?[i,[0,1],e[1]]:[i,e[1],e[2]]}return e}),s,t,{spring:$.spring}).forEach(({keyframes:e,transition:t},i)=>{n.push(...em(i,e,t))}),l=n}else{let{onComplete:s,...o}=n||{};"function"==typeof s&&(r=s),l=em(e,a,void 0!==i?{reduceMotion:i,...o}:o,t)}let o=new I(l);return r&&o.finished.then(r),t&&(t.animations.push(o),o.finished.then(()=>{(0,D.removeItem)(t.animations,o)})),o}}();var ex=e.i(87652),eh=e.i(63059),eg=e.i(23934);let ef=(0,u.default)("gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);var eb=e.i(25652),ev=e.i(75157),ej=e.i(30747);function ey(e,t,i){let a=e.filter(e=>{if("won"!==e.status&&"lost"!==e.status)return!1;let a=new Date(e.updatedAt);return a>=t&&a<=i}),n=a.filter(e=>"won"===e.status).length,s=a.length;return{won:n,total:s,rate:s>0?n/s*100:0}}function ew({value:e,format:a}){let n=(0,ex.useMotionValue)(e),[s,r]=(0,i.useState)(e);return(0,i.useEffect)(()=>n.on("change",e=>{r(e)}),[n]),(0,i.useEffect)(()=>ep(n,e,{duration:.22,ease:[.22,.61,.36,1]}).stop,[n,e]),(0,t.jsx)(t.Fragment,{children:function(e,t){if("currency"===t){let t=Math.abs(e);return t>=1e3?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",notation:"compact",maximumFractionDigits:t>=1e6?2:1}).format(e):new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:0}).format(e)}return"percent"===t?`${e.toFixed(1)}%`:Math.round(e).toString()}(s,a)})}function eN({chip:e}){return(0,t.jsx)("span",{className:(0,ev.cn)("inline-flex h-[24px] max-w-full items-center rounded-full border px-2.5 text-[11px] font-semibold tracking-tight whitespace-nowrap","neutral"===e.tone&&"border-zinc-200/85 bg-zinc-100/80 text-zinc-700","info"===e.tone&&"border-sky-200/80 bg-sky-50/80 text-sky-700","warning"===e.tone&&"border-amber-200/80 bg-amber-50/80 text-amber-700","danger"===e.tone&&"border-rose-200/80 bg-rose-50/80 text-rose-700","success"===e.tone&&"border-emerald-200/80 bg-emerald-50/80 text-emerald-700"),title:e.label,children:(0,t.jsx)("span",{className:"truncate",children:e.label})})}function ek({icon:e,data:i,onNavigate:n,onRetry:r}){let l=i.state??"default",o="default"===l&&!i.disabled,d=i.chips.slice(0,2),c=i.chips.length>2?{label:"Ver detalhes",targetPath:i.targetPath}:i.detailAction;return(0,t.jsx)(a.motion.article,{onClick:function(){o&&n(i.targetPath)},onKeyDown:function(e){o&&("Enter"===e.key||" "===e.key)&&(e.preventDefault(),n(i.targetPath))},role:o?"button":void 0,tabIndex:o?0:-1,"aria-disabled":!o,whileTap:o?{scale:.99}:void 0,transition:{duration:.09,ease:"easeInOut"},className:(0,ev.cn)("premium-shine group flex h-[222px] w-full flex-col overflow-hidden rounded-[24px] border border-zinc-200/80 bg-white/90 p-5 text-left","shadow-(--shadow-bento-sm) transition-[box-shadow,border-color,background-color] duration-150 ease-out",o&&"cursor-pointer hover:shadow-(--shadow-bento-sm-hover)","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/25"),children:"loading"===l?(0,t.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,t.jsx)(s.Skeleton,{className:"h-4 w-28 rounded-md before:animation-duration-[900ms]"}),(0,t.jsx)(s.Skeleton,{className:"h-10 w-36 rounded-lg before:animation-duration-[900ms]"})]}):"error"===l?(0,t.jsxs)("div",{className:"flex h-full flex-col justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-[13px] font-semibold text-zinc-900",children:i.label}),(0,t.jsx)("p",{className:"mt-2 text-xs text-red-700",children:"Erro ao carregar métrica."})]}),(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),r()},className:"w-fit text-xs font-semibold text-brand underline underline-offset-4",children:"Tentar novamente"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("header",{className:"flex h-8 items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-2.5",children:[(0,t.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-[10px] bg-zinc-100 text-zinc-700",children:e}),(0,t.jsx)("p",{className:"truncate text-[13px] font-medium text-zinc-600",children:i.label})]}),o?(0,t.jsx)(eh.ChevronRight,{className:"h-4 w-4 shrink-0 text-zinc-400 transition-[color,transform] duration-150 group-hover:translate-x-[1px] group-hover:text-zinc-600"}):null]}),(0,t.jsxs)("div",{className:"mt-3 flex h-[66px] min-w-0 items-end gap-1.5",children:[(0,t.jsx)("p",{className:"tabular-nums whitespace-nowrap text-[clamp(1.9rem,2.35vw,2.85rem)] leading-[0.92] font-bold tracking-tight text-zinc-900",children:(0,t.jsx)(ew,{value:i.value,format:i.valueFormat})}),i.valueSuffix?(0,t.jsx)("p",{className:"tabular-nums shrink-0 truncate pb-1 text-[13px] font-semibold text-zinc-500",children:i.valueSuffix}):null]}),(0,t.jsx)("p",{className:"mt-2 h-6 truncate text-[13px] font-medium text-zinc-500",children:i.subtext}),(0,t.jsxs)("footer",{className:"mt-auto flex h-[58px] flex-col justify-end pt-3",children:[(0,t.jsxs)("div",{className:"flex min-h-[24px] items-center gap-2 overflow-hidden",children:[d.map(e=>(0,t.jsx)(eN,{chip:e},e.id)),0!==d.length||c?null:(0,t.jsx)("p",{className:"truncate text-[12px] text-zinc-500",title:i.line4Text||"Sem alertas hoje",children:i.line4Text||"Sem alertas hoje"}),c?(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),n(c.targetPath)},className:"inline-flex h-[24px] shrink-0 items-center text-[12px] font-semibold text-brand underline underline-offset-4 transition-[color,transform,opacity] duration-150 hover:translate-x-[1px] hover:text-brand/80",children:c.label}):null]}),(0,t.jsx)("p",{className:"tabular-nums mt-1.5 h-[16px] truncate text-[11px] text-zinc-500",children:i.microText??""})]})]})})}function ez(){let e=(0,n.useRouter)(),s=function(){let{filteredActivities:e,openOpportunities:t,now:a,period:n,context:s,userId:r,userRole:l}=z(),o=(0,j.useOpportunityStore)(e=>e.opportunities);return(0,i.useMemo)(()=>{let i="me"===s?(0,k.filterByUser)(o,r,l):o,{start:d,end:c}=b(n,a),u=c.getTime()-d.getTime()+1,m=new Date(d.getTime()-1),p=new Date(m.getTime()-u+1),x=ey(i,d,c),h=ey(i,p,m),g=x.total>0,f=h.total>0,v=f?x.rate-h.rate:null,j=t.reduce((e,t)=>e+(t.value||0),0),y=e.filter(e=>"pending"===e.effectiveStatus||"overdue"===e.effectiveStatus),w=e.filter(e=>"overdue"===e.effectiveStatus).length,N=a.toISOString().slice(0,10),z=e.filter(e=>"pending"===e.effectiveStatus&&e.dueDate===N).length,A=a.getTime()-432e6,S=t.filter(e=>new Date(e.updatedAt).getTime()<A).length,T=t.filter(e=>{var t;return t=e.slaDeadline,!!t&&new Date(t)<a}).length,C=t.filter(e=>(function(e,t){if(!e)return!1;let i=(new Date(e).getTime()-t.getTime())/36e5;return i>0&&i<=24})(e.slaDeadline,a)).length,I=t.length>0?Math.round((T+C)/t.length*100):0,D=[];g&&null!==v&&(v>0?D.push({id:"conversion-up",label:`Alta +${v.toFixed(1)} p.p.`,tone:"success"}):v<0?D.push({id:"conversion-down",label:`Queda ${Math.abs(v).toFixed(1)} p.p.`,tone:"danger"}):D.push({id:"conversion-flat",label:"Estavel 0.0 p.p.",tone:"neutral"}));let M=[];w>0&&M.push({id:"activities-overdue",label:`Atrasadas: ${w}`,tone:"danger"}),z>0&&M.push({id:"activities-today",label:`Hoje: ${z}`,tone:"warning"}),0===M.length&&M.push({id:"activities-ok",label:"OK",tone:"success"});let $=[];T>0&&$.push({id:"sla-overdue",label:`Estourados: ${T}`,tone:"danger"}),C>0&&$.push({id:"sla-risk",label:`Em risco: ${C}`,tone:"warning"}),0===$.length&&$.push({id:"sla-ok",label:"OK",tone:"success"});let P=[];T>0&&P.push({id:"pipeline-overdue",label:`Estourados: ${T}`,tone:"danger"});let _=T>0?"/pipes?filter=sla_overdue":"/pipes?filter=sla_risk";return{pipeline:{label:"Pipeline Total",value:j,valueFormat:"currency",subtext:`${t.length} oportunidades abertas`,chips:P,line4Text:0===P.length&&0===S?"Sem alertas hoje":void 0,detailAction:S>0?{label:"Ver sem atividade",targetPath:"/pipes?filter=stale"}:void 0,targetPath:"/pipes",state:"default"},conversion:{label:"Conversão Global",value:x.rate,valueFormat:"percent",subtext:g?`Ganhos no per\xedodo: ${x.won}`:"Sem dados no período",chips:D,line4Text:g?f?void 0:"Sem base comparável":"Ajuste o período para comparar.",disabled:!g,targetPath:"/dashboard?view=conversion",state:"default"},activities:{label:"Atividades",value:y.length,valueFormat:"integer",subtext:`${w} atrasadas \xb7 ${z} para hoje`,chips:M.slice(0,2),targetPath:"/activities?statuses=pending,overdue",state:"default"},sla:{label:"SLA Crítico",value:T,valueFormat:"integer",valueSuffix:"estourados",subtext:`${C} em risco`,chips:$.slice(0,2),detailAction:T>0||C>0?{label:"Ver deals",targetPath:_}:void 0,microText:`${I}% da carteira em risco`,targetPath:_,state:"default"}}},[e,t,a,n,s,r,l,o])}(),[r,l]=(0,i.useState)({pipeline:"default",conversion:"default",activities:"default",sla:"default"}),o=(0,i.useMemo)(()=>({pipeline:{...s.pipeline,state:r.pipeline},conversion:{...s.conversion,state:r.conversion},activities:{...s.activities,state:r.activities},sla:{...s.sla,state:r.sla}}),[s,r]);function d(e){l(t=>({...t,[e]:"loading"})),window.setTimeout(()=>{l(t=>({...t,[e]:"default"}))},240)}return(0,t.jsxs)(a.motion.div,{variants:ej.cardStaggerContainer,initial:"hidden",animate:"show",className:"grid grid-cols-1 items-stretch gap-4 sm:grid-cols-2 xl:grid-cols-4",children:[(0,t.jsx)(a.motion.div,{custom:0,variants:ej.listItemReveal,className:"h-full",children:(0,t.jsx)(ek,{icon:(0,t.jsx)(ef,{className:"h-4 w-4"}),data:o.pipeline,onNavigate:t=>e.push(t),onRetry:()=>d("pipeline")})}),(0,t.jsx)(a.motion.div,{custom:1,variants:ej.listItemReveal,className:"h-full",children:(0,t.jsx)(ek,{icon:(0,t.jsx)(eb.TrendingUp,{className:"h-4 w-4"}),data:o.conversion,onNavigate:t=>e.push(t),onRetry:()=>d("conversion")})}),(0,t.jsx)(a.motion.div,{custom:2,variants:ej.listItemReveal,className:"h-full",children:(0,t.jsx)(ek,{icon:(0,t.jsx)(eg.Clock3,{className:"h-4 w-4"}),data:o.activities,onNavigate:t=>e.push(t),onRetry:()=>d("activities")})}),(0,t.jsx)(a.motion.div,{custom:3,variants:ej.listItemReveal,className:"h-full",children:(0,t.jsx)(ek,{icon:(0,t.jsx)(c.ShieldAlert,{className:"h-4 w-4"}),data:o.sla,onNavigate:t=>e.push(t),onRetry:()=>d("sla")})})]})}var eA=e.i(88653),eS=e.i(72520),eT=e.i(15057),eC=e.i(83086);let eI=(0,u.default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),eD=i.forwardRef(({title:e,description:i,actions:n,children:s,size:r="md",state:l="default",className:o,noPadding:d=!1,elevated:c=!1,hoverable:u=!1,shine:m=!0,...p},x)=>{let h=e||i||n;return(0,t.jsxs)(a.motion.div,{ref:x,whileHover:u?ej.premiumPressMotion.whileHover:void 0,whileTap:u?ej.premiumPressMotion.whileTap:void 0,transition:u?{duration:.22,ease:[.22,.61,.36,1]}:void 0,className:(0,ev.cn)("group/card relative overflow-hidden","bento-card-base premium-panel","rounded-[var(--radius-bento-card)]","border border-[var(--border-bento-default)]","focus-within:ring-2 focus-within:ring-brand/20",c&&"bento-card-elevated",!c&&"shadow-[var(--shadow-bento-sm)]",u&&c&&"bento-card-elevated-hover",u&&!c&&"bento-card-hover",u&&"premium-lift",u&&m&&"premium-shine","sm"===r?"min-h-[140px]":"lg"===r?"min-h-[260px]":"tall"===r?"min-h-[340px]":"wide"===r?"min-h-[200px]":"min-h-[180px]","error"===l&&"border-[var(--border-bento-error)]","loading"===l&&"pointer-events-none opacity-80",o),...p,children:[m&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 ease-out group-hover/card:opacity-100",children:[(0,t.jsx)("div",{className:"absolute -top-16 right-[-12%] h-40 w-40 rounded-full bg-brand/15 blur-3xl"}),(0,t.jsx)("div",{className:"absolute -bottom-16 left-[-10%] h-36 w-36 rounded-full bg-cyan-300/15 blur-3xl"})]}),(0,t.jsx)("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-x-0 top-0 h-px bg-linear-to-r from-transparent via-white/90 to-transparent opacity-70"})]}),h&&(0,t.jsxs)("div",{className:(0,ev.cn)("flex items-start justify-between gap-4",d?"px-6 pt-6":"px-6 pt-6 pb-4"),children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[e&&(0,t.jsx)("h3",{className:"font-heading text-lg font-semibold text-black",children:e}),i&&(0,t.jsx)("p",{className:"mt-1 font-body text-sm text-zinc-500",children:i})]}),n&&(0,t.jsx)("div",{className:"flex shrink-0 gap-2",children:n})]}),(0,t.jsx)("div",{className:(0,ev.cn)(!d&&(h?"px-6 pb-6":"p-6")),children:s})]})});eD.displayName="BentoCard";var eM=e.i(46798);let e$={lead:"lead-in",contact:"contato-feito",meeting:"reuniao-agendada",proposal:"proposta-enviada",negotiation:"negociacao",won:"fechamento"},eP={"lead-in":"lead","contato-feito":"contact","reuniao-agendada":"meeting","proposta-enviada":"proposal",negociacao:"negotiation",fechamento:"won"},e_={lead:"Leads",contact:"Contato",meeting:"Reunião",proposal:"Proposta",negotiation:"Negociação",won:"Fechamento"},eE=["lead","contact","meeting","proposal","negotiation","won"];function eR({stage:e,selected:i,onSelectStage:n,compact:s}){var r;return(0,t.jsxs)(a.motion.button,{type:"button",onClick:()=>n(e.id),whileTap:{scale:.99},transition:{duration:.14,ease:"easeOut"},className:(0,ev.cn)("group/step min-w-0 rounded-xl border px-3 py-3 text-left transition-[background-color,border-color,box-shadow,opacity] duration-[140ms] ease-out","shadow-[0_8px_22px_-18px_rgba(15,23,42,0.45)] hover:shadow-[0_10px_26px_-16px_rgba(15,23,42,0.5)]",s?"w-full":"flex-[1_1_148px]",i?"border-brand/40 bg-brand/10 shadow-[0_0_0_1px_rgba(29,78,216,0.14),0_10px_26px_-16px_rgba(29,78,216,0.55)]":"border-zinc-200/85 bg-white/90 hover:border-zinc-300/90"),"aria-pressed":i,children:[(0,t.jsx)("p",{className:"truncate text-[11px] font-semibold uppercase tracking-[0.07em] text-zinc-500",children:e.label}),(0,t.jsx)("p",{className:"mt-1 text-xl font-bold leading-none text-zinc-900",children:e.volume}),(0,t.jsx)("p",{className:"mt-1 text-[11px] text-zinc-500",children:(r=e.value)>=1e6?`R$ ${(r/1e6).toFixed(1)}M`:r>=1e3?`R$ ${(r/1e3).toFixed(0)}k`:`R$ ${r}`})]})}let eV=(0,u.default)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);function eL({transition:e,isBottleneck:i,orientation:n,delay:s}){let r=i?"bg-amber-300/80":"bg-zinc-300/85";return(0,t.jsxs)(eM.Tooltip,{children:[(0,t.jsx)(eM.TooltipTrigger,{asChild:!0,children:(0,t.jsxs)(a.motion.div,{className:(0,ev.cn)("group/connector relative flex shrink-0 items-center justify-center","horizontal"===n?"min-w-[46px] flex-1 md:max-w-[64px]":"h-6 w-full"),children:["horizontal"===n?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.motion.div,{initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.22,delay:s,ease:"easeOut"},className:(0,ev.cn)("h-px w-full origin-left transition-opacity duration-[120ms] group-hover/connector:opacity-100",r,i?"opacity-95":"opacity-70")}),(0,t.jsx)(eS.ArrowRight,{className:"ml-1 h-3 w-3 text-zinc-400 transition-opacity duration-[120ms] group-hover/connector:opacity-100"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(a.motion.div,{initial:{scaleY:0},animate:{scaleY:1},transition:{duration:.22,delay:s,ease:"easeOut"},className:(0,ev.cn)("h-full w-px origin-top transition-opacity duration-[120ms] group-hover/connector:opacity-100",r,i?"opacity-95":"opacity-70")}),(0,t.jsx)(eV,{className:"absolute bottom-[-3px] h-3 w-3 text-zinc-400 transition-opacity duration-[120ms] group-hover/connector:opacity-100"})]}),(0,t.jsxs)("span",{className:(0,ev.cn)("absolute rounded-full border px-1.5 py-0.5 text-[10px] font-semibold shadow-sm transition-opacity duration-[120ms] group-hover/connector:opacity-100","horizontal"===n?"top-[-11px]":"right-2 top-[2px]",i?"border-amber-300/80 bg-amber-50 text-amber-700":"border-zinc-200 bg-white text-zinc-600",i?"opacity-100":"opacity-85"),children:[e.conversion,"%"]})]})}),(0,t.jsxs)(eM.TooltipContent,{side:"top",className:"text-[11px]",children:[e.advanced," de ",e.base," avançaram"]})]})}function eF({stages:e,transitions:a,selectedStageId:n,bottleneckToStageId:s,onSelectStage:r}){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"hidden items-stretch gap-2 md:flex md:flex-wrap xl:flex-nowrap",children:e.map((e,l)=>(0,t.jsxs)(i.Fragment,{children:[(0,t.jsx)(eR,{stage:e,selected:n===e.id,onSelectStage:r,compact:!1}),l<a.length&&(0,t.jsx)(eL,{transition:a[l],isBottleneck:s===a[l].to.id,orientation:"horizontal",delay:.03*l})]},e.id))}),(0,t.jsx)("div",{className:"space-y-2 md:hidden",children:e.map((e,l)=>(0,t.jsxs)(i.Fragment,{children:[(0,t.jsx)(eR,{stage:e,selected:n===e.id,onSelectStage:r,compact:!0}),l<a.length&&(0,t.jsx)(eL,{transition:a[l],isBottleneck:s===a[l].to.id,orientation:"vertical",delay:.03*l})]},`mobile-${e.id}`))})]})}function eB({tag:e,headline:i,description:n,meta:r,primaryAction:l,secondaryAction:o,onRetry:d,status:c="default",tone:u="neutral",icon:m,feedback:p}){let x="default"===c;return(0,t.jsx)(a.motion.article,{onClick:function(){!x||l.disabled||l.loading||l.onAction()},onKeyDown:function(e){!x||l.disabled||l.loading||("Enter"===e.key||" "===e.key)&&(e.preventDefault(),l.onAction())},role:x?"button":void 0,tabIndex:x?0:-1,"aria-disabled":!x,whileTap:x?{scale:.99}:void 0,transition:{duration:.1,ease:"easeOut"},className:(0,ev.cn)("flex min-h-[186px] flex-col rounded-[20px] border p-4","shadow-[0_10px_20px_-18px_rgba(15,23,42,0.5)]","transition-[background-color,border-color,box-shadow,opacity,color] duration-140 ease-out","danger"===u?"border-red-200/80 bg-red-50/55 hover:border-red-300/90":"success"===u?"border-emerald-200/80 bg-emerald-50/55 hover:border-emerald-300/90":"border-zinc-200/80 bg-white/85 hover:border-zinc-300/90",x&&"cursor-pointer hover:shadow-[0_14px_24px_-18px_rgba(15,23,42,0.55)]","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/25"),children:"loading"===c?(0,t.jsxs)("div",{className:"flex h-full flex-col gap-3",children:[(0,t.jsx)(s.Skeleton,{className:"h-5 w-28 rounded-md"}),(0,t.jsx)(s.Skeleton,{className:"h-8 w-4/5 rounded-md"}),(0,t.jsx)(s.Skeleton,{className:"h-4 w-3/4 rounded-md"}),(0,t.jsx)("div",{className:"mt-auto",children:(0,t.jsx)(s.Skeleton,{className:"h-4 w-20 rounded-md"})})]}):"error"===c?(0,t.jsxs)("div",{className:"flex h-full flex-col",children:[(0,t.jsx)("p",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-zinc-500",children:e}),(0,t.jsx)("p",{className:"mt-3 text-sm font-semibold text-zinc-900",children:"Erro ao carregar este insight."}),(0,t.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"Os dados não puderam ser processados agora."}),(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),d()},className:"mt-auto w-fit text-xs font-semibold text-brand underline underline-offset-4",children:"Tentar novamente"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,t.jsx)("p",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-zinc-500",children:e}),m?(0,t.jsx)("span",{className:"text-zinc-500",children:m}):null]}),(0,t.jsx)("p",{className:"mt-2 truncate text-[1.18rem] font-bold leading-tight text-zinc-900",children:i}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("p",{className:"truncate text-[13px] text-zinc-600",children:n}),r?(0,t.jsx)("p",{className:"mt-0.5 text-[11px] text-zinc-500",children:r}):null]}),(0,t.jsxs)("div",{className:"mt-auto pt-3",children:[p?(0,t.jsx)("div",{className:"mb-2 text-[11px]",children:p}):null,l.asButton?(0,t.jsx)("button",{type:"button",disabled:!!(l.disabled||l.loading),onClick:e=>{e.stopPropagation(),l.disabled||l.loading||l.onAction()},className:"h-9 w-full rounded-full bg-zinc-900 text-xs font-semibold text-white transition-colors hover:bg-zinc-800 disabled:cursor-not-allowed disabled:opacity-65",children:l.label}):(0,t.jsxs)("button",{type:"button",onClick:e=>{e.stopPropagation(),l.onAction()},className:"inline-flex items-center gap-1 text-xs font-semibold text-brand underline-offset-4 transition-colors hover:text-brand-strong hover:underline",children:[l.label,(0,t.jsx)(eS.ArrowRight,{className:"h-3 w-3"})]}),o?(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),o.onAction()},disabled:!!o.loading,className:"mt-2 w-full text-center text-xs font-semibold text-zinc-600 underline-offset-4 transition-colors hover:text-zinc-800 hover:underline disabled:cursor-not-allowed disabled:opacity-65",children:o.label}):null]})]})})}function eO({state:e="ready"}){let s=(0,n.useRouter)(),l=(0,n.usePathname)(),o=(0,n.useSearchParams)(),d=(0,y.useActivityStore)(e=>e.addActivity),[c,u]=(0,i.useState)(e),[m,x]=(0,i.useState)("idle"),[h,g]=(0,i.useState)(0),{filteredOpportunities:f,openOpportunities:b,now:v,userId:j}=z(),w=(0,i.useMemo)(()=>{let e;return e=f.filter(e=>"open"===e.status),eE.map(t=>{let i=e$[t],a=e.filter(e=>e.stage===i),n=a.length,s=a.reduce((e,t)=>e+(t.value||0),0),r=a.filter(e=>v.getTime()-new Date(e.updatedAt).getTime()>432e6),l=r.length,o=0;return r.length>0&&(o=Math.round(r.reduce((e,t)=>e+Math.round((v.getTime()-new Date(t.updatedAt).getTime())/864e5),0)/r.length)),{id:t,label:e_[t],volume:n,value:s,stalledCount:l,stalledDays:o}})},[f,v]),N=(0,i.useMemo)(()=>w.slice(0,-1).map((e,t)=>{let i=w[t+1],a=e.volume>0?Math.round(i.volume/e.volume*100):0;return{from:e,to:i,conversion:a,advanced:i.volume,base:e.volume}}),[w]),k=w.length>=2&&w.some(e=>e.volume>0),A=(0,i.useMemo)(()=>{var e;return(e=o.get("stage")??o.get("stageId"))?eE.includes(e)?e:eP[e]??null:null},[o]),S=(0,i.useMemo)(()=>A?w.find(e=>e.id===A)??null:null,[A,w]),T=(0,i.useMemo)(()=>0===N.length?null:N.reduce((e,t)=>t.conversion<e.conversion?t:e),[N]),C=(0,i.useMemo)(()=>{let e=T?.to.id??w[0]?.id??null;return e?w.find(t=>t.id===e)??null:null},[T,w]),I=S??C,D=S?.id??"all",M=(0,i.useMemo)(()=>0===N.length?null:N.reduce((e,t)=>t.conversion>e.conversion?t:e),[N]),$=M?.conversion??0,P=M?.from.label??"—",_=M?`${M.advanced} de ${M.base} oportunidades avan\xe7aram no per\xedodo.`:"Sem base comparável no período.",E=(0,i.useMemo)(()=>{let e=v.getTime()-432e6,t=S?e$[S.id]:null,i=b.filter(e=>!t||e.stage===t).filter(t=>new Date(t.updatedAt).getTime()<e).sort((e,t)=>new Date(e.updatedAt).getTime()-new Date(t.updatedAt).getTime()),a=i[0]??null,n=i.length;if(!a){let e=S?.id??C?.id??null;return{topDealLabel:"Sem oportunidades em risco hoje",description:S?`Etapa ${S.label} sem alertas cr\xedticos.`:"Sua carteira está sem riscos críticos no momento.",meta:"Total em risco: 0",total:n,stageId:e}}let s=eP[a.stage]??S?.id??null,r=s?e_[s]:"Etapa atual",l=Math.max(1,Math.round((v.getTime()-new Date(a.updatedAt).getTime())/864e5));return{topDealLabel:a.title||a.clientName,description:`${l} dias sem retorno \xb7 ${r}`,meta:`Total em risco: ${n}`,total:n,stageId:s}},[b,v,S,C]),R=T?Math.max(0,100-T.conversion):0;function V(e){if((S?.id??null)===e)return;let t=new URLSearchParams(o.toString());e?t.set("stage",e$[e]):(t.delete("stage"),t.delete("stageId"));let i=t.toString();s.replace(i?`${l}?${i}`:l,{scroll:!1})}function L({stageId:e,filters:t}={}){let i=new URLSearchParams;e&&i.set("stageId",e$[e]),t&&i.set("filters",t);let a=i.toString();s.push(a?`/pipes?${a}`:"/pipes")}function F(){if("loading"===m)return;if(!I)return void x("error");x("loading");let e=e$[I.id],t=b.filter(t=>t.stage===e&&v.getTime()-new Date(t.updatedAt).getTime()>432e6).slice(0,3),i=new Date(v);i.setDate(i.getDate()+1);let a=i.toISOString().split("T")[0],n=0;for(let e of t)d({title:`Follow-up: ${e.title||e.clientName}`,description:`Cobrar feedback — oportunidade parada h\xe1 +${Math.round((v.getTime()-new Date(e.updatedAt).getTime())/864e5)} dias`,type:"call",status:"pending",dueDate:a,dueTime:"10:00",opportunityId:e.id,clientId:e.clientId||"",responsibleId:j||e.responsibleId,responsibleName:e.responsibleName}),n+=1;if(0===n){g(0),x("error");return}g(n),x("success")}function B(){u("loading"),window.setTimeout(()=>{u("ready")},260)}return(0,i.useEffect)(()=>{u(e)},[e]),(0,i.useEffect)(()=>{x("idle"),g(0)},[S?.id]),(0,i.useEffect)(()=>{if("success"!==m&&"error"!==m)return;let e=setTimeout(()=>x("idle"),6e3);return()=>clearTimeout(e)},[m]),(0,t.jsxs)(eD,{noPadding:!0,elevated:!0,className:"premium-panel min-h-0 overflow-hidden border-zinc-200/80 bg-white/86 shadow-[0_20px_32px_-28px_rgba(15,23,42,0.45)]",children:[(0,t.jsx)("div",{className:"border-b border-zinc-200/75 bg-white/85 px-3.5 py-3 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("h3",{className:"font-heading text-[1.02rem] font-semibold text-zinc-900",children:"Raio X do Funil"}),(0,t.jsx)("p",{className:"truncate text-xs text-zinc-500",children:"Fluxo de conversão, gargalos e ação recomendada para hoje"})]}),(0,t.jsxs)(a.motion.button,{type:"button",onClick:()=>L({stageId:S?.id}),whileTap:{scale:.99},transition:{duration:.09,ease:"easeOut"},className:"group inline-flex shrink-0 items-center gap-1.5 rounded-full px-2 py-1 text-xs font-semibold text-zinc-700 transition-[background-color,color,border-color,opacity] duration-120 ease-out hover:bg-zinc-100 hover:text-zinc-900",children:[(0,t.jsx)("span",{className:"underline-offset-4 transition-colors duration-120 group-hover:underline",children:"Ver Pipeline"}),(0,t.jsx)(eS.ArrowRight,{className:"h-3.5 w-3.5"})]})]})}),"ready"!==c||k?null:(0,t.jsx)("div",{className:"p-5",children:(0,t.jsxs)("div",{className:"rounded-xl border border-dashed border-zinc-300 bg-zinc-50/70 p-4",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-zinc-900",children:"Sem dados suficientes para o Raio X"}),(0,t.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"Cadastre oportunidades para gerar conversão e gargalos acionáveis."}),(0,t.jsx)(p.Button,{size:"sm",className:"mt-3 h-8 rounded-full bg-zinc-900 text-xs text-white hover:bg-zinc-800",onClick:()=>L(),children:"Ver pipeline"})]})}),"loading"===c||"error"===c?(0,t.jsx)("div",{className:"p-5",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:[(0,t.jsx)(eB,{tag:"Oportunidades em risco",headline:"",description:"",primaryAction:{label:"Ver etapa",onAction:()=>{}},onRetry:B,status:"loading"===c?"loading":"error"}),(0,t.jsx)(eB,{tag:"Top gargalo",headline:"",description:"",primaryAction:{label:"Ver lista",onAction:()=>{}},onRetry:B,status:"loading"===c?"loading":"error"}),(0,t.jsx)(eB,{tag:"Destaque",headline:"",description:"",primaryAction:{label:"Ver motivo",onAction:()=>{}},onRetry:B,status:"loading"===c?"loading":"error"}),(0,t.jsx)(eB,{tag:"Ação recomendada",headline:"",description:"",primaryAction:{label:"Cobrar feedbacks",onAction:()=>{},asButton:!0},onRetry:B,status:"loading"===c?"loading":"error"})]})}):null,"ready"===c&&k?(0,t.jsx)(a.motion.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18,ease:"easeOut"},className:"flex flex-col gap-5 p-5",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(eM.TooltipProvider,{delayDuration:80,children:(0,t.jsx)(eF,{stages:w,transitions:N,selectedStageId:S?.id??null,bottleneckToStageId:T?.to.id??null,onSelectStage:V})}),S?(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-xl border border-zinc-200/80 bg-zinc-50/70 px-3 py-2",children:[(0,t.jsxs)("p",{className:"text-xs text-zinc-600",children:["Exibindo insights da etapa:"," ",(0,t.jsx)("span",{className:"font-semibold text-zinc-900",children:S.label})]}),(0,t.jsx)("button",{type:"button",onClick:()=>V(null),className:"text-xs font-semibold text-brand underline underline-offset-4",children:"Limpar seleção"})]}):null,(0,t.jsx)(eA.AnimatePresence,{mode:"wait",children:(0,t.jsxs)(a.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.14},className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:[(0,t.jsx)(eB,{tag:"Oportunidades em risco",headline:E.topDealLabel,description:E.description,meta:E.meta,primaryAction:{label:E.total>0?"Ver etapa":"Ver pipeline",onAction:()=>E.total>0?L({stageId:E.stageId??void 0,filters:"risk"}):L({stageId:S?.id})},onRetry:B,icon:(0,t.jsx)(r.AlertTriangle,{className:"h-4 w-4 text-amber-600"})}),(0,t.jsx)(eB,{tag:"Top gargalo",headline:T?`Queda de ${R}% em ${T.to.label}`:"Sem gargalos relevantes no período",description:T?`${T.to.stalledCount} oportunidades paradas h\xe1 +${T.to.stalledDays} dias`:"Nenhuma etapa com queda crítica no período atual.",primaryAction:{label:T?"Ver lista":"Ver pipeline",onAction:()=>T?L({stageId:T.to.id,filters:"stalled"}):L()},onRetry:B,tone:T?"danger":"neutral",icon:(0,t.jsx)(eI,{className:"h-4 w-4 text-red-600"})}),(0,t.jsx)(eB,{tag:"Destaque",headline:M&&M.base>0?`Melhor convers\xe3o: ${$}% em ${P}`:"Sem base comparável no período",description:_,primaryAction:{label:M&&M.base>0?"Ver motivo":"Ver pipeline",onAction:()=>M&&M.base>0?void(M?.from.id&&V(M.from.id)):L()},onRetry:B,tone:M&&M.base>0?"success":"neutral",icon:(0,t.jsx)(eT.ArrowUpRight,{className:"h-4 w-4 text-emerald-600"})}),(0,t.jsx)(eB,{tag:"Ação recomendada",headline:I?"Cobrar feedbacks":"Nenhuma ação recomendada agora",description:I?`Aten\xe7\xe3o: ${E.total} oportunidades paradas. Priorizar follow-up hoje.`:"Sem oportunidades paradas críticas neste momento.",primaryAction:{label:"loading"===m?"Criando ações...":I?"Cobrar feedbacks":"Ver pipeline",onAction:()=>I?F():L(),asButton:!0,disabled:"loading"===m,loading:"loading"===m},feedback:(0,t.jsxs)(t.Fragment,{children:["success"===m?(0,t.jsxs)("p",{className:"rounded-md border border-emerald-200 bg-emerald-50 px-2 py-1 text-emerald-700",children:["Ações criadas (",h,")."," ",(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),s.push("/activities?statuses=pending,overdue&q=Follow-up")},className:"font-semibold underline underline-offset-4",children:"Ver atividades"})]}):null,"error"===m?(0,t.jsxs)("p",{className:"rounded-md border border-red-200 bg-red-50 px-2 py-1 text-red-700",children:["Não foi possível criar ações agora."," ",(0,t.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),F()},className:"font-semibold underline underline-offset-4",children:"Tentar novamente"})]}):null]}),onRetry:B,icon:(0,t.jsx)(eC.Sparkles,{className:"h-4 w-4 text-brand"})})]},D)})]})}):null]})}var eq=e.i(63209),eH=e.i(59208),eG=e.i(95468),eU=e.i(74886),eK=e.i(78917),eY=e.i(52571),eW=e.i(63488),eX=e.i(94983),eQ=e.i(41071),eZ=e.i(43432),eJ=e.i(16715),e0=e.i(20278),e1=e.i(93479),e2=e.i(37822),e5=e.i(68499),e4=e.i(96435),e3=e.i(32739);let e6={"lead-in":"Leads","contato-feito":"Contato","reuniao-agendada":"Reunião","proposta-enviada":"Proposta",negociacao:"Negociação",fechamento:"Fechamento"},e8=[{id:"all",label:"Todos"},{id:"critical",label:"Críticos"},{id:"churn",label:"Risco de churn"},{id:"pipeline",label:"Pipeline parado"},{id:"activities",label:"Atividades"},{id:"goals",label:"Metas"}],e7=[{label:"1h",hours:1},{label:"Amanhã",hours:24},{label:"1 semana",hours:168}],e9={critical:0,high:1,medium:2},te={in_progress:0,open:1,resolved:2,snoozed:3};function tt(e){let t=e.getFullYear(),i=`${e.getMonth()+1}`.padStart(2,"0"),a=`${e.getDate()}`.padStart(2,"0");return`${t}-${i}-${a}`}function ti(e){return e?e6[e]??"Sem etapa":"Sem etapa"}function ta(e){return"critical"===e?"critical":"high"}function tn(e){if(!Number.isFinite(e)||e<=0)return"0min";let t=Math.max(1,Math.round(e/6e4));if(t<60)return`${t}min`;let i=Math.round(t/60);if(i<24)return`${i}h`;let a=Math.round(i/24);return`${a}d`}function ts(e){return"call"===e?"Ligar":"whatsapp"===e?"WhatsApp":"email"===e?"Email":"meeting"===e?"Entrar":"Executar"}function tr(e){return"call"===e?eZ.Phone:"email"===e?eW.Mail:"whatsapp"===e?eX.MessageCircle:eH.CalendarClock}function tl(e){return"open"===e||"in_progress"===e}function to(){let e=(0,n.useRouter)(),{riskAlerts:a}=(0,e3.useExecutionPanelData)(),{filteredActivities:l,openOpportunities:o,now:d,userId:u}=z(),m=(0,v.useAuthStore)(e=>e.user?.name??"Sales Executive"),h=(0,e4.useClientStore)(e=>e.clients),g=(0,y.useActivityStore)(e=>e.activities),f=(0,y.useActivityStore)(e=>e.isLoading),b=(0,j.useOpportunityStore)(e=>e.isLoading),w=(0,y.useActivityStore)(e=>e.addActivity),k=(0,j.useOpportunityStore)(e=>e.updateOpportunity),[A,S]=(0,i.useState)("all"),[T,C]=(0,i.useState)({}),[I,D]=(0,i.useState)(new Set),[M,$]=(0,i.useState)(null),[P,_]=(0,i.useState)({}),[E,R]=(0,i.useState)([]),[V,L]=(0,i.useState)(!1),F=(0,i.useMemo)(()=>{let e=new Map(o.map(e=>[e.id,e])),t=new Map(h.map(e=>[e.id,e])),i=new Map,n=e=>{let t=`${e.kind}:${e.entityId??"global"}:${e.reasonCode}`,a=i.get(t);a?i.set(t,{...a,impactScore:Math.max(a.impactScore,e.impactScore),severity:e9[e.severity]<e9[a.severity]?e.severity:a.severity,duplicateCount:a.duplicateCount+1}):i.set(t,{...e,duplicateCount:1})};for(let i of a){if("health-drop"===i.type){let e=i.linkedEntityId?t.get(i.linkedEntityId):null;n({id:i.id,title:"Saúde crítica",context:e?.companyName??i.title,impact:i.description,recommendation:"Reengajar cliente com follow-up imediato.",consequence:"Vai criar atividade de WhatsApp para hoje.",severity:ta(i.severity),kind:"health_critical",group:"churn",reasonCode:"health_drop",viewPath:i.linkedEntityId?`/clients/${i.linkedEntityId}`:"/clients?health=critical",entityId:i.linkedEntityId,impactScore:e?.monthlyRevenue??0});continue}if("stale"===i.type){let t=i.linkedEntityId?e.get(i.linkedEntityId):null,a=t?Math.max(1,Math.round((d.getTime()-new Date(t.updatedAt).getTime())/864e5)):null;n({id:i.id,title:a?`Parado h\xe1 ${a}d`:"Pipeline parado",context:t?`${t.clientName} - ${ti(t.stage)}`:i.title,impact:i.description,recommendation:"Cobrar resposta e registrar próxima ação.",consequence:"Vai criar follow-up para hoje e abrir a oportunidade filtrada.",severity:ta(i.severity),kind:"stalled_deal",group:"pipeline",reasonCode:"stalled_deal",viewPath:i.linkedEntityId?`/pipes?opportunityId=${i.linkedEntityId}&tab=activities`:"/pipes?filter=stale",entityId:i.linkedEntityId,impactScore:t?.value??0});continue}if("sla-breach"===i.type){let t=i.linkedEntityId?e.get(i.linkedEntityId):null;n({id:i.id,title:"SLA estourado",context:t?`${t.clientName} - ${ti(t.stage)}`:i.title,impact:i.description,recommendation:"Tratar SLA imediatamente e formalizar próxima ação.",consequence:"Vai criar atividade crítica de follow-up para hoje.",severity:"critical",kind:"sla_risk",group:"pipeline",reasonCode:"sla_breach",viewPath:i.linkedEntityId?`/pipes?opportunityId=${i.linkedEntityId}&filter=sla_overdue`:"/pipes?filter=sla_overdue",entityId:i.linkedEntityId,impactScore:(t?.value??0)+2e5});continue}if("goal-risk"===i.type){n({id:i.id,title:"Meta em risco",context:i.title,impact:i.description,recommendation:"Ajustar plano de recuperação da meta agora.",consequence:"Vai criar tarefa de recuperação e abrir metas em risco.",severity:"critical",kind:"goal_risk",group:"goals",reasonCode:"goal_risk",viewPath:"/goals",entityId:i.linkedEntityId,impactScore:12e4});continue}if("contract-expiring"===i.type){let e=i.linkedEntityId?t.get(i.linkedEntityId):null;n({id:i.id,title:"Contrato expirando",context:e?.companyName??i.title,impact:i.description,recommendation:"Iniciar renovação com proposta de valor objetiva.",consequence:"Vai criar atividade de renovação para hoje.",severity:ta(i.severity),kind:"contract_risk",group:"churn",reasonCode:"contract_expiring",viewPath:i.linkedEntityId?`/clients/${i.linkedEntityId}`:"/clients",entityId:i.linkedEntityId,impactScore:e?.monthlyRevenue??0})}}let s=l.filter(e=>"overdue"===e.effectiveStatus);if(s.length>0){let e=s.reduce((e,t)=>{let i=(0,N.getActivityDueAt)(t);return Math.max(e,d.getTime()-i.getTime())},0),t=s.length>=8?"critical":s.length>=3?"high":"medium";n({id:"overdue-activities",title:"Atividades atrasadas",context:`${s.length} item(ns) aguardando execu\xe7\xe3o`,impact:`Maior atraso acumulado: ${tn(e)}.`,recommendation:"Priorizar backlog atrasado para proteger o SLA.",consequence:"Vai abrir a lista de atrasadas e criar tarefa de mutirão.",severity:t,kind:"overdue_activities",group:"activities",reasonCode:"overdue_activities",viewPath:"/activities?status=overdue",impactScore:1e4*s.length})}return Array.from(i.values()).sort((e,t)=>{let i=e9[e.severity]-e9[t.severity];return 0!==i?i:t.impactScore-e.impactScore})},[a,l,o,h,d]),B=(0,i.useMemo)(()=>F.filter(e=>!I.has(e.id)).filter(e=>(T[e.id]?.status??"open")!=="snoozed").filter(e=>"all"===A||("critical"===A?"critical"===e.severity:e.group===A)).sort((e,t)=>{let i=T[e.id]?.status??"open",a=T[t.id]?.status??"open",n=te[i]-te[a];return 0!==n?n:e9[e.severity]-e9[t.severity]}),[F,I,T,A]),O=B.filter(e=>tl(T[e.id]?.status??"open")),q=(0,i.useMemo)(()=>{let e={all:0,critical:0,churn:0,pipeline:0,activities:0,goals:0};for(let t of F)!I.has(t.id)&&tl(T[t.id]?.status??"open")&&(e.all+=1,"critical"===t.severity&&(e.critical+=1),e[t.group]+=1);return e},[F,I,T]),H=f||b,G=(e,t)=>{C(i=>({...i,[e]:t}))},U=e=>{window.setTimeout(()=>{D(t=>{let i=new Set(t);return i.add(e),i})},1800)};(0,i.useEffect)(()=>{let e=Object.entries(T).filter(([,e])=>e.feedback?.tone==="info"&&"resolved"!==e.status).map(([e])=>e);if(0===e.length)return;let t=setTimeout(()=>{C(t=>{let i={...t};for(let t of e){let e=i[t];if(e?.feedback?.tone==="info"){let{feedback:a,...n}=e;i[t]=n}}return i})},5e3);return()=>clearTimeout(t)},[T]);let K=e=>{let t=g.find(t=>{if("completed"===t.status||"cancelled"===t.status)return!1;let i=t.title.toLowerCase(),a=e.opportunityId&&t.opportunityId===e.opportunityId,n=e.clientId&&t.clientId===e.clientId;return(!!a||!!n)&&i.includes(e.searchTerm)});return t?t.id:w({title:e.title,description:e.description,type:e.type,status:"pending",dueDate:tt(d),dueTime:e.dueTime,opportunityId:e.opportunityId,clientId:e.clientId,responsibleId:u,responsibleName:m}).id},Y=async e=>{if("health_critical"===e.kind){let t=K({title:`Follow-up de sa\xfade: ${e.context}`,description:`Gerado a partir de alerta: ${e.title}`,type:"whatsapp",dueTime:"16:00",clientId:e.entityId,searchTerm:"saúde"});return{message:"Resolvido, atividade criada para hoje.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${t}`}}if("contract_risk"===e.kind){let t=K({title:`Renovacao de contrato: ${e.context}`,description:`Gerado a partir de alerta: ${e.title}`,type:"meeting",dueTime:"15:00",clientId:e.entityId,searchTerm:"renovação"});return{message:"Resolvido, atividade de renovação criada.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${t}`}}if("stalled_deal"===e.kind){let t=e.entityId?o.find(t=>t.id===e.entityId):null,i=K({title:`Follow-up urgente: ${t?.clientName??e.context}`,description:`Gerado a partir de alerta: ${e.title}`,type:"follow-up",dueTime:"11:00",opportunityId:t?.id,clientId:t?.clientId,searchTerm:"follow-up"});return t?.id&&k(t.id,{updatedAt:new Date().toISOString()}),{message:"Resolvido, follow-up registrado e deal atualizado.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${i}`}}if("sla_risk"===e.kind){let t=e.entityId?o.find(t=>t.id===e.entityId):null,i=K({title:`SLA cr\xedtico: ${t?.clientName??e.context}`,description:`Gerado a partir de alerta: ${e.title}`,type:"call",dueTime:"10:00",opportunityId:t?.id,clientId:t?.clientId,searchTerm:"sla"});return t?.id&&k(t.id,{updatedAt:new Date().toISOString()}),{message:"Resolvido, plano de SLA registrado para hoje.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${i}`}}if("goal_risk"===e.kind){let t=K({title:"Plano de recuperação da meta",description:`Gerado a partir de alerta: ${e.context}`,type:"task",dueTime:"09:00",searchTerm:"recuperação da meta"});return{message:"Resolvido, plano de recuperação criado.",linkLabel:"Ver plano",linkPath:`/activities?activityId=${t}`}}if("overdue_activities"===e.kind){let e=K({title:"Mutirão de atividades atrasadas",description:"Priorizar backlog atrasado e concluir itens críticos.",type:"task",dueTime:"09:30",searchTerm:"mutirão"});return{message:"Resolvido, mutirão criado para limpar atrasos.",linkLabel:"Ver mutirão",linkPath:`/activities?activityId=${e}`}}return{message:"Alerta tratado com sucesso.",linkLabel:"Ver detalhes",linkPath:e.viewPath}},W=async e=>{G(e.id,{status:"in_progress"});try{await new Promise(e=>{window.setTimeout(e,180)});let t=await Y(e);G(e.id,{status:"resolved",feedback:{tone:"success",message:t.message,linkLabel:t.linkLabel,linkPath:t.linkPath}}),U(e.id)}catch{G(e.id,{status:"open",feedback:{tone:"error",message:"Não consegui resolver agora."}})}},X=async e=>{try{await navigator.clipboard.writeText(`${e.title} | ${e.context} | ${e.impact} | A\xe7\xe3o: ${e.recommendation}`),G(e.id,{status:T[e.id]?.status??"open",feedback:{tone:"info",message:"Resumo copiado."}})}catch{G(e.id,{status:T[e.id]?.status??"open",feedback:{tone:"error",message:"Não consegui copiar o resumo."}})}},Q=async()=>{for(let e of(L(!1),O))await W(e)};return(0,t.jsxs)(eD,{className:"premium-panel flex flex-col gap-4 border-zinc-200/80 bg-white/88 p-5 shadow-[0_18px_32px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-zinc-900",children:"Alertas Críticos"}),(0,t.jsx)("span",{className:"inline-flex h-6 min-w-6 items-center justify-center rounded-full border border-red-200 bg-red-50 px-2 text-xs font-semibold text-red-700",children:q.all}),E.length>0?(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2 py-1 text-[11px] font-medium text-sky-700",children:["Adiados ",E.length,(0,t.jsx)("button",{type:"button",className:"underline underline-offset-4",onClick:()=>{R(e=>{if(0===e.length)return e;let t=[...e],i=t.pop();return i&&G(i.id,{status:"open",feedback:{tone:"info",message:"Adiamento desfeito."}}),t})},children:"Desfazer"})]}):null]}),O.length>1?(0,t.jsx)(p.Button,{size:"xs",variant:"outline",className:"h-7 rounded-full border-zinc-200 px-3 text-xs",onClick:()=>{O.length<2||L(!0)},children:"Resolver todos do tipo"}):null,(0,t.jsx)(e5.AlertDialog,{open:V,onOpenChange:L,children:(0,t.jsxs)(e5.AlertDialogContent,{children:[(0,t.jsxs)(e5.AlertDialogHeader,{children:[(0,t.jsxs)(e5.AlertDialogTitle,{children:["Resolver ",O.length," alerta(s)?"]}),(0,t.jsx)(e5.AlertDialogDescription,{children:"Isso vai criar atividades de follow-up para cada alerta acionável visível."})]}),(0,t.jsxs)(e5.AlertDialogFooter,{children:[(0,t.jsx)(e5.AlertDialogCancel,{children:"Cancelar"}),(0,t.jsx)(e5.AlertDialogAction,{onClick:Q,children:"Resolver todos"})]})]})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-1.5",children:e8.map(e=>{let i=A===e.id,a=q[e.id];return(0,t.jsxs)("button",{type:"button",onClick:()=>S(e.id),className:(0,ev.cn)("inline-flex h-7 items-center gap-1 rounded-full border px-2.5 text-[11px] font-medium transition-[border-color,background-color,color] duration-150",i?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 bg-white text-zinc-600 hover:border-zinc-300 hover:text-zinc-900"),children:[e.label,(0,t.jsx)("span",{className:(0,ev.cn)("text-[10px]",i?"text-white/80":"text-zinc-400"),children:a})]},e.id)})}),H?(0,t.jsx)("div",{className:"space-y-2",children:Array.from({length:3}).map((e,i)=>(0,t.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 p-3",children:[(0,t.jsx)(s.Skeleton,{className:"h-4 w-44"}),(0,t.jsx)(s.Skeleton,{className:"mt-2 h-3 w-full"}),(0,t.jsx)(s.Skeleton,{className:"mt-2 h-3 w-[82%]"})]},i))}):null,H||0!==B.length?null:(0,t.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 bg-zinc-50/40 p-6 text-center",children:[(0,t.jsx)(eG.CheckCircle2,{className:"mx-auto h-7 w-7 text-emerald-600"}),(0,t.jsx)("p",{className:"mt-2 text-sm font-medium text-zinc-900",children:"Sem alertas ativos no seu escopo."}),(0,t.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"Tudo estável por enquanto."})]}),H?null:(0,t.jsx)("div",{className:"space-y-2.5",children:B.map(i=>{var a,n;let s=T[i.id],l=s?.status??"open",o="in_progress"===l,u="resolved"===l;return(0,t.jsxs)("article",{className:(0,ev.cn)("rounded-xl border bg-white p-3 transition-[border-color,box-shadow,background-color] duration-150","hover:border-zinc-300 hover:bg-zinc-50/40 hover:shadow-[0_14px_24px_-24px_rgba(15,23,42,0.45)]",u&&"border-emerald-200 bg-emerald-50/30",!u&&"critical"===i.severity&&"border-red-200/85",!u&&"high"===i.severity&&"border-amber-200/85",!u&&"medium"===i.severity&&"border-sky-200/85"),children:[(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)("span",{className:"mt-0.5 shrink-0",children:"sla_risk"===i.kind?(0,t.jsx)(c.ShieldAlert,{className:"h-4 w-4 text-red-600"}):"goal_risk"===i.kind?(0,t.jsx)(e0.Target,{className:"h-4 w-4 text-amber-600"}):"critical"===i.severity?(0,t.jsx)(eq.AlertCircle,{className:"h-4 w-4 text-red-600"}):"high"===i.severity?(0,t.jsx)(r.AlertTriangle,{className:"h-4 w-4 text-amber-600"}):(0,t.jsx)(eY.Info,{className:"h-4 w-4 text-sky-600"})}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,t.jsx)("p",{className:"text-sm font-semibold text-zinc-900",children:i.title}),(0,t.jsx)("span",{className:(0,ev.cn)("inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] font-semibold","critical"===(a=i.severity)?"border-red-200 bg-red-50 text-red-700":"high"===a?"border-amber-200 bg-amber-50 text-amber-700":"border-sky-200 bg-sky-50 text-sky-700"),children:"critical"===(n=i.severity)?"Crítico":"high"===n?"Alto":"Médio"}),i.duplicateCount>1?(0,t.jsxs)("span",{className:"inline-flex items-center rounded-full border border-zinc-200 bg-zinc-100 px-2 py-0.5 text-[10px] font-semibold text-zinc-600",children:["+",i.duplicateCount-1]}):null]}),(0,t.jsx)("p",{className:"mt-1 truncate text-sm text-zinc-700",children:i.context}),(0,t.jsxs)("p",{className:"mt-0.5 text-xs text-zinc-500",children:["Impacto: ",i.impact]})]})]}),(0,t.jsxs)("div",{className:"mt-2 rounded-lg border border-zinc-200/80 bg-zinc-50/70 p-2.5",children:[(0,t.jsxs)("p",{className:"text-xs font-semibold text-zinc-700",children:["Ação recomendada: ",i.recommendation]}),(0,t.jsx)("p",{className:"mt-0.5 text-xs text-zinc-500",children:i.consequence})]})]}),(0,t.jsxs)("div",{className:"flex shrink-0 flex-col items-end gap-1.5",children:[(0,t.jsx)(p.Button,{size:"xs",className:"h-7 rounded-md bg-zinc-900 px-3 text-xs font-semibold text-white hover:bg-zinc-800",disabled:o||u,onClick:()=>W(i),children:o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(eJ.RefreshCw,{className:"h-3.5 w-3.5 animate-spin"}),"Executando..."]}):"Resolver"}),(0,t.jsx)(p.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-3 text-xs",onClick:()=>e.push(i.viewPath),children:"Ver"}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsxs)(e2.Popover,{open:M===i.id,onOpenChange:e=>$(e?i.id:null),children:[(0,t.jsx)(e2.PopoverTrigger,{asChild:!0,children:(0,t.jsxs)(p.Button,{size:"xs",variant:"ghost",className:"h-7 px-2 text-xs text-zinc-600",children:[(0,t.jsx)(eg.Clock3,{className:"h-3.5 w-3.5"}),"Adiar"]})}),(0,t.jsxs)(e2.PopoverContent,{align:"end",className:"w-64 rounded-xl border-zinc-200 p-3",children:[(0,t.jsxs)(e2.PopoverHeader,{className:"gap-0.5",children:[(0,t.jsx)(e2.PopoverTitle,{children:"Adiar alerta"}),(0,t.jsx)(e2.PopoverDescription,{children:"Escolha o tempo e informe o motivo."})]}),(0,t.jsx)(e1.Input,{className:"mt-2 h-8",placeholder:"Motivo (opcional)",value:P[i.id]??"",onChange:e=>_(t=>({...t,[i.id]:e.target.value}))}),(0,t.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-1.5",children:e7.map(e=>(0,t.jsx)(p.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 text-[11px]",onClick:()=>{var t;let a,n;return t=e.hours,a=(P[i.id]??"").trim(),n=new Date(d.getTime()+60*t*6e4).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),void(G(i.id,{status:"snoozed",feedback:{tone:"info",message:a?`Adiado ate ${n}. Motivo: ${a}.`:`Adiado ate ${n}.`}}),R(e=>[...e,{id:i.id,label:i.title}]),$(null))},children:e.label},e.label))})]})]}),(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(p.Button,{size:"icon-xs",variant:"ghost",className:"h-7 w-7 text-zinc-500",children:(0,t.jsx)(eQ.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(x.DropdownMenuContent,{align:"end",className:"w-52 rounded-xl",children:[(0,t.jsxs)(x.DropdownMenuItem,{onClick:()=>{G(i.id,{status:"resolved",feedback:{tone:"success",message:"Marcado como tratado.",linkLabel:"Ver entidade",linkPath:i.viewPath}}),U(i.id)},children:[(0,t.jsx)(eG.CheckCircle2,{className:"h-3.5 w-3.5"}),"Marcar como tratado"]}),(0,t.jsxs)(x.DropdownMenuItem,{onClick:()=>X(i),children:[(0,t.jsx)(eU.Copy,{className:"h-3.5 w-3.5"}),"Copiar resumo"]}),(0,t.jsx)(x.DropdownMenuSeparator,{}),(0,t.jsxs)(x.DropdownMenuItem,{onClick:()=>e.push(i.viewPath),children:[(0,t.jsx)(eK.ExternalLink,{className:"h-3.5 w-3.5"}),"Abrir entidade"]})]})]})]})]})]}),s?.feedback?(0,t.jsxs)("div",{className:(0,ev.cn)("mt-2 flex flex-wrap items-center gap-2 rounded-md border px-2.5 py-1.5 text-xs","success"===s.feedback.tone&&"border-emerald-200 bg-emerald-50/70 text-emerald-700","info"===s.feedback.tone&&"border-sky-200 bg-sky-50/70 text-sky-700","error"===s.feedback.tone&&"border-red-200 bg-red-50/70 text-red-700"),children:[(0,t.jsx)("span",{children:s.feedback.message}),s.feedback.linkPath&&s.feedback.linkLabel?(0,t.jsx)("button",{type:"button",className:"font-semibold underline underline-offset-4",onClick:()=>e.push(s.feedback?.linkPath??i.viewPath),children:s.feedback.linkLabel}):null,"error"===s.feedback.tone?(0,t.jsx)("button",{type:"button",className:"font-semibold underline underline-offset-4",onClick:()=>W(i),children:"Tentar novamente"}):null]}):null]},i.id)})})]})}function td(){let e=(0,n.useRouter)(),{filteredActivities:a,now:r}=z(),l=(0,y.useActivityStore)(e=>e.completeActivity),o=(0,y.useActivityStore)(e=>e.postponeActivity),d=(0,y.useActivityStore)(e=>e.cancelActivity),c=(0,y.useActivityStore)(e=>e.isLoading),[u,m]=(0,i.useState)(new Set),[h,g]=(0,i.useState)(null),[f,b]=(0,i.useState)({}),[v,j]=(0,i.useState)(null),[w,k]=(0,i.useState)({}),[A,S]=(0,i.useState)(null);(0,i.useEffect)(()=>{if(!v)return;let e=setTimeout(()=>j(null),6e3);return()=>clearTimeout(e)},[v]);let T=tt(r),C=(0,i.useMemo)(()=>a.filter(e=>"pending"===e.effectiveStatus||"overdue"===e.effectiveStatus).filter(e=>e.dueDate<=T).map(e=>{let t=(0,N.getActivityDueAt)(e),i="overdue"===e.effectiveStatus;return{id:e.id,title:e.title,clientLine:e.clientName||e.opportunityTitle||"Sem cliente associado",description:e.description||"Sem descrição registrada.",type:e.type,status:i?"overdue":"pending",dueDate:e.dueDate,dueTime:e.dueTime,dueAt:t,hasTime:!!e.dueTime,delayLabel:i?`Atrasada ${tn(r.getTime()-t.getTime())}`:null}}).sort((e,t)=>e.dueAt.getTime()-t.dueAt.getTime()).slice(0,10),[a,r,T]),I=C.filter(e=>e.hasTime),D=C.filter(e=>!e.hasTime),M=C.filter(e=>"overdue"===e.status).length,$=C.filter(e=>e.dueDate===T).length,P=(e,t)=>{k(i=>({...i,[e]:t}))},_=e=>{let t,i=tt(((t=new Date(r)).setDate(t.getDate()+1),t));g(e.id),b(t=>({...t,[e.id]:{dueDate:e.dueDate||i,dueTime:e.dueTime||"09:00"}}))},E=e=>{P(e.id,{loading:!0});try{l(e.id,"Concluída pela Agenda de Hoje"),j({tone:"success",message:"Atividade concluída com sucesso.",linkLabel:"Ver historico",linkPath:"/activities?status=completed"}),m(t=>{let i=new Set(t);return i.delete(e.id),i}),P(e.id,{})}catch{P(e.id,{error:"Não consegui concluir agora."})}};return(0,t.jsxs)(eD,{className:"premium-panel flex min-h-[320px] flex-col gap-4 border-zinc-200/80 bg-white/88 p-5 shadow-[0_18px_32px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[(0,t.jsx)("h3",{className:"text-base font-semibold text-zinc-900",children:"Agenda de Hoje"}),(0,t.jsxs)("span",{className:"inline-flex h-6 items-center rounded-full border border-red-200 bg-red-50 px-2 text-[11px] font-semibold text-red-700",children:["Atrasadas ",M]}),(0,t.jsxs)("span",{className:"inline-flex h-6 items-center rounded-full border border-zinc-200 bg-zinc-100 px-2 text-[11px] font-semibold text-zinc-700",children:["Hoje ",$]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsxs)(p.Button,{size:"xs",variant:"outline",className:"h-7 rounded-full border-zinc-200 px-3 text-xs",onClick:()=>e.push("/activities?view=agenda"),children:["Ver tudo",(0,t.jsx)(eh.ChevronRight,{className:"h-3.5 w-3.5"})]}),(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(p.Button,{size:"icon-xs",variant:"ghost",className:"h-7 w-7 text-zinc-500",children:(0,t.jsx)(eQ.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,t.jsx)(x.DropdownMenuContent,{align:"end",className:"w-52 rounded-xl",children:(0,t.jsx)(x.DropdownMenuItem,{onClick:()=>e.push("/activities?status=overdue"),children:"Ver apenas atrasadas"})})]})]})]}),v?(0,t.jsxs)("div",{className:(0,ev.cn)("flex flex-wrap items-center gap-2 rounded-lg border px-3 py-2 text-xs","success"===v.tone&&"border-emerald-200 bg-emerald-50/70 text-emerald-700","info"===v.tone&&"border-sky-200 bg-sky-50/70 text-sky-700","error"===v.tone&&"border-red-200 bg-red-50/70 text-red-700"),children:[(0,t.jsx)("span",{children:v.message}),v.linkPath&&v.linkLabel?(0,t.jsx)("button",{type:"button",className:"font-semibold underline underline-offset-4",onClick:()=>e.push(v.linkPath??"/activities"),children:v.linkLabel}):null]}):null,c?(0,t.jsx)("div",{className:"space-y-2",children:Array.from({length:4}).map((e,i)=>(0,t.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 p-3",children:[(0,t.jsx)(s.Skeleton,{className:"h-4 w-32"}),(0,t.jsx)(s.Skeleton,{className:"mt-2 h-3 w-[88%]"}),(0,t.jsx)(s.Skeleton,{className:"mt-2 h-8 w-40"})]},i))}):null,c||0!==C.length?null:(0,t.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 bg-zinc-50/40 p-6 text-center",children:[(0,t.jsx)(eG.CheckCircle2,{className:"mx-auto h-7 w-7 text-emerald-600"}),(0,t.jsx)("p",{className:"mt-2 text-sm font-medium text-zinc-900",children:"Sem atividades pendentes para hoje."}),(0,t.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"A agenda está limpa no seu escopo."}),(0,t.jsx)(p.Button,{size:"xs",variant:"outline",className:"mt-3 h-7 rounded-full border-zinc-200 px-3 text-xs",onClick:()=>e.push("/activities?view=agenda"),children:"Abrir agenda completa"})]}),!c&&C.length>0?(0,t.jsxs)("div",{className:"space-y-2",children:[I.map(i=>{let a=tr(i.type),n=w[i.id],s=f[i.id],r=h===i.id,l=u.has(i.id);return(0,t.jsx)("article",{className:(0,ev.cn)("rounded-xl border border-zinc-200/85 bg-white p-3 transition-[border-color,box-shadow,background-color] duration-150","hover:border-zinc-300 hover:bg-zinc-50/40 hover:shadow-[0_12px_24px_-24px_rgba(15,23,42,0.45)]","overdue"===i.status&&"border-red-200/90"),children:(0,t.jsxs)("div",{className:"grid gap-3 md:grid-cols-[96px_minmax(0,1fr)_auto] md:items-start",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-xl font-semibold tabular-nums text-zinc-900",children:i.dueTime||"--:--"}),i.delayLabel?(0,t.jsx)("p",{className:"text-xs font-medium text-red-600",children:i.delayLabel}):(0,t.jsx)("p",{className:"text-xs text-zinc-500",children:"No prazo"})]}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(a,{className:"mt-0.5 h-4 w-4 text-zinc-500"}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("p",{className:"truncate text-sm font-semibold text-zinc-900",children:i.title}),(0,t.jsx)("p",{className:"truncate text-xs text-zinc-600",children:i.clientLine}),(0,t.jsx)("p",{className:"mt-0.5 truncate text-xs text-zinc-500",children:i.description})]})]}),l?(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-1.5 rounded-md border border-zinc-200 bg-zinc-50/80 p-2",children:[(0,t.jsx)("span",{className:"text-xs text-zinc-600",children:"Execução iniciada:"}),(0,t.jsx)(p.Button,{size:"xs",className:"h-7 rounded-md bg-zinc-900 px-2.5 text-xs text-white hover:bg-zinc-800",onClick:()=>E(i),children:"Marcar concluída"}),(0,t.jsx)(p.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-2.5 text-xs",onClick:()=>e.push(`/activities?activityId=${i.id}`),children:"Registrar nota"})]}):null,r?(0,t.jsxs)("div",{className:"mt-2 grid gap-1.5 rounded-md border border-zinc-200 bg-zinc-50/80 p-2 md:grid-cols-[1fr_110px_auto] md:items-center",children:[(0,t.jsx)(e1.Input,{type:"date",className:"h-8",value:s?.dueDate??"",onChange:e=>b(t=>({...t,[i.id]:{dueDate:e.target.value,dueTime:t[i.id]?.dueTime??i.dueTime??"09:00"}}))}),(0,t.jsx)(e1.Input,{type:"time",className:"h-8",value:s?.dueTime??"",onChange:e=>b(t=>({...t,[i.id]:{dueDate:t[i.id]?.dueDate??i.dueDate,dueTime:e.target.value}}))}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(p.Button,{size:"xs",className:"h-8 rounded-md bg-zinc-900 px-2.5 text-xs text-white hover:bg-zinc-800",onClick:()=>(e=>{let t=f[e.id];if(!t?.dueDate)return void P(e.id,{error:"Escolha uma data válida."});P(e.id,{loading:!0});try{var i,a;let n;o(e.id,t.dueDate,t.dueTime||void 0),g(null),j({tone:"success",message:`Reagendado para ${(i=t.dueDate,a=t.dueTime,n=new Date(`${i}T${a||"09:00"}:00`),Number.isNaN(n.getTime())?a?`${i} ${a}`:i:n.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}))}.`}),m(t=>{let i=new Set(t);return i.delete(e.id),i}),P(e.id,{})}catch{P(e.id,{error:"Não consegui reagendar agora."})}})(i),children:"Salvar"}),(0,t.jsx)(p.Button,{size:"xs",variant:"ghost",className:"h-8 rounded-md px-2.5 text-xs",onClick:()=>g(null),children:"Cancelar"})]})]}):null,n?.error?(0,t.jsxs)("div",{className:"mt-2 rounded-md border border-red-200 bg-red-50/70 px-2.5 py-1.5 text-xs text-red-700",children:[n.error,(0,t.jsx)("button",{type:"button",className:"ml-2 font-semibold underline underline-offset-4",onClick:()=>P(i.id,{}),children:"Tentar novamente"})]}):null]}),(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 md:flex-col md:items-end",children:[(0,t.jsx)(p.Button,{size:"xs",className:"h-7 rounded-md bg-zinc-900 px-3 text-xs text-white hover:bg-zinc-800",disabled:n?.loading,onClick:()=>{var t,a;m(e=>{let t=new Set(e);return t.add(i.id),t}),j({tone:"info",message:`${ts(i.type)} iniciado. Ao voltar, conclua ou registre nota.`,linkLabel:"Abrir atividade",linkPath:`/activities?activityId=${i.id}`}),e.push((t=i.id,a=i.type,`/activities?activityId=${t}&execute=${a}`))},children:n?.loading?(0,t.jsx)(eJ.RefreshCw,{className:"h-3.5 w-3.5 animate-spin"}):ts(i.type)}),(0,t.jsx)(p.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-3 text-xs",disabled:n?.loading,onClick:()=>_(i),children:"Reagendar"}),(0,t.jsxs)(x.DropdownMenu,{children:[(0,t.jsx)(x.DropdownMenuTrigger,{asChild:!0,children:(0,t.jsx)(p.Button,{size:"icon-xs",variant:"ghost",className:"h-7 w-7 text-zinc-500",children:(0,t.jsx)(eQ.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,t.jsxs)(x.DropdownMenuContent,{align:"end",className:"w-44 rounded-xl",children:[(0,t.jsxs)(x.DropdownMenuItem,{onClick:()=>E(i),children:[(0,t.jsx)(eG.CheckCircle2,{className:"h-3.5 w-3.5"}),"Concluir"]}),(0,t.jsxs)(x.DropdownMenuItem,{onClick:()=>e.push(`/activities?activityId=${i.id}`),children:[(0,t.jsx)(eK.ExternalLink,{className:"h-3.5 w-3.5"}),"Ver detalhes"]}),(0,t.jsx)(x.DropdownMenuSeparator,{}),(0,t.jsx)(x.DropdownMenuItem,{onClick:()=>{S(i.id)},children:"Cancelar"})]})]})]})]})},i.id)}),D.length>0?(0,t.jsxs)("div",{className:"rounded-xl border border-zinc-200/85 bg-zinc-50/30 p-3",children:[(0,t.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-zinc-500",children:"Sem horário"}),(0,t.jsx)(p.Button,{size:"xs",variant:"ghost",className:"h-7 px-2 text-xs text-zinc-600",onClick:()=>{let e=D[0];e&&_(e)},children:"Definir horário"})]}),(0,t.jsx)("div",{className:"space-y-2",children:D.map(e=>{let i=tr(e.type);return(0,t.jsx)("div",{className:"rounded-lg border border-zinc-200/85 bg-white p-2.5",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,t.jsxs)("div",{className:"flex min-w-0 items-start gap-2",children:[(0,t.jsx)(i,{className:"mt-0.5 h-4 w-4 text-zinc-500"}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsx)("p",{className:"truncate text-sm font-medium text-zinc-900",children:e.title}),(0,t.jsx)("p",{className:"truncate text-xs text-zinc-600",children:e.clientLine})]})]}),(0,t.jsx)(p.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-2.5 text-xs",onClick:()=>_(e),children:"Definir horário"})]})},e.id)})})]}):null]}):null,(0,t.jsx)(e5.AlertDialog,{open:null!==A,onOpenChange:e=>{e||S(null)},children:(0,t.jsxs)(e5.AlertDialogContent,{children:[(0,t.jsxs)(e5.AlertDialogHeader,{children:[(0,t.jsx)(e5.AlertDialogTitle,{children:"Cancelar atividade?"}),(0,t.jsx)(e5.AlertDialogDescription,{children:"A atividade será cancelada permanentemente."})]}),(0,t.jsxs)(e5.AlertDialogFooter,{children:[(0,t.jsx)(e5.AlertDialogCancel,{children:"Manter"}),(0,t.jsx)(e5.AlertDialogAction,{onClick:()=>{if(S(null),A){P(A,{loading:!0});try{d(A),j({tone:"info",message:"Atividade cancelada."}),P(A,{})}catch{P(A,{error:"Não consegui cancelar agora."})}}},children:"Cancelar atividade"})]})]})})]})}var tc=e.i(61911);let tu=(0,u.default)("thermometer-sun",[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 8a4 4 0 0 0-1.645 7.647",key:"wz5p04"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 14.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0z",key:"yu0u2z"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}]]);var tm=e.i(99676);e.i(5010);var tp=e.i(47691);function tx(){let e=(0,n.useRouter)(),{openOpportunities:s,filteredOpportunities:r,now:l}=z(),{healthMetrics:o,temperature:d,avgDays:c}=(0,i.useMemo)(()=>{let e=s.filter(e=>Math.round((l.getTime()-new Date(e.updatedAt).getTime())/864e5)>30).length,t=y.useActivityStore.getState().activities,i=s.filter(e=>0===t.filter(t=>t.opportunityId===e.id&&("pending"===t.status||"overdue"===t.status)).length).length,a=s.filter(e=>!e.value||0===e.value).length,n=Math.max(s.length,1),o=s.length>0?s.reduce((e,t)=>e+(t.value||0),0)/s.length:1e4,d=0,c=0;for(let e of s){let t=(0,N.calculateTemperature)(e,o,l);"hot"===t?d++:"cold"===t&&c++}let u=d>c?"Quente":c>d?"Frio":"Morno",m=r.filter(e=>"won"===e.status),p=0;return m.forEach(e=>{let t=new Date(e.createdAt).getTime(),i=new Date(e.updatedAt).getTime();p+=Math.max(1,Math.round((i-t)/864e5))}),{healthMetrics:[{label:"Estagnados (+30 dias)",value:e,color:"bg-red-500",filter:"stale",max:n},{label:"Sem próxima ação",value:i,color:"bg-amber-500",filter:"no_activity",max:n},{label:"Valor vazio",value:a,color:"bg-zinc-400",filter:"stale",max:n}],temperature:u,avgDays:m.length>0?Math.round(p/m.length):0}},[s,r,l]);return(0,t.jsxs)(eD,{className:"premium-panel flex flex-col gap-4 border-zinc-200/80 bg-white/86 p-5 shadow-[0_16px_28px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsxs)("h3",{className:"flex items-center gap-2 font-semibold text-zinc-900",children:[(0,t.jsx)(tu,{className:"h-4 w-4 text-orange-500"}),"Saúde do Pipeline"]})}),(0,t.jsx)("div",{className:"space-y-4",children:o.map(i=>(0,t.jsxs)("div",{className:"group cursor-pointer",onClick:()=>e.push(`/pipes?filter=${i.filter}`),role:"button",tabIndex:0,onKeyDown:t=>{"Enter"===t.key&&e.push(`/pipes?filter=${i.filter}`)},children:[(0,t.jsxs)("div",{className:"mb-1.5 flex items-center justify-between",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-zinc-600 transition-colors group-hover:text-zinc-900",children:i.label}),(0,t.jsxs)("span",{className:"text-xs font-bold text-zinc-900",children:[i.value," deals"]})]}),(0,t.jsx)("div",{className:"h-2 w-full overflow-hidden rounded-full bg-zinc-100",children:(0,t.jsx)(a.motion.div,{initial:{width:0},animate:{width:`${Math.min(i.value/Math.max(i.max,1)*100,100)}%`},transition:{duration:.24,ease:"easeOut"},className:(0,ev.cn)("h-full rounded-full transition-all group-hover:brightness-110",i.color)})})]},i.label))}),(0,t.jsx)("div",{className:"mt-auto border-t border-zinc-100 pt-4",children:(0,t.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-zinc-400",children:"Temperatura"}),(0,t.jsx)("p",{className:(0,ev.cn)("text-lg font-bold","Quente"===d?"text-emerald-600":"Frio"===d?"text-red-600":"text-amber-600"),children:d})]}),(0,t.jsx)("div",{className:"h-8 w-px bg-zinc-100"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-zinc-400",children:"Velocidade"}),(0,t.jsx)("p",{className:"text-lg font-bold text-zinc-900",children:c>0?`${c} dias`:"—"})]})]})})]})}function th(){let e=(0,n.useRouter)(),{filteredOpportunities:a,context:s,userId:r,userRole:l}=z(),o="master"===l||"admin"===l,d=(0,i.useMemo)(()=>{let e=a.filter(e=>"won"===e.status||"lost"===e.status),t={};for(let i of e)if(i.responsibleId&&("me"!==s||o||i.responsibleId===r)){if(!t[i.responsibleId]){let e=tp.mockUsers.find(e=>e.id===i.responsibleId);t[i.responsibleId]={name:e?.name??i.responsibleName??"—",role:e?.role??"comercial",revenue:0,won:0,total:0}}t[i.responsibleId].total+=1,"won"===i.status&&(t[i.responsibleId].revenue+=i.value||0,t[i.responsibleId].won+=1)}return Object.entries(t).map(([e,t])=>{let i=(0,N.calculateProjectedCommission)(t.revenue);return{id:e,name:t.name,role:t.role,revenue:t.revenue,commission:i.commissionValue,conversion:t.total>0?Math.round(t.won/t.total*100):0,won:t.won,isMe:e===r}}).sort((e,t)=>t.revenue-e.revenue).slice(0,3)},[a,s,r,o]);return(0,t.jsxs)(eD,{className:"premium-panel flex flex-col gap-4 border-zinc-200/80 bg-white/86 p-5 shadow-[0_16px_28px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("h3",{className:"flex items-center gap-2 font-semibold text-zinc-900",children:[(0,t.jsx)(tc.Users,{className:"h-4 w-4 text-blue-500"}),o?"Performance do time":"Performance pessoal"]}),(0,t.jsx)("button",{className:"text-xs font-medium text-zinc-500 transition-colors hover:text-zinc-900",onClick:()=>e.push("/goals"),children:"Ver metas"})]}),0===d.length?(0,t.jsx)("div",{className:"py-6 text-center text-sm text-zinc-500",children:"Sem dados de performance ainda."}):(0,t.jsx)("div",{className:"space-y-3",children:d.map((i,a)=>(0,t.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg p-2 transition-colors hover:bg-zinc-50",onClick:()=>e.push("/goals"),role:"button",tabIndex:0,onKeyDown:t=>{"Enter"===t.key&&e.push("/goals")},children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:(0,ev.cn)("flex h-5 w-5 items-center justify-center rounded text-[10px] font-bold",0===a?"bg-amber-100 text-amber-700":1===a?"bg-zinc-100 text-zinc-600":"bg-zinc-100 text-zinc-400"),children:a+1}),(0,t.jsx)(tm.Avatar,{className:"h-8 w-8 border border-zinc-100",children:(0,t.jsx)(tm.AvatarFallback,{className:"bg-zinc-100 text-[10px]",children:i.name.substring(0,2)})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-bold text-zinc-900",children:i.name}),(0,t.jsx)("p",{className:"text-[10px] text-zinc-500",children:i.role})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-xs font-bold text-zinc-900",children:i.isMe||o?(0,N.formatCurrencyBRL)(i.revenue):`${i.won} ganhos`}),(0,t.jsxs)("div",{className:"flex items-center justify-end gap-1.5",children:[(0,t.jsxs)("span",{className:"text-[10px] text-zinc-500",children:[i.conversion,"% conv."]}),(i.isMe||o)&&i.commission>0&&(0,t.jsxs)("span",{className:"text-[10px] font-medium text-emerald-600",children:["+",(0,N.formatCurrencyBRL)(i.commission)]})]})]})]},i.id))}),(0,t.jsxs)("button",{className:"mt-auto flex w-full items-center justify-center gap-1 rounded-lg border border-zinc-100 py-2 text-xs font-medium text-zinc-600 transition-colors hover:bg-zinc-50",onClick:()=>e.push("/finance"),children:["Ver relatório de comissão ",(0,t.jsx)(eh.ChevronRight,{className:"h-3 w-3"})]})]})}var tg=e.i(27438);function tf(){return(0,t.jsxs)("div",{className:"space-y-6 p-6 md:p-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(s.Skeleton,{className:"h-8 w-56"}),(0,t.jsx)(s.Skeleton,{className:"h-9 w-36 rounded-full"})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:Array.from({length:4}).map((e,i)=>(0,t.jsx)(s.Skeleton,{className:"h-24 rounded-xl"},i))}),(0,t.jsx)(s.Skeleton,{className:"h-64 rounded-xl"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12",children:[(0,t.jsxs)("div",{className:"lg:col-span-8 flex flex-col gap-6",children:[(0,t.jsx)(s.Skeleton,{className:"h-48 rounded-xl"}),(0,t.jsx)(s.Skeleton,{className:"h-48 rounded-xl"})]}),(0,t.jsx)("div",{className:"lg:col-span-4 flex flex-col gap-6",children:(0,t.jsx)(s.Skeleton,{className:"h-48 rounded-xl"})})]})]})}function tb(){(0,tg.useProactiveEngine)();let e=(0,n.useSearchParams)().get("view"),[s,r]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{let e=setTimeout(()=>r(!1),800);return()=>clearTimeout(e)},[]),(0,i.useEffect)(()=>{if("conversion"!==e)return;let t=document.getElementById("dashboard-funnel");t&&t.scrollIntoView({behavior:"smooth",block:"start"})},[e]),s)?(0,t.jsx)(tf,{}):(0,t.jsxs)(a.motion.div,{variants:ej.screenContainer,initial:"hidden",animate:"show",className:"w-full max-w-full space-y-6",children:[(0,t.jsx)(a.motion.div,{variants:ej.sectionEnter,children:(0,t.jsx)(S,{})}),(0,t.jsx)(a.motion.section,{id:"dashboard-kpis",variants:ej.sectionEnter,className:"scroll-mt-44",children:(0,t.jsx)(ez,{})}),(0,t.jsx)(a.motion.section,{id:"dashboard-funnel",variants:ej.sectionEnter,className:"scroll-mt-44",children:(0,t.jsx)(eO,{})}),(0,t.jsxs)(a.motion.section,{id:"dashboard-execution",variants:ej.sectionEnter,className:"grid grid-cols-1 gap-6 scroll-mt-44 lg:grid-cols-12",children:[(0,t.jsxs)("div",{className:"lg:col-span-8 flex flex-col gap-6",children:[(0,t.jsx)(to,{}),(0,t.jsx)(td,{})]}),(0,t.jsxs)("div",{className:"lg:col-span-4 flex flex-col gap-6",children:[(0,t.jsx)(tx,{}),(0,t.jsx)(th,{})]})]})]})}function tv(){return(0,t.jsx)(i.Suspense,{fallback:(0,t.jsx)(tf,{}),children:(0,t.jsx)(tb,{})})}e.s(["default",()=>tv],92228)}]);