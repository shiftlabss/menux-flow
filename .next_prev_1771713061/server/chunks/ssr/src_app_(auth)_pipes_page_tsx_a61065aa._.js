module.exports=[66382,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(87532),e=a.i(69012),f=a.i(33508),g=a.i(70106);let h=(0,g.default)("palette",[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]]);var i=a.i(33441),j=a.i(67453),k=a.i(73570),l=a.i(35830);let m=(0,g.default)("columns-3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);var n=a.i(5784);let o=(0,g.default)("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);var p=a.i(15618),q=a.i(8406),r=a.i(16106),s=a.i(59385),t=a.i(62036),u=a.i(46271),v=a.i(50944),w=a.i(99570),x=a.i(66718),y=a.i(99209),z=a.i(35732),A=a.i(30455),B=a.i(66206),C=a.i(2789),D=a.i(31791),E=a.i(48282),F=a.i(45113),G=a.i(6021),H=a.i(91361);let I=[{id:"comercial",label:"Leads",stages:[{id:"lead-in",label:"Lead-In",slaHours:48},{id:"contato-feito",label:"Contato Feito",slaHours:72},{id:"reuniao-agendada",label:"Reuniao Agendada",slaHours:120},{id:"proposta-enviada",label:"Proposta Enviada",slaHours:96},{id:"negociacao",label:"Negociacao",slaHours:168},{id:"fechamento",label:"Fechamento",slaHours:48}]},{id:"indicacao",label:"Indicacao",stages:[{id:"lead-in",label:"Lead-In",slaHours:24},{id:"contato-feito",label:"Contato Feito",slaHours:48},{id:"proposta-enviada",label:"Proposta Enviada",slaHours:72},{id:"fechamento",label:"Fechamento",slaHours:48}]}],J={"lead-in":[],"contato-feito":[{field:"clientName",label:"Nome do contato"}],"reuniao-agendada":[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"}],"proposta-enviada":[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"},{field:"value",label:"Valor da proposta"}],negociacao:[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"},{field:"value",label:"Valor da proposta"},{field:"monthlyValue",label:"Valor mensal"}],fechamento:[{field:"clientName",label:"Nome do contato"},{field:"expectedCloseDate",label:"Data prevista de fechamento"},{field:"value",label:"Valor da proposta"},{field:"monthlyValue",label:"Valor mensal"}]},K={hot:{icon:(0,b.jsx)(r.Flame,{className:"h-3.5 w-3.5"}),label:"Quente",colorClass:"text-status-danger"},warm:{icon:(0,b.jsx)(G.Thermometer,{className:"h-3.5 w-3.5"}),label:"Morno",colorClass:"text-status-warning"},cold:{icon:(0,b.jsx)(H.Snowflake,{className:"h-3.5 w-3.5"}),label:"Frio",colorClass:"text-status-info"}},L=[{id:"default",label:"Padrao",bg:"bg-brand",hex:"#1d4ed8"},{id:"blue",label:"Azul",bg:"bg-blue-500",hex:"#3b82f6"},{id:"cyan",label:"Ciano",bg:"bg-cyan-500",hex:"#06b6d4"},{id:"green",label:"Verde",bg:"bg-emerald-500",hex:"#10b981"},{id:"yellow",label:"Amarelo",bg:"bg-amber-400",hex:"#fbbf24"},{id:"orange",label:"Laranja",bg:"bg-orange-500",hex:"#f97316"},{id:"red",label:"Vermelho",bg:"bg-red-500",hex:"#ef4444"},{id:"pink",label:"Rosa",bg:"bg-pink-500",hex:"#ec4899"},{id:"gray",label:"Cinza",bg:"bg-zinc-400",hex:"#a1a1aa"}];function M(a){if(!a)return{status:"ok",label:"",detailLabel:"SLA nao definido"};let b=new Date,c=new Date(a).getTime()-b.getTime();if(c<=0){let a=Math.floor(Math.abs(c)/36e5),b=Math.floor(a/24),d=b>0?`${b}d ${a%24}h`:`${a}h`;return{status:"breached",label:"Estourado",detailLabel:`SLA estourado ha ${d}`}}let d=c/36e5,e=Math.floor(d/24),f=Math.floor(d%24),g=e>0?`${e}d ${f}h`:`${f}h`;return d<=12?{status:"near",label:g,detailLabel:`SLA vence em ${g} — atencao!`}:{status:"ok",label:g,detailLabel:`SLA restante: ${g}`}}function N(a,b){let c=D.PIPELINE_STAGE_ORDER.indexOf(a.stage);if(D.PIPELINE_STAGE_ORDER.indexOf(b)<c)return{missing:[],isRegression:!0};let d=J[b]||[],e=[];for(let b of d){let c=a[b.field];null==c||""===c?e.push(b.label):"number"==typeof c&&c<=0&&e.push(b.label)}return{missing:e,isRegression:!1}}function O(a,b,c){return Math.min(Math.max(a,b),c)}function P(a,b,c){return a<b+96?-Math.ceil((1-O(a-b,0,96)/96)*22):a>c-96?Math.ceil((1-O(c-a,0,96)/96)*22):0}var Q=a.i(17755),R=a.i(16221),S=a.i(24987),T=a.i(22245),U=a.i(49363),V=a.i(86304),W=a.i(85259);function X(a){let b=new Date(a),c=Math.floor(Math.max(0,new Date().getTime()-b.getTime())/36e5);if(c<1)return"<1h";if(c<24)return`${c}h`;let d=Math.floor(c/24);if(d<30)return`${d}d`;let e=Math.floor(d/30);return`${Math.max(1,e)}m`}function Y({opportunity:a,temp:d,isDragging:e,isUpdating:f,isHighlighted:g,canMove:h=!0,canEdit:i=!0,canCreateActivity:l=!0,onOpen:m,onDragStart:n,onDragEnd:o,inlineFeedback:p,onTagClick:q}){var r,s;let{openDrawer:t,openModal:u}=(0,A.useUIStore)(),v=(0,c.useRef)(!1),w=M(a.slaDeadline),x=function(a){switch(a){case"ok":return{dot:"bg-status-success",border:"border-l-brand",text:"text-zinc-400"};case"near":return{dot:"bg-status-warning",border:"border-l-status-warning",text:"text-status-warning"};case"breached":return{dot:"bg-status-danger",border:"border-l-status-danger",text:"text-status-danger"}}}(w.status),y=(r=w.status,s=d.label,"breached"===r?{label:"Critica",className:"border-red-200 bg-red-50 text-red-700"}:"Quente"===s||a.value>=2e4?{label:"Alta",className:"border-amber-200 bg-amber-50 text-amber-700"}:{label:"Normal",className:"border-zinc-200 bg-zinc-50 text-zinc-600"}),B=a.tags[0]??"Sem segmento",C=(0,c.useCallback)(a=>{v.current=!0,n(a)},[n]),E=(0,c.useCallback)(()=>{setTimeout(()=>{v.current=!1},0),o()},[o]),G=(0,c.useCallback)(()=>{v.current||m()},[m]);return(0,b.jsxs)("div",{className:`group relative rounded-[22px] border border-zinc-200/90 border-l-[3px] ${x.border} bg-white p-4 shadow-[var(--shadow-bento-sm)] transition-all duration-300 hover:-translate-y-[1.5px] hover:shadow-[0_8px_24px_-10px_rgba(0,0,0,0.08)] focus-within:ring-2 focus-within:ring-brand/40 active:scale-[0.98] ${e?"cursor-grabbing shadow-[0_14px_30px_-18px_rgba(15,23,42,0.38)] scale-[1.02]":h?"cursor-grab":"cursor-pointer"} ${f?"opacity-60 saturate-50 pointer-events-none":""} ${g?"ring-2 ring-emerald-300/70":""}`,onClick:G,draggable:h,onDragStart:C,onDragEnd:E,tabIndex:0,role:"button","aria-roledescription":"card arrastavel","aria-label":`${a.title}, ${(0,D.formatCurrencyBRL)(a.value)}, prioridade ${y.label}`,onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&(a.preventDefault(),m())},children:[(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"min-w-0 flex-1 truncate font-heading text-[17px] font-semibold text-zinc-950",children:a.title}),(0,b.jsx)("span",{className:`inline-flex h-6 shrink-0 items-center rounded-full border px-2.5 text-[11px] font-semibold ${y.className}`,children:y.label}),(0,b.jsxs)(z.DropdownMenu,{children:[(0,b.jsx)(z.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)("button",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-lg text-zinc-400 opacity-0 transition-opacity hover:bg-zinc-100 hover:text-zinc-600 group-hover:opacity-100 focus:opacity-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand",onClick:a=>a.stopPropagation(),onPointerDown:a=>a.stopPropagation(),"aria-label":"Acoes da oportunidade",children:(0,b.jsx)(Q.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(z.DropdownMenuContent,{align:"end",className:"rounded-[var(--radius-bento-card)]",onClick:a=>a.stopPropagation(),onCloseAutoFocus:a=>a.preventDefault(),children:[(0,b.jsx)(z.DropdownMenuItem,{disabled:!i,onClick:a=>{a.stopPropagation(),m()},children:"Editar"}),(0,b.jsx)(z.DropdownMenuItem,{disabled:!l,onClick:b=>{b.stopPropagation(),t("new-activity",{opportunityId:a.id})},children:"Nova atividade"}),(0,b.jsx)(z.DropdownMenuSeparator,{}),(0,b.jsx)(z.DropdownMenuItem,{disabled:!i,className:"text-status-success",onClick:b=>{b.stopPropagation(),u("win-opportunity",{opportunityId:a.id})},children:"Marcar como Ganho"}),(0,b.jsx)(z.DropdownMenuItem,{disabled:!i,className:"text-status-danger",onClick:b=>{b.stopPropagation(),u("lose-opportunity",{opportunityId:a.id})},children:"Marcar como Perdido"})]})]})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-between gap-2",children:[(0,b.jsx)("span",{className:"font-heading text-[20px] font-bold tracking-tight text-zinc-950",children:a.value>0?(0,D.formatCurrencyBRL)(a.value):"Sem valor"}),(0,b.jsxs)("span",{className:`inline-flex items-center gap-1 rounded-full border px-2.5 py-1 text-[11px] font-semibold ${function(a){switch(a){case"Quente":return"border-red-200 bg-red-50 text-red-700";case"Morno":return"border-amber-200 bg-amber-50 text-amber-700";case"Frio":return"border-sky-200 bg-sky-50 text-sky-700";default:return"border-zinc-200 bg-zinc-50 text-zinc-600"}}(d.label)}`,children:[d.icon,d.label]})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-between gap-2 text-[12px] text-zinc-600",children:[(0,b.jsxs)("span",{className:"inline-flex min-w-0 flex-1 items-center gap-1.5 truncate",children:[(0,b.jsx)(S.MapPin,{className:"h-3.5 w-3.5 shrink-0 text-zinc-400"}),a.neighborhood||"Sem localizacao"]}),(0,b.jsxs)("span",{className:(0,F.cn)("inline-flex shrink-0 items-center gap-1 rounded-full border border-zinc-200 bg-zinc-50 px-2.5 py-1 text-[11px] font-medium text-zinc-600 transition-colors",q&&"Sem segmento"!==B&&"cursor-pointer hover:bg-zinc-100 hover:text-zinc-900"),onClick:a=>{q&&"Sem segmento"!==B&&(a.stopPropagation(),q(B))},children:[(0,b.jsx)(T.Tags,{className:"h-3 w-3"}),B]})]}),(0,b.jsxs)("div",{className:"mt-2.5 grid grid-cols-2 gap-2 text-[11px] text-zinc-500",children:[(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,b.jsx)(R.Clock3,{className:"h-3.5 w-3.5 shrink-0 text-zinc-400"}),"Ultima atividade ",X(a.updatedAt)]}),(0,b.jsxs)("span",{className:"inline-flex items-center justify-end gap-1.5 text-right",children:[(0,b.jsx)(U.CalendarClock,{className:"h-3.5 w-3.5 shrink-0 text-zinc-400"}),"No pipeline ha ",X(a.createdAt)]})]}),(0,b.jsxs)("div",{className:"mt-2.5 flex items-center justify-between gap-2",children:[(0,b.jsxs)("span",{className:`inline-flex min-w-0 items-center gap-1.5 rounded-full border px-2.5 py-1 text-[11px] font-semibold ${"breached"===w.status?"border-red-200 bg-red-50 text-red-700":"near"===w.status?"border-amber-200 bg-amber-50 text-amber-700":"border-zinc-200 bg-zinc-50 text-zinc-600"}`,children:["breached"===w.status?(0,b.jsx)(k.AlertTriangle,{className:"h-3.5 w-3.5"}):(0,b.jsx)(R.Clock3,{className:"h-3.5 w-3.5"}),"breached"===w.status?"Estourado":`SLA ${w.label||"ok"}`]}),(0,b.jsxs)(W.Tooltip,{children:[(0,b.jsx)(W.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("span",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-zinc-900 font-heading text-[10px] font-semibold text-white",children:a.responsibleName.split(" ").filter(Boolean).map(a=>a[0]).slice(0,2).join("").toUpperCase()})}),(0,b.jsx)(W.TooltipContent,{children:a.responsibleName})]})]}),a.tags.length>0&&(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap items-center gap-1.5",children:[a.tags.slice(0,2).map((a,c)=>(0,b.jsx)(V.Badge,{variant:"secondary",className:(0,F.cn)("shrink-0 rounded-full border border-zinc-200 bg-zinc-50 px-2 py-0.5 font-body text-[10px] text-zinc-600 transition-colors",q&&"cursor-pointer hover:bg-zinc-100 hover:text-zinc-900"),onClick:b=>{q&&(b.stopPropagation(),q(a))},children:a},c)),a.tags.length>2&&(0,b.jsxs)(W.Tooltip,{children:[(0,b.jsx)(W.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(V.Badge,{variant:"secondary",className:"shrink-0 rounded-full border border-zinc-200 bg-zinc-50 px-2 py-0.5 font-body text-[10px] text-zinc-600",children:["+",a.tags.length-2]})}),(0,b.jsx)(W.TooltipContent,{children:a.tags.slice(2).join(", ")})]})]}),p?(0,b.jsx)("div",{className:`mt-3 rounded-xl border px-2.5 py-2 text-[11px] ${"error"===p.tone?"border-red-200 bg-red-50 text-red-700":"warning"===p.tone?"border-amber-200 bg-amber-50 text-amber-700":"border-emerald-200 bg-emerald-50 text-emerald-700"}`,role:"error"===p.tone?"alert":"status",children:(0,b.jsxs)("div",{className:"flex items-start gap-1.5",children:["success"===p.tone?(0,b.jsx)(j.CheckCircle2,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}):(0,b.jsx)(k.AlertTriangle,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{children:p.message}),p.actionLabel&&p.onAction?(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),p.onAction?.()},className:"mt-1 font-semibold underline underline-offset-2",children:p.actionLabel}):null]})]})}):null,(0,b.jsx)("span",{className:"sr-only",children:w.detailLabel})]})}var Z=a.i(33140);function $({stageCount:a}){return(0,b.jsxs)("div",{className:"flex h-[calc(100vh-64px)] flex-col overflow-hidden",children:[(0,b.jsx)("div",{className:"shrink-0 space-y-3 pb-4",children:(0,b.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(Z.Skeleton,{className:"h-7 w-52"}),(0,b.jsx)(Z.Skeleton,{className:"h-4 w-72"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Z.Skeleton,{className:"h-9 w-[180px] rounded-full"}),(0,b.jsx)(Z.Skeleton,{className:"h-9 w-20 rounded-full"}),(0,b.jsx)(Z.Skeleton,{className:"h-9 w-16 rounded-full"}),(0,b.jsx)(Z.Skeleton,{className:"h-9 w-28 rounded-full"})]})]})}),(0,b.jsx)("div",{className:"flex flex-1 gap-3 overflow-hidden px-7 pb-2",children:Array.from({length:a}).map((a,c)=>(0,b.jsxs)("div",{className:"flex w-[320px] shrink-0 flex-col rounded-[var(--radius-bento-card)] bg-zinc-50/80 p-3",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(Z.Skeleton,{className:"h-2.5 w-2.5 rounded-full"}),(0,b.jsx)(Z.Skeleton,{className:"h-4 w-24"}),(0,b.jsx)(Z.Skeleton,{className:"h-4 w-6 rounded-md"})]}),(0,b.jsx)(Z.Skeleton,{className:"h-4 w-16"})]}),Array.from({length:2-c%2}).map((a,c)=>(0,b.jsxs)("div",{className:"mb-2 rounded-[var(--radius-bento-card)] border border-zinc-200 bg-white p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(Z.Skeleton,{className:"h-4 w-32"}),(0,b.jsx)(Z.Skeleton,{className:"h-4 w-4 rounded"})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,b.jsx)(Z.Skeleton,{className:"h-3 w-28"}),(0,b.jsx)(Z.Skeleton,{className:"h-6 w-6 rounded-full"})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[(0,b.jsx)(Z.Skeleton,{className:"h-4 w-20"}),(0,b.jsx)(Z.Skeleton,{className:"h-3 w-12"})]})]},c))]},c))})]})}var _=a.i(55376);let aa={"lead-in":9,"contato-feito":8,"reuniao-agendada":7,"proposta-enviada":7,negociacao:6,fechamento:5};function ab(a){return new Date(a.updatedAt).getTime()<Date.now()-432e6}function ac(){return{responsible:[],stage:[],temperature:[],tags:[],dateStart:"",dateEnd:"",valueMin:"",valueMax:"",overdue:!1,stale:!1,risk:!1}}function ad(a){return a.replace(/-/g," ").replace(/\b\w/g,a=>a.toUpperCase())}function ae(){let{openDrawer:a,openModal:g}=(0,A.useUIStore)(),{user:G,permissions:H}=(0,B.useAuthStore)(),J=(0,C.useOpportunityStore)(a=>a.opportunities),Q=(0,C.useOpportunityStore)(a=>a.replaceOpportunities),R=(0,v.useRouter)(),S=(0,v.useSearchParams)(),T=G?.id??null,U=H?.canCreateOpportunity??!1,V=H?.canEditOpportunity??!1,W=H?.canCreateActivity??!1,X=H?.canManageSettings??!1,Z=H?.canViewAllUnits??!1,[ae,af]=(0,c.useState)("comercial"),[ag,ah]=(0,c.useState)(null),[ai,aj]=(0,c.useState)(null),ak=(0,c.useMemo)(()=>{let a=J.filter(a=>"open"===a.status);return Z||!T?a:a.filter(a=>a.responsibleId===T)},[Z,J,T]);(0,c.useEffect)(()=>{let a=S.get("opportunityId");if(!a)return;let b=ak.find(b=>b.id===a),c=null;b?g("lead-card",{id:a,opportunitySnapshot:b}):c=window.setTimeout(()=>{aj({tone:"error",message:"Não foi possível abrir o card. Oportunidade não encontrada no escopo atual."})},0);let d=new URLSearchParams(S.toString());d.delete("opportunityId");let e=d.toString();return R.replace(e?`/pipes?${e}`:"/pipes",{scroll:!1}),()=>{c&&window.clearTimeout(c)}},[g,ak,R,S]);let[al,am]=(0,c.useState)(!0),[an,ao]=(0,c.useState)(""),[ap,aq]=(0,c.useState)(""),[ar,as]=(0,c.useState)(!1),[at,au]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=S.get("filter")??S.get("filters");if(!a)return;let b=a.split(",").map(a=>a.trim()).filter(Boolean),c=window.requestAnimationFrame(()=>{au(a=>{let c=a??ac(),d={...c,overdue:!1,stale:!1,risk:!1};for(let a of b)"sla_overdue"===a&&(d.overdue=!0),("sla_risk"===a||"risk"===a)&&(d.risk=!0),("stale"===a||"stalled"===a||"no_activity"===a)&&(d.stale=!0);return c.overdue===d.overdue&&c.stale===d.stale&&!!c.risk==!!d.risk?a??d:d})});return()=>window.cancelAnimationFrame(c)},[S]);let av=(0,c.useRef)(null),aw=(0,c.useRef)(null),ax=(0,c.useRef)(null),ay=I.find(a=>a.id===ae)??I[0],az=(0,c.useMemo)(()=>ay.stages.map(a=>a.id),[ay]),aA=(0,c.useMemo)(()=>{let a=S.get("stage")??S.get("stageId");return a&&az.includes(a)?a:null},[S,az]),aB=(0,c.useMemo)(()=>aA?ay.stages.filter(a=>a.id===aA):ay.stages,[ay,aA]),aC=(0,c.useMemo)(()=>aA?[aA]:az,[aA,az]),aD=(0,c.useCallback)(a=>{let b="function"==typeof a?a(ak):a,c=new Set(ak.map(a=>a.id)),d=new Map(b.map(a=>[a.id,a])),e=J.map(a=>c.has(a.id)?d.get(a.id)??a:a);for(let a of b)J.some(b=>b.id===a.id)||e.push(a);Q(e)},[ak,Q,J]),aE=(0,c.useCallback)(a=>{ax.current&&(ax.current.textContent=a)},[]);(0,c.useEffect)(()=>{let a=window.setTimeout(()=>am(!1),600);return()=>window.clearTimeout(a)},[]),(0,c.useEffect)(()=>{},[]),(0,c.useEffect)(()=>{if(!ai)return;let a=window.setTimeout(()=>aj(null),2200);return()=>window.clearTimeout(a)},[ai]),(0,c.useEffect)(()=>{let a=window.setTimeout(()=>{ao(ap)},250);return()=>window.clearTimeout(a)},[ap]);let aF=(0,c.useMemo)(()=>an.toLowerCase().trim(),[an]),aG=(0,c.useMemo)(()=>ak.filter(a=>aC.includes(a.stage)),[aC,ak]),aH=(0,c.useMemo)(()=>0===aG.length?1e4:aG.reduce((a,b)=>a+b.value,0)/aG.length,[aG]),aI=(0,c.useCallback)(a=>(0,D.calculateTemperature)(a,aH),[aH]),aJ=(0,c.useCallback)(a=>K[aI(a)],[aI]),aK=(0,c.useMemo)(()=>{let a={"lead-in":[],"contato-feito":[],"reuniao-agendada":[],"proposta-enviada":[],negociacao:[],fechamento:[]};for(let b of ak){if(!aC.includes(b.stage))continue;if(aF){let a=b.title.toLowerCase().includes(aF)||b.clientName.toLowerCase().includes(aF)||b.tags.some(a=>a.toLowerCase().includes(aF)),c=aF.replace(/\D/g,""),d=c.length>0&&String(b.value).includes(c);if(!a&&!d)continue}let c=aI(b);if(at){if(at.temperature?.length>0&&!at.temperature.includes(c)||at.responsible?.length>0&&!at.responsible.includes(b.responsibleId)||at.tags?.length>0&&!at.tags.some(a=>b.tags.includes(a))||at.overdue&&"breached"!==M(b.slaDeadline).status||at.risk&&!function(a){if(!a.slaDeadline)return!1;let b=(new Date(a.slaDeadline).getTime()-Date.now())/36e5;return b>0&&b<=24}(b)||at.stale&&!ab(b)||at.stage?.length>0&&!at.stage.includes(b.stage))continue;let a=(b.expectedCloseDate??b.updatedAt).slice(0,10);if(at.dateStart&&a<at.dateStart||at.dateEnd&&a>at.dateEnd)continue;let d=Number(at.valueMin||0);if(Number.isFinite(d)&&d>0&&b.value<d)continue;let e=Number(at.valueMax||0);if(Number.isFinite(e)&&e>0&&b.value>e)continue}a[b.stage].push(b)}return a},[ak,aC,aF,aI,at]),aL=(0,c.useMemo)(()=>{let a=Object.values(aK).flat();return{totalCards:a.length,boardTotal:a.reduce((a,b)=>a+b.value,0),overdueCards:a.filter(a=>"breached"===M(a.slaDeadline).status).length,staleCards:a.filter(a=>ab(a)).length}},[aK]),aM=(0,c.useMemo)(()=>at?at.responsible.length+at.stage.length+at.temperature.length+at.tags.length+ +!!at.dateStart+ +!!at.dateEnd+ +!!at.valueMin+ +!!at.valueMax+ +!!at.overdue+ +!!at.stale+ +!!at.risk+ +!!aA:+!!aA,[at,aA]),aN=(0,c.useCallback)(()=>{aq(""),ao(""),as(!1)},[]),aO=(0,c.useCallback)(a=>{let b=new URLSearchParams(S.toString());"all"===a?b.delete("stage"):b.set("stage",a),b.delete("stageId");let c=b.toString();R.replace(c?`/pipes?${c}`:"/pipes",{scroll:!1})},[R,S]),aP=(0,c.useCallback)(()=>{au(null),aj({tone:"info",message:"Filtros do pipeline limpos."}),aq(""),ao(""),as(!1);let a=new URLSearchParams(S.toString());a.delete("filter"),a.delete("filters"),a.delete("stage"),a.delete("stageId");let b=a.toString();R.replace(b?`/pipes?${b}`:"/pipes",{scroll:!1})},[R,S]),aQ=(0,c.useCallback)(a=>{au(b=>{let c=b??ac();return{...c,[a]:!c[a]}})},[]),aR=(0,c.useCallback)(a=>{af(a),ap&&aN(),aO("all")},[aN,ap,aO]),aS=(0,c.useMemo)(()=>[{id:"pipeline-total",label:`Pipeline: ${(0,D.formatCurrencyBRL)(aL.boardTotal)}`,icon:(0,b.jsx)(l.CircleDollarSign,{className:"h-3.5 w-3.5"}),tone:"info"},{id:"stages-visible",label:`Etapas: ${aB.length}`,icon:(0,b.jsx)(m,{className:"h-3.5 w-3.5"}),tone:"neutral"},{id:"cards-total",label:`Cards: ${aL.totalCards}`,icon:(0,b.jsx)(e.Filter,{className:"h-3.5 w-3.5"}),tone:"neutral"},{id:"cards-overdue",label:`Estourados: ${aL.overdueCards}`,icon:(0,b.jsx)(r.Flame,{className:"h-3.5 w-3.5"}),tone:at?.overdue?"danger":"neutral",onClick:()=>aQ("overdue")},{id:"cards-stale",label:`Sem atividade: ${aL.staleCards}`,icon:(0,b.jsx)(s.TimerReset,{className:"h-3.5 w-3.5"}),tone:at?.stale?"warning":"neutral",onClick:()=>aQ("stale")}],[aL.boardTotal,aL.overdueCards,aL.staleCards,aL.totalCards,aB.length,at,aQ]),aT=(0,c.useMemo)(()=>{let a=[];if(at){let b=a=>{au(a)};if(at.temperature?.length>0&&a.push({id:"temp",label:`Temperatura: ${at.temperature.map(a=>"hot"===a?"Quente":"warm"===a?"Morna":"Fria").join(", ")}`,onRemove:()=>b({...at,temperature:[]})}),at.responsible?.length>0&&a.push({id:"owner",label:`Donos: ${at.responsible.length}`,onRemove:()=>b({...at,responsible:[]})}),at.tags?.length>0&&a.push({id:"segment",label:`Tags: ${at.tags.join(", ")}`,onRemove:()=>b({...at,tags:[]})}),at.stage?.length>0&&a.push({id:"stage-filters",label:`Etapas: ${at.stage.length}`,onRemove:()=>b({...at,stage:[]})}),(at.dateStart||at.dateEnd)&&a.push({id:"period",label:`Periodo: ${at.dateStart||"..."} ate ${at.dateEnd||"..."}`,onRemove:()=>b({...at,dateStart:"",dateEnd:""})}),at.valueMin||at.valueMax){let c=at.valueMin?(0,D.formatCurrencyBRL)(Number(at.valueMin)):"...",d=at.valueMax?(0,D.formatCurrencyBRL)(Number(at.valueMax)):"...";a.push({id:"value-range",label:`Valor: ${c} ate ${d}`,onRemove:()=>b({...at,valueMin:"",valueMax:""})})}at.overdue&&a.push({id:"overdue",label:"Somente estourados",onRemove:()=>b({...at,overdue:!1})}),at.risk&&a.push({id:"risk",label:"Somente em risco",onRemove:()=>b({...at,risk:!1})}),at.stale&&a.push({id:"stale",label:"Somente sem atividade",onRemove:()=>b({...at,stale:!1})})}return aA&&a.push({id:"stage",label:`Etapa: ${ay.stages.find(a=>a.id===aA)?.label??ad(aA)}`,onRemove:()=>aO("all")}),a},[at,aA,ay.stages,aO]);(0,c.useEffect)(()=>{if(!aF)return;let a=Object.values(aK).reduce((a,b)=>a+b.length,0);aE(`${a} cards encontrados para "${an}"`)},[aE,aF,aK,an]);let{draggingCardId:aU,draggingOpportunity:aV,dragOverStage:aW,dropIndicator:aX,columnError:aY,setColumnError:aZ,successFeedback:a$,updatingCardId:a_,recentlyMovedCardId:a0,handleDragStart:a1,handleDragOver:a2,handleDragLeave:a3,handleDrop:a4,handleDragEnd:a5}=function({localOpportunities:a,setLocalOpportunities:b,activeFunnel:d,announce:e,canMoveCards:f=!0}){let[g,h]=(0,c.useState)(null),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),y=(0,c.useRef)(null),z=(0,c.useRef)(null),A=(0,c.useRef)([]),B=(0,c.useRef)(null),C=(0,c.useCallback)(()=>{null!==z.current&&(window.cancelAnimationFrame(z.current),z.current=null),B.current=null},[]),E=(0,c.useCallback)((a,b)=>{let c=window.setTimeout(()=>{A.current=A.current.filter(a=>a!==c),a()},b);A.current.push(c)},[]),F=(0,c.useCallback)(()=>{let a=()=>{let b=B.current;if(!b){z.current=null;return}let{clientX:c,clientY:d,horizontalContainer:e,verticalContainer:f}=b,g=!1;if(f){let a=f.getBoundingClientRect(),b=P(d,a.top,a.bottom);0!==b&&(f.scrollTop+=b,g=!0)}if(e){let a=e.getBoundingClientRect(),b=P(c,a.left,a.right);0!==b&&(e.scrollLeft+=b,g=!0)}if(g||null!==B.current){z.current=window.requestAnimationFrame(a);return}z.current=null};a()},[]);(0,c.useEffect)(()=>()=>{C(),A.current.forEach(a=>window.clearTimeout(a)),A.current=[]},[C]);let G=(0,c.useCallback)((a,b)=>{if(!f){a.preventDefault(),e("Voce nao tem permissao para mover oportunidades.");return}h(b.id),j(b.stage),l(b),y.current=b,B.current=null,a.dataTransfer.effectAllowed="move",a.dataTransfer.setData("text/plain",b.id),document.body.style.cursor="grabbing",e(`Arrastando card ${b.title}. Solte em uma etapa para mover.`)},[e,f]),H=(0,c.useCallback)((a,b)=>{if(!f)return;a.preventDefault(),a.dataTransfer.dropEffect="move",n(b);let c=a.currentTarget.querySelectorAll("[data-card-index]"),d=c.length;for(let b=0;b<c.length;b++){let e=c[b].getBoundingClientRect(),f=e.top+e.height/2;if(a.clientY<f){d=b;break}}p({stage:b,index:d});let e=a.currentTarget,g=e.closest("[data-pipe-column-scroll]"),h=e.closest("[data-pipe-board-scroll]");B.current={clientX:a.clientX,clientY:a.clientY,horizontalContainer:h,verticalContainer:g},null===z.current&&(z.current=window.requestAnimationFrame(F))},[f,F]),I=(0,c.useCallback)(a=>{let b=a.relatedTarget;b&&!a.currentTarget.contains(b)&&(n(null),p(null))},[]),J=(0,c.useCallback)((c,g)=>{if(!f){c.preventDefault(),e("Voce nao tem permissao para mover oportunidades.");return}c.preventDefault(),n(null),p(null),r(null),document.body.style.cursor="",C();let i=y.current;if(i){v(i.id);try{let c=d.stages.map(a=>a.id),f=a.filter(a=>a.stage===i.stage).findIndex(a=>a.id===i.id),k=o?.stage===g?o.index:a.filter(a=>a.stage===g).length;if(i.stage===g&&f>-1&&f<k&&(k-=1),i.stage===g&&f>-1&&k===f){h(null),j(null),y.current=null,v(null);return}let{missing:m,isRegression:n}=N(i,g),p=d.stages.find(a=>a.id===g),q=p?.label??g.replace(/-/g," ");if(m.length>0){r({stage:g,tone:"error",cardId:i.id,missingFields:m,targetStage:g,message:`Para mover para ${q}, preencha: ${m.join(", ")}.`}),e(`Aviso: campos pendentes — ${m.join(", ")}`),h(null),j(null),l(null),y.current=null,v(null),E(()=>r(null),4200);return}if(n){let a=d.stages.find(a=>a.id===i.stage)?.label??i.stage;r({stage:g,tone:"warning",message:`Card retrocedido de ${a} para ${q}`}),e(`Aviso: card retrocedido de ${a} para ${q}`),E(()=>r(null),4e3)}let s=p?(0,D.calculateSlaDeadline)(p.slaHours):void 0;b(a=>{let b=a.findIndex(a=>a.id===i.id);if(-1===b)return a;let d=a[b],e=a.filter(a=>a.id!==d.id),f=e.filter(a=>a.stage===g),h=O(k,0,f.length),j={...d,stage:g,updatedAt:new Date().toISOString(),slaDeadline:s},l=e.length;if(0===f.length)l=function(a,b,c){let d=c.indexOf(b);if(-1===d)return a.length;for(let b=d-1;b>=0;b-=1){let d=c[b];for(let b=a.length-1;b>=0;b-=1)if(a[b].stage===d)return b+1}for(let b=d+1;b<c.length;b+=1){let d=c[b],e=a.findIndex(a=>a.stage===d);if(-1!==e)return e}return a.length}(e,g,c);else if(h>=f.length){let a=f[f.length-1].id,b=e.findIndex(b=>b.id===a);l=-1===b?e.length:b+1}else{let a=f[h].id,b=e.findIndex(b=>b.id===a);l=-1===b?e.length:b}let m=[...e];return m.splice(l,0,j),m}),i.stage===g?(t({stage:g,message:`${i.title} reordenado na etapa.`,cardId:i.id}),e(`Card ${i.title} reordenado dentro da etapa.`),E(()=>t(null),1800)):n?(t({stage:g,message:`${i.title} retrocedido para ${q}.`,cardId:i.id}),E(()=>t(null),2300)):(t({stage:g,message:`${i.title} movido para ${q} agora.`,cardId:i.id}),e(`Card ${i.title} movido com sucesso para ${q}`),E(()=>t(null),2500)),x(i.id),E(()=>x(a=>a===i.id?null:a),2600),E(()=>v(a=>a===i.id?null:a),850)}finally{h(null),j(null),l(null),y.current=null,document.body.style.cursor=""}}},[d,e,f,o,a,E,b,C]);return{draggingCardId:g,draggingCardStage:i,draggingOpportunity:k,dragOverStage:m,dropIndicator:o,columnError:q,setColumnError:r,successFeedback:s,updatingCardId:u,recentlyMovedCardId:w,handleDragStart:G,handleDragOver:H,handleDragLeave:I,handleDrop:J,handleDragEnd:(0,c.useCallback)(()=>{h(null),j(null),l(null),n(null),p(null),y.current=null,document.body.style.cursor="",C()},[C])}}({localOpportunities:ak,setLocalOpportunities:aD,activeFunnel:ay,announce:aE,canMoveCards:V}),{stageCustomizations:a6,renamingStage:a7,renameValue:a8,renameError:a9,setRenameValue:ba,renameInputRef:bb,startRename:bc,confirmRename:bd,cancelRename:be,setStageColor:bf,getStageColor:bg}=function(){let[a,b]=(0,c.useState)(()=>({})),[d,e]=(0,c.useState)(null),[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(null),j=(0,c.useRef)(null);(0,c.useEffect)(()=>{},[a]);let k=(0,c.useCallback)((a,b)=>{e(a),g(b),i(null),setTimeout(()=>j.current?.focus(),50)},[]),l=(0,c.useCallback)(()=>{if(!d)return;let a=f.trim();if(a.length<2){i(`M\xednimo 2 caracteres`),j.current?.focus();return}if(a.length>30){i(`M\xe1ximo 30 caracteres`),j.current?.focus();return}b(b=>({...b,[d]:{...b[d],label:a}})),e(null),g(""),i(null)},[d,f]),m=(0,c.useCallback)(()=>{e(null),g(""),i(null)},[]),n=(0,c.useCallback)((a,c)=>{b(b=>({...b,[a]:{...b[a],colorId:c}}))},[]),o=(0,c.useCallback)(b=>{let c=a[b]?.colorId||"default";return L.find(a=>a.id===c)??L[0]},[a]);return{stageCustomizations:a,renamingStage:d,renameValue:f,renameError:h,setRenameValue:g,renameInputRef:j,startRename:k,confirmRename:l,cancelRename:m,setStageColor:n,getStageColor:o}}(),bh=(0,c.useCallback)(a=>{if(!aV||aW!==a)return null;let b=ay.stages.find(b=>b.id===a)?.label??ad(a),c=N(aV,a);if(c.missing.length>0)return{tone:"error",message:`Bloqueado: faltam ${c.missing.join(", ")} para mover para ${b}.`};if(c.isRegression)return{tone:"warning",message:`Retrocesso detectado. Solte para mover para ${b}.`};let d=aK[a]||[],e=aa[a]??7,f=aV.stage!==a?d.length+1:d.length;return f>e?{tone:"warning",message:`WIP excedido (${f}/${e}). Solte para mover para ${b}.`}:{tone:"success",message:`Solte para mover para ${b}.`}},[ay.stages,aW,aV,aK]),bi=(0,c.useCallback)(()=>{if(!aY?.cardId)return;let a=ak.find(a=>a.id===aY.cardId);g("lead-card",{id:aY.cardId,focusFields:aY.missingFields,pendingStage:aY.targetStage,initialTab:"empresa",opportunitySnapshot:a})},[aY,g,ak]);return((0,c.useEffect)(()=>{function a(a){if((a.metaKey||a.ctrlKey)&&"k"===a.key.toLowerCase()){a.preventDefault(),window.setTimeout(()=>av.current?.focus(),50);return}"Escape"===a.key&&(as(!1),av.current?.blur(),aw.current?.blur())}return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),(0,c.useEffect)(()=>{if(!ar)return;let a=window.setTimeout(()=>{aw.current?.focus()},50);return()=>window.clearTimeout(a)},[ar]),al)?(0,b.jsx)($,{stageCount:aB.length}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{ref:ax,role:"status","aria-live":"polite","aria-atomic":"true",className:"sr-only"}),(0,b.jsxs)(u.motion.div,{initial:"hidden",animate:"show",variants:E.screenContainer,className:"flex h-[calc(100dvh-2rem)] min-h-0 w-full max-w-full flex-col gap-4",children:[(0,b.jsx)(u.motion.div,{variants:E.sectionEnter,className:"shrink-0",children:(0,b.jsx)(_.ModuleCommandHeader,{title:ay.label,titleAccessory:(0,b.jsxs)(z.DropdownMenu,{children:[(0,b.jsx)(z.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)("button",{type:"button","aria-label":"Trocar funil",className:"premium-shine inline-flex h-8 w-8 items-center justify-center rounded-full border border-zinc-200 bg-white/90 text-zinc-500 transition-all duration-120 hover:-translate-y-px hover:bg-zinc-100 hover:text-zinc-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300",children:(0,b.jsx)(n.ChevronDown,{className:"h-4 w-4"})})}),(0,b.jsxs)(z.DropdownMenuContent,{align:"start",className:"w-[270px] rounded-[16px] border-zinc-200 bg-white/95 p-1.5 shadow-[0_18px_30px_-24px_rgba(15,23,42,0.45)]",children:[(0,b.jsxs)("div",{className:"px-2.5 pb-2 pt-1.5",children:[(0,b.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-[0.08em] text-zinc-500",children:"Selecionar funil"}),(0,b.jsx)("p",{className:"mt-0.5 text-xs text-zinc-500",children:"Troque o contexto do board e mantenha o foco operacional."})]}),I.map(a=>(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>aR(a.id),className:"h-9 rounded-xl px-2.5 font-medium text-zinc-700",children:[(0,b.jsx)("span",{className:"truncate",children:a.label}),a.id===ae?(0,b.jsx)(i.Check,{className:"h-3.5 w-3.5 text-brand"}):null]},a.id))]})]}),description:"Mesa de controle do pipeline comercial com prioridade operacional clara.",chips:aS,actionsClassName:"gap-2.5 p-2",actions:[(0,b.jsxs)("div",{className:"relative hidden w-[min(38vw,360px)] md:block",children:[(0,b.jsx)(d.Search,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-zinc-400"}),(0,b.jsx)(x.Input,{ref:av,value:ap,onChange:a=>aq(a.target.value),placeholder:"Buscar atividade, cliente, valor ou segmento",className:"h-10 rounded-full border-zinc-200 pl-9 pr-16 font-body text-sm"}),(0,b.jsx)("span",{className:"pointer-events-none absolute right-8 top-1/2 hidden -translate-y-1/2 rounded-md border border-zinc-200 bg-zinc-50 px-1.5 py-0.5 text-[10px] font-medium text-zinc-500 lg:inline-flex",children:"Ctrl K"}),ap?(0,b.jsx)("button",{type:"button",onClick:aN,className:"absolute right-2.5 top-1/2 -translate-y-1/2 rounded-full p-1 text-zinc-400 transition-colors hover:bg-zinc-100 hover:text-zinc-600","aria-label":"Limpar busca",children:(0,b.jsx)(f.X,{className:"h-3.5 w-3.5"})}):null]},"search"),(0,b.jsxs)(y.Popover,{open:ar,onOpenChange:as,children:[(0,b.jsx)(y.PopoverTrigger,{asChild:!0,children:(0,b.jsx)(w.Button,{variant:"outline",size:"sm",className:"h-10 rounded-full px-3 md:hidden",children:(0,b.jsx)(d.Search,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(y.PopoverContent,{align:"end",side:"bottom",sideOffset:8,className:"w-[min(92vw,360px)] rounded-[16px] border-zinc-200 bg-white p-2",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(d.Search,{className:"absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-zinc-400"}),(0,b.jsx)(x.Input,{ref:aw,value:ap,onChange:a=>aq(a.target.value),placeholder:"Buscar cards...",className:"h-10 w-full rounded-full pl-8 pr-8 font-body text-sm"}),ap?(0,b.jsx)("button",{type:"button",onClick:aN,className:"absolute right-2.5 top-1/2 -translate-y-1/2 text-zinc-400 hover:text-zinc-600","aria-label":"Limpar busca",children:(0,b.jsx)(f.X,{className:"h-3.5 w-3.5"})}):null]})})]},"mobile-search"),(0,b.jsxs)(w.Button,{variant:"outline",size:"sm",className:"h-10 rounded-full px-4",onClick:()=>a("filters"),children:[(0,b.jsx)(e.Filter,{className:"h-4 w-4"}),"Filtros",aM>0?(0,b.jsx)("span",{className:"ml-1.5 flex h-5 w-5 items-center justify-center rounded-[7px] bg-zinc-100 text-[10px] font-bold text-zinc-900 border border-zinc-200",children:aM}):null]},"filters"),(0,b.jsxs)(z.DropdownMenu,{children:[(0,b.jsx)(z.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(w.Button,{size:"sm",className:"h-10 rounded-full px-5",disabled:!U,children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4"}),"Novo"]})}),(0,b.jsxs)(z.DropdownMenuContent,{align:"end",className:"w-[220px] rounded-[16px]",children:[(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>a("new-opportunity"),disabled:!U,children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4"}),"Novo card"]}),(0,b.jsxs)(z.DropdownMenuItem,{onClick:()=>a("new-opportunity",{source:"captura-rapida"}),disabled:!U,children:[(0,b.jsx)(q.Sparkles,{className:"h-4 w-4"}),"Capturar lead"]})]})]},"new-card")],children:aT.length>0?(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",role:"group","aria-label":"Filtros ativos",children:[aT.map(a=>(0,b.jsxs)("span",{className:"inline-flex h-[28px] items-center gap-1 rounded-full border border-zinc-200/80 bg-white/70 pl-2.5 pr-1 text-[11.5px] font-medium text-zinc-700 shadow-(--shadow-premium-soft)",children:[(0,b.jsx)("span",{className:"truncate max-w-[140px] sm:max-w-[200px]",children:a.label}),(0,b.jsx)("button",{type:"button",onClick:a.onRemove,className:"ml-1 flex h-5 w-5 shrink-0 items-center justify-center rounded-full text-zinc-400 transition-colors hover:bg-zinc-200 hover:text-zinc-900 focus:outline-none","aria-label":`Remover filtro ${a.label}`,children:(0,b.jsx)(f.X,{className:"h-3 w-3"})})]},a.id)),(0,b.jsx)("button",{type:"button",onClick:aP,className:"ml-2 flex h-[26px] items-center justify-center text-[11.5px] font-semibold text-zinc-500 underline decoration-zinc-300 underline-offset-2 transition-colors hover:text-zinc-900",children:"Limpar tudo"})]}):null})}),ai?(0,b.jsx)("div",{className:(0,F.cn)("shrink-0 rounded-[14px] border px-3.5 py-2 text-xs font-medium","error"===ai.tone?"border-red-200 bg-red-50 text-red-700":"info"===ai.tone?"border-sky-200 bg-sky-50 text-sky-700":"border-emerald-200 bg-emerald-50 text-emerald-700"),role:"status",children:ai.message}):null,(0,b.jsxs)("div",{className:"premium-ambient premium-grain relative flex min-h-0 min-w-0 flex-1 flex-col overflow-hidden rounded-[22px] border border-zinc-200/70 bg-white/72 p-3 shadow-(--shadow-premium-soft) backdrop-blur-sm md:p-4",role:"region","aria-label":"Pipeline de vendas arrastavel",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between px-1 text-[11px] text-zinc-500 md:hidden",children:[(0,b.jsx)("span",{children:"Deslize para ver as etapas"}),(0,b.jsxs)("span",{children:[aB.length," colunas"]})]}),(0,b.jsx)("div",{"data-pipe-board-scroll":!0,className:"flex min-w-0 flex-1 gap-4 overflow-x-auto scroll-smooth px-1 pb-1 md:gap-5 md:px-2",style:{scrollSnapType:"x proximity"},children:aB.map((c,d)=>{let e,l,m=!!aF||aM>0,n=aK[c.id]||[],q=a6[c.id]?.label||c.label,r=bg(c.id),s=n.reduce((a,b)=>a+b.value,0),v=aW===c.id,x=aY?.stage===c.id?aY:null,z=a$?.stage===c.id?a$:null,A=bh(c.id),B=n.filter(a=>"breached"===M(a.slaDeadline).status).length,C=aa[c.id]??7,G=n.length>C;return(0,b.jsxs)(u.motion.div,{custom:d,variants:E.listItemReveal,className:(0,F.cn)("group/col flex w-[min(88vw,372px)] shrink-0 flex-col rounded-[22px] border transition-all duration-200 sm:w-[352px]",v?"border-brand/70 bg-brand/5 ring-2 ring-brand/26 shadow-[0_18px_30px_-22px_rgba(37,99,235,0.52)]":"border-zinc-200/80 bg-white/88"),style:{scrollSnapAlign:"start"},onDragOver:a=>a2(a,c.id),onDragLeave:a3,onDrop:a=>a4(a,c.id),role:"list","aria-label":`Etapa ${q}, ${n.length} cards, total ${(0,D.formatCurrencyBRL)(s)}`,children:[(0,b.jsxs)("div",{className:"sticky top-0 z-10 rounded-t-[22px] bg-inherit px-3.5 pb-3 pt-3 backdrop-blur-sm",children:[(0,b.jsx)("div",{className:"mb-2 h-1 w-full rounded-full bg-zinc-200/70",children:(0,b.jsx)("div",{className:(0,F.cn)("h-1 rounded-full",r.bg)})}),(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[X?(0,b.jsxs)(y.Popover,{open:ag===c.id,onOpenChange:a=>ah(a?c.id:null),children:[(0,b.jsx)(y.PopoverTrigger,{asChild:!0,children:(0,b.jsx)("button",{className:"flex h-7 w-7 shrink-0 items-center justify-center rounded-lg border border-zinc-200 bg-white text-zinc-400 shadow-sm transition-all hover:bg-zinc-50 hover:text-zinc-600 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand","aria-label":`Personalizar etapa ${q}`,children:(0,b.jsx)(o,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(y.PopoverContent,{align:"start",className:"w-auto rounded-[16px] p-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-1.5 text-[11px] font-medium text-zinc-600",children:[(0,b.jsx)(h,{className:"h-3 w-3"}),"Cor da etapa"]}),(0,b.jsx)("div",{className:"grid grid-cols-5 gap-1.5",children:L.map(a=>{let d=(a6[c.id]?.colorId||"default")===a.id;return(0,b.jsx)("button",{onClick:()=>{bf(c.id,a.id),ah(null)},className:(0,F.cn)("flex h-6 w-6 items-center justify-center rounded-full transition-all",a.bg,d?"ring-2 ring-zinc-900 ring-offset-2":"hover:ring-2 hover:ring-zinc-300 hover:ring-offset-1"),title:a.label,"aria-label":a.label,children:d?(0,b.jsx)(i.Check,{className:"h-3 w-3 text-white"}):null},a.id)})})]})]}):null,a7===c.id&&X?(0,b.jsxs)("div",{className:"flex min-w-0 flex-1 flex-col",children:[(0,b.jsx)("input",{ref:bb,value:a8,maxLength:30,onChange:a=>ba(a.target.value),onBlur:bd,onKeyDown:a=>{"Enter"===a.key&&bd(),"Escape"===a.key&&be()},className:(0,F.cn)("min-w-0 w-full truncate rounded-md border bg-white px-1.5 py-0.5 font-heading text-[14px] font-semibold text-zinc-900 outline-none focus:ring-1",a9?"border-red-400 focus:border-red-400 focus:ring-red-300":"border-zinc-300 focus:border-brand focus:ring-brand"),"aria-label":"Renomear etapa","aria-invalid":!!a9}),a9?(0,b.jsx)("span",{className:"mt-0.5 text-[10px] font-medium text-red-600",role:"alert",children:a9}):null]}):X?(0,b.jsx)("button",{onClick:()=>bc(c.id,q),className:"truncate font-heading text-[15px] font-semibold text-zinc-900 transition-colors hover:text-brand",title:"Clique para renomear",children:q}):(0,b.jsx)("span",{className:"truncate font-heading text-[15px] font-semibold text-zinc-900",children:q}),(0,b.jsx)("span",{className:"shrink-0 rounded-md bg-zinc-200/80 px-1.5 py-0.5 font-body text-[11px] font-semibold text-zinc-700",children:n.length})]}),(0,b.jsx)("span",{className:"shrink-0 text-[11px] font-semibold text-zinc-500",children:(0,D.formatCurrencyBRL)(s)})]}),(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-1.5",children:[(0,b.jsxs)("span",{className:"rounded-full border border-zinc-200 bg-zinc-50 px-2 py-1 text-[10px] font-semibold text-zinc-600",children:["SLA ",c.slaHours,"h"]}),(0,b.jsxs)("span",{className:(0,F.cn)("rounded-full border px-2 py-1 text-[10px] font-semibold",G?"border-amber-200 bg-amber-50 text-amber-700":"border-emerald-200 bg-emerald-50 text-emerald-700"),children:["WIP ",n.length,"/",C]}),(0,b.jsxs)("span",{className:(0,F.cn)("rounded-full border px-2 py-1 text-[10px] font-semibold",B>0?"border-red-200 bg-red-50 text-red-700":"border-zinc-200 bg-zinc-50 text-zinc-600"),children:["Estourados ",B]})]}),A?(0,b.jsx)("div",{className:(0,F.cn)("mt-2 rounded-[14px] border px-2.5 py-2 text-[11px] font-medium","error"===A.tone?"border-red-200 bg-red-50 text-red-700":"warning"===A.tone?"border-amber-200 bg-amber-50 text-amber-700":"border-emerald-200 bg-emerald-50 text-emerald-700"),role:"status",children:A.message}):null,x?(0,b.jsx)("div",{className:(0,F.cn)("mt-2 rounded-[14px] border px-2.5 py-2","warning"===x.tone?"border-amber-200 bg-amber-50 text-amber-700":"border-red-200 bg-red-50 text-red-700"),role:"alert",children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(k.AlertTriangle,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsx)("p",{className:"text-[11px] font-medium leading-relaxed",children:x.message}),x.missingFields?.length?(0,b.jsx)("button",{type:"button",onClick:bi,className:"mt-1 text-[11px] font-semibold underline underline-offset-2",children:"Preencher agora"}):null]}),(0,b.jsx)("button",{onClick:()=>aZ(null),className:"rounded-md p-1 transition hover:bg-black/5 focus:outline-none focus-visible:ring-2","aria-label":"Fechar aviso",children:(0,b.jsx)(f.X,{className:"h-3.5 w-3.5"})})]})}):null,z?(0,b.jsx)("div",{className:"mt-2 rounded-[14px] border border-emerald-200 bg-emerald-50 px-2.5 py-2 text-emerald-700",role:"status",children:(0,b.jsxs)("div",{className:"flex items-start gap-1.5",children:[(0,b.jsx)(j.CheckCircle2,{className:"mt-0.5 h-3.5 w-3.5 shrink-0"}),(0,b.jsx)("span",{className:"text-[11px] font-medium leading-relaxed",children:z.message})]})}):null]}),(0,b.jsx)("div",{"data-pipe-column-scroll":!0,className:"flex-1 overflow-y-auto px-3.5 pb-3.5",onDragOver:a=>a2(a,c.id),onDrop:a=>a4(a,c.id),children:n.length>0||v?(0,b.jsx)("div",{className:"space-y-3",children:(l=(e=!!(aU&&aX?.stage===c.id))?Math.min(aX?.index??0,n.length):-1,(0,b.jsxs)(t.AnimatePresence,{initial:!1,children:[n.flatMap((a,d)=>{let f=[],h=aU===a.id,i=x?.cardId===a.id?{tone:"error"===x.tone?"error":"warning",message:x.message,actionLabel:x.missingFields?.length?"Preencher agora":void 0,onAction:x.missingFields?.length?bi:void 0}:z?.cardId===a.id?{tone:"success",message:z.message}:null;return e&&l===d&&f.push((0,b.jsx)(u.motion.div,{layout:!0,initial:{opacity:0,scaleY:.82,height:0},animate:{opacity:1,scaleY:1,height:190},exit:{opacity:0,scaleY:.82,height:0},transition:{duration:.18,ease:[.22,1,.36,1]},className:"rounded-[22px] border border-dashed border-brand/45 bg-brand/5 shadow-[inset_0_0_0_1px_rgba(37,99,235,0.16)]"},`drop-placeholder-${c.id}-${d}`)),f.push((0,b.jsx)(u.motion.div,{layout:!0,"data-card-index":d,animate:{x:x?.cardId===a.id?[-5,5,-4,4,-2,2,0]:0},transition:{x:{duration:.4,ease:"easeInOut"},layout:{duration:.22,ease:[.22,1,.36,1]}},className:(0,F.cn)("transition-[transform,opacity,filter] duration-180 ease-out",h?"scale-[0.985] opacity-30 saturate-50":""),children:(0,b.jsx)(Y,{opportunity:a,temp:aJ(a),isDragging:h,isUpdating:a_===a.id,isHighlighted:a0===a.id,canMove:V,canEdit:V,canCreateActivity:W,inlineFeedback:i,onTagClick:a=>{aq(a),ao(a),window.scrollTo({top:0,behavior:"smooth"}),av.current?.focus()},onOpen:()=>g("lead-card",{id:a.id,opportunitySnapshot:a}),onDragStart:b=>a1(b,a),onDragEnd:a5})},a.id)),d===n.length-1&&e&&l>=n.length&&f.push((0,b.jsx)(u.motion.div,{layout:!0,initial:{opacity:0,scaleY:.82,height:0},animate:{opacity:1,scaleY:1,height:190},exit:{opacity:0,scaleY:.82,height:0},transition:{duration:.18,ease:[.22,1,.36,1]},className:"rounded-[22px] border border-dashed border-brand/45 bg-brand/5 shadow-[inset_0_0_0_1px_rgba(37,99,235,0.16)]"},`drop-placeholder-${c.id}-end`)),f}),0===n.length&&v?(0,b.jsx)(u.motion.div,{layout:!0,initial:{opacity:0,scaleY:.82,height:0},animate:{opacity:1,scaleY:1,height:190},exit:{opacity:0,scaleY:.82,height:0},transition:{duration:.18,ease:[.22,1,.36,1]},className:"rounded-[22px] border border-dashed border-brand/45 bg-brand/5 shadow-[inset_0_0_0_1px_rgba(37,99,235,0.16)]"},`drop-placeholder-empty-${c.id}`):null]}))}):(0,b.jsxs)("div",{className:"mt-1 flex min-h-[180px] flex-col items-center justify-center rounded-[16px] border-2 border-dashed border-zinc-200 bg-zinc-50/40 px-4 text-center",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-zinc-700",children:m?"Zero resultados no filtro":"Sem cards nesta etapa"}),(0,b.jsx)("p",{className:"mt-1 text-[11px] leading-relaxed text-zinc-500",children:m?"Tente limpar a busca ou os filtros ativos acima.":"Crie um novo card aqui ou mova um card de outra coluna."}),(0,b.jsx)("div",{className:"mt-3 flex flex-wrap items-center justify-center gap-2",children:(0,b.jsxs)(w.Button,{size:"sm",className:"h-8 rounded-full px-3 text-xs",onClick:()=>a("new-opportunity",{initialStage:c.id}),disabled:!U,children:[(0,b.jsx)(p.Plus,{className:"h-3.5 w-3.5"}),"Criar card nesta etapa"]})})]})})]},c.id)})})]})]})]})}function af(){return(0,b.jsx)("div",{className:"premium-ambient min-h-[calc(100vh-72px)] p-6",children:(0,b.jsx)($,{stageCount:I[0].stages.length})})}function ag(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(af,{}),children:(0,b.jsx)(ae,{})})}a.s(["default",()=>ag],66382)}];

//# sourceMappingURL=src_app_%28auth%29_pipes_page_tsx_a61065aa._.js.map