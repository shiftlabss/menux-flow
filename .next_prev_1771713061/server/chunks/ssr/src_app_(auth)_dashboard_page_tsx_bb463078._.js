module.exports=[85626,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(46271),e=a.i(50944),f=a.i(33140),g=a.i(73570),h=a.i(41675),i=a.i(5784),j=a.i(57064),k=a.i(66384),l=a.i(70106);let m=(0,l.default)("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);var n=a.i(99570),o=a.i(35732),p=a.i(55376),q=a.i(45113);let r=(0,a.i(20226).create)(a=>({period:"today",context:"me",setPeriod:b=>a({period:b}),setContext:b=>a({context:b})}));function s(a,b){let c,d=new Date(b.getFullYear(),b.getMonth(),b.getDate(),23,59,59,999);switch(a){case"today":c=new Date(b.getFullYear(),b.getMonth(),b.getDate());break;case"7d":c=new Date(b.getFullYear(),b.getMonth(),b.getDate()-7);break;case"30d":c=new Date(b.getFullYear(),b.getMonth(),b.getDate()-30);break;case"quarter":{let a=3*Math.floor(b.getMonth()/3);c=new Date(b.getFullYear(),a,1)}}return{start:c,end:d}}var t=a.i(66206),u=a.i(2789),v=a.i(81584),w=a.i(12412),x=a.i(31791),y=a.i(92992);function z(){let a=(0,u.useOpportunityStore)(a=>a.opportunities),b=(0,v.useActivityStore)(a=>a.activities),d=(0,t.useAuthStore)(a=>a.user),e=r(a=>a.period),f=r(a=>a.context),g=(0,w.useNow)(),h=d?.id??"",i=d?.role??"comercial";return(0,c.useMemo)(()=>{let{start:c,end:d}=s(e,g),j="me"===f?(0,y.filterByUser)(a,h,i):a,k="me"===f?(0,y.filterByUser)(b,h,i):b,l=j.filter(a=>"open"===a.status);return{filteredOpportunities:j.filter(a=>{if("open"===a.status)return!0;let b=new Date(a.updatedAt);return b>=c&&b<=d}),filteredActivities:k.map(a=>({...a,effectiveStatus:(0,x.getEffectiveActivityStatus)(a,g)})).filter(a=>{if("pending"===a.effectiveStatus||"overdue"===a.effectiveStatus)return!0;let b=new Date(a.dueDate);return b>=c&&b<=d}),openOpportunities:l,now:g,period:e,context:f,userId:h,userRole:i}},[a,b,e,f,g,h,i])}let A={today:"Hoje","7d":"7 dias","30d":"30 dias",quarter:"Trimestre"};function B(){let a,d,l,s,u,v,w,y=(0,e.useRouter)(),B=(0,e.usePathname)(),{period:C,setPeriod:D}=r(),{user:E,isLoading:F}=(0,t.useAuthStore)(),[G,H]=(0,c.useState)(!1),{filteredActivities:I,openOpportunities:J,now:K}=z(),L=E?.name?.trim().split(" ")[0]??"Admin",M=I.filter(a=>"overdue"===a.effectiveStatus).length,N=J.filter(a=>a.slaDeadline&&new Date(a.slaDeadline)<K),O=N.length,P=N.reduce((a,b)=>a+(b.value||0),0),Q=!Number.isFinite(M)||!Number.isFinite(O)||!Number.isFinite(P),R=[M>0?{id:"overdue",value:`${M}`,label:"atrasadas",icon:g.AlertTriangle,tone:"danger"}:null,O>0?{id:"sla",value:`${O}`,label:"SLAs estourados",icon:k.ShieldAlert,tone:"warning"}:null,P>0?{id:"risk",value:(0,x.formatCurrencyBRL)(P),label:"valor em risco",icon:m,tone:"info"}:null].filter(a=>!!a).slice(0,3),S=`${(a=new Intl.DateTimeFormat("pt-BR",{weekday:"short",day:"2-digit",month:"short",timeZone:"America/Sao_Paulo"}).formatToParts(K),d=a.find(a=>"weekday"===a.type)?.value??"",l=a.find(a=>"day"===a.type)?.value??"",s=a.find(a=>"month"===a.type)?.value??"",u=d.replaceAll(".","").trim(),v=s.replaceAll(".","").trim(),w=u.charAt(0).toUpperCase()+u.slice(1),`${w}, ${l} ${v}`)} \xb7 Ol\xe1, ${L}`,T=Q?[]:R.map(a=>{let c=a.icon;return{id:a.id,label:`${a.value} ${a.label}`,icon:(0,b.jsx)(c,{className:"h-3.5 w-3.5"}),tone:"danger"===a.tone?"danger":"warning"===a.tone?"warning":"info",onClick:()=>(a=>{if("overdue"===a)return void y.push("/activities?status=overdue");let b="sla"===a?"dashboard-execution":"dashboard-funnel",c=document.getElementById(b);c?c.scrollIntoView({behavior:"smooth",block:"start"}):"/dashboard"!==B&&y.push(`/dashboard#${b}`)})(a.id)}}),U={id:"dashboard-empty",label:"Sem dados do dia · Ver pipeline",icon:(0,b.jsx)(j.LayoutGrid,{className:"h-3.5 w-3.5 text-zinc-500"}),onClick:()=>y.push("/pipes"),tone:"neutral"},V=(0,b.jsx)("div",{className:(0,q.cn)("flex w-full flex-wrap items-center justify-end gap-2",F&&"pointer-events-none opacity-60"),children:(0,b.jsxs)(o.DropdownMenu,{children:[(0,b.jsx)(o.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsxs)(n.Button,{variant:"outline",className:"premium-shine h-8 gap-1.5 rounded-full border-zinc-200 bg-white/90 px-3 text-sm font-medium hover:bg-zinc-100/80 active:scale-[0.99]",children:[(0,b.jsx)(j.LayoutGrid,{className:"h-3.5 w-3.5 text-zinc-500"}),A[C],(0,b.jsx)(i.ChevronDown,{className:"h-3.5 w-3.5 text-zinc-400"})]})}),(0,b.jsx)(o.DropdownMenuContent,{align:"end",className:"w-40 rounded-xl",children:Object.keys(A).map(a=>(0,b.jsxs)(o.DropdownMenuItem,{onClick:()=>D(a),className:"gap-2",children:[C===a?(0,b.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-brand"}):null,(0,b.jsx)("span",{className:C===a?"font-medium":"",children:A[a]})]},a))})]})});return(0,b.jsxs)(p.ModuleCommandHeader,{title:"Dashboard",description:"Raio X do comercial",sticky:!0,actions:V,meta:(0,b.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,b.jsx)(h.Calendar,{className:"h-3.5 w-3.5"}),S]}),chips:T,fallbackChip:U,className:"premium-panel",children:[F?(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsx)(f.Skeleton,{className:"h-8 w-[110px] rounded-full"}),(0,b.jsx)(f.Skeleton,{className:"h-8 w-[128px] rounded-full"}),(0,b.jsx)(f.Skeleton,{className:"h-8 w-[142px] rounded-full"})]}):null,Q?(0,b.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-full border border-red-200 bg-red-50/90 px-3 py-1.5 text-xs text-red-700",children:[(0,b.jsx)(g.AlertTriangle,{className:"h-3.5 w-3.5"}),"Falha ao carregar indicadores.",(0,b.jsx)("button",{type:"button",onClick:()=>{H(!0),y.refresh(),window.setTimeout(()=>H(!1),220)},className:"font-semibold underline underline-offset-4",children:G?"Tentando...":"Tentar novamente"})]}):null]})}class C{constructor(a){this.stop=()=>this.runAll("stop"),this.animations=a.filter(Boolean)}get finished(){return Promise.all(this.animations.map(a=>a.finished))}getAll(a){return this.animations[0][a]}setAll(a,b){for(let c=0;c<this.animations.length;c++)this.animations[c][a]=b}attachTimeline(a){let b=this.animations.map(b=>b.attachTimeline(a));return()=>{b.forEach((a,b)=>{a&&a(),this.animations[b].stop()})}}get time(){return this.getAll("time")}set time(a){this.setAll("time",a)}get speed(){return this.getAll("speed")}set speed(a){this.setAll("speed",a)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return D(this.animations,"duration")}get iterationDuration(){return D(this.animations,"iterationDuration")}runAll(a){this.animations.forEach(b=>b[a]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function D(a,b){let c=0;for(let d=0;d<a.length;d++){let e=a[d][b];null!==e&&e>c&&(c=e)}return c}class E extends C{then(a,b){return this.finished.finally(a).then(()=>{})}}var F=a.i(32562),G=a.i(36083),H=a.i(26286),I=a.i(98852),J=a.i(78025),K=a.i(78652),L=a.i(94015),M=a.i(80733),N=a.i(84913),O=a.i(18271),P=a.i(702),Q=a.i(25164);function R(a,b){var c;let d;return(0,Q.isEasingArray)(a)?a[c=a.length,((b-0)%(d=c-0)+d)%d+0]:a}var S=a.i(54760);function T(a){return"object"==typeof a&&!Array.isArray(a)}function U(a,b,c,d){return null==a?[]:"string"==typeof a&&T(b)?(0,S.resolveElements)(a,c,d):a instanceof NodeList?Array.from(a):Array.isArray(a)?a.filter(a=>null!=a):[a]}function V(a,b,c,d){return"number"==typeof b?b:b.startsWith("-")||b.startsWith("+")?Math.max(0,a+parseFloat(b)):"<"===b?c:b.startsWith("<")?Math.max(0,c+parseFloat(b.slice(1))):d.get(b)??a}var W=a.i(55761);function X(a,b){return a.at!==b.at?a.at-b.at:null===a.value?1:null===b.value?-1:0}function Y(a,b){return b.has(a)||b.set(a,{}),b.get(a)}function Z(a,b){return b[a]||(b[a]=[]),b[a]}let $=a=>"number"==typeof a,_=a=>a.every($);var aa=a.i(12711),ab=a.i(73559),ac=a.i(10349),ad=a.i(45854),ae=a.i(4721),af=a.i(87328),ag=a.i(72789),ah=a.i(20275),ai=a.i(55794);class aj extends ai.VisualElement{constructor(){super(...arguments),this.type="object"}readValueFromInstance(a,b){if(b in a){let c=a[b];if("string"==typeof c||"number"==typeof c)return c}}getBaseTargetFromProps(){}removeValueFromRenderState(a,b){delete b.output[a]}measureInstanceViewportBox(){return(0,ah.createBox)()}build(a,b){Object.assign(a.output,b)}renderInstance(a,{output:b}){Object.assign(a,b)}sortInstanceNodePosition(){return 0}}function ak(a){let b={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},c=(0,ad.isSVGElement)(a)&&!(0,ae.isSVGSVGElement)(a)?new af.SVGVisualElement(b):new ag.HTMLVisualElement(b);c.mount(a),ab.visualElementStore.set(a,c)}function al(a){let b=new aj({presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}});b.mount(a),ab.visualElementStore.set(a,b)}function am(a,b,c,d){let e=[];if((0,I.isMotionValue)(a)||"number"==typeof a||"string"==typeof a&&!T(b))e.push((0,aa.animateSingleValue)(a,T(b)&&b.default||b,c&&c.default||c));else{if(null==a)return e;let f=U(a,b,d),g=f.length;(0,P.invariant)(!!g,"No valid elements provided.","no-valid-elements");for(let a=0;a<g;a++){let d=f[a],h=d instanceof Element?ak:al;ab.visualElementStore.has(d)||h(d);let i=ab.visualElementStore.get(d),j={...c};"delay"in j&&"function"==typeof j.delay&&(j.delay=j.delay(a,g)),e.push(...(0,ac.animateTarget)(i,{...b,transition:j},{}))}}return e}let an=function(a={}){let{scope:b,reduceMotion:c}=a;return function(a,d,e){var f;let g,h=[];if(Array.isArray(a)&&a.some(Array.isArray)){let e;f=void 0!==c?{reduceMotion:c,...d}:d,e=[],(function(a,{defaultTransition:b={},...c}={},d,e){let f=b.duration||.3,g=new Map,h=new Map,i={},j=new Map,k=0,l=0,m=0;for(let c=0;c<a.length;c++){let g=a[c];if("string"==typeof g){j.set(g,l);continue}if(!Array.isArray(g)){j.set(g.name,V(l,g.at,k,j));continue}let[p,q,r={}]=g;void 0!==r.at&&(l=V(l,r.at,k,j));let s=0,t=(a,c,d,g=0,h=0)=>{var i;let j=Array.isArray(i=a)?i:[i],{delay:k=0,times:n=(0,J.defaultOffset)(j),type:o=b.type||"keyframes",repeat:p,repeatType:q,repeatDelay:r=0,...t}=c,{ease:u=b.ease||"easeOut",duration:v}=c,w="function"==typeof k?k(g,h):k,x=j.length,y=(0,K.isGenerator)(o)?o:e?.[o||"keyframes"];if(x<=2&&y){let a=100;2===x&&_(j)&&(a=Math.abs(j[1]-j[0]));let c={...b,...t};void 0!==v&&(c.duration=(0,O.secondsToMilliseconds)(v));let d=(0,L.createGeneratorEasing)(c,a,y);u=d.ease,v=d.duration}v??(v=f);let z=l+w;1===n.length&&0===n[0]&&(n[1]=1);let A=n.length-j.length;if(A>0&&(0,M.fillOffset)(n,A),1===j.length&&j.unshift(null),p){(0,P.invariant)(p<20,"Repeat count too high, must be less than 20","repeat-count-high");v*=p+1;let a=[...j],b=[...n],c=[...u=Array.isArray(u)?[...u]:[u]];for(let d=0;d<p;d++){j.push(...a);for(let e=0;e<a.length;e++)n.push(b[e]+(d+1)),u.push(0===e?"linear":R(c,e-1))}for(let a=0;a<n.length;a++)n[a]=n[a]/(p+1)}let B=z+v;!function(a,b,c,d,e,f){for(let b=0;b<a.length;b++){let c=a[b];c.at>e&&c.at<f&&((0,F.removeItem)(a,c),b--)}for(let g=0;g<b.length;g++)a.push({value:b[g],at:(0,W.mixNumber)(e,f,d[g]),easing:R(c,g)})}(d,j,u,n,z,B),s=Math.max(w+v,s),m=Math.max(B,m)};if((0,I.isMotionValue)(p))t(q,r,Z("default",Y(p,h)));else{let a=U(p,q,d,i),b=a.length;for(let c=0;c<b;c++){let d=Y(a[c],h);for(let a in q){var n,o;t(q[a],(n=r,o=a,n&&n[o]?{...n,...n[o]}:{...n}),Z(a,d),c,b)}}}k=l,l+=s}return h.forEach((a,d)=>{for(let e in a){let f=a[e];f.sort(X);let h=[],i=[],j=[];for(let a=0;a<f.length;a++){let{at:b,value:c,easing:d}=f[a];h.push(c),i.push((0,N.progress)(0,m,b)),j.push(d||"easeOut")}0!==i[0]&&(i.unshift(0),h.unshift(h[0]),j.unshift("easeInOut")),1!==i[i.length-1]&&(i.push(1),h.push(null)),g.has(d)||g.set(d,{keyframes:{},transition:{}});let k=g.get(d);k.keyframes[e]=h;let{type:l,...n}=b;k.transition[e]={...n,duration:m,ease:j,times:i,...c}}}),g})(a.map(a=>{if(Array.isArray(a)&&"function"==typeof a[0]){let b=a[0],c=(0,G.motionValue)(0);return(c.on("change",b),1===a.length)?[c,[0,1]]:2===a.length?[c,[0,1],a[1]]:[c,a[1],a[2]]}return a}),f,b,{spring:H.spring}).forEach(({keyframes:a,transition:b},c)=>{e.push(...am(c,a,b))}),h=e}else{let{onComplete:f,...i}=e||{};"function"==typeof f&&(g=f),h=am(a,d,void 0!==c?{reduceMotion:c,...i}:i,b)}let i=new E(h);return g&&i.finished.then(g),b&&(b.animations.push(i),i.finished.then(()=>{(0,F.removeItem)(b.animations,i)})),i}}();var ao=a.i(21520),ap=a.i(50522),aq=a.i(16221);let ar=(0,l.default)("gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]);var as=a.i(24669),at=a.i(68114),au=a.i(48282);function av(a,b,c){let d=a.filter(a=>{if("won"!==a.status&&"lost"!==a.status)return!1;let d=new Date(a.updatedAt);return d>=b&&d<=c}),e=d.filter(a=>"won"===a.status).length,f=d.length;return{won:e,total:f,rate:f>0?e/f*100:0}}function aw({value:a,format:d}){let e=(0,ao.useMotionValue)(a),[f,g]=(0,c.useState)(a);return(0,c.useEffect)(()=>e.on("change",a=>{g(a)}),[e]),(0,c.useEffect)(()=>an(e,a,{duration:.22,ease:[.22,.61,.36,1]}).stop,[e,a]),(0,b.jsx)(b.Fragment,{children:function(a,b){if("currency"===b){let b=Math.abs(a);return b>=1e3?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",notation:"compact",maximumFractionDigits:b>=1e6?2:1}).format(a):new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:0}).format(a)}return"percent"===b?`${a.toFixed(1)}%`:Math.round(a).toString()}(f,d)})}function ax({chip:a}){return(0,b.jsx)("span",{className:(0,at.cn)("inline-flex h-[24px] max-w-full items-center rounded-full border px-2.5 text-[11px] font-semibold tracking-tight whitespace-nowrap","neutral"===a.tone&&"border-zinc-200/85 bg-zinc-100/80 text-zinc-700","info"===a.tone&&"border-sky-200/80 bg-sky-50/80 text-sky-700","warning"===a.tone&&"border-amber-200/80 bg-amber-50/80 text-amber-700","danger"===a.tone&&"border-rose-200/80 bg-rose-50/80 text-rose-700","success"===a.tone&&"border-emerald-200/80 bg-emerald-50/80 text-emerald-700"),title:a.label,children:(0,b.jsx)("span",{className:"truncate",children:a.label})})}function ay({icon:a,data:c,onNavigate:e,onRetry:g}){let h=c.state??"default",i="default"===h&&!c.disabled,j=c.chips.slice(0,2),k=c.chips.length>2?{label:"Ver detalhes",targetPath:c.targetPath}:c.detailAction;return(0,b.jsx)(d.motion.article,{onClick:function(){i&&e(c.targetPath)},onKeyDown:function(a){i&&("Enter"===a.key||" "===a.key)&&(a.preventDefault(),e(c.targetPath))},role:i?"button":void 0,tabIndex:i?0:-1,"aria-disabled":!i,whileTap:i?{scale:.99}:void 0,transition:{duration:.09,ease:"easeInOut"},className:(0,at.cn)("premium-shine group flex h-[222px] w-full flex-col overflow-hidden rounded-[24px] border border-zinc-200/80 bg-white/90 p-5 text-left","shadow-(--shadow-bento-sm) transition-[box-shadow,border-color,background-color] duration-150 ease-out",i&&"cursor-pointer hover:shadow-(--shadow-bento-sm-hover)","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/25"),children:"loading"===h?(0,b.jsxs)("div",{className:"flex h-full flex-col gap-4",children:[(0,b.jsx)(f.Skeleton,{className:"h-4 w-28 rounded-md before:animation-duration-[900ms]"}),(0,b.jsx)(f.Skeleton,{className:"h-10 w-36 rounded-lg before:animation-duration-[900ms]"})]}):"error"===h?(0,b.jsxs)("div",{className:"flex h-full flex-col justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-[13px] font-semibold text-zinc-900",children:c.label}),(0,b.jsx)("p",{className:"mt-2 text-xs text-red-700",children:"Erro ao carregar métrica."})]}),(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),g()},className:"w-fit text-xs font-semibold text-brand underline underline-offset-4",children:"Tentar novamente"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("header",{className:"flex h-8 items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex min-w-0 items-center gap-2.5",children:[(0,b.jsx)("div",{className:"flex h-8 w-8 shrink-0 items-center justify-center rounded-[10px] bg-zinc-100 text-zinc-700",children:a}),(0,b.jsx)("p",{className:"truncate text-[13px] font-medium text-zinc-600",children:c.label})]}),i?(0,b.jsx)(ap.ChevronRight,{className:"h-4 w-4 shrink-0 text-zinc-400 transition-[color,transform] duration-150 group-hover:translate-x-[1px] group-hover:text-zinc-600"}):null]}),(0,b.jsxs)("div",{className:"mt-3 flex h-[66px] min-w-0 items-end gap-1.5",children:[(0,b.jsx)("p",{className:"tabular-nums whitespace-nowrap text-[clamp(1.9rem,2.35vw,2.85rem)] leading-[0.92] font-bold tracking-tight text-zinc-900",children:(0,b.jsx)(aw,{value:c.value,format:c.valueFormat})}),c.valueSuffix?(0,b.jsx)("p",{className:"tabular-nums shrink-0 truncate pb-1 text-[13px] font-semibold text-zinc-500",children:c.valueSuffix}):null]}),(0,b.jsx)("p",{className:"mt-2 h-6 truncate text-[13px] font-medium text-zinc-500",children:c.subtext}),(0,b.jsxs)("footer",{className:"mt-auto flex h-[58px] flex-col justify-end pt-3",children:[(0,b.jsxs)("div",{className:"flex min-h-[24px] items-center gap-2 overflow-hidden",children:[j.map(a=>(0,b.jsx)(ax,{chip:a},a.id)),0!==j.length||k?null:(0,b.jsx)("p",{className:"truncate text-[12px] text-zinc-500",title:c.line4Text||"Sem alertas hoje",children:c.line4Text||"Sem alertas hoje"}),k?(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),e(k.targetPath)},className:"inline-flex h-[24px] shrink-0 items-center text-[12px] font-semibold text-brand underline underline-offset-4 transition-[color,transform,opacity] duration-150 hover:translate-x-[1px] hover:text-brand/80",children:k.label}):null]}),(0,b.jsx)("p",{className:"tabular-nums mt-1.5 h-[16px] truncate text-[11px] text-zinc-500",children:c.microText??""})]})]})})}function az(){let a=(0,e.useRouter)(),f=function(){let{filteredActivities:a,openOpportunities:b,now:d,period:e,context:f,userId:g,userRole:h}=z(),i=(0,u.useOpportunityStore)(a=>a.opportunities);return(0,c.useMemo)(()=>{let c="me"===f?(0,y.filterByUser)(i,g,h):i,{start:j,end:k}=s(e,d),l=k.getTime()-j.getTime()+1,m=new Date(j.getTime()-1),n=new Date(m.getTime()-l+1),o=av(c,j,k),p=av(c,n,m),q=o.total>0,r=p.total>0,t=r?o.rate-p.rate:null,u=b.reduce((a,b)=>a+(b.value||0),0),v=a.filter(a=>"pending"===a.effectiveStatus||"overdue"===a.effectiveStatus),w=a.filter(a=>"overdue"===a.effectiveStatus).length,x=d.toISOString().slice(0,10),z=a.filter(a=>"pending"===a.effectiveStatus&&a.dueDate===x).length,A=d.getTime()-432e6,B=b.filter(a=>new Date(a.updatedAt).getTime()<A).length,C=b.filter(a=>{var b;return b=a.slaDeadline,!!b&&new Date(b)<d}).length,D=b.filter(a=>(function(a,b){if(!a)return!1;let c=(new Date(a).getTime()-b.getTime())/36e5;return c>0&&c<=24})(a.slaDeadline,d)).length,E=b.length>0?Math.round((C+D)/b.length*100):0,F=[];q&&null!==t&&(t>0?F.push({id:"conversion-up",label:`Alta +${t.toFixed(1)} p.p.`,tone:"success"}):t<0?F.push({id:"conversion-down",label:`Queda ${Math.abs(t).toFixed(1)} p.p.`,tone:"danger"}):F.push({id:"conversion-flat",label:"Estavel 0.0 p.p.",tone:"neutral"}));let G=[];w>0&&G.push({id:"activities-overdue",label:`Atrasadas: ${w}`,tone:"danger"}),z>0&&G.push({id:"activities-today",label:`Hoje: ${z}`,tone:"warning"}),0===G.length&&G.push({id:"activities-ok",label:"OK",tone:"success"});let H=[];C>0&&H.push({id:"sla-overdue",label:`Estourados: ${C}`,tone:"danger"}),D>0&&H.push({id:"sla-risk",label:`Em risco: ${D}`,tone:"warning"}),0===H.length&&H.push({id:"sla-ok",label:"OK",tone:"success"});let I=[];C>0&&I.push({id:"pipeline-overdue",label:`Estourados: ${C}`,tone:"danger"});let J=C>0?"/pipes?filter=sla_overdue":"/pipes?filter=sla_risk";return{pipeline:{label:"Pipeline Total",value:u,valueFormat:"currency",subtext:`${b.length} oportunidades abertas`,chips:I,line4Text:0===I.length&&0===B?"Sem alertas hoje":void 0,detailAction:B>0?{label:"Ver sem atividade",targetPath:"/pipes?filter=stale"}:void 0,targetPath:"/pipes",state:"default"},conversion:{label:"Conversão Global",value:o.rate,valueFormat:"percent",subtext:q?`Ganhos no per\xedodo: ${o.won}`:"Sem dados no período",chips:F,line4Text:q?r?void 0:"Sem base comparável":"Ajuste o período para comparar.",disabled:!q,targetPath:"/dashboard?view=conversion",state:"default"},activities:{label:"Atividades",value:v.length,valueFormat:"integer",subtext:`${w} atrasadas \xb7 ${z} para hoje`,chips:G.slice(0,2),targetPath:"/activities?statuses=pending,overdue",state:"default"},sla:{label:"SLA Crítico",value:C,valueFormat:"integer",valueSuffix:"estourados",subtext:`${D} em risco`,chips:H.slice(0,2),detailAction:C>0||D>0?{label:"Ver deals",targetPath:J}:void 0,microText:`${E}% da carteira em risco`,targetPath:J,state:"default"}}},[a,b,d,e,f,g,h,i])}(),[g,h]=(0,c.useState)({pipeline:"default",conversion:"default",activities:"default",sla:"default"}),i=(0,c.useMemo)(()=>({pipeline:{...f.pipeline,state:g.pipeline},conversion:{...f.conversion,state:g.conversion},activities:{...f.activities,state:g.activities},sla:{...f.sla,state:g.sla}}),[f,g]);function j(a){h(b=>({...b,[a]:"loading"})),window.setTimeout(()=>{h(b=>({...b,[a]:"default"}))},240)}return(0,b.jsxs)(d.motion.div,{variants:au.cardStaggerContainer,initial:"hidden",animate:"show",className:"grid grid-cols-1 items-stretch gap-4 sm:grid-cols-2 xl:grid-cols-4",children:[(0,b.jsx)(d.motion.div,{custom:0,variants:au.listItemReveal,className:"h-full",children:(0,b.jsx)(ay,{icon:(0,b.jsx)(ar,{className:"h-4 w-4"}),data:i.pipeline,onNavigate:b=>a.push(b),onRetry:()=>j("pipeline")})}),(0,b.jsx)(d.motion.div,{custom:1,variants:au.listItemReveal,className:"h-full",children:(0,b.jsx)(ay,{icon:(0,b.jsx)(as.TrendingUp,{className:"h-4 w-4"}),data:i.conversion,onNavigate:b=>a.push(b),onRetry:()=>j("conversion")})}),(0,b.jsx)(d.motion.div,{custom:2,variants:au.listItemReveal,className:"h-full",children:(0,b.jsx)(ay,{icon:(0,b.jsx)(aq.Clock3,{className:"h-4 w-4"}),data:i.activities,onNavigate:b=>a.push(b),onRetry:()=>j("activities")})}),(0,b.jsx)(d.motion.div,{custom:3,variants:au.listItemReveal,className:"h-full",children:(0,b.jsx)(ay,{icon:(0,b.jsx)(k.ShieldAlert,{className:"h-4 w-4"}),data:i.sla,onNavigate:b=>a.push(b),onRetry:()=>j("sla")})})]})}var aA=a.i(62036),aB=a.i(32860),aC=a.i(22520),aD=a.i(8406);let aE=(0,l.default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),aF=c.forwardRef(({title:a,description:c,actions:e,children:f,size:g="md",state:h="default",className:i,noPadding:j=!1,elevated:k=!1,hoverable:l=!1,shine:m=!0,...n},o)=>{let p=a||c||e;return(0,b.jsxs)(d.motion.div,{ref:o,whileHover:l?au.premiumPressMotion.whileHover:void 0,whileTap:l?au.premiumPressMotion.whileTap:void 0,transition:l?{duration:.22,ease:[.22,.61,.36,1]}:void 0,className:(0,at.cn)("group/card relative overflow-hidden","bento-card-base premium-panel","rounded-[var(--radius-bento-card)]","border border-[var(--border-bento-default)]","focus-within:ring-2 focus-within:ring-brand/20",k&&"bento-card-elevated",!k&&"shadow-[var(--shadow-bento-sm)]",l&&k&&"bento-card-elevated-hover",l&&!k&&"bento-card-hover",l&&"premium-lift",l&&m&&"premium-shine","sm"===g?"min-h-[140px]":"lg"===g?"min-h-[260px]":"tall"===g?"min-h-[340px]":"wide"===g?"min-h-[200px]":"min-h-[180px]","error"===h&&"border-[var(--border-bento-error)]","loading"===h&&"pointer-events-none opacity-80",i),...n,children:[m&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-0 opacity-0 transition-opacity duration-300 ease-out group-hover/card:opacity-100",children:[(0,b.jsx)("div",{className:"absolute -top-16 right-[-12%] h-40 w-40 rounded-full bg-brand/15 blur-3xl"}),(0,b.jsx)("div",{className:"absolute -bottom-16 left-[-10%] h-36 w-36 rounded-full bg-cyan-300/15 blur-3xl"})]}),(0,b.jsx)("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-x-0 top-0 h-px bg-linear-to-r from-transparent via-white/90 to-transparent opacity-70"})]}),p&&(0,b.jsxs)("div",{className:(0,at.cn)("flex items-start justify-between gap-4",j?"px-6 pt-6":"px-6 pt-6 pb-4"),children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[a&&(0,b.jsx)("h3",{className:"font-heading text-lg font-semibold text-black",children:a}),c&&(0,b.jsx)("p",{className:"mt-1 font-body text-sm text-zinc-500",children:c})]}),e&&(0,b.jsx)("div",{className:"flex shrink-0 gap-2",children:e})]}),(0,b.jsx)("div",{className:(0,at.cn)(!j&&(p?"px-6 pb-6":"p-6")),children:f})]})});aF.displayName="BentoCard";var aG=a.i(85259);let aH={lead:"lead-in",contact:"contato-feito",meeting:"reuniao-agendada",proposal:"proposta-enviada",negotiation:"negociacao",won:"fechamento"},aI={"lead-in":"lead","contato-feito":"contact","reuniao-agendada":"meeting","proposta-enviada":"proposal",negociacao:"negotiation",fechamento:"won"},aJ={lead:"Leads",contact:"Contato",meeting:"Reunião",proposal:"Proposta",negotiation:"Negociação",won:"Fechamento"},aK=["lead","contact","meeting","proposal","negotiation","won"];function aL({stage:a,selected:c,onSelectStage:e,compact:f}){var g;return(0,b.jsxs)(d.motion.button,{type:"button",onClick:()=>e(a.id),whileTap:{scale:.99},transition:{duration:.14,ease:"easeOut"},className:(0,at.cn)("group/step min-w-0 rounded-xl border px-3 py-3 text-left transition-[background-color,border-color,box-shadow,opacity] duration-[140ms] ease-out","shadow-[0_8px_22px_-18px_rgba(15,23,42,0.45)] hover:shadow-[0_10px_26px_-16px_rgba(15,23,42,0.5)]",f?"w-full":"flex-[1_1_148px]",c?"border-brand/40 bg-brand/10 shadow-[0_0_0_1px_rgba(29,78,216,0.14),0_10px_26px_-16px_rgba(29,78,216,0.55)]":"border-zinc-200/85 bg-white/90 hover:border-zinc-300/90"),"aria-pressed":c,children:[(0,b.jsx)("p",{className:"truncate text-[11px] font-semibold uppercase tracking-[0.07em] text-zinc-500",children:a.label}),(0,b.jsx)("p",{className:"mt-1 text-xl font-bold leading-none text-zinc-900",children:a.volume}),(0,b.jsx)("p",{className:"mt-1 text-[11px] text-zinc-500",children:(g=a.value)>=1e6?`R$ ${(g/1e6).toFixed(1)}M`:g>=1e3?`R$ ${(g/1e3).toFixed(0)}k`:`R$ ${g}`})]})}let aM=(0,l.default)("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);function aN({transition:a,isBottleneck:c,orientation:e,delay:f}){let g=c?"bg-amber-300/80":"bg-zinc-300/85";return(0,b.jsxs)(aG.Tooltip,{children:[(0,b.jsx)(aG.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(d.motion.div,{className:(0,at.cn)("group/connector relative flex shrink-0 items-center justify-center","horizontal"===e?"min-w-[46px] flex-1 md:max-w-[64px]":"h-6 w-full"),children:["horizontal"===e?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.motion.div,{initial:{scaleX:0},animate:{scaleX:1},transition:{duration:.22,delay:f,ease:"easeOut"},className:(0,at.cn)("h-px w-full origin-left transition-opacity duration-[120ms] group-hover/connector:opacity-100",g,c?"opacity-95":"opacity-70")}),(0,b.jsx)(aB.ArrowRight,{className:"ml-1 h-3 w-3 text-zinc-400 transition-opacity duration-[120ms] group-hover/connector:opacity-100"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.motion.div,{initial:{scaleY:0},animate:{scaleY:1},transition:{duration:.22,delay:f,ease:"easeOut"},className:(0,at.cn)("h-full w-px origin-top transition-opacity duration-[120ms] group-hover/connector:opacity-100",g,c?"opacity-95":"opacity-70")}),(0,b.jsx)(aM,{className:"absolute bottom-[-3px] h-3 w-3 text-zinc-400 transition-opacity duration-[120ms] group-hover/connector:opacity-100"})]}),(0,b.jsxs)("span",{className:(0,at.cn)("absolute rounded-full border px-1.5 py-0.5 text-[10px] font-semibold shadow-sm transition-opacity duration-[120ms] group-hover/connector:opacity-100","horizontal"===e?"top-[-11px]":"right-2 top-[2px]",c?"border-amber-300/80 bg-amber-50 text-amber-700":"border-zinc-200 bg-white text-zinc-600",c?"opacity-100":"opacity-85"),children:[a.conversion,"%"]})]})}),(0,b.jsxs)(aG.TooltipContent,{side:"top",className:"text-[11px]",children:[a.advanced," de ",a.base," avançaram"]})]})}function aO({stages:a,transitions:d,selectedStageId:e,bottleneckToStageId:f,onSelectStage:g}){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"hidden items-stretch gap-2 md:flex md:flex-wrap xl:flex-nowrap",children:a.map((a,h)=>(0,b.jsxs)(c.Fragment,{children:[(0,b.jsx)(aL,{stage:a,selected:e===a.id,onSelectStage:g,compact:!1}),h<d.length&&(0,b.jsx)(aN,{transition:d[h],isBottleneck:f===d[h].to.id,orientation:"horizontal",delay:.03*h})]},a.id))}),(0,b.jsx)("div",{className:"space-y-2 md:hidden",children:a.map((a,h)=>(0,b.jsxs)(c.Fragment,{children:[(0,b.jsx)(aL,{stage:a,selected:e===a.id,onSelectStage:g,compact:!0}),h<d.length&&(0,b.jsx)(aN,{transition:d[h],isBottleneck:f===d[h].to.id,orientation:"vertical",delay:.03*h})]},`mobile-${a.id}`))})]})}function aP({tag:a,headline:c,description:e,meta:g,primaryAction:h,secondaryAction:i,onRetry:j,status:k="default",tone:l="neutral",icon:m,feedback:n}){let o="default"===k;return(0,b.jsx)(d.motion.article,{onClick:function(){!o||h.disabled||h.loading||h.onAction()},onKeyDown:function(a){!o||h.disabled||h.loading||("Enter"===a.key||" "===a.key)&&(a.preventDefault(),h.onAction())},role:o?"button":void 0,tabIndex:o?0:-1,"aria-disabled":!o,whileTap:o?{scale:.99}:void 0,transition:{duration:.1,ease:"easeOut"},className:(0,at.cn)("flex min-h-[186px] flex-col rounded-[20px] border p-4","shadow-[0_10px_20px_-18px_rgba(15,23,42,0.5)]","transition-[background-color,border-color,box-shadow,opacity,color] duration-140 ease-out","danger"===l?"border-red-200/80 bg-red-50/55 hover:border-red-300/90":"success"===l?"border-emerald-200/80 bg-emerald-50/55 hover:border-emerald-300/90":"border-zinc-200/80 bg-white/85 hover:border-zinc-300/90",o&&"cursor-pointer hover:shadow-[0_14px_24px_-18px_rgba(15,23,42,0.55)]","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand/25"),children:"loading"===k?(0,b.jsxs)("div",{className:"flex h-full flex-col gap-3",children:[(0,b.jsx)(f.Skeleton,{className:"h-5 w-28 rounded-md"}),(0,b.jsx)(f.Skeleton,{className:"h-8 w-4/5 rounded-md"}),(0,b.jsx)(f.Skeleton,{className:"h-4 w-3/4 rounded-md"}),(0,b.jsx)("div",{className:"mt-auto",children:(0,b.jsx)(f.Skeleton,{className:"h-4 w-20 rounded-md"})})]}):"error"===k?(0,b.jsxs)("div",{className:"flex h-full flex-col",children:[(0,b.jsx)("p",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-zinc-500",children:a}),(0,b.jsx)("p",{className:"mt-3 text-sm font-semibold text-zinc-900",children:"Erro ao carregar este insight."}),(0,b.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"Os dados não puderam ser processados agora."}),(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),j()},className:"mt-auto w-fit text-xs font-semibold text-brand underline underline-offset-4",children:"Tentar novamente"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,b.jsx)("p",{className:"text-[11px] font-semibold uppercase tracking-[0.08em] text-zinc-500",children:a}),m?(0,b.jsx)("span",{className:"text-zinc-500",children:m}):null]}),(0,b.jsx)("p",{className:"mt-2 truncate text-[1.18rem] font-bold leading-tight text-zinc-900",children:c}),(0,b.jsxs)("div",{className:"mt-2",children:[(0,b.jsx)("p",{className:"truncate text-[13px] text-zinc-600",children:e}),g?(0,b.jsx)("p",{className:"mt-0.5 text-[11px] text-zinc-500",children:g}):null]}),(0,b.jsxs)("div",{className:"mt-auto pt-3",children:[n?(0,b.jsx)("div",{className:"mb-2 text-[11px]",children:n}):null,h.asButton?(0,b.jsx)("button",{type:"button",disabled:!!(h.disabled||h.loading),onClick:a=>{a.stopPropagation(),h.disabled||h.loading||h.onAction()},className:"h-9 w-full rounded-full bg-zinc-900 text-xs font-semibold text-white transition-colors hover:bg-zinc-800 disabled:cursor-not-allowed disabled:opacity-65",children:h.label}):(0,b.jsxs)("button",{type:"button",onClick:a=>{a.stopPropagation(),h.onAction()},className:"inline-flex items-center gap-1 text-xs font-semibold text-brand underline-offset-4 transition-colors hover:text-brand-strong hover:underline",children:[h.label,(0,b.jsx)(aB.ArrowRight,{className:"h-3 w-3"})]}),i?(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),i.onAction()},disabled:!!i.loading,className:"mt-2 w-full text-center text-xs font-semibold text-zinc-600 underline-offset-4 transition-colors hover:text-zinc-800 hover:underline disabled:cursor-not-allowed disabled:opacity-65",children:i.label}):null]})]})})}function aQ({state:a="ready"}){let f=(0,e.useRouter)(),h=(0,e.usePathname)(),i=(0,e.useSearchParams)(),j=(0,v.useActivityStore)(a=>a.addActivity),[k,l]=(0,c.useState)(a),[m,o]=(0,c.useState)("idle"),[p,q]=(0,c.useState)(0),{filteredOpportunities:r,openOpportunities:s,now:t,userId:u}=z(),w=(0,c.useMemo)(()=>{let a;return a=r.filter(a=>"open"===a.status),aK.map(b=>{let c=aH[b],d=a.filter(a=>a.stage===c),e=d.length,f=d.reduce((a,b)=>a+(b.value||0),0),g=d.filter(a=>t.getTime()-new Date(a.updatedAt).getTime()>432e6),h=g.length,i=0;return g.length>0&&(i=Math.round(g.reduce((a,b)=>a+Math.round((t.getTime()-new Date(b.updatedAt).getTime())/864e5),0)/g.length)),{id:b,label:aJ[b],volume:e,value:f,stalledCount:h,stalledDays:i}})},[r,t]),x=(0,c.useMemo)(()=>w.slice(0,-1).map((a,b)=>{let c=w[b+1],d=a.volume>0?Math.round(c.volume/a.volume*100):0;return{from:a,to:c,conversion:d,advanced:c.volume,base:a.volume}}),[w]),y=w.length>=2&&w.some(a=>a.volume>0),A=(0,c.useMemo)(()=>{var a;return(a=i.get("stage")??i.get("stageId"))?aK.includes(a)?a:aI[a]??null:null},[i]),B=(0,c.useMemo)(()=>A?w.find(a=>a.id===A)??null:null,[A,w]),C=(0,c.useMemo)(()=>0===x.length?null:x.reduce((a,b)=>b.conversion<a.conversion?b:a),[x]),D=(0,c.useMemo)(()=>{let a=C?.to.id??w[0]?.id??null;return a?w.find(b=>b.id===a)??null:null},[C,w]),E=B??D,F=B?.id??"all",G=(0,c.useMemo)(()=>0===x.length?null:x.reduce((a,b)=>b.conversion>a.conversion?b:a),[x]),H=G?.conversion??0,I=G?.from.label??"—",J=G?`${G.advanced} de ${G.base} oportunidades avan\xe7aram no per\xedodo.`:"Sem base comparável no período.",K=(0,c.useMemo)(()=>{let a=t.getTime()-432e6,b=B?aH[B.id]:null,c=s.filter(a=>!b||a.stage===b).filter(b=>new Date(b.updatedAt).getTime()<a).sort((a,b)=>new Date(a.updatedAt).getTime()-new Date(b.updatedAt).getTime()),d=c[0]??null,e=c.length;if(!d){let a=B?.id??D?.id??null;return{topDealLabel:"Sem oportunidades em risco hoje",description:B?`Etapa ${B.label} sem alertas cr\xedticos.`:"Sua carteira está sem riscos críticos no momento.",meta:"Total em risco: 0",total:e,stageId:a}}let f=aI[d.stage]??B?.id??null,g=f?aJ[f]:"Etapa atual",h=Math.max(1,Math.round((t.getTime()-new Date(d.updatedAt).getTime())/864e5));return{topDealLabel:d.title||d.clientName,description:`${h} dias sem retorno \xb7 ${g}`,meta:`Total em risco: ${e}`,total:e,stageId:f}},[s,t,B,D]),L=C?Math.max(0,100-C.conversion):0;function M(a){if((B?.id??null)===a)return;let b=new URLSearchParams(i.toString());a?b.set("stage",aH[a]):(b.delete("stage"),b.delete("stageId"));let c=b.toString();f.replace(c?`${h}?${c}`:h,{scroll:!1})}function N({stageId:a,filters:b}={}){let c=new URLSearchParams;a&&c.set("stageId",aH[a]),b&&c.set("filters",b);let d=c.toString();f.push(d?`/pipes?${d}`:"/pipes")}function O(){if("loading"===m)return;if(!E)return void o("error");o("loading");let a=aH[E.id],b=s.filter(b=>b.stage===a&&t.getTime()-new Date(b.updatedAt).getTime()>432e6).slice(0,3),c=new Date(t);c.setDate(c.getDate()+1);let d=c.toISOString().split("T")[0],e=0;for(let a of b)j({title:`Follow-up: ${a.title||a.clientName}`,description:`Cobrar feedback — oportunidade parada h\xe1 +${Math.round((t.getTime()-new Date(a.updatedAt).getTime())/864e5)} dias`,type:"call",status:"pending",dueDate:d,dueTime:"10:00",opportunityId:a.id,clientId:a.clientId||"",responsibleId:u||a.responsibleId,responsibleName:a.responsibleName}),e+=1;if(0===e){q(0),o("error");return}q(e),o("success")}function P(){l("loading"),window.setTimeout(()=>{l("ready")},260)}return(0,c.useEffect)(()=>{l(a)},[a]),(0,c.useEffect)(()=>{o("idle"),q(0)},[B?.id]),(0,c.useEffect)(()=>{if("success"!==m&&"error"!==m)return;let a=setTimeout(()=>o("idle"),6e3);return()=>clearTimeout(a)},[m]),(0,b.jsxs)(aF,{noPadding:!0,elevated:!0,className:"premium-panel min-h-0 overflow-hidden border-zinc-200/80 bg-white/86 shadow-[0_20px_32px_-28px_rgba(15,23,42,0.45)]",children:[(0,b.jsx)("div",{className:"border-b border-zinc-200/75 bg-white/85 px-3.5 py-3 backdrop-blur-sm",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("h3",{className:"font-heading text-[1.02rem] font-semibold text-zinc-900",children:"Raio X do Funil"}),(0,b.jsx)("p",{className:"truncate text-xs text-zinc-500",children:"Fluxo de conversão, gargalos e ação recomendada para hoje"})]}),(0,b.jsxs)(d.motion.button,{type:"button",onClick:()=>N({stageId:B?.id}),whileTap:{scale:.99},transition:{duration:.09,ease:"easeOut"},className:"group inline-flex shrink-0 items-center gap-1.5 rounded-full px-2 py-1 text-xs font-semibold text-zinc-700 transition-[background-color,color,border-color,opacity] duration-120 ease-out hover:bg-zinc-100 hover:text-zinc-900",children:[(0,b.jsx)("span",{className:"underline-offset-4 transition-colors duration-120 group-hover:underline",children:"Ver Pipeline"}),(0,b.jsx)(aB.ArrowRight,{className:"h-3.5 w-3.5"})]})]})}),"ready"!==k||y?null:(0,b.jsx)("div",{className:"p-5",children:(0,b.jsxs)("div",{className:"rounded-xl border border-dashed border-zinc-300 bg-zinc-50/70 p-4",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-zinc-900",children:"Sem dados suficientes para o Raio X"}),(0,b.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"Cadastre oportunidades para gerar conversão e gargalos acionáveis."}),(0,b.jsx)(n.Button,{size:"sm",className:"mt-3 h-8 rounded-full bg-zinc-900 text-xs text-white hover:bg-zinc-800",onClick:()=>N(),children:"Ver pipeline"})]})}),"loading"===k||"error"===k?(0,b.jsx)("div",{className:"p-5",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:[(0,b.jsx)(aP,{tag:"Oportunidades em risco",headline:"",description:"",primaryAction:{label:"Ver etapa",onAction:()=>{}},onRetry:P,status:"loading"===k?"loading":"error"}),(0,b.jsx)(aP,{tag:"Top gargalo",headline:"",description:"",primaryAction:{label:"Ver lista",onAction:()=>{}},onRetry:P,status:"loading"===k?"loading":"error"}),(0,b.jsx)(aP,{tag:"Destaque",headline:"",description:"",primaryAction:{label:"Ver motivo",onAction:()=>{}},onRetry:P,status:"loading"===k?"loading":"error"}),(0,b.jsx)(aP,{tag:"Ação recomendada",headline:"",description:"",primaryAction:{label:"Cobrar feedbacks",onAction:()=>{},asButton:!0},onRetry:P,status:"loading"===k?"loading":"error"})]})}):null,"ready"===k&&y?(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.18,ease:"easeOut"},className:"flex flex-col gap-5 p-5",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(aG.TooltipProvider,{delayDuration:80,children:(0,b.jsx)(aO,{stages:w,transitions:x,selectedStageId:B?.id??null,bottleneckToStageId:C?.to.id??null,onSelectStage:M})}),B?(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 rounded-xl border border-zinc-200/80 bg-zinc-50/70 px-3 py-2",children:[(0,b.jsxs)("p",{className:"text-xs text-zinc-600",children:["Exibindo insights da etapa:"," ",(0,b.jsx)("span",{className:"font-semibold text-zinc-900",children:B.label})]}),(0,b.jsx)("button",{type:"button",onClick:()=>M(null),className:"text-xs font-semibold text-brand underline underline-offset-4",children:"Limpar seleção"})]}):null,(0,b.jsx)(aA.AnimatePresence,{mode:"wait",children:(0,b.jsxs)(d.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.14},className:"grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-4",children:[(0,b.jsx)(aP,{tag:"Oportunidades em risco",headline:K.topDealLabel,description:K.description,meta:K.meta,primaryAction:{label:K.total>0?"Ver etapa":"Ver pipeline",onAction:()=>K.total>0?N({stageId:K.stageId??void 0,filters:"risk"}):N({stageId:B?.id})},onRetry:P,icon:(0,b.jsx)(g.AlertTriangle,{className:"h-4 w-4 text-amber-600"})}),(0,b.jsx)(aP,{tag:"Top gargalo",headline:C?`Queda de ${L}% em ${C.to.label}`:"Sem gargalos relevantes no período",description:C?`${C.to.stalledCount} oportunidades paradas h\xe1 +${C.to.stalledDays} dias`:"Nenhuma etapa com queda crítica no período atual.",primaryAction:{label:C?"Ver lista":"Ver pipeline",onAction:()=>C?N({stageId:C.to.id,filters:"stalled"}):N()},onRetry:P,tone:C?"danger":"neutral",icon:(0,b.jsx)(aE,{className:"h-4 w-4 text-red-600"})}),(0,b.jsx)(aP,{tag:"Destaque",headline:G&&G.base>0?`Melhor convers\xe3o: ${H}% em ${I}`:"Sem base comparável no período",description:J,primaryAction:{label:G&&G.base>0?"Ver motivo":"Ver pipeline",onAction:()=>G&&G.base>0?void(G?.from.id&&M(G.from.id)):N()},onRetry:P,tone:G&&G.base>0?"success":"neutral",icon:(0,b.jsx)(aC.ArrowUpRight,{className:"h-4 w-4 text-emerald-600"})}),(0,b.jsx)(aP,{tag:"Ação recomendada",headline:E?"Cobrar feedbacks":"Nenhuma ação recomendada agora",description:E?`Aten\xe7\xe3o: ${K.total} oportunidades paradas. Priorizar follow-up hoje.`:"Sem oportunidades paradas críticas neste momento.",primaryAction:{label:"loading"===m?"Criando ações...":E?"Cobrar feedbacks":"Ver pipeline",onAction:()=>E?O():N(),asButton:!0,disabled:"loading"===m,loading:"loading"===m},feedback:(0,b.jsxs)(b.Fragment,{children:["success"===m?(0,b.jsxs)("p",{className:"rounded-md border border-emerald-200 bg-emerald-50 px-2 py-1 text-emerald-700",children:["Ações criadas (",p,")."," ",(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),f.push("/activities?statuses=pending,overdue&q=Follow-up")},className:"font-semibold underline underline-offset-4",children:"Ver atividades"})]}):null,"error"===m?(0,b.jsxs)("p",{className:"rounded-md border border-red-200 bg-red-50 px-2 py-1 text-red-700",children:["Não foi possível criar ações agora."," ",(0,b.jsx)("button",{type:"button",onClick:a=>{a.stopPropagation(),O()},className:"font-semibold underline underline-offset-4",children:"Tentar novamente"})]}):null]}),onRetry:P,icon:(0,b.jsx)(aD.Sparkles,{className:"h-4 w-4 text-brand"})})]},F)})]})}):null]})}var aR=a.i(92e3),aS=a.i(49363),aT=a.i(67453),aU=a.i(5151),aV=a.i(52495),aW=a.i(97063),aX=a.i(92258),aY=a.i(45222),aZ=a.i(17755),a$=a.i(63519),a_=a.i(69520),a0=a.i(50429),a1=a.i(66718),a2=a.i(99209),a3=a.i(86192),a4=a.i(73331),a5=a.i(58438);let a6={"lead-in":"Leads","contato-feito":"Contato","reuniao-agendada":"Reunião","proposta-enviada":"Proposta",negociacao:"Negociação",fechamento:"Fechamento"},a7=[{id:"all",label:"Todos"},{id:"critical",label:"Críticos"},{id:"churn",label:"Risco de churn"},{id:"pipeline",label:"Pipeline parado"},{id:"activities",label:"Atividades"},{id:"goals",label:"Metas"}],a8=[{label:"1h",hours:1},{label:"Amanhã",hours:24},{label:"1 semana",hours:168}],a9={critical:0,high:1,medium:2},ba={in_progress:0,open:1,resolved:2,snoozed:3};function bb(a){let b=a.getFullYear(),c=`${a.getMonth()+1}`.padStart(2,"0"),d=`${a.getDate()}`.padStart(2,"0");return`${b}-${c}-${d}`}function bc(a){return a?a6[a]??"Sem etapa":"Sem etapa"}function bd(a){return"critical"===a?"critical":"high"}function be(a){if(!Number.isFinite(a)||a<=0)return"0min";let b=Math.max(1,Math.round(a/6e4));if(b<60)return`${b}min`;let c=Math.round(b/60);if(c<24)return`${c}h`;let d=Math.round(c/24);return`${d}d`}function bf(a){return"call"===a?"Ligar":"whatsapp"===a?"WhatsApp":"email"===a?"Email":"meeting"===a?"Entrar":"Executar"}function bg(a){return"call"===a?a$.Phone:"email"===a?aX.Mail:"whatsapp"===a?aY.MessageCircle:aS.CalendarClock}function bh(a){return"open"===a||"in_progress"===a}function bi(){let a=(0,e.useRouter)(),{riskAlerts:d}=(0,a5.useExecutionPanelData)(),{filteredActivities:h,openOpportunities:i,now:j,userId:l}=z(),m=(0,t.useAuthStore)(a=>a.user?.name??"Sales Executive"),p=(0,a4.useClientStore)(a=>a.clients),q=(0,v.useActivityStore)(a=>a.activities),r=(0,v.useActivityStore)(a=>a.isLoading),s=(0,u.useOpportunityStore)(a=>a.isLoading),w=(0,v.useActivityStore)(a=>a.addActivity),y=(0,u.useOpportunityStore)(a=>a.updateOpportunity),[A,B]=(0,c.useState)("all"),[C,D]=(0,c.useState)({}),[E,F]=(0,c.useState)(new Set),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)({}),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)(!1),O=(0,c.useMemo)(()=>{let a=new Map(i.map(a=>[a.id,a])),b=new Map(p.map(a=>[a.id,a])),c=new Map,e=a=>{let b=`${a.kind}:${a.entityId??"global"}:${a.reasonCode}`,d=c.get(b);d?c.set(b,{...d,impactScore:Math.max(d.impactScore,a.impactScore),severity:a9[a.severity]<a9[d.severity]?a.severity:d.severity,duplicateCount:d.duplicateCount+1}):c.set(b,{...a,duplicateCount:1})};for(let c of d){if("health-drop"===c.type){let a=c.linkedEntityId?b.get(c.linkedEntityId):null;e({id:c.id,title:"Saúde crítica",context:a?.companyName??c.title,impact:c.description,recommendation:"Reengajar cliente com follow-up imediato.",consequence:"Vai criar atividade de WhatsApp para hoje.",severity:bd(c.severity),kind:"health_critical",group:"churn",reasonCode:"health_drop",viewPath:c.linkedEntityId?`/clients/${c.linkedEntityId}`:"/clients?health=critical",entityId:c.linkedEntityId,impactScore:a?.monthlyRevenue??0});continue}if("stale"===c.type){let b=c.linkedEntityId?a.get(c.linkedEntityId):null,d=b?Math.max(1,Math.round((j.getTime()-new Date(b.updatedAt).getTime())/864e5)):null;e({id:c.id,title:d?`Parado h\xe1 ${d}d`:"Pipeline parado",context:b?`${b.clientName} - ${bc(b.stage)}`:c.title,impact:c.description,recommendation:"Cobrar resposta e registrar próxima ação.",consequence:"Vai criar follow-up para hoje e abrir a oportunidade filtrada.",severity:bd(c.severity),kind:"stalled_deal",group:"pipeline",reasonCode:"stalled_deal",viewPath:c.linkedEntityId?`/pipes?opportunityId=${c.linkedEntityId}&tab=activities`:"/pipes?filter=stale",entityId:c.linkedEntityId,impactScore:b?.value??0});continue}if("sla-breach"===c.type){let b=c.linkedEntityId?a.get(c.linkedEntityId):null;e({id:c.id,title:"SLA estourado",context:b?`${b.clientName} - ${bc(b.stage)}`:c.title,impact:c.description,recommendation:"Tratar SLA imediatamente e formalizar próxima ação.",consequence:"Vai criar atividade crítica de follow-up para hoje.",severity:"critical",kind:"sla_risk",group:"pipeline",reasonCode:"sla_breach",viewPath:c.linkedEntityId?`/pipes?opportunityId=${c.linkedEntityId}&filter=sla_overdue`:"/pipes?filter=sla_overdue",entityId:c.linkedEntityId,impactScore:(b?.value??0)+2e5});continue}if("goal-risk"===c.type){e({id:c.id,title:"Meta em risco",context:c.title,impact:c.description,recommendation:"Ajustar plano de recuperação da meta agora.",consequence:"Vai criar tarefa de recuperação e abrir metas em risco.",severity:"critical",kind:"goal_risk",group:"goals",reasonCode:"goal_risk",viewPath:"/goals",entityId:c.linkedEntityId,impactScore:12e4});continue}if("contract-expiring"===c.type){let a=c.linkedEntityId?b.get(c.linkedEntityId):null;e({id:c.id,title:"Contrato expirando",context:a?.companyName??c.title,impact:c.description,recommendation:"Iniciar renovação com proposta de valor objetiva.",consequence:"Vai criar atividade de renovação para hoje.",severity:bd(c.severity),kind:"contract_risk",group:"churn",reasonCode:"contract_expiring",viewPath:c.linkedEntityId?`/clients/${c.linkedEntityId}`:"/clients",entityId:c.linkedEntityId,impactScore:a?.monthlyRevenue??0})}}let f=h.filter(a=>"overdue"===a.effectiveStatus);if(f.length>0){let a=f.reduce((a,b)=>{let c=(0,x.getActivityDueAt)(b);return Math.max(a,j.getTime()-c.getTime())},0),b=f.length>=8?"critical":f.length>=3?"high":"medium";e({id:"overdue-activities",title:"Atividades atrasadas",context:`${f.length} item(ns) aguardando execu\xe7\xe3o`,impact:`Maior atraso acumulado: ${be(a)}.`,recommendation:"Priorizar backlog atrasado para proteger o SLA.",consequence:"Vai abrir a lista de atrasadas e criar tarefa de mutirão.",severity:b,kind:"overdue_activities",group:"activities",reasonCode:"overdue_activities",viewPath:"/activities?status=overdue",impactScore:1e4*f.length})}return Array.from(c.values()).sort((a,b)=>{let c=a9[a.severity]-a9[b.severity];return 0!==c?c:b.impactScore-a.impactScore})},[d,h,i,p,j]),P=(0,c.useMemo)(()=>O.filter(a=>!E.has(a.id)).filter(a=>(C[a.id]?.status??"open")!=="snoozed").filter(a=>"all"===A||("critical"===A?"critical"===a.severity:a.group===A)).sort((a,b)=>{let c=C[a.id]?.status??"open",d=C[b.id]?.status??"open",e=ba[c]-ba[d];return 0!==e?e:a9[a.severity]-a9[b.severity]}),[O,E,C,A]),Q=P.filter(a=>bh(C[a.id]?.status??"open")),R=(0,c.useMemo)(()=>{let a={all:0,critical:0,churn:0,pipeline:0,activities:0,goals:0};for(let b of O)!E.has(b.id)&&bh(C[b.id]?.status??"open")&&(a.all+=1,"critical"===b.severity&&(a.critical+=1),a[b.group]+=1);return a},[O,E,C]),S=r||s,T=(a,b)=>{D(c=>({...c,[a]:b}))},U=a=>{window.setTimeout(()=>{F(b=>{let c=new Set(b);return c.add(a),c})},1800)};(0,c.useEffect)(()=>{let a=Object.entries(C).filter(([,a])=>a.feedback?.tone==="info"&&"resolved"!==a.status).map(([a])=>a);if(0===a.length)return;let b=setTimeout(()=>{D(b=>{let c={...b};for(let b of a){let a=c[b];if(a?.feedback?.tone==="info"){let{feedback:d,...e}=a;c[b]=e}}return c})},5e3);return()=>clearTimeout(b)},[C]);let V=a=>{let b=q.find(b=>{if("completed"===b.status||"cancelled"===b.status)return!1;let c=b.title.toLowerCase(),d=a.opportunityId&&b.opportunityId===a.opportunityId,e=a.clientId&&b.clientId===a.clientId;return(!!d||!!e)&&c.includes(a.searchTerm)});return b?b.id:w({title:a.title,description:a.description,type:a.type,status:"pending",dueDate:bb(j),dueTime:a.dueTime,opportunityId:a.opportunityId,clientId:a.clientId,responsibleId:l,responsibleName:m}).id},W=async a=>{if("health_critical"===a.kind){let b=V({title:`Follow-up de sa\xfade: ${a.context}`,description:`Gerado a partir de alerta: ${a.title}`,type:"whatsapp",dueTime:"16:00",clientId:a.entityId,searchTerm:"saúde"});return{message:"Resolvido, atividade criada para hoje.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${b}`}}if("contract_risk"===a.kind){let b=V({title:`Renovacao de contrato: ${a.context}`,description:`Gerado a partir de alerta: ${a.title}`,type:"meeting",dueTime:"15:00",clientId:a.entityId,searchTerm:"renovação"});return{message:"Resolvido, atividade de renovação criada.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${b}`}}if("stalled_deal"===a.kind){let b=a.entityId?i.find(b=>b.id===a.entityId):null,c=V({title:`Follow-up urgente: ${b?.clientName??a.context}`,description:`Gerado a partir de alerta: ${a.title}`,type:"follow-up",dueTime:"11:00",opportunityId:b?.id,clientId:b?.clientId,searchTerm:"follow-up"});return b?.id&&y(b.id,{updatedAt:new Date().toISOString()}),{message:"Resolvido, follow-up registrado e deal atualizado.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${c}`}}if("sla_risk"===a.kind){let b=a.entityId?i.find(b=>b.id===a.entityId):null,c=V({title:`SLA cr\xedtico: ${b?.clientName??a.context}`,description:`Gerado a partir de alerta: ${a.title}`,type:"call",dueTime:"10:00",opportunityId:b?.id,clientId:b?.clientId,searchTerm:"sla"});return b?.id&&y(b.id,{updatedAt:new Date().toISOString()}),{message:"Resolvido, plano de SLA registrado para hoje.",linkLabel:"Ver atividade",linkPath:`/activities?activityId=${c}`}}if("goal_risk"===a.kind){let b=V({title:"Plano de recuperação da meta",description:`Gerado a partir de alerta: ${a.context}`,type:"task",dueTime:"09:00",searchTerm:"recuperação da meta"});return{message:"Resolvido, plano de recuperação criado.",linkLabel:"Ver plano",linkPath:`/activities?activityId=${b}`}}if("overdue_activities"===a.kind){let a=V({title:"Mutirão de atividades atrasadas",description:"Priorizar backlog atrasado e concluir itens críticos.",type:"task",dueTime:"09:30",searchTerm:"mutirão"});return{message:"Resolvido, mutirão criado para limpar atrasos.",linkLabel:"Ver mutirão",linkPath:`/activities?activityId=${a}`}}return{message:"Alerta tratado com sucesso.",linkLabel:"Ver detalhes",linkPath:a.viewPath}},X=async a=>{T(a.id,{status:"in_progress"});try{await new Promise(a=>{window.setTimeout(a,180)});let b=await W(a);T(a.id,{status:"resolved",feedback:{tone:"success",message:b.message,linkLabel:b.linkLabel,linkPath:b.linkPath}}),U(a.id)}catch{T(a.id,{status:"open",feedback:{tone:"error",message:"Não consegui resolver agora."}})}},Y=async a=>{try{await navigator.clipboard.writeText(`${a.title} | ${a.context} | ${a.impact} | A\xe7\xe3o: ${a.recommendation}`),T(a.id,{status:C[a.id]?.status??"open",feedback:{tone:"info",message:"Resumo copiado."}})}catch{T(a.id,{status:C[a.id]?.status??"open",feedback:{tone:"error",message:"Não consegui copiar o resumo."}})}},Z=async()=>{for(let a of(N(!1),Q))await X(a)};return(0,b.jsxs)(aF,{className:"premium-panel flex flex-col gap-4 border-zinc-200/80 bg-white/88 p-5 shadow-[0_18px_32px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-zinc-900",children:"Alertas Críticos"}),(0,b.jsx)("span",{className:"inline-flex h-6 min-w-6 items-center justify-center rounded-full border border-red-200 bg-red-50 px-2 text-xs font-semibold text-red-700",children:R.all}),K.length>0?(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border border-sky-200 bg-sky-50 px-2 py-1 text-[11px] font-medium text-sky-700",children:["Adiados ",K.length,(0,b.jsx)("button",{type:"button",className:"underline underline-offset-4",onClick:()=>{L(a=>{if(0===a.length)return a;let b=[...a],c=b.pop();return c&&T(c.id,{status:"open",feedback:{tone:"info",message:"Adiamento desfeito."}}),b})},children:"Desfazer"})]}):null]}),Q.length>1?(0,b.jsx)(n.Button,{size:"xs",variant:"outline",className:"h-7 rounded-full border-zinc-200 px-3 text-xs",onClick:()=>{Q.length<2||N(!0)},children:"Resolver todos do tipo"}):null,(0,b.jsx)(a3.AlertDialog,{open:M,onOpenChange:N,children:(0,b.jsxs)(a3.AlertDialogContent,{children:[(0,b.jsxs)(a3.AlertDialogHeader,{children:[(0,b.jsxs)(a3.AlertDialogTitle,{children:["Resolver ",Q.length," alerta(s)?"]}),(0,b.jsx)(a3.AlertDialogDescription,{children:"Isso vai criar atividades de follow-up para cada alerta acionável visível."})]}),(0,b.jsxs)(a3.AlertDialogFooter,{children:[(0,b.jsx)(a3.AlertDialogCancel,{children:"Cancelar"}),(0,b.jsx)(a3.AlertDialogAction,{onClick:Z,children:"Resolver todos"})]})]})})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1.5",children:a7.map(a=>{let c=A===a.id,d=R[a.id];return(0,b.jsxs)("button",{type:"button",onClick:()=>B(a.id),className:(0,at.cn)("inline-flex h-7 items-center gap-1 rounded-full border px-2.5 text-[11px] font-medium transition-[border-color,background-color,color] duration-150",c?"border-zinc-900 bg-zinc-900 text-white":"border-zinc-200 bg-white text-zinc-600 hover:border-zinc-300 hover:text-zinc-900"),children:[a.label,(0,b.jsx)("span",{className:(0,at.cn)("text-[10px]",c?"text-white/80":"text-zinc-400"),children:d})]},a.id)})}),S?(0,b.jsx)("div",{className:"space-y-2",children:Array.from({length:3}).map((a,c)=>(0,b.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 p-3",children:[(0,b.jsx)(f.Skeleton,{className:"h-4 w-44"}),(0,b.jsx)(f.Skeleton,{className:"mt-2 h-3 w-full"}),(0,b.jsx)(f.Skeleton,{className:"mt-2 h-3 w-[82%]"})]},c))}):null,S||0!==P.length?null:(0,b.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 bg-zinc-50/40 p-6 text-center",children:[(0,b.jsx)(aT.CheckCircle2,{className:"mx-auto h-7 w-7 text-emerald-600"}),(0,b.jsx)("p",{className:"mt-2 text-sm font-medium text-zinc-900",children:"Sem alertas ativos no seu escopo."}),(0,b.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"Tudo estável por enquanto."})]}),S?null:(0,b.jsx)("div",{className:"space-y-2.5",children:P.map(c=>{var d,e;let f=C[c.id],h=f?.status??"open",i="in_progress"===h,l="resolved"===h;return(0,b.jsxs)("article",{className:(0,at.cn)("rounded-xl border bg-white p-3 transition-[border-color,box-shadow,background-color] duration-150","hover:border-zinc-300 hover:bg-zinc-50/40 hover:shadow-[0_14px_24px_-24px_rgba(15,23,42,0.45)]",l&&"border-emerald-200 bg-emerald-50/30",!l&&"critical"===c.severity&&"border-red-200/85",!l&&"high"===c.severity&&"border-amber-200/85",!l&&"medium"===c.severity&&"border-sky-200/85"),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)("span",{className:"mt-0.5 shrink-0",children:"sla_risk"===c.kind?(0,b.jsx)(k.ShieldAlert,{className:"h-4 w-4 text-red-600"}):"goal_risk"===c.kind?(0,b.jsx)(a0.Target,{className:"h-4 w-4 text-amber-600"}):"critical"===c.severity?(0,b.jsx)(aR.AlertCircle,{className:"h-4 w-4 text-red-600"}):"high"===c.severity?(0,b.jsx)(g.AlertTriangle,{className:"h-4 w-4 text-amber-600"}):(0,b.jsx)(aW.Info,{className:"h-4 w-4 text-sky-600"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-zinc-900",children:c.title}),(0,b.jsx)("span",{className:(0,at.cn)("inline-flex items-center rounded-full border px-2 py-0.5 text-[10px] font-semibold","critical"===(d=c.severity)?"border-red-200 bg-red-50 text-red-700":"high"===d?"border-amber-200 bg-amber-50 text-amber-700":"border-sky-200 bg-sky-50 text-sky-700"),children:"critical"===(e=c.severity)?"Crítico":"high"===e?"Alto":"Médio"}),c.duplicateCount>1?(0,b.jsxs)("span",{className:"inline-flex items-center rounded-full border border-zinc-200 bg-zinc-100 px-2 py-0.5 text-[10px] font-semibold text-zinc-600",children:["+",c.duplicateCount-1]}):null]}),(0,b.jsx)("p",{className:"mt-1 truncate text-sm text-zinc-700",children:c.context}),(0,b.jsxs)("p",{className:"mt-0.5 text-xs text-zinc-500",children:["Impacto: ",c.impact]})]})]}),(0,b.jsxs)("div",{className:"mt-2 rounded-lg border border-zinc-200/80 bg-zinc-50/70 p-2.5",children:[(0,b.jsxs)("p",{className:"text-xs font-semibold text-zinc-700",children:["Ação recomendada: ",c.recommendation]}),(0,b.jsx)("p",{className:"mt-0.5 text-xs text-zinc-500",children:c.consequence})]})]}),(0,b.jsxs)("div",{className:"flex shrink-0 flex-col items-end gap-1.5",children:[(0,b.jsx)(n.Button,{size:"xs",className:"h-7 rounded-md bg-zinc-900 px-3 text-xs font-semibold text-white hover:bg-zinc-800",disabled:i||l,onClick:()=>X(c),children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a_.RefreshCw,{className:"h-3.5 w-3.5 animate-spin"}),"Executando..."]}):"Resolver"}),(0,b.jsx)(n.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-3 text-xs",onClick:()=>a.push(c.viewPath),children:"Ver"}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsxs)(a2.Popover,{open:G===c.id,onOpenChange:a=>H(a?c.id:null),children:[(0,b.jsx)(a2.PopoverTrigger,{asChild:!0,children:(0,b.jsxs)(n.Button,{size:"xs",variant:"ghost",className:"h-7 px-2 text-xs text-zinc-600",children:[(0,b.jsx)(aq.Clock3,{className:"h-3.5 w-3.5"}),"Adiar"]})}),(0,b.jsxs)(a2.PopoverContent,{align:"end",className:"w-64 rounded-xl border-zinc-200 p-3",children:[(0,b.jsxs)(a2.PopoverHeader,{className:"gap-0.5",children:[(0,b.jsx)(a2.PopoverTitle,{children:"Adiar alerta"}),(0,b.jsx)(a2.PopoverDescription,{children:"Escolha o tempo e informe o motivo."})]}),(0,b.jsx)(a1.Input,{className:"mt-2 h-8",placeholder:"Motivo (opcional)",value:I[c.id]??"",onChange:a=>J(b=>({...b,[c.id]:a.target.value}))}),(0,b.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-1.5",children:a8.map(a=>(0,b.jsx)(n.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 text-[11px]",onClick:()=>{var b;let d,e;return b=a.hours,d=(I[c.id]??"").trim(),e=new Date(j.getTime()+60*b*6e4).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}),void(T(c.id,{status:"snoozed",feedback:{tone:"info",message:d?`Adiado ate ${e}. Motivo: ${d}.`:`Adiado ate ${e}.`}}),L(a=>[...a,{id:c.id,label:c.title}]),H(null))},children:a.label},a.label))})]})]}),(0,b.jsxs)(o.DropdownMenu,{children:[(0,b.jsx)(o.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(n.Button,{size:"icon-xs",variant:"ghost",className:"h-7 w-7 text-zinc-500",children:(0,b.jsx)(aZ.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(o.DropdownMenuContent,{align:"end",className:"w-52 rounded-xl",children:[(0,b.jsxs)(o.DropdownMenuItem,{onClick:()=>{T(c.id,{status:"resolved",feedback:{tone:"success",message:"Marcado como tratado.",linkLabel:"Ver entidade",linkPath:c.viewPath}}),U(c.id)},children:[(0,b.jsx)(aT.CheckCircle2,{className:"h-3.5 w-3.5"}),"Marcar como tratado"]}),(0,b.jsxs)(o.DropdownMenuItem,{onClick:()=>Y(c),children:[(0,b.jsx)(aU.Copy,{className:"h-3.5 w-3.5"}),"Copiar resumo"]}),(0,b.jsx)(o.DropdownMenuSeparator,{}),(0,b.jsxs)(o.DropdownMenuItem,{onClick:()=>a.push(c.viewPath),children:[(0,b.jsx)(aV.ExternalLink,{className:"h-3.5 w-3.5"}),"Abrir entidade"]})]})]})]})]})]}),f?.feedback?(0,b.jsxs)("div",{className:(0,at.cn)("mt-2 flex flex-wrap items-center gap-2 rounded-md border px-2.5 py-1.5 text-xs","success"===f.feedback.tone&&"border-emerald-200 bg-emerald-50/70 text-emerald-700","info"===f.feedback.tone&&"border-sky-200 bg-sky-50/70 text-sky-700","error"===f.feedback.tone&&"border-red-200 bg-red-50/70 text-red-700"),children:[(0,b.jsx)("span",{children:f.feedback.message}),f.feedback.linkPath&&f.feedback.linkLabel?(0,b.jsx)("button",{type:"button",className:"font-semibold underline underline-offset-4",onClick:()=>a.push(f.feedback?.linkPath??c.viewPath),children:f.feedback.linkLabel}):null,"error"===f.feedback.tone?(0,b.jsx)("button",{type:"button",className:"font-semibold underline underline-offset-4",onClick:()=>X(c),children:"Tentar novamente"}):null]}):null]},c.id)})})]})}function bj(){let a=(0,e.useRouter)(),{filteredActivities:d,now:g}=z(),h=(0,v.useActivityStore)(a=>a.completeActivity),i=(0,v.useActivityStore)(a=>a.postponeActivity),j=(0,v.useActivityStore)(a=>a.cancelActivity),k=(0,v.useActivityStore)(a=>a.isLoading),[l,m]=(0,c.useState)(new Set),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)({}),[t,u]=(0,c.useState)(null),[w,y]=(0,c.useState)({}),[A,B]=(0,c.useState)(null);(0,c.useEffect)(()=>{if(!t)return;let a=setTimeout(()=>u(null),6e3);return()=>clearTimeout(a)},[t]);let C=bb(g),D=(0,c.useMemo)(()=>d.filter(a=>"pending"===a.effectiveStatus||"overdue"===a.effectiveStatus).filter(a=>a.dueDate<=C).map(a=>{let b=(0,x.getActivityDueAt)(a),c="overdue"===a.effectiveStatus;return{id:a.id,title:a.title,clientLine:a.clientName||a.opportunityTitle||"Sem cliente associado",description:a.description||"Sem descrição registrada.",type:a.type,status:c?"overdue":"pending",dueDate:a.dueDate,dueTime:a.dueTime,dueAt:b,hasTime:!!a.dueTime,delayLabel:c?`Atrasada ${be(g.getTime()-b.getTime())}`:null}}).sort((a,b)=>a.dueAt.getTime()-b.dueAt.getTime()).slice(0,10),[d,g,C]),E=D.filter(a=>a.hasTime),F=D.filter(a=>!a.hasTime),G=D.filter(a=>"overdue"===a.status).length,H=D.filter(a=>a.dueDate===C).length,I=(a,b)=>{y(c=>({...c,[a]:b}))},J=a=>{let b,c=bb(((b=new Date(g)).setDate(b.getDate()+1),b));q(a.id),s(b=>({...b,[a.id]:{dueDate:a.dueDate||c,dueTime:a.dueTime||"09:00"}}))},K=a=>{I(a.id,{loading:!0});try{h(a.id,"Concluída pela Agenda de Hoje"),u({tone:"success",message:"Atividade concluída com sucesso.",linkLabel:"Ver historico",linkPath:"/activities?status=completed"}),m(b=>{let c=new Set(b);return c.delete(a.id),c}),I(a.id,{})}catch{I(a.id,{error:"Não consegui concluir agora."})}};return(0,b.jsxs)(aF,{className:"premium-panel flex min-h-[320px] flex-col gap-4 border-zinc-200/80 bg-white/88 p-5 shadow-[0_18px_32px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[(0,b.jsxs)("div",{className:"flex min-w-0 items-center gap-2",children:[(0,b.jsx)("h3",{className:"text-base font-semibold text-zinc-900",children:"Agenda de Hoje"}),(0,b.jsxs)("span",{className:"inline-flex h-6 items-center rounded-full border border-red-200 bg-red-50 px-2 text-[11px] font-semibold text-red-700",children:["Atrasadas ",G]}),(0,b.jsxs)("span",{className:"inline-flex h-6 items-center rounded-full border border-zinc-200 bg-zinc-100 px-2 text-[11px] font-semibold text-zinc-700",children:["Hoje ",H]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,b.jsxs)(n.Button,{size:"xs",variant:"outline",className:"h-7 rounded-full border-zinc-200 px-3 text-xs",onClick:()=>a.push("/activities?view=agenda"),children:["Ver tudo",(0,b.jsx)(ap.ChevronRight,{className:"h-3.5 w-3.5"})]}),(0,b.jsxs)(o.DropdownMenu,{children:[(0,b.jsx)(o.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(n.Button,{size:"icon-xs",variant:"ghost",className:"h-7 w-7 text-zinc-500",children:(0,b.jsx)(aZ.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,b.jsx)(o.DropdownMenuContent,{align:"end",className:"w-52 rounded-xl",children:(0,b.jsx)(o.DropdownMenuItem,{onClick:()=>a.push("/activities?status=overdue"),children:"Ver apenas atrasadas"})})]})]})]}),t?(0,b.jsxs)("div",{className:(0,at.cn)("flex flex-wrap items-center gap-2 rounded-lg border px-3 py-2 text-xs","success"===t.tone&&"border-emerald-200 bg-emerald-50/70 text-emerald-700","info"===t.tone&&"border-sky-200 bg-sky-50/70 text-sky-700","error"===t.tone&&"border-red-200 bg-red-50/70 text-red-700"),children:[(0,b.jsx)("span",{children:t.message}),t.linkPath&&t.linkLabel?(0,b.jsx)("button",{type:"button",className:"font-semibold underline underline-offset-4",onClick:()=>a.push(t.linkPath??"/activities"),children:t.linkLabel}):null]}):null,k?(0,b.jsx)("div",{className:"space-y-2",children:Array.from({length:4}).map((a,c)=>(0,b.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 p-3",children:[(0,b.jsx)(f.Skeleton,{className:"h-4 w-32"}),(0,b.jsx)(f.Skeleton,{className:"mt-2 h-3 w-[88%]"}),(0,b.jsx)(f.Skeleton,{className:"mt-2 h-8 w-40"})]},c))}):null,k||0!==D.length?null:(0,b.jsxs)("div",{className:"rounded-xl border border-zinc-200/80 bg-zinc-50/40 p-6 text-center",children:[(0,b.jsx)(aT.CheckCircle2,{className:"mx-auto h-7 w-7 text-emerald-600"}),(0,b.jsx)("p",{className:"mt-2 text-sm font-medium text-zinc-900",children:"Sem atividades pendentes para hoje."}),(0,b.jsx)("p",{className:"mt-1 text-xs text-zinc-500",children:"A agenda está limpa no seu escopo."}),(0,b.jsx)(n.Button,{size:"xs",variant:"outline",className:"mt-3 h-7 rounded-full border-zinc-200 px-3 text-xs",onClick:()=>a.push("/activities?view=agenda"),children:"Abrir agenda completa"})]}),!k&&D.length>0?(0,b.jsxs)("div",{className:"space-y-2",children:[E.map(c=>{let d=bg(c.type),e=w[c.id],f=r[c.id],g=p===c.id,h=l.has(c.id);return(0,b.jsx)("article",{className:(0,at.cn)("rounded-xl border border-zinc-200/85 bg-white p-3 transition-[border-color,box-shadow,background-color] duration-150","hover:border-zinc-300 hover:bg-zinc-50/40 hover:shadow-[0_12px_24px_-24px_rgba(15,23,42,0.45)]","overdue"===c.status&&"border-red-200/90"),children:(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-[96px_minmax(0,1fr)_auto] md:items-start",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-xl font-semibold tabular-nums text-zinc-900",children:c.dueTime||"--:--"}),c.delayLabel?(0,b.jsx)("p",{className:"text-xs font-medium text-red-600",children:c.delayLabel}):(0,b.jsx)("p",{className:"text-xs text-zinc-500",children:"No prazo"})]}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-start gap-2",children:[(0,b.jsx)(d,{className:"mt-0.5 h-4 w-4 text-zinc-500"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"truncate text-sm font-semibold text-zinc-900",children:c.title}),(0,b.jsx)("p",{className:"truncate text-xs text-zinc-600",children:c.clientLine}),(0,b.jsx)("p",{className:"mt-0.5 truncate text-xs text-zinc-500",children:c.description})]})]}),h?(0,b.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-1.5 rounded-md border border-zinc-200 bg-zinc-50/80 p-2",children:[(0,b.jsx)("span",{className:"text-xs text-zinc-600",children:"Execução iniciada:"}),(0,b.jsx)(n.Button,{size:"xs",className:"h-7 rounded-md bg-zinc-900 px-2.5 text-xs text-white hover:bg-zinc-800",onClick:()=>K(c),children:"Marcar concluída"}),(0,b.jsx)(n.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-2.5 text-xs",onClick:()=>a.push(`/activities?activityId=${c.id}`),children:"Registrar nota"})]}):null,g?(0,b.jsxs)("div",{className:"mt-2 grid gap-1.5 rounded-md border border-zinc-200 bg-zinc-50/80 p-2 md:grid-cols-[1fr_110px_auto] md:items-center",children:[(0,b.jsx)(a1.Input,{type:"date",className:"h-8",value:f?.dueDate??"",onChange:a=>s(b=>({...b,[c.id]:{dueDate:a.target.value,dueTime:b[c.id]?.dueTime??c.dueTime??"09:00"}}))}),(0,b.jsx)(a1.Input,{type:"time",className:"h-8",value:f?.dueTime??"",onChange:a=>s(b=>({...b,[c.id]:{dueDate:b[c.id]?.dueDate??c.dueDate,dueTime:a.target.value}}))}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(n.Button,{size:"xs",className:"h-8 rounded-md bg-zinc-900 px-2.5 text-xs text-white hover:bg-zinc-800",onClick:()=>(a=>{let b=r[a.id];if(!b?.dueDate)return void I(a.id,{error:"Escolha uma data válida."});I(a.id,{loading:!0});try{var c,d;let e;i(a.id,b.dueDate,b.dueTime||void 0),q(null),u({tone:"success",message:`Reagendado para ${(c=b.dueDate,d=b.dueTime,e=new Date(`${c}T${d||"09:00"}:00`),Number.isNaN(e.getTime())?d?`${c} ${d}`:c:e.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"}))}.`}),m(b=>{let c=new Set(b);return c.delete(a.id),c}),I(a.id,{})}catch{I(a.id,{error:"Não consegui reagendar agora."})}})(c),children:"Salvar"}),(0,b.jsx)(n.Button,{size:"xs",variant:"ghost",className:"h-8 rounded-md px-2.5 text-xs",onClick:()=>q(null),children:"Cancelar"})]})]}):null,e?.error?(0,b.jsxs)("div",{className:"mt-2 rounded-md border border-red-200 bg-red-50/70 px-2.5 py-1.5 text-xs text-red-700",children:[e.error,(0,b.jsx)("button",{type:"button",className:"ml-2 font-semibold underline underline-offset-4",onClick:()=>I(c.id,{}),children:"Tentar novamente"})]}):null]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-1.5 md:flex-col md:items-end",children:[(0,b.jsx)(n.Button,{size:"xs",className:"h-7 rounded-md bg-zinc-900 px-3 text-xs text-white hover:bg-zinc-800",disabled:e?.loading,onClick:()=>{var b,d;m(a=>{let b=new Set(a);return b.add(c.id),b}),u({tone:"info",message:`${bf(c.type)} iniciado. Ao voltar, conclua ou registre nota.`,linkLabel:"Abrir atividade",linkPath:`/activities?activityId=${c.id}`}),a.push((b=c.id,d=c.type,`/activities?activityId=${b}&execute=${d}`))},children:e?.loading?(0,b.jsx)(a_.RefreshCw,{className:"h-3.5 w-3.5 animate-spin"}):bf(c.type)}),(0,b.jsx)(n.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-3 text-xs",disabled:e?.loading,onClick:()=>J(c),children:"Reagendar"}),(0,b.jsxs)(o.DropdownMenu,{children:[(0,b.jsx)(o.DropdownMenuTrigger,{asChild:!0,children:(0,b.jsx)(n.Button,{size:"icon-xs",variant:"ghost",className:"h-7 w-7 text-zinc-500",children:(0,b.jsx)(aZ.MoreHorizontal,{className:"h-3.5 w-3.5"})})}),(0,b.jsxs)(o.DropdownMenuContent,{align:"end",className:"w-44 rounded-xl",children:[(0,b.jsxs)(o.DropdownMenuItem,{onClick:()=>K(c),children:[(0,b.jsx)(aT.CheckCircle2,{className:"h-3.5 w-3.5"}),"Concluir"]}),(0,b.jsxs)(o.DropdownMenuItem,{onClick:()=>a.push(`/activities?activityId=${c.id}`),children:[(0,b.jsx)(aV.ExternalLink,{className:"h-3.5 w-3.5"}),"Ver detalhes"]}),(0,b.jsx)(o.DropdownMenuSeparator,{}),(0,b.jsx)(o.DropdownMenuItem,{onClick:()=>{B(c.id)},children:"Cancelar"})]})]})]})]})},c.id)}),F.length>0?(0,b.jsxs)("div",{className:"rounded-xl border border-zinc-200/85 bg-zinc-50/30 p-3",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-xs font-semibold uppercase tracking-wide text-zinc-500",children:"Sem horário"}),(0,b.jsx)(n.Button,{size:"xs",variant:"ghost",className:"h-7 px-2 text-xs text-zinc-600",onClick:()=>{let a=F[0];a&&J(a)},children:"Definir horário"})]}),(0,b.jsx)("div",{className:"space-y-2",children:F.map(a=>{let c=bg(a.type);return(0,b.jsx)("div",{className:"rounded-lg border border-zinc-200/85 bg-white p-2.5",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,b.jsxs)("div",{className:"flex min-w-0 items-start gap-2",children:[(0,b.jsx)(c,{className:"mt-0.5 h-4 w-4 text-zinc-500"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"truncate text-sm font-medium text-zinc-900",children:a.title}),(0,b.jsx)("p",{className:"truncate text-xs text-zinc-600",children:a.clientLine})]})]}),(0,b.jsx)(n.Button,{size:"xs",variant:"outline",className:"h-7 rounded-md border-zinc-200 px-2.5 text-xs",onClick:()=>J(a),children:"Definir horário"})]})},a.id)})})]}):null]}):null,(0,b.jsx)(a3.AlertDialog,{open:null!==A,onOpenChange:a=>{a||B(null)},children:(0,b.jsxs)(a3.AlertDialogContent,{children:[(0,b.jsxs)(a3.AlertDialogHeader,{children:[(0,b.jsx)(a3.AlertDialogTitle,{children:"Cancelar atividade?"}),(0,b.jsx)(a3.AlertDialogDescription,{children:"A atividade será cancelada permanentemente."})]}),(0,b.jsxs)(a3.AlertDialogFooter,{children:[(0,b.jsx)(a3.AlertDialogCancel,{children:"Manter"}),(0,b.jsx)(a3.AlertDialogAction,{onClick:()=>{if(B(null),A){I(A,{loading:!0});try{j(A),u({tone:"info",message:"Atividade cancelada."}),I(A,{})}catch{I(A,{error:"Não consegui cancelar agora."})}}},children:"Cancelar atividade"})]})]})})]})}var bk=a.i(60246);let bl=(0,l.default)("thermometer-sun",[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 8a4 4 0 0 0-1.645 7.647",key:"wz5p04"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 14.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0z",key:"yu0u2z"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}]]);var bm=a.i(72233);a.i(42651);var bn=a.i(69506);function bo(){let a=(0,e.useRouter)(),{openOpportunities:f,filteredOpportunities:g,now:h}=z(),{healthMetrics:i,temperature:j,avgDays:k}=(0,c.useMemo)(()=>{let a=f.filter(a=>Math.round((h.getTime()-new Date(a.updatedAt).getTime())/864e5)>30).length,b=v.useActivityStore.getState().activities,c=f.filter(a=>0===b.filter(b=>b.opportunityId===a.id&&("pending"===b.status||"overdue"===b.status)).length).length,d=f.filter(a=>!a.value||0===a.value).length,e=Math.max(f.length,1),i=f.length>0?f.reduce((a,b)=>a+(b.value||0),0)/f.length:1e4,j=0,k=0;for(let a of f){let b=(0,x.calculateTemperature)(a,i,h);"hot"===b?j++:"cold"===b&&k++}let l=j>k?"Quente":k>j?"Frio":"Morno",m=g.filter(a=>"won"===a.status),n=0;return m.forEach(a=>{let b=new Date(a.createdAt).getTime(),c=new Date(a.updatedAt).getTime();n+=Math.max(1,Math.round((c-b)/864e5))}),{healthMetrics:[{label:"Estagnados (+30 dias)",value:a,color:"bg-red-500",filter:"stale",max:e},{label:"Sem próxima ação",value:c,color:"bg-amber-500",filter:"no_activity",max:e},{label:"Valor vazio",value:d,color:"bg-zinc-400",filter:"stale",max:e}],temperature:l,avgDays:m.length>0?Math.round(n/m.length):0}},[f,g,h]);return(0,b.jsxs)(aF,{className:"premium-panel flex flex-col gap-4 border-zinc-200/80 bg-white/86 p-5 shadow-[0_16px_28px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between",children:(0,b.jsxs)("h3",{className:"flex items-center gap-2 font-semibold text-zinc-900",children:[(0,b.jsx)(bl,{className:"h-4 w-4 text-orange-500"}),"Saúde do Pipeline"]})}),(0,b.jsx)("div",{className:"space-y-4",children:i.map(c=>(0,b.jsxs)("div",{className:"group cursor-pointer",onClick:()=>a.push(`/pipes?filter=${c.filter}`),role:"button",tabIndex:0,onKeyDown:b=>{"Enter"===b.key&&a.push(`/pipes?filter=${c.filter}`)},children:[(0,b.jsxs)("div",{className:"mb-1.5 flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-zinc-600 transition-colors group-hover:text-zinc-900",children:c.label}),(0,b.jsxs)("span",{className:"text-xs font-bold text-zinc-900",children:[c.value," deals"]})]}),(0,b.jsx)("div",{className:"h-2 w-full overflow-hidden rounded-full bg-zinc-100",children:(0,b.jsx)(d.motion.div,{initial:{width:0},animate:{width:`${Math.min(c.value/Math.max(c.max,1)*100,100)}%`},transition:{duration:.24,ease:"easeOut"},className:(0,at.cn)("h-full rounded-full transition-all group-hover:brightness-110",c.color)})})]},c.label))}),(0,b.jsx)("div",{className:"mt-auto border-t border-zinc-100 pt-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-6",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-zinc-400",children:"Temperatura"}),(0,b.jsx)("p",{className:(0,at.cn)("text-lg font-bold","Quente"===j?"text-emerald-600":"Frio"===j?"text-red-600":"text-amber-600"),children:j})]}),(0,b.jsx)("div",{className:"h-8 w-px bg-zinc-100"}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-[10px] font-semibold uppercase tracking-wider text-zinc-400",children:"Velocidade"}),(0,b.jsx)("p",{className:"text-lg font-bold text-zinc-900",children:k>0?`${k} dias`:"—"})]})]})})]})}function bp(){let a=(0,e.useRouter)(),{filteredOpportunities:d,context:f,userId:g,userRole:h}=z(),i="master"===h||"admin"===h,j=(0,c.useMemo)(()=>{let a=d.filter(a=>"won"===a.status||"lost"===a.status),b={};for(let c of a)if(c.responsibleId&&("me"!==f||i||c.responsibleId===g)){if(!b[c.responsibleId]){let a=bn.mockUsers.find(a=>a.id===c.responsibleId);b[c.responsibleId]={name:a?.name??c.responsibleName??"—",role:a?.role??"comercial",revenue:0,won:0,total:0}}b[c.responsibleId].total+=1,"won"===c.status&&(b[c.responsibleId].revenue+=c.value||0,b[c.responsibleId].won+=1)}return Object.entries(b).map(([a,b])=>{let c=(0,x.calculateProjectedCommission)(b.revenue);return{id:a,name:b.name,role:b.role,revenue:b.revenue,commission:c.commissionValue,conversion:b.total>0?Math.round(b.won/b.total*100):0,won:b.won,isMe:a===g}}).sort((a,b)=>b.revenue-a.revenue).slice(0,3)},[d,f,g,i]);return(0,b.jsxs)(aF,{className:"premium-panel flex flex-col gap-4 border-zinc-200/80 bg-white/86 p-5 shadow-[0_16px_28px_-24px_rgba(15,23,42,0.45)] md:p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h3",{className:"flex items-center gap-2 font-semibold text-zinc-900",children:[(0,b.jsx)(bk.Users,{className:"h-4 w-4 text-blue-500"}),i?"Performance do time":"Performance pessoal"]}),(0,b.jsx)("button",{className:"text-xs font-medium text-zinc-500 transition-colors hover:text-zinc-900",onClick:()=>a.push("/goals"),children:"Ver metas"})]}),0===j.length?(0,b.jsx)("div",{className:"py-6 text-center text-sm text-zinc-500",children:"Sem dados de performance ainda."}):(0,b.jsx)("div",{className:"space-y-3",children:j.map((c,d)=>(0,b.jsxs)("div",{className:"flex cursor-pointer items-center justify-between rounded-lg p-2 transition-colors hover:bg-zinc-50",onClick:()=>a.push("/goals"),role:"button",tabIndex:0,onKeyDown:b=>{"Enter"===b.key&&a.push("/goals")},children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:(0,at.cn)("flex h-5 w-5 items-center justify-center rounded text-[10px] font-bold",0===d?"bg-amber-100 text-amber-700":1===d?"bg-zinc-100 text-zinc-600":"bg-zinc-100 text-zinc-400"),children:d+1}),(0,b.jsx)(bm.Avatar,{className:"h-8 w-8 border border-zinc-100",children:(0,b.jsx)(bm.AvatarFallback,{className:"bg-zinc-100 text-[10px]",children:c.name.substring(0,2)})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-bold text-zinc-900",children:c.name}),(0,b.jsx)("p",{className:"text-[10px] text-zinc-500",children:c.role})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-xs font-bold text-zinc-900",children:c.isMe||i?(0,x.formatCurrencyBRL)(c.revenue):`${c.won} ganhos`}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-1.5",children:[(0,b.jsxs)("span",{className:"text-[10px] text-zinc-500",children:[c.conversion,"% conv."]}),(c.isMe||i)&&c.commission>0&&(0,b.jsxs)("span",{className:"text-[10px] font-medium text-emerald-600",children:["+",(0,x.formatCurrencyBRL)(c.commission)]})]})]})]},c.id))}),(0,b.jsxs)("button",{className:"mt-auto flex w-full items-center justify-center gap-1 rounded-lg border border-zinc-100 py-2 text-xs font-medium text-zinc-600 transition-colors hover:bg-zinc-50",onClick:()=>a.push("/finance"),children:["Ver relatório de comissão ",(0,b.jsx)(ap.ChevronRight,{className:"h-3 w-3"})]})]})}var bq=a.i(55007);function br(){return(0,b.jsxs)("div",{className:"space-y-6 p-6 md:p-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(f.Skeleton,{className:"h-8 w-56"}),(0,b.jsx)(f.Skeleton,{className:"h-9 w-36 rounded-full"})]}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4",children:Array.from({length:4}).map((a,c)=>(0,b.jsx)(f.Skeleton,{className:"h-24 rounded-xl"},c))}),(0,b.jsx)(f.Skeleton,{className:"h-64 rounded-xl"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12",children:[(0,b.jsxs)("div",{className:"lg:col-span-8 flex flex-col gap-6",children:[(0,b.jsx)(f.Skeleton,{className:"h-48 rounded-xl"}),(0,b.jsx)(f.Skeleton,{className:"h-48 rounded-xl"})]}),(0,b.jsx)("div",{className:"lg:col-span-4 flex flex-col gap-6",children:(0,b.jsx)(f.Skeleton,{className:"h-48 rounded-xl"})})]})]})}function bs(){(0,bq.useProactiveEngine)();let a=(0,e.useSearchParams)().get("view"),[f,g]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{let a=setTimeout(()=>g(!1),800);return()=>clearTimeout(a)},[]),(0,c.useEffect)(()=>{if("conversion"!==a)return;let b=document.getElementById("dashboard-funnel");b&&b.scrollIntoView({behavior:"smooth",block:"start"})},[a]),f)?(0,b.jsx)(br,{}):(0,b.jsxs)(d.motion.div,{variants:au.screenContainer,initial:"hidden",animate:"show",className:"w-full max-w-full space-y-6",children:[(0,b.jsx)(d.motion.div,{variants:au.sectionEnter,children:(0,b.jsx)(B,{})}),(0,b.jsx)(d.motion.section,{id:"dashboard-kpis",variants:au.sectionEnter,className:"scroll-mt-44",children:(0,b.jsx)(az,{})}),(0,b.jsx)(d.motion.section,{id:"dashboard-funnel",variants:au.sectionEnter,className:"scroll-mt-44",children:(0,b.jsx)(aQ,{})}),(0,b.jsxs)(d.motion.section,{id:"dashboard-execution",variants:au.sectionEnter,className:"grid grid-cols-1 gap-6 scroll-mt-44 lg:grid-cols-12",children:[(0,b.jsxs)("div",{className:"lg:col-span-8 flex flex-col gap-6",children:[(0,b.jsx)(bi,{}),(0,b.jsx)(bj,{})]}),(0,b.jsxs)("div",{className:"lg:col-span-4 flex flex-col gap-6",children:[(0,b.jsx)(bo,{}),(0,b.jsx)(bp,{})]})]})]})}function bt(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(br,{}),children:(0,b.jsx)(bs,{})})}a.s(["default",()=>bt],85626)}];

//# sourceMappingURL=src_app_%28auth%29_dashboard_page_tsx_bb463078._.js.map