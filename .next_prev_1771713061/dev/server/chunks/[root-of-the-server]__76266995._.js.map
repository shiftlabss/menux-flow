{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/lib/auth-types.ts"],"sourcesContent":["export const USER_ROLES = [\n  \"master\",\n  \"admin\",\n  \"comercial\",\n  \"cs\",\n  \"leitura\",\n] as const;\n\nexport type UserRole = (typeof USER_ROLES)[number];\n\nexport interface SessionUser {\n  id: string;\n  name: string;\n  email: string;\n  role: UserRole;\n  avatar?: string;\n  unitId: string;\n  unitName: string;\n  isActive: boolean;\n}\n\nexport function isUserRole(value: unknown): value is UserRole {\n  return (\n    typeof value === \"string\" &&\n    (USER_ROLES as readonly string[]).includes(value)\n  );\n}\n\nexport function isSessionUser(value: unknown): value is SessionUser {\n  if (!value || typeof value !== \"object\") return false;\n\n  const candidate = value as Record<string, unknown>;\n  return (\n    typeof candidate.id === \"string\" &&\n    typeof candidate.name === \"string\" &&\n    typeof candidate.email === \"string\" &&\n    isUserRole(candidate.role) &&\n    typeof candidate.unitId === \"string\" &&\n    typeof candidate.unitName === \"string\" &&\n    typeof candidate.isActive === \"boolean\" &&\n    (candidate.avatar === undefined || typeof candidate.avatar === \"string\")\n  );\n}\n"],"names":[],"mappings":";;;;;;;;AAAO,MAAM,aAAa;IACxB;IACA;IACA;IACA;IACA;CACD;AAeM,SAAS,WAAW,KAAc;IACvC,OACE,OAAO,UAAU,YACjB,AAAC,WAAiC,QAAQ,CAAC;AAE/C;AAEO,SAAS,cAAc,KAAc;IAC1C,IAAI,CAAC,SAAS,OAAO,UAAU,UAAU,OAAO;IAEhD,MAAM,YAAY;IAClB,OACE,OAAO,UAAU,EAAE,KAAK,YACxB,OAAO,UAAU,IAAI,KAAK,YAC1B,OAAO,UAAU,KAAK,KAAK,YAC3B,WAAW,UAAU,IAAI,KACzB,OAAO,UAAU,MAAM,KAAK,YAC5B,OAAO,UAAU,QAAQ,KAAK,YAC9B,OAAO,UAAU,QAAQ,KAAK,aAC9B,CAAC,UAAU,MAAM,KAAK,aAAa,OAAO,UAAU,MAAM,KAAK,QAAQ;AAE3E"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/lib/auth-session.ts"],"sourcesContent":["import { isSessionUser, type SessionUser, type UserRole } from \"@/lib/auth-types\";\n\nconst FALLBACK_AUTH_SECRET = \"flow-dev-auth-secret-change-me\";\n\nconst ROLE_BY_EMAIL: Record<string, UserRole> = {\n  \"master@flow.demo\": \"master\",\n  \"master@menux.co\": \"master\",\n  \"admin@flow.demo\": \"admin\",\n  \"comercial@flow.demo\": \"comercial\",\n  \"cs@flow.demo\": \"cs\",\n  \"leitura@flow.demo\": \"leitura\",\n};\n\nconst DEFAULT_USER_ID_BY_ROLE: Record<UserRole, string> = {\n  master: \"user-1\",\n  admin: \"user-2\",\n  comercial: \"user-3\",\n  cs: \"user-5\",\n  leitura: \"user-8\",\n};\n\nconst FIXED_DEMO_PROFILE_BY_EMAIL: Partial<\n  Record<\n    string,\n    {\n      id: string;\n      name: string;\n    }\n  >\n> = {\n  \"master@flow.demo\": { id: \"user-1\", name: \"Rafael Mendes\" },\n  \"master@menux.co\": { id: \"user-1\", name: \"Master\" },\n  \"admin@flow.demo\": { id: \"user-2\", name: \"Camila Ferreira\" },\n  \"comercial@flow.demo\": { id: \"user-3\", name: \"Lucas Oliveira\" },\n  \"cs@flow.demo\": { id: \"user-5\", name: \"Fernanda Lima\" },\n  \"leitura@flow.demo\": { id: \"user-8\", name: \"Pedro Almeida\" },\n};\n\nexport interface SessionTokenPayload {\n  user: SessionUser;\n  iat: number;\n  exp: number;\n}\n\nfunction getAuthSecret(): string {\n  const value = process.env.FLOW_AUTH_SECRET;\n  return value && value.length >= 16 ? value : FALLBACK_AUTH_SECRET;\n}\n\nfunction toBase64Url(data: Uint8Array): string {\n  if (typeof Buffer !== \"undefined\") {\n    return Buffer.from(data)\n      .toString(\"base64\")\n      .replace(/\\+/g, \"-\")\n      .replace(/\\//g, \"_\")\n      .replace(/=+$/g, \"\");\n  }\n\n  let binary = \"\";\n  for (const byte of data) {\n    binary += String.fromCharCode(byte);\n  }\n  return btoa(binary).replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=+$/g, \"\");\n}\n\nfunction fromBase64Url(data: string): Uint8Array | null {\n  const normalized = data.replace(/-/g, \"+\").replace(/_/g, \"/\");\n  const padded = normalized + \"=\".repeat((4 - (normalized.length % 4)) % 4);\n\n  try {\n    if (typeof Buffer !== \"undefined\") {\n      return new Uint8Array(Buffer.from(padded, \"base64\"));\n    }\n\n    const binary = atob(padded);\n    const out = new Uint8Array(binary.length);\n    for (let i = 0; i < binary.length; i += 1) {\n      out[i] = binary.charCodeAt(i);\n    }\n    return out;\n  } catch {\n    return null;\n  }\n}\n\nfunction asArrayBuffer(bytes: Uint8Array): ArrayBuffer {\n  return bytes.buffer.slice(\n    bytes.byteOffset,\n    bytes.byteOffset + bytes.byteLength\n  ) as ArrayBuffer;\n}\n\nasync function importSigningKey(): Promise<CryptoKey> {\n  const raw = new TextEncoder().encode(getAuthSecret());\n  return crypto.subtle.importKey(\n    \"raw\",\n    raw,\n    {\n      name: \"HMAC\",\n      hash: \"SHA-256\",\n    },\n    false,\n    [\"sign\", \"verify\"]\n  );\n}\n\nfunction isSessionTokenPayload(value: unknown): value is SessionTokenPayload {\n  if (!value || typeof value !== \"object\") return false;\n\n  const payload = value as Record<string, unknown>;\n  return (\n    isSessionUser(payload.user) &&\n    typeof payload.iat === \"number\" &&\n    Number.isFinite(payload.iat) &&\n    typeof payload.exp === \"number\" &&\n    Number.isFinite(payload.exp) &&\n    payload.exp > payload.iat\n  );\n}\n\nfunction normalizeName(email: string): string {\n  const localPart = email.split(\"@\")[0] ?? \"\";\n  const cleaned = localPart\n    .replace(/[._-]+/g, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n\n  if (!cleaned) return \"Usuário Demo\";\n\n  return cleaned\n    .split(\" \")\n    .map((part) => part.charAt(0).toUpperCase() + part.slice(1).toLowerCase())\n    .join(\" \");\n}\n\nexport function buildDemoUser(email: string): SessionUser {\n  const normalizedEmail = email.trim().toLowerCase();\n  const role = ROLE_BY_EMAIL[normalizedEmail] ?? \"comercial\";\n  const fixedProfile = FIXED_DEMO_PROFILE_BY_EMAIL[normalizedEmail];\n  const id = fixedProfile?.id ?? DEFAULT_USER_ID_BY_ROLE[role];\n  const name = fixedProfile?.name ?? normalizeName(normalizedEmail);\n\n  return {\n    id,\n    name,\n    email: normalizedEmail,\n    role,\n    unitId: \"unit-1\",\n    unitName: \"Matriz\",\n    isActive: true,\n  };\n}\n\nexport async function createSessionToken(\n  user: SessionUser,\n  maxAgeSeconds: number\n): Promise<string> {\n  const nowSeconds = Math.floor(Date.now() / 1000);\n  const payload: SessionTokenPayload = {\n    user,\n    iat: nowSeconds,\n    exp: nowSeconds + maxAgeSeconds,\n  };\n\n  const payloadPart = toBase64Url(\n    new TextEncoder().encode(JSON.stringify(payload))\n  );\n\n  const key = await importSigningKey();\n  const signatureBuffer = await crypto.subtle.sign(\n    \"HMAC\",\n    key,\n    new TextEncoder().encode(payloadPart)\n  );\n\n  const signaturePart = toBase64Url(new Uint8Array(signatureBuffer));\n  return `${payloadPart}.${signaturePart}`;\n}\n\nexport async function verifySessionToken(\n  token: string\n): Promise<SessionTokenPayload | null> {\n  const [payloadPart, signaturePart, extra] = token.split(\".\");\n  if (!payloadPart || !signaturePart || extra) return null;\n\n  const payloadBytes = fromBase64Url(payloadPart);\n  const signatureBytes = fromBase64Url(signaturePart);\n  if (!payloadBytes || !signatureBytes) return null;\n\n  const key = await importSigningKey();\n  const isValidSignature = await crypto.subtle.verify(\n    \"HMAC\",\n    key,\n    asArrayBuffer(signatureBytes),\n    new TextEncoder().encode(payloadPart)\n  );\n\n  if (!isValidSignature) return null;\n\n  try {\n    const parsed = JSON.parse(new TextDecoder().decode(payloadBytes));\n    if (!isSessionTokenPayload(parsed)) return null;\n    if (parsed.exp <= Math.floor(Date.now() / 1000)) return null;\n    return parsed;\n  } catch {\n    return null;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 231, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/app/api/auth/session/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { verifySessionToken } from \"@/lib/auth-session\";\n\nconst AUTH_COOKIE_NAME = \"flow-token\";\n\nexport async function GET(request: NextRequest) {\n  const token = request.cookies.get(AUTH_COOKIE_NAME)?.value;\n  if (!token) {\n    return NextResponse.json({ error: \"Não autenticado.\" }, { status: 401 });\n  }\n\n  const payload = await verifySessionToken(token);\n  if (!payload) {\n    const response = NextResponse.json(\n      { error: \"Sessão inválida ou expirada.\" },\n      { status: 401 }\n    );\n    response.cookies.set(AUTH_COOKIE_NAME, \"\", {\n      httpOnly: true,\n      sameSite: \"lax\",\n      secure: process.env.NODE_ENV === \"production\",\n      maxAge: 0,\n      path: \"/\",\n    });\n    return response;\n  }\n\n  return NextResponse.json({ user: payload.user });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,mBAAmB;AAElB,eAAe,IAAI,OAAoB;IAC5C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACrD,IAAI,CAAC,OAAO;QACV,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmB,GAAG;YAAE,QAAQ;QAAI;IACxE;IAEA,MAAM,UAAU,MAAM,IAAA,qJAAkB,EAAC;IACzC,IAAI,CAAC,SAAS;QACZ,MAAM,WAAW,gJAAY,CAAC,IAAI,CAChC;YAAE,OAAO;QAA+B,GACxC;YAAE,QAAQ;QAAI;QAEhB,SAAS,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI;YACzC,UAAU;YACV,UAAU;YACV,QAAQ,oDAAyB;YACjC,QAAQ;YACR,MAAM;QACR;QACA,OAAO;IACT;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,MAAM,QAAQ,IAAI;IAAC;AAChD"}}]
}