{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/components/drawers/lead-negotiation-tab.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Plus,\n  ChevronDown,\n  ChevronUp,\n  Download,\n  Handshake,\n  Clock3,\n  Send,\n  CheckCircle2,\n  XCircle,\n  Pencil,\n  Trash2,\n  GitCompareArrows,\n  CalendarClock,\n  Copy,\n  Loader2,\n  BadgeCheck,\n  ArrowRight,\n  FileText,\n} from \"lucide-react\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { cn } from \"@/lib/utils\";\n\nimport type { NegotiationRound, NegotiationType } from \"@/types\";\nimport { mockNegotiationRounds } from \"@/lib/mock-data\";\n\ntype RoundLifecycleStatus = \"draft\" | \"sent\" | \"awaiting\" | \"accepted\" | \"rejected\";\ntype RoundVisibility = \"client\" | \"internal\";\ntype RoundActorRole = \"team\" | \"client\" | \"system\";\ntype BannerType = \"success\" | \"error\" | \"warning\" | \"info\";\ntype RowAction =\n  | \"send\"\n  | \"awaiting\"\n  | \"accept\"\n  | \"reject\"\n  | \"set-current\"\n  | \"delete\"\n  | \"save-edit\"\n  | \"save-create\";\n\ninterface NegotiationRoundItem extends NegotiationRound {\n  lifecycleStatus: RoundLifecycleStatus;\n  visibility: RoundVisibility;\n  actorRole: RoundActorRole;\n  sentAt?: string;\n  acceptedAt?: string;\n  rejectedAt?: string;\n  rejectedReason?: string;\n  updatedAt?: string;\n}\n\ninterface NegotiationTermsState {\n  sourceRoundId: string;\n  monthlyValue: number;\n  setupValue: number;\n  termMonths: number;\n  totalValue: number;\n  updatedAt: string;\n  updatedBy: string;\n  sourceStatus: RoundLifecycleStatus;\n  sourceVisibility: RoundVisibility;\n}\n\ninterface InlineBanner {\n  type: BannerType;\n  message: string;\n}\n\ninterface NextStepDraft {\n  action: string;\n  dueAt: string;\n  channel: \"call\" | \"whatsapp\" | \"email\" | \"meeting\" | \"visit\";\n  ownerId: string;\n}\n\ninterface RoundFormPayload {\n  type: NegotiationType;\n  actorRole: RoundActorRole;\n  visibility: RoundVisibility;\n  lifecycleStatus: RoundLifecycleStatus;\n  monthlyValue: number;\n  setupValue: number;\n  termMonths: number;\n  notes: string;\n  conditions: string[];\n  rejectedReason?: string;\n}\n\ninterface RoundFormSeed {\n  type: NegotiationType;\n  actorRole: RoundActorRole;\n  visibility: RoundVisibility;\n  lifecycleStatus: RoundLifecycleStatus;\n  monthlyValue: string;\n  setupValue: string;\n  termMonths: string;\n  notes: string;\n  conditionsText: string;\n  rejectedReason: string;\n}\n\nconst LOGGED_USER = {\n  id: \"u1\",\n  name: \"Maria Silva\",\n};\n\nconst TEAM_OWNERS = [\n  { id: \"u1\", name: \"Maria Silva\" },\n  { id: \"u2\", name: \"Pedro Santos\" },\n  { id: \"u3\", name: \"Julia Fernandes\" },\n];\n\nconst ROUND_EDIT_WINDOW_HOURS = 24;\nconst MIN_NOTES_LENGTH = 10;\n\nconst roundTypeMeta: Record<\n  NegotiationType,\n  {\n    label: string;\n    badgeClass: string;\n    icon: typeof FileText;\n  }\n> = {\n  proposal: {\n    label: \"Proposta\",\n    badgeClass: \"border-blue-200 bg-blue-50 text-blue-700\",\n    icon: FileText,\n  },\n  counter: {\n    label: \"Contra proposta\",\n    badgeClass: \"border-amber-200 bg-amber-50 text-amber-700\",\n    icon: ArrowRight,\n  },\n  internal: {\n    label: \"Ajuste interno\",\n    badgeClass: \"border-zinc-200 bg-zinc-100 text-zinc-700\",\n    icon: Handshake,\n  },\n  agreement: {\n    label: \"Fechamento\",\n    badgeClass: \"border-emerald-200 bg-emerald-50 text-emerald-700\",\n    icon: BadgeCheck,\n  },\n};\n\nconst lifecycleMeta: Record<\n  RoundLifecycleStatus,\n  {\n    label: string;\n    chipClass: string;\n  }\n> = {\n  draft: { label: \"Rascunho\", chipClass: \"border-zinc-200 bg-zinc-100 text-zinc-600\" },\n  sent: { label: \"Enviada\", chipClass: \"border-sky-200 bg-sky-50 text-sky-700\" },\n  awaiting: { label: \"Aguardando cliente\", chipClass: \"border-violet-200 bg-violet-50 text-violet-700\" },\n  accepted: { label: \"Aceita\", chipClass: \"border-emerald-200 bg-emerald-50 text-emerald-700\" },\n  rejected: { label: \"Rejeitada\", chipClass: \"border-red-200 bg-red-50 text-red-700\" },\n};\n\nconst visibilityMeta: Record<\n  RoundVisibility,\n  { label: string; chipClass: string }\n> = {\n  client: { label: \"Visível ao cliente\", chipClass: \"border-zinc-200 bg-zinc-50 text-zinc-600\" },\n  internal: { label: \"Interna\", chipClass: \"border-zinc-200 bg-zinc-100 text-zinc-500\" },\n};\n\nconst channelOptions: Array<{ id: NextStepDraft[\"channel\"]; label: string }> = [\n  { id: \"call\", label: \"Ligação\" },\n  { id: \"whatsapp\", label: \"WhatsApp\" },\n  { id: \"email\", label: \"E-mail\" },\n  { id: \"meeting\", label: \"Reunião\" },\n  { id: \"visit\", label: \"Visita\" },\n];\n\nconst roundTypeOptions: Array<{ id: NegotiationType; label: string }> = [\n  { id: \"proposal\", label: \"Proposta do time\" },\n  { id: \"counter\", label: \"Contra proposta do cliente\" },\n  { id: \"internal\", label: \"Ajuste interno\" },\n  { id: \"agreement\", label: \"Fechamento\" },\n];\n\nconst lifecycleOptions: Array<{ id: RoundLifecycleStatus; label: string }> = [\n  { id: \"draft\", label: \"Rascunho\" },\n  { id: \"sent\", label: \"Enviada ao cliente\" },\n  { id: \"awaiting\", label: \"Aguardando resposta\" },\n  { id: \"accepted\", label: \"Aceita\" },\n  { id: \"rejected\", label: \"Rejeitada\" },\n];\n\nconst formatCurrency = (value: number) =>\n  new Intl.NumberFormat(\"pt-BR\", {\n    style: \"currency\",\n    currency: \"BRL\",\n  }).format(value);\n\nconst toDateTimeLabel = (dateIso?: string) => {\n  if (!dateIso) return \"Sem data\";\n  const date = new Date(dateIso);\n  if (Number.isNaN(date.getTime())) return \"Sem data\";\n  return format(date, \"dd MMM, HH:mm\", { locale: ptBR });\n};\n\nconst toInputNumber = (raw: string) => {\n  const parsed = Number(raw);\n  if (Number.isNaN(parsed)) return 0;\n  return parsed;\n};\n\nconst calcTotalValue = (monthlyValue: number, setupValue: number, termMonths: number) =>\n  monthlyValue * termMonths + setupValue;\n\nconst isTermsRequired = (type: NegotiationType) =>\n  type === \"proposal\" || type === \"counter\" || type === \"agreement\";\n\nconst isTeamOfferCandidate = (round: NegotiationRoundItem) =>\n  (round.type === \"proposal\" || round.type === \"agreement\") &&\n  round.actorRole === \"team\" &&\n  round.visibility === \"client\";\n\nconst isRoundEditable = (round: NegotiationRoundItem) => {\n  if (round.authorId !== LOGGED_USER.id) return false;\n  if (round.lifecycleStatus !== \"draft\") return false;\n  const createdAt = new Date(round.createdAt).getTime();\n  if (Number.isNaN(createdAt)) return false;\n  return Date.now() - createdAt <= ROUND_EDIT_WINDOW_HOURS * 60 * 60 * 1000;\n};\n\nconst isRoundDeletable = (round: NegotiationRoundItem) =>\n  isRoundEditable(round) && !round.isFinal;\n\nconst createRoundId = () => `round-${Date.now()}-${Math.floor(Math.random() * 999)}`;\n\nconst nowIso = () => new Date().toISOString();\n\nfunction downloadTextFile(fileName: string, content: string) {\n  if (typeof window === \"undefined\") return;\n  const blob = new Blob([content], { type: \"text/plain;charset=utf-8\" });\n  const objectUrl = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = objectUrl;\n  link.download = fileName;\n  document.body.append(link);\n  link.click();\n  link.remove();\n  URL.revokeObjectURL(objectUrl);\n}\n\nfunction buildInitialRounds(): NegotiationRoundItem[] {\n  return mockNegotiationRounds.map((round) => {\n    if (round.type === \"counter\") {\n      return {\n        ...round,\n        actorRole: \"client\",\n        visibility: \"client\",\n        lifecycleStatus: \"awaiting\",\n        sentAt: round.createdAt,\n      };\n    }\n\n    if (round.type === \"internal\") {\n      return {\n        ...round,\n        actorRole: \"team\",\n        visibility: \"internal\",\n        lifecycleStatus: \"draft\",\n      };\n    }\n\n    if (round.type === \"agreement\") {\n      return {\n        ...round,\n        actorRole: \"team\",\n        visibility: \"client\",\n        lifecycleStatus: \"accepted\",\n        sentAt: round.createdAt,\n        acceptedAt: round.createdAt,\n        isFinal: true,\n      };\n    }\n\n    return {\n      ...round,\n      actorRole: \"team\",\n      visibility: \"client\",\n      lifecycleStatus: \"sent\",\n      sentAt: round.createdAt,\n    };\n  });\n}\n\nfunction deriveCurrentTermsRoundId(rounds: NegotiationRoundItem[]) {\n  const ordered = [...rounds].sort(\n    (a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime(),\n  );\n  const accepted = [...ordered].reverse().find(\n    (round) => isTeamOfferCandidate(round) && round.lifecycleStatus === \"accepted\",\n  );\n  if (accepted) return accepted.id;\n\n  const sentOrAwaiting = [...ordered].reverse().find(\n    (round) =>\n      isTeamOfferCandidate(round) &&\n      (round.lifecycleStatus === \"sent\" || round.lifecycleStatus === \"awaiting\"),\n  );\n  return sentOrAwaiting?.id ?? null;\n}\n\nfunction deriveNegotiationStatus(\n  rounds: NegotiationRoundItem[],\n  currentTermsRoundId: string | null,\n) {\n  if (rounds.length === 0) {\n    return {\n      label: \"Não iniciada\",\n      description: \"Nenhuma rodada registrada até agora.\",\n      tone: \"neutral\" as const,\n    };\n  }\n\n  const accepted = rounds.find((round) => round.lifecycleStatus === \"accepted\");\n  if (accepted) {\n    return {\n      label: \"Aceita\",\n      description: \"Rodada aceita pelo cliente. Pronta para fechamento.\",\n      tone: \"success\" as const,\n    };\n  }\n\n  const currentRound = rounds.find((round) => round.id === currentTermsRoundId);\n  if (currentRound?.lifecycleStatus === \"awaiting\" || currentRound?.lifecycleStatus === \"sent\") {\n    return {\n      label: \"Aguardando cliente\",\n      description: `Aguardando resposta da rodada vigente enviada em ${toDateTimeLabel(currentRound.sentAt)}.`,\n      tone: \"warning\" as const,\n    };\n  }\n\n  return {\n    label: \"Em negociação\",\n    description: \"Negociação ativa com ajustes internos e respostas em andamento.\",\n    tone: \"info\" as const,\n  };\n}\n\nfunction toRoundFormSeed(round?: NegotiationRoundItem): RoundFormSeed {\n  if (!round) {\n    return {\n      type: \"proposal\",\n      actorRole: \"team\",\n      visibility: \"client\",\n      lifecycleStatus: \"draft\",\n      monthlyValue: \"\",\n      setupValue: \"\",\n      termMonths: \"12\",\n      notes: \"\",\n      conditionsText: \"\",\n      rejectedReason: \"\",\n    };\n  }\n\n  return {\n    type: round.type,\n    actorRole: round.actorRole,\n    visibility: round.visibility,\n    lifecycleStatus: round.lifecycleStatus,\n    monthlyValue: String(round.monthlyValue ?? \"\"),\n    setupValue: String(round.setupValue ?? \"\"),\n    termMonths: String(round.termMonths ?? 12),\n    notes: round.details ?? \"\",\n    conditionsText: round.conditions.join(\", \"),\n    rejectedReason: round.rejectedReason ?? \"\",\n  };\n}\n\nfunction extractTerms(round: NegotiationRoundItem | null): NegotiationTermsState | null {\n  if (!round) return null;\n  if (!isTermsRequired(round.type)) return null;\n  const monthlyValue = round.monthlyValue ?? 0;\n  const setupValue = round.setupValue ?? 0;\n  const termMonths = round.termMonths ?? 12;\n  return {\n    sourceRoundId: round.id,\n    monthlyValue,\n    setupValue,\n    termMonths,\n    totalValue: calcTotalValue(monthlyValue, setupValue, termMonths),\n    updatedAt: round.updatedAt ?? round.createdAt,\n    updatedBy: round.authorName,\n    sourceStatus: round.lifecycleStatus,\n    sourceVisibility: round.visibility,\n  };\n}\n\nfunction buildSummaryText(\n  dealTitle: string,\n  terms: NegotiationTermsState,\n  rounds: NegotiationRoundItem[],\n) {\n  const relevantRounds = rounds.filter(\n    (round) => round.visibility === \"client\" && round.type !== \"internal\",\n  );\n\n  const lines = relevantRounds.map((round, index) => {\n    const typeLabel = roundTypeMeta[round.type].label;\n    const statusLabel = lifecycleMeta[round.lifecycleStatus].label;\n    return `${index + 1}. ${typeLabel} | ${statusLabel} | Mensal ${formatCurrency(\n      round.monthlyValue ?? 0,\n    )} | Setup ${formatCurrency(round.setupValue ?? 0)} | ${round.termMonths ?? 12} meses`;\n  });\n\n  return [\n    `Resumo de negociação - ${dealTitle}`,\n    \"\",\n    \"Termos vigentes\",\n    `Mensal: ${formatCurrency(terms.monthlyValue)}`,\n    `Setup: ${formatCurrency(terms.setupValue)}`,\n    `Prazo: ${terms.termMonths} meses`,\n    `Valor total: ${formatCurrency(terms.totalValue)}`,\n    `Origem: rodada ${terms.sourceRoundId}`,\n    `Atualizado por: ${terms.updatedBy} em ${toDateTimeLabel(terms.updatedAt)}`,\n    \"\",\n    \"Rodadas relevantes para cliente\",\n    ...lines,\n  ].join(\"\\n\");\n}\n\ninterface NegotiationTabProps {\n  dealId: string;\n  dealTitle: string;\n}\n\nexport function NegotiationTab({ dealId, dealTitle }: NegotiationTabProps) {\n  const initialRounds = useMemo(() => buildInitialRounds(), []);\n  const [rounds, setRounds] = useState<NegotiationRoundItem[]>(initialRounds);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [formMode, setFormMode] = useState<\"create\" | \"edit\">(\"create\");\n  const [formSeed, setFormSeed] = useState<RoundFormSeed>(toRoundFormSeed());\n  const [editingRoundId, setEditingRoundId] = useState<string | null>(null);\n  const [isSavingRound, setIsSavingRound] = useState(false);\n  const [formError, setFormError] = useState<string | null>(null);\n\n  const [currentTermsRoundId, setCurrentTermsRoundId] = useState<string | null>(\n    deriveCurrentTermsRoundId(initialRounds),\n  );\n  const [rowActionLoading, setRowActionLoading] = useState<Record<string, RowAction | null>>({});\n\n  const [banner, setBanner] = useState<InlineBanner | null>(null);\n\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportError, setExportError] = useState<string | null>(null);\n  const [exportSummaryText, setExportSummaryText] = useState<string | null>(null);\n\n  const [nextStep, setNextStep] = useState<NextStepDraft>({\n    action: \"Validar retorno do cliente sobre a proposta vigente\",\n    dueAt: \"\",\n    channel: \"whatsapp\",\n    ownerId: LOGGED_USER.id,\n  });\n  const [nextStepState, setNextStepState] = useState<\"idle\" | \"saving\" | \"saved\" | \"error\">(\n    \"idle\",\n  );\n  const [nextStepError, setNextStepError] = useState<string | null>(null);\n  const [highlightRoundId, setHighlightRoundId] = useState<string | null>(null);\n  const [highlightNextStep, setHighlightNextStep] = useState(false);\n\n  const orderedRounds = useMemo(\n    () =>\n      [...rounds].sort(\n        (a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime(),\n      ),\n    [rounds],\n  );\n\n  const currentTermsRound = useMemo(\n    () => orderedRounds.find((round) => round.id === currentTermsRoundId) ?? null,\n    [orderedRounds, currentTermsRoundId],\n  );\n  const currentTermsRoundNumber = useMemo(() => {\n    if (!currentTermsRound) return null;\n    const index = orderedRounds.findIndex((round) => round.id === currentTermsRound.id);\n    return index >= 0 ? index + 1 : null;\n  }, [currentTermsRound, orderedRounds]);\n\n  const currentTerms = useMemo(() => extractTerms(currentTermsRound), [currentTermsRound]);\n\n  const latestTeamOffer = useMemo(\n    () => [...orderedRounds].reverse().find((round) => isTeamOfferCandidate(round)) ?? null,\n    [orderedRounds],\n  );\n\n  const latestClientCounter = useMemo(\n    () => [...orderedRounds].reverse().find((round) => round.type === \"counter\") ?? null,\n    [orderedRounds],\n  );\n\n  const negotiationStatus = useMemo(\n    () => deriveNegotiationStatus(orderedRounds, currentTermsRoundId),\n    [orderedRounds, currentTermsRoundId],\n  );\n\n  const runRowAction = async (\n    roundId: string,\n    action: RowAction,\n    callback: () => void,\n    onErrorMessage: string,\n  ) => {\n    setRowActionLoading((prev) => ({ ...prev, [roundId]: action }));\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 220));\n      callback();\n    } catch {\n      setBanner({\n        type: \"error\",\n        message: onErrorMessage,\n      });\n    } finally {\n      setRowActionLoading((prev) => ({ ...prev, [roundId]: null }));\n    }\n  };\n\n  const pushBanner = (next: InlineBanner) => {\n    setBanner(next);\n    window.setTimeout(() => setBanner(null), 2200);\n  };\n\n  const pulseRound = (roundId: string) => {\n    setHighlightRoundId(roundId);\n    window.setTimeout(() => {\n      setHighlightRoundId((prev) => (prev === roundId ? null : prev));\n    }, 1800);\n  };\n\n  const scrollToRound = (roundId: string) => {\n    const target = document.querySelector(`[data-round-anchor=\"${roundId}\"]`);\n    if (target instanceof HTMLElement) {\n      target.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n      pulseRound(roundId);\n    }\n  };\n\n  const focusNextStepCard = () => {\n    const target = document.querySelector('[data-next-step-card=\"true\"]');\n    if (target instanceof HTMLElement) {\n      target.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n      setHighlightNextStep(true);\n      window.setTimeout(() => setHighlightNextStep(false), 1600);\n    }\n  };\n\n  const openCreateRound = (sourceRound?: NegotiationRoundItem | null) => {\n    const baseSeed = toRoundFormSeed(sourceRound ?? undefined);\n    setFormMode(\"create\");\n    setEditingRoundId(null);\n    setFormError(null);\n    setFormSeed({\n      ...baseSeed,\n      type: sourceRound?.type === \"counter\" ? \"proposal\" : baseSeed.type,\n      actorRole: \"team\",\n      visibility: sourceRound?.visibility === \"internal\" ? \"client\" : baseSeed.visibility,\n      lifecycleStatus: \"draft\",\n      rejectedReason: \"\",\n    });\n    setIsFormOpen(true);\n  };\n\n  const openEditRound = (round: NegotiationRoundItem) => {\n    if (!isRoundEditable(round)) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Você só pode editar rodadas próprias em rascunho dentro da janela de 24h.\",\n      });\n      return;\n    }\n    setFormMode(\"edit\");\n    setEditingRoundId(round.id);\n    setFormError(null);\n    setFormSeed(toRoundFormSeed(round));\n    setIsFormOpen(true);\n  };\n\n  const closeForm = () => {\n    setIsFormOpen(false);\n    setFormError(null);\n    setEditingRoundId(null);\n    setFormSeed(toRoundFormSeed());\n  };\n\n  const handleSaveRound = async (payload: RoundFormPayload) => {\n    setIsSavingRound(true);\n    setFormError(null);\n\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 250));\n\n      if (formMode === \"edit\" && editingRoundId) {\n        setRounds((prev) =>\n          prev.map((round) => {\n            if (round.id !== editingRoundId) return round;\n            const totalValue = calcTotalValue(\n              payload.monthlyValue,\n              payload.setupValue,\n              payload.termMonths,\n            );\n            return {\n              ...round,\n              type: payload.type,\n              actorRole: payload.actorRole,\n              visibility: payload.visibility,\n              lifecycleStatus: payload.lifecycleStatus,\n              monthlyValue: payload.monthlyValue,\n              setupValue: payload.setupValue,\n              termMonths: payload.termMonths,\n              totalValue,\n              conditions: payload.conditions,\n              details: payload.notes,\n              rejectedReason: payload.lifecycleStatus === \"rejected\" ? payload.rejectedReason : undefined,\n              sentAt:\n                payload.lifecycleStatus === \"sent\" ||\n                payload.lifecycleStatus === \"awaiting\" ||\n                payload.lifecycleStatus === \"accepted\"\n                  ? round.sentAt ?? nowIso()\n                  : undefined,\n              acceptedAt:\n                payload.lifecycleStatus === \"accepted\"\n                  ? round.acceptedAt ?? nowIso()\n                  : undefined,\n              rejectedAt:\n                payload.lifecycleStatus === \"rejected\"\n                  ? round.rejectedAt ?? nowIso()\n                  : undefined,\n              updatedAt: nowIso(),\n            };\n          }),\n        );\n\n        const shouldPromoteTerms =\n          payload.lifecycleStatus === \"accepted\" &&\n          payload.actorRole === \"team\" &&\n          payload.visibility === \"client\" &&\n          (payload.type === \"proposal\" || payload.type === \"agreement\");\n\n        if (shouldPromoteTerms) {\n          setCurrentTermsRoundId(editingRoundId);\n          pulseRound(editingRoundId);\n        }\n\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada atualizada com sucesso.\",\n        });\n      } else {\n        const createdAt = nowIso();\n        const totalValue = calcTotalValue(\n          payload.monthlyValue,\n          payload.setupValue,\n          payload.termMonths,\n        );\n        const newRound: NegotiationRoundItem = {\n          id: createRoundId(),\n          opportunityId: dealId,\n          type: payload.type,\n          authorId: payload.actorRole === \"team\" ? LOGGED_USER.id : \"client-user\",\n          authorName:\n            payload.actorRole === \"team\"\n              ? `${LOGGED_USER.name} - Equipe`\n              : \"Cliente - Cliente\",\n          actorRole: payload.actorRole,\n          visibility: payload.visibility,\n          lifecycleStatus: payload.lifecycleStatus,\n          createdAt,\n          monthlyValue: payload.monthlyValue,\n          setupValue: payload.setupValue,\n          termMonths: payload.termMonths,\n          totalValue,\n          conditions: payload.conditions,\n          details: payload.notes,\n          rejectedReason:\n            payload.lifecycleStatus === \"rejected\" ? payload.rejectedReason : undefined,\n          sentAt:\n            payload.lifecycleStatus === \"sent\" ||\n            payload.lifecycleStatus === \"awaiting\" ||\n            payload.lifecycleStatus === \"accepted\"\n              ? createdAt\n              : undefined,\n          acceptedAt: payload.lifecycleStatus === \"accepted\" ? createdAt : undefined,\n          rejectedAt: payload.lifecycleStatus === \"rejected\" ? createdAt : undefined,\n          status: \"active\",\n        };\n\n        setRounds((prev) => [...prev, newRound]);\n\n        if (newRound.lifecycleStatus === \"accepted\" && isTeamOfferCandidate(newRound)) {\n          setCurrentTermsRoundId(newRound.id);\n          pulseRound(newRound.id);\n        }\n\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada registrada. Histórico e resumo atualizados.\",\n        });\n      }\n\n      closeForm();\n    } catch {\n      setFormError(\"Não consegui salvar a rodada. Revise os campos e tente novamente.\");\n    } finally {\n      setIsSavingRound(false);\n    }\n  };\n\n  const handleMarkRoundSent = async (round: NegotiationRoundItem) => {\n    if (!isTeamOfferCandidate(round)) {\n      pushBanner({ type: \"warning\", message: \"Somente propostas visíveis ao cliente podem ser enviadas.\" });\n      return;\n    }\n    if (round.lifecycleStatus !== \"draft\") {\n      pushBanner({ type: \"warning\", message: \"Apenas rodadas em rascunho podem ser enviadas.\" });\n      return;\n    }\n    if (!window.confirm(\"Confirmar envio desta rodada ao cliente?\")) return;\n\n    await runRowAction(\n      round.id,\n      \"send\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"sent\",\n                  sentAt: nowIso(),\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada enviada ao cliente e pronta para acompanhamento.\",\n        });\n      },\n      \"Não consegui marcar a rodada como enviada.\",\n    );\n  };\n\n  const handleMarkRoundAwaiting = async (round: NegotiationRoundItem) => {\n    if (round.lifecycleStatus !== \"sent\") return;\n\n    await runRowAction(\n      round.id,\n      \"awaiting\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"awaiting\",\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        pushBanner({\n          type: \"info\",\n          message: \"Status atualizado para aguardando resposta do cliente.\",\n        });\n      },\n      \"Não consegui atualizar o status da rodada.\",\n    );\n  };\n\n  const handleMarkRoundAccepted = async (round: NegotiationRoundItem) => {\n    if (!window.confirm(\"Confirmar esta rodada como aceita?\")) return;\n\n    await runRowAction(\n      round.id,\n      \"accept\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"accepted\",\n                  acceptedAt: nowIso(),\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        if (isTeamOfferCandidate(round)) {\n          setCurrentTermsRoundId(round.id);\n          pulseRound(round.id);\n        }\n        pushBanner({\n          type: \"success\",\n          message: isTeamOfferCandidate(round)\n            ? \"Rodada aceita e promovida para termos vigentes.\"\n            : \"Rodada aceita com sucesso.\",\n        });\n      },\n      \"Não consegui marcar a rodada como aceita.\",\n    );\n  };\n\n  const handleMarkRoundRejected = async (round: NegotiationRoundItem) => {\n    const reason = window.prompt(\"Informe o motivo da rejeição (mínimo 5 caracteres):\");\n    if (!reason || reason.trim().length < 5) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Motivo obrigatório para rejeitar a rodada.\",\n      });\n      return;\n    }\n\n    await runRowAction(\n      round.id,\n      \"reject\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"rejected\",\n                  rejectedAt: nowIso(),\n                  rejectedReason: reason.trim(),\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        pushBanner({\n          type: \"warning\",\n          message: \"Rodada marcada como rejeitada.\",\n        });\n      },\n      \"Não consegui rejeitar a rodada.\",\n    );\n  };\n\n  const handleSetCurrentTerms = async (round: NegotiationRoundItem) => {\n    if (!isTeamOfferCandidate(round)) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Somente proposta do time visível ao cliente pode virar termo vigente.\",\n      });\n      return;\n    }\n\n    await runRowAction(\n      round.id,\n      \"set-current\",\n      () => {\n        setCurrentTermsRoundId(round.id);\n        pulseRound(round.id);\n        pushBanner({\n          type: \"success\",\n          message: `Rodada ${round.id} definida como fonte dos termos vigentes.`,\n        });\n      },\n      \"Não consegui definir os termos vigentes desta rodada.\",\n    );\n  };\n\n  const handleDeleteRound = async (round: NegotiationRoundItem) => {\n    if (!isRoundDeletable(round)) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Você só pode excluir rodadas próprias em rascunho dentro da janela permitida.\",\n      });\n      return;\n    }\n    if (!window.confirm(\"Excluir esta rodada? Esta ação remove o item do histórico.\")) return;\n\n    await runRowAction(\n      round.id,\n      \"delete\",\n      () => {\n        setRounds((prev) => {\n          const nextRounds = prev.filter((item) => item.id !== round.id);\n          if (currentTermsRoundId === round.id) {\n            setCurrentTermsRoundId(deriveCurrentTermsRoundId(nextRounds));\n          }\n          return nextRounds;\n        });\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada excluída com sucesso.\",\n        });\n      },\n      \"Não consegui excluir a rodada.\",\n    );\n  };\n\n  const handleExportSummary = async () => {\n    if (!currentTerms) {\n      setExportError(\"Export bloqueado. Defina termos vigentes antes de exportar.\");\n      pushBanner({\n        type: \"warning\",\n        message: \"Defina os termos vigentes para gerar um resumo confiável.\",\n      });\n      return;\n    }\n\n    setIsExporting(true);\n    setExportError(null);\n\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 260));\n      const summaryText = buildSummaryText(dealTitle, currentTerms, orderedRounds);\n      setExportSummaryText(summaryText);\n      downloadTextFile(`negociacao-${dealId}.txt`, summaryText);\n      pushBanner({\n        type: \"success\",\n        message: \"Resumo exportado com base nos termos vigentes.\",\n      });\n    } catch {\n      setExportError(\"Não consegui gerar o resumo. Tente novamente.\");\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const handleCopySummary = async () => {\n    if (!exportSummaryText) return;\n    try {\n      if (navigator.clipboard?.writeText) {\n        await navigator.clipboard.writeText(exportSummaryText);\n      } else {\n        const textarea = document.createElement(\"textarea\");\n        textarea.value = exportSummaryText;\n        document.body.append(textarea);\n        textarea.select();\n        document.execCommand(\"copy\");\n        textarea.remove();\n      }\n      pushBanner({\n        type: \"success\",\n        message: \"Resumo copiado para a área de transferência.\",\n      });\n    } catch {\n      pushBanner({\n        type: \"error\",\n        message: \"Não consegui copiar o resumo.\",\n      });\n    }\n  };\n\n  const handleSaveNextStep = async () => {\n    setNextStepState(\"saving\");\n    setNextStepError(null);\n\n    if (nextStep.action.trim().length < 4) {\n      setNextStepState(\"error\");\n      setNextStepError(\"Defina uma ação objetiva para o próximo passo.\");\n      return;\n    }\n\n    if (!nextStep.dueAt) {\n      setNextStepState(\"error\");\n      setNextStepError(\"Defina a data para o próximo passo.\");\n      return;\n    }\n\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 220));\n      setNextStepState(\"saved\");\n      pushBanner({\n        type: \"success\",\n        message: \"Próximo passo salvo com sucesso.\",\n      });\n      window.setTimeout(() => setNextStepState(\"idle\"), 1600);\n    } catch {\n      setNextStepState(\"error\");\n      setNextStepError(\"Não consegui salvar o próximo passo. Tente novamente.\");\n    }\n  };\n\n  const handleOpenClientReturn = () => {\n    setFormMode(\"create\");\n    setEditingRoundId(null);\n    setFormError(null);\n    setFormSeed({\n      type: \"counter\",\n      actorRole: \"client\",\n      visibility: \"client\",\n      lifecycleStatus: \"awaiting\",\n      monthlyValue: String(\n        latestClientCounter?.monthlyValue ?? currentTerms?.monthlyValue ?? latestTeamOffer?.monthlyValue ?? 0,\n      ),\n      setupValue: String(\n        latestClientCounter?.setupValue ?? currentTerms?.setupValue ?? latestTeamOffer?.setupValue ?? 0,\n      ),\n      termMonths: String(\n        latestClientCounter?.termMonths ?? currentTerms?.termMonths ?? latestTeamOffer?.termMonths ?? 12,\n      ),\n      notes: \"\",\n      conditionsText: \"\",\n      rejectedReason: \"\",\n    });\n    setIsFormOpen(true);\n  };\n\n  const statusToneClass =\n    negotiationStatus.tone === \"success\"\n      ? \"border-emerald-200 bg-emerald-50 text-emerald-700\"\n      : negotiationStatus.tone === \"warning\"\n        ? \"border-amber-200 bg-amber-50 text-amber-700\"\n        : negotiationStatus.tone === \"info\"\n          ? \"border-sky-200 bg-sky-50 text-sky-700\"\n          : \"border-zinc-200 bg-zinc-100 text-zinc-600\";\n\n  return (\n    <div className=\"space-y-5\" data-deal-id={dealId}>\n      <header className=\"space-y-4 border-b border-zinc-100 pb-4\">\n        <div className=\"flex flex-wrap items-start justify-between gap-3\">\n          <div className=\"space-y-1\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex h-8 w-8 items-center justify-center rounded-lg border border-violet-200 bg-violet-50 text-violet-700\">\n                <Handshake className=\"h-4 w-4\" />\n              </div>\n              <h2 className=\"font-heading text-lg font-semibold text-zinc-900\">Negociação</h2>\n            </div>\n            <p className=\"pl-10 text-sm text-zinc-500\">\n              Rodadas, termos vigentes e próximo passo em uma única execução.\n            </p>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"h-8 gap-1.5 rounded-full text-xs\"\n              onClick={handleExportSummary}\n              disabled={isExporting}\n            >\n              {isExporting ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <Download className=\"h-3.5 w-3.5\" />}\n              {isExporting ? \"Gerando...\" : \"Exportar resumo\"}\n            </Button>\n            <Button\n              size=\"sm\"\n              className=\"h-8 gap-1.5 rounded-full bg-zinc-900 text-xs text-white hover:bg-zinc-800\"\n              onClick={() => openCreateRound(latestTeamOffer)}\n            >\n              <Plus className=\"h-3.5 w-3.5\" />\n              Nova rodada\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex flex-wrap items-center justify-between gap-2\">\n          <div className={cn(\"inline-flex items-center gap-2 rounded-full border px-2.5 py-1 text-[11px] font-medium\", statusToneClass)}>\n            <Clock3 className=\"h-3.5 w-3.5\" />\n            {negotiationStatus.label}\n          </div>\n          <p className=\"text-xs text-zinc-500\">{negotiationStatus.description}</p>\n        </div>\n      </header>\n\n      {banner ? (\n        <div\n          className={cn(\n            \"rounded-lg border px-3 py-2 text-xs font-medium\",\n            banner.type === \"success\" && \"border-emerald-200 bg-emerald-50 text-emerald-700\",\n            banner.type === \"error\" && \"border-red-200 bg-red-50 text-red-700\",\n            banner.type === \"warning\" && \"border-amber-200 bg-amber-50 text-amber-700\",\n            banner.type === \"info\" && \"border-sky-200 bg-sky-50 text-sky-700\",\n          )}\n          role=\"status\"\n        >\n          {banner.message}\n        </div>\n      ) : null}\n\n      <div className=\"grid grid-cols-1 items-start gap-5 lg:grid-cols-12\">\n        <div className=\"space-y-4 lg:col-span-8 lg:min-h-[calc(100vh-24rem)] lg:space-y-3\">\n          <AnimatePresence>\n            {isFormOpen && (\n              <motion.div\n                initial={{ opacity: 0, y: -8 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -6 }}\n                transition={{ duration: 0.16 }}\n              >\n                <NegotiationRoundForm\n                  mode={formMode}\n                  seed={formSeed}\n                  isSaving={isSavingRound}\n                  errorMessage={formError}\n                  onCancel={closeForm}\n                  onSave={handleSaveRound}\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          {orderedRounds.length === 0 ? (\n            <EmptyState onStart={() => openCreateRound()} />\n          ) : (\n            <div className=\"relative space-y-2.5 rounded-2xl border border-zinc-200 bg-white p-3\">\n              <div className=\"absolute bottom-3 left-[1.35rem] top-3 w-px bg-zinc-200\" />\n\n              {orderedRounds.map((round, index) => (\n                <NegotiationRoundCard\n                  key={round.id}\n                  round={round}\n                  displayIndex={index + 1}\n                  isCurrentTerms={round.id === currentTermsRoundId}\n                  isLast={index === orderedRounds.length - 1}\n                  isHighlighted={highlightRoundId === round.id}\n                  loadingAction={rowActionLoading[round.id] ?? null}\n                  onEdit={openEditRound}\n                  onDelete={handleDeleteRound}\n                  onSend={handleMarkRoundSent}\n                  onAwaiting={handleMarkRoundAwaiting}\n                  onAccept={handleMarkRoundAccepted}\n                  onReject={handleMarkRoundRejected}\n                  onSetCurrent={handleSetCurrentTerms}\n                  onCreateFromRound={(item) => openCreateRound(item)}\n                />\n              ))}\n            </div>\n          )}\n\n          <NegotiationExecutionCard\n            hasRounds={orderedRounds.length > 0}\n            hasCurrentTerms={Boolean(currentTerms)}\n            sourceRound={currentTermsRound}\n            hasClientCounter={Boolean(latestClientCounter)}\n            nextStep={nextStep}\n            onCreateRound={() => openCreateRound(latestTeamOffer ?? currentTermsRound)}\n            onExport={handleExportSummary}\n            onRegisterClientReturn={handleOpenClientReturn}\n            onFocusNextStep={focusNextStepCard}\n            isExporting={isExporting}\n          />\n        </div>\n\n        <div className=\"space-y-4 lg:col-span-4 lg:sticky lg:top-4 lg:self-start\">\n          <CurrentTermsCard\n            terms={currentTerms}\n            sourceRound={currentTermsRound}\n            sourceRoundNumber={currentTermsRoundNumber}\n            onJumpToSourceRound={scrollToRound}\n            onCreateFromCurrent={() => openCreateRound(currentTermsRound)}\n          />\n\n          <NegotiationComparisonCard\n            currentOfferRound={currentTermsRound ?? latestTeamOffer}\n            lastClientCounter={latestClientCounter}\n          />\n\n          <NextStepCard\n            draft={nextStep}\n            saveState={nextStepState}\n            errorMessage={nextStepError}\n            onChange={setNextStep}\n            onSave={handleSaveNextStep}\n            highlighted={highlightNextStep}\n          />\n\n          <div className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n            <div className=\"space-y-1\">\n              <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Resumo para envio</h3>\n              <p className=\"text-xs text-zinc-500\">\n                O export usa os termos vigentes e ignora rodadas internas por padrão.\n              </p>\n            </div>\n\n            <div className=\"mt-3 flex flex-wrap items-center gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"h-8 gap-1.5 rounded-full text-xs\"\n                onClick={handleExportSummary}\n                disabled={isExporting}\n              >\n                {isExporting ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <Download className=\"h-3.5 w-3.5\" />}\n                Exportar\n              </Button>\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-8 gap-1.5 rounded-full text-xs text-zinc-600 hover:bg-zinc-100\"\n                onClick={handleCopySummary}\n                disabled={!exportSummaryText}\n              >\n                <Copy className=\"h-3.5 w-3.5\" />\n                Copiar texto\n              </Button>\n            </div>\n\n            {exportError ? (\n              <p className=\"mt-2 text-xs text-red-600\">{exportError}</p>\n            ) : null}\n            {exportSummaryText ? (\n              <p className=\"mt-2 text-xs text-emerald-700\">Resumo pronto para compartilhamento.</p>\n            ) : null}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction CurrentTermsCard({\n  terms,\n  sourceRound,\n  sourceRoundNumber,\n  onJumpToSourceRound,\n  onCreateFromCurrent,\n}: {\n  terms: NegotiationTermsState | null;\n  sourceRound: NegotiationRoundItem | null;\n  sourceRoundNumber: number | null;\n  onJumpToSourceRound: (roundId: string) => void;\n  onCreateFromCurrent: () => void;\n}) {\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n      <div className=\"space-y-1\">\n        <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Termos vigentes</h3>\n        <p className=\"text-xs text-zinc-500\">\n          Fonte de verdade para resumo e decisão de fechamento.\n        </p>\n      </div>\n\n      {!terms || !sourceRound ? (\n        <div className=\"mt-4 rounded-xl border border-dashed border-zinc-200 bg-zinc-50 p-3\">\n          <p className=\"text-xs text-zinc-600\">\n            Ainda não existem termos vigentes. Defina uma rodada do time como vigente.\n          </p>\n        </div>\n      ) : (\n        <div className=\"mt-4 space-y-3\">\n          <div className=\"grid grid-cols-2 gap-2\">\n            <StatCard label=\"Mensal\" value={formatCurrency(terms.monthlyValue)} />\n            <StatCard label=\"Setup\" value={formatCurrency(terms.setupValue)} />\n            <StatCard label=\"Prazo\" value={`${terms.termMonths} meses`} />\n            <StatCard label=\"Total\" value={formatCurrency(terms.totalValue)} />\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2 text-[11px]\">\n            <button\n              type=\"button\"\n              onClick={() => onJumpToSourceRound(sourceRound.id)}\n              className=\"inline-flex h-6 items-center rounded-full border border-zinc-200 bg-zinc-100 px-2 text-[11px] font-medium text-zinc-700 transition-colors hover:border-brand/30 hover:text-brand\"\n            >\n              Rodada fonte: {sourceRoundNumber ? `Rodada ${sourceRoundNumber}` : sourceRound.id}\n            </button>\n            <Badge className={cn(\"border\", lifecycleMeta[sourceRound.lifecycleStatus].chipClass)}>\n              {lifecycleMeta[sourceRound.lifecycleStatus].label}\n            </Badge>\n            <Badge className={cn(\"border\", visibilityMeta[sourceRound.visibility].chipClass)}>\n              {visibilityMeta[sourceRound.visibility].label}\n            </Badge>\n          </div>\n\n          <p className=\"text-[11px] text-zinc-500\">\n            Atualizado por {terms.updatedBy} em {toDateTimeLabel(terms.updatedAt)}.\n          </p>\n        </div>\n      )}\n\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        size=\"sm\"\n        className=\"mt-4 h-8 w-full gap-1.5 rounded-full text-xs\"\n        onClick={onCreateFromCurrent}\n      >\n        <Plus className=\"h-3.5 w-3.5\" />\n        Nova rodada baseada na última oferta\n      </Button>\n    </div>\n  );\n}\n\nfunction StatCard({ label, value }: { label: string; value: string }) {\n  return (\n    <div className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-2.5\">\n      <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">{label}</p>\n      <p className=\"mt-1 text-sm font-semibold text-zinc-900\">{value}</p>\n    </div>\n  );\n}\n\nfunction NegotiationComparisonCard({\n  currentOfferRound,\n  lastClientCounter,\n}: {\n  currentOfferRound: NegotiationRoundItem | null;\n  lastClientCounter: NegotiationRoundItem | null;\n}) {\n  const deltaMonthly =\n    (lastClientCounter?.monthlyValue ?? 0) - (currentOfferRound?.monthlyValue ?? 0);\n  const deltaSetup =\n    (lastClientCounter?.setupValue ?? 0) - (currentOfferRound?.setupValue ?? 0);\n\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n      <div className=\"flex items-center gap-2\">\n        <GitCompareArrows className=\"h-4 w-4 text-zinc-500\" />\n        <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Comparador de negociação</h3>\n      </div>\n\n      <div className=\"mt-3 space-y-2\">\n        <div className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-3\">\n          <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">\n            Nossa última oferta\n          </p>\n          <p className=\"mt-1 text-sm font-semibold text-zinc-900\">\n            {currentOfferRound ? formatCurrency(currentOfferRound.monthlyValue ?? 0) : \"--\"} /mês\n          </p>\n          <p className=\"text-[11px] text-zinc-500\">\n            Setup {currentOfferRound ? formatCurrency(currentOfferRound.setupValue ?? 0) : \"--\"}\n          </p>\n        </div>\n\n        <div className=\"rounded-xl border border-amber-200 bg-amber-50/70 p-3\">\n          <p className=\"text-[10px] font-semibold uppercase tracking-wide text-amber-700\">\n            Última contra proposta do cliente\n          </p>\n          <p className=\"mt-1 text-sm font-semibold text-amber-900\">\n            {lastClientCounter ? formatCurrency(lastClientCounter.monthlyValue ?? 0) : \"--\"} /mês\n          </p>\n          <p className=\"text-[11px] text-amber-700\">\n            Setup {lastClientCounter ? formatCurrency(lastClientCounter.setupValue ?? 0) : \"--\"}\n          </p>\n        </div>\n      </div>\n\n      {currentOfferRound && lastClientCounter ? (\n        <div className=\"mt-3 grid grid-cols-2 gap-2\">\n          <div className=\"rounded-xl border border-zinc-200 bg-white p-2.5\">\n            <p className=\"text-[10px] uppercase tracking-wide text-zinc-500\">Delta mensal</p>\n            <p className={cn(\"mt-1 text-sm font-semibold\", deltaMonthly <= 0 ? \"text-emerald-700\" : \"text-amber-700\")}>\n              {deltaMonthly > 0 ? \"+\" : \"\"}\n              {formatCurrency(deltaMonthly)}\n            </p>\n          </div>\n          <div className=\"rounded-xl border border-zinc-200 bg-white p-2.5\">\n            <p className=\"text-[10px] uppercase tracking-wide text-zinc-500\">Delta setup</p>\n            <p className={cn(\"mt-1 text-sm font-semibold\", deltaSetup <= 0 ? \"text-emerald-700\" : \"text-amber-700\")}>\n              {deltaSetup > 0 ? \"+\" : \"\"}\n              {formatCurrency(deltaSetup)}\n            </p>\n          </div>\n        </div>\n      ) : (\n        <p className=\"mt-3 text-xs text-zinc-500\">\n          Registre ao menos uma proposta do time e uma contra proposta do cliente para comparar.\n        </p>\n      )}\n    </div>\n  );\n}\n\nfunction NextStepCard({\n  draft,\n  saveState,\n  errorMessage,\n  onChange,\n  onSave,\n  highlighted,\n}: {\n  draft: NextStepDraft;\n  saveState: \"idle\" | \"saving\" | \"saved\" | \"error\";\n  errorMessage: string | null;\n  onChange: (draft: NextStepDraft) => void;\n  onSave: () => void;\n  highlighted: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        \"rounded-2xl border border-zinc-200 bg-white p-4 transition-all duration-200\",\n        highlighted && \"ring-2 ring-brand/30\",\n      )}\n      data-next-step-card=\"true\"\n    >\n      <div className=\"flex items-center gap-2\">\n        <CalendarClock className=\"h-4 w-4 text-zinc-500\" />\n        <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Próximo passo</h3>\n      </div>\n      <p className=\"mt-1 text-xs text-zinc-500\">\n        Defina ação, data, canal e responsável para manter a negociação no ritmo.\n      </p>\n\n      <div className=\"mt-3 space-y-3\">\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Ação\n          </Label>\n          <Input\n            value={draft.action}\n            onChange={(event) => onChange({ ...draft, action: event.target.value })}\n            className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n            placeholder=\"Ex.: Ligar para validar objeção de setup\"\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-2\">\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Data\n            </Label>\n            <Input\n              type=\"date\"\n              value={draft.dueAt}\n              onChange={(event) => onChange({ ...draft, dueAt: event.target.value })}\n              className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n            />\n          </div>\n\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Canal\n            </Label>\n            <Select\n              value={draft.channel}\n              onValueChange={(value) =>\n                onChange({ ...draft, channel: value as NextStepDraft[\"channel\"] })\n              }\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {channelOptions.map((channel) => (\n                  <SelectItem key={channel.id} value={channel.id}>\n                    {channel.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Responsável\n          </Label>\n          <Select\n            value={draft.ownerId}\n            onValueChange={(value) => onChange({ ...draft, ownerId: value })}\n          >\n            <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {TEAM_OWNERS.map((owner) => (\n                <SelectItem key={owner.id} value={owner.id}>\n                  {owner.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          className=\"h-8 w-full rounded-full bg-zinc-900 text-xs text-white hover:bg-zinc-800\"\n          onClick={onSave}\n          disabled={saveState === \"saving\"}\n        >\n          {saveState === \"saving\" ? (\n            <>\n              <Loader2 className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" />\n              Salvando...\n            </>\n          ) : (\n            \"Salvar próximo passo\"\n          )}\n        </Button>\n\n        {saveState === \"saved\" ? (\n          <p className=\"text-xs text-emerald-700\">Próximo passo salvo.</p>\n        ) : null}\n        {saveState === \"error\" && errorMessage ? (\n          <p className=\"text-xs text-red-600\">{errorMessage}</p>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n\nfunction NegotiationExecutionCard({\n  hasRounds,\n  hasCurrentTerms,\n  sourceRound,\n  hasClientCounter,\n  nextStep,\n  onCreateRound,\n  onExport,\n  onRegisterClientReturn,\n  onFocusNextStep,\n  isExporting,\n}: {\n  hasRounds: boolean;\n  hasCurrentTerms: boolean;\n  sourceRound: NegotiationRoundItem | null;\n  hasClientCounter: boolean;\n  nextStep: NextStepDraft;\n  onCreateRound: () => void;\n  onExport: () => void;\n  onRegisterClientReturn: () => void;\n  onFocusNextStep: () => void;\n  isExporting: boolean;\n}) {\n  const nextStepReady = nextStep.action.trim().length >= 4 && Boolean(nextStep.dueAt);\n  const dueAtDate = nextStep.dueAt ? new Date(`${nextStep.dueAt}T00:00:00`) : null;\n  const dueAtLabel =\n    dueAtDate && !Number.isNaN(dueAtDate.getTime())\n      ? format(dueAtDate, \"dd MMM\", { locale: ptBR })\n      : \"Sem data\";\n  const sourceSent =\n    sourceRound?.visibility === \"client\" &&\n    (sourceRound.lifecycleStatus === \"sent\" ||\n      sourceRound.lifecycleStatus === \"awaiting\" ||\n      sourceRound.lifecycleStatus === \"accepted\");\n\n  const checklistItems = [\n    {\n      id: \"terms\",\n      label: \"Termos vigentes definidos\",\n      done: hasCurrentTerms,\n    },\n    {\n      id: \"source\",\n      label: \"Rodada vigente enviada ao cliente\",\n      done: sourceSent,\n    },\n    {\n      id: \"counter\",\n      label: \"Retorno do cliente registrado\",\n      done: hasClientCounter,\n    },\n    {\n      id: \"next-step\",\n      label: \"Próximo passo com data\",\n      done: nextStepReady,\n    },\n  ];\n\n  return (\n    <section className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n      <div className=\"flex flex-wrap items-start justify-between gap-2\">\n        <div>\n          <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Execução da negociação</h3>\n          <p className=\"mt-1 text-xs text-zinc-500\">\n            Fechamento visual da timeline com checklist e ações rápidas da rodada vigente.\n          </p>\n        </div>\n        {!hasRounds ? (\n          <Badge className=\"border-zinc-200 bg-zinc-100 text-[10px] text-zinc-600\">Sem rodadas</Badge>\n        ) : null}\n      </div>\n\n      <div className=\"mt-3 rounded-xl border border-zinc-200 bg-zinc-50/80 p-3\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <p className=\"text-xs font-medium text-zinc-800\">Próximo passo</p>\n          <button\n            type=\"button\"\n            className=\"text-[11px] font-medium text-brand transition-colors hover:text-brand/80\"\n            onClick={onFocusNextStep}\n          >\n            Editar\n          </button>\n        </div>\n        <p className=\"mt-1 text-xs text-zinc-600\">\n          {nextStepReady\n            ? `${nextStep.action} · ${dueAtLabel} · ${\n                channelOptions.find((channel) => channel.id === nextStep.channel)?.label ?? \"Canal\"\n              }`\n            : \"Defina ação, data e canal para não perder o timing da negociação.\"}\n        </p>\n      </div>\n\n      <div className=\"mt-3 grid gap-2 sm:grid-cols-2\">\n        {checklistItems.map((item) => (\n          <div\n            key={item.id}\n            className={cn(\n              \"flex items-center gap-2 rounded-lg border px-2.5 py-2\",\n              item.done\n                ? \"border-emerald-200 bg-emerald-50 text-emerald-700\"\n                : \"border-zinc-200 bg-zinc-50 text-zinc-600\",\n            )}\n          >\n            {item.done ? (\n              <CheckCircle2 className=\"h-3.5 w-3.5\" />\n            ) : (\n              <Clock3 className=\"h-3.5 w-3.5\" />\n            )}\n            <span className=\"text-[11px] font-medium\">{item.label}</span>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"mt-3 flex flex-wrap items-center gap-2\">\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          className=\"h-8 rounded-full bg-zinc-900 px-3 text-xs text-white hover:bg-zinc-800\"\n          onClick={onCreateRound}\n        >\n          <Plus className=\"mr-1.5 h-3.5 w-3.5\" />\n          Nova rodada\n        </Button>\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          variant=\"outline\"\n          className=\"h-8 rounded-full px-3 text-xs\"\n          onClick={onRegisterClientReturn}\n        >\n          Registrar retorno do cliente\n        </Button>\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          variant=\"outline\"\n          className=\"h-8 rounded-full px-3 text-xs\"\n          onClick={onExport}\n          disabled={isExporting}\n        >\n          {isExporting ? <Loader2 className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" /> : <Download className=\"mr-1.5 h-3.5 w-3.5\" />}\n          Exportar resumo\n        </Button>\n      </div>\n    </section>\n  );\n}\n\nfunction NegotiationRoundCard({\n  round,\n  displayIndex,\n  isCurrentTerms,\n  isLast,\n  isHighlighted,\n  loadingAction,\n  onEdit,\n  onDelete,\n  onSend,\n  onAwaiting,\n  onAccept,\n  onReject,\n  onSetCurrent,\n  onCreateFromRound,\n}: {\n  round: NegotiationRoundItem;\n  displayIndex: number;\n  isCurrentTerms: boolean;\n  isLast: boolean;\n  isHighlighted: boolean;\n  loadingAction: RowAction | null;\n  onEdit: (round: NegotiationRoundItem) => void;\n  onDelete: (round: NegotiationRoundItem) => void;\n  onSend: (round: NegotiationRoundItem) => void;\n  onAwaiting: (round: NegotiationRoundItem) => void;\n  onAccept: (round: NegotiationRoundItem) => void;\n  onReject: (round: NegotiationRoundItem) => void;\n  onSetCurrent: (round: NegotiationRoundItem) => void;\n  onCreateFromRound: (round: NegotiationRoundItem) => void;\n}) {\n  const [expanded, setExpanded] = useState(isLast);\n  const typeMeta = roundTypeMeta[round.type];\n  const TypeIcon = typeMeta.icon;\n\n  const canSend = isTeamOfferCandidate(round) && round.lifecycleStatus === \"draft\";\n  const canAwaiting = round.lifecycleStatus === \"sent\";\n  const canAccept = round.lifecycleStatus === \"sent\" || round.lifecycleStatus === \"awaiting\";\n  const canReject = round.lifecycleStatus === \"sent\" || round.lifecycleStatus === \"awaiting\";\n  const canSetCurrent = isTeamOfferCandidate(round) && round.lifecycleStatus !== \"draft\";\n  const canEdit = isRoundEditable(round);\n  const canDelete = isRoundDeletable(round);\n\n  return (\n    <div className=\"relative pl-6\" data-round-anchor={round.id}>\n      <div\n        className={cn(\n          \"absolute left-3 top-5 h-6 w-6 -translate-x-1/2 rounded-full border-2 bg-white\",\n          isCurrentTerms ? \"border-brand\" : \"border-zinc-300\",\n        )}\n      >\n        <div\n          className={cn(\n            \"absolute left-1/2 top-1/2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full\",\n            isCurrentTerms ? \"bg-brand\" : \"bg-zinc-300\",\n          )}\n        />\n      </div>\n\n      <motion.div\n        layout\n        className={cn(\n          \"rounded-xl border bg-white shadow-sm transition-all duration-200\",\n          expanded && \"ring-1 ring-zinc-200\",\n          isHighlighted && \"border-brand/50 ring-2 ring-brand/20\",\n        )}\n      >\n        <button\n          type=\"button\"\n          className=\"flex w-full items-center gap-3 p-3 text-left\"\n          onClick={() => setExpanded((prev) => !prev)}\n        >\n          <div className={cn(\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg border\", typeMeta.badgeClass)}>\n            <TypeIcon className=\"h-4 w-4\" />\n          </div>\n\n          <div className=\"min-w-0 flex-1 space-y-1\">\n            <div className=\"flex flex-wrap items-center gap-1.5\">\n              <span className=\"text-[11px] font-bold uppercase tracking-wide text-zinc-500\">\n                Rodada {displayIndex}\n              </span>\n              <Badge className={cn(\"border text-[10px]\", typeMeta.badgeClass)}>{typeMeta.label}</Badge>\n              <Badge className={cn(\"border text-[10px]\", lifecycleMeta[round.lifecycleStatus].chipClass)}>\n                {lifecycleMeta[round.lifecycleStatus].label}\n              </Badge>\n              <Badge className={cn(\"border text-[10px]\", visibilityMeta[round.visibility].chipClass)}>\n                {visibilityMeta[round.visibility].label}\n              </Badge>\n              {isCurrentTerms ? (\n                <Badge className=\"border-emerald-200 bg-emerald-50 text-[10px] text-emerald-700\">\n                  Fonte dos termos vigentes\n                </Badge>\n              ) : null}\n            </div>\n\n            <div className=\"flex flex-wrap items-center gap-2.5 text-xs text-zinc-600\">\n              <span className=\"font-medium text-zinc-800\">{round.authorName}</span>\n              <span>{formatCurrency(round.monthlyValue ?? 0)} /mês</span>\n              <span>Setup {formatCurrency(round.setupValue ?? 0)}</span>\n              <span className=\"text-zinc-500\">{round.termMonths ?? 12} meses</span>\n            </div>\n            <div className=\"text-[11px] text-zinc-400\">\n              Criada em {toDateTimeLabel(round.createdAt)}\n              {round.sentAt ? ` · Enviada em ${toDateTimeLabel(round.sentAt)}` : \"\"}\n            </div>\n          </div>\n\n          {expanded ? <ChevronUp className=\"h-4 w-4 text-zinc-400\" /> : <ChevronDown className=\"h-4 w-4 text-zinc-400\" />}\n        </button>\n\n        <AnimatePresence>\n          {expanded && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \"auto\" }}\n              exit={{ opacity: 0, height: 0 }}\n              transition={{ duration: 0.16 }}\n              className=\"overflow-hidden\"\n            >\n              <div className=\"space-y-3 px-3 pb-3 pt-0\">\n                <Separator />\n\n                {isTermsRequired(round.type) ? (\n                  <div className=\"grid grid-cols-1 gap-2 sm:grid-cols-2\">\n                    <StatCard label=\"Mensal\" value={formatCurrency(round.monthlyValue ?? 0)} />\n                    <StatCard label=\"Setup\" value={formatCurrency(round.setupValue ?? 0)} />\n                    <StatCard label=\"Prazo\" value={`${round.termMonths ?? 12} meses`} />\n                    <StatCard label=\"Total\" value={formatCurrency(round.totalValue ?? 0)} />\n                  </div>\n                ) : (\n                  <div className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-3 text-xs text-zinc-600\">\n                    Ajuste interno sem alteração direta de termos vigentes.\n                  </div>\n                )}\n\n                {round.conditions.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">Condições</p>\n                    <div className=\"flex flex-wrap gap-1.5\">\n                      {round.conditions.slice(0, 3).map((condition) => (\n                        <Badge\n                          key={`${round.id}-${condition}`}\n                          className=\"border-zinc-200 bg-zinc-100 text-[10px] font-normal text-zinc-700\"\n                        >\n                          {condition}\n                        </Badge>\n                      ))}\n                      {round.conditions.length > 3 ? (\n                        <Badge className=\"border-zinc-200 bg-zinc-100 text-[10px] font-normal text-zinc-700\">\n                          +{round.conditions.length - 3}\n                        </Badge>\n                      ) : null}\n                    </div>\n                  </div>\n                ) : null}\n\n                {round.details ? (\n                  <div className=\"space-y-1.5\">\n                    <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">Observações</p>\n                    <p className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-3 text-xs text-zinc-700\">\n                      {round.details}\n                    </p>\n                  </div>\n                ) : null}\n\n                {round.rejectedReason ? (\n                  <p className=\"rounded-lg border border-red-200 bg-red-50 px-2.5 py-2 text-xs text-red-700\">\n                    Motivo da rejeição: {round.rejectedReason}\n                  </p>\n                ) : null}\n\n                <div className=\"flex flex-wrap items-center gap-1.5\">\n                  <ActionButton\n                    label=\"Marcar enviada\"\n                    icon={Send}\n                    visible={canSend}\n                    loading={loadingAction === \"send\"}\n                    onClick={() => onSend(round)}\n                  />\n                  <ActionButton\n                    label=\"Aguardando\"\n                    icon={Clock3}\n                    visible={canAwaiting}\n                    loading={loadingAction === \"awaiting\"}\n                    onClick={() => onAwaiting(round)}\n                  />\n                  <ActionButton\n                    label=\"Aceita\"\n                    icon={CheckCircle2}\n                    visible={canAccept}\n                    loading={loadingAction === \"accept\"}\n                    onClick={() => onAccept(round)}\n                  />\n                  <ActionButton\n                    label=\"Rejeitar\"\n                    icon={XCircle}\n                    visible={canReject}\n                    loading={loadingAction === \"reject\"}\n                    onClick={() => onReject(round)}\n                  />\n                  <ActionButton\n                    label=\"Definir vigente\"\n                    icon={BadgeCheck}\n                    visible={canSetCurrent && !isCurrentTerms}\n                    loading={loadingAction === \"set-current\"}\n                    onClick={() => onSetCurrent(round)}\n                  />\n                  <ActionButton\n                    label=\"Nova rodada\"\n                    icon={Plus}\n                    visible\n                    loading={false}\n                    onClick={() => onCreateFromRound(round)}\n                  />\n                  <ActionButton\n                    label=\"Editar\"\n                    icon={Pencil}\n                    visible={canEdit}\n                    loading={loadingAction === \"save-edit\"}\n                    onClick={() => onEdit(round)}\n                  />\n                  <ActionButton\n                    label=\"Excluir\"\n                    icon={Trash2}\n                    visible={canDelete}\n                    loading={loadingAction === \"delete\"}\n                    onClick={() => onDelete(round)}\n                  />\n                </div>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n    </div>\n  );\n}\n\nfunction ActionButton({\n  label,\n  icon: Icon,\n  visible,\n  loading,\n  onClick,\n}: {\n  label: string;\n  icon: typeof Send;\n  visible: boolean;\n  loading: boolean;\n  onClick: () => void;\n}) {\n  if (!visible) return null;\n\n  return (\n    <Button\n      type=\"button\"\n      size=\"sm\"\n      variant=\"outline\"\n      className=\"h-7 gap-1.5 rounded-full px-2.5 text-[11px]\"\n      onClick={onClick}\n      disabled={loading}\n    >\n      {loading ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <Icon className=\"h-3.5 w-3.5\" />}\n      {label}\n    </Button>\n  );\n}\n\nfunction EmptyState({ onStart }: { onStart: () => void }) {\n  return (\n    <div className=\"rounded-2xl border border-dashed border-zinc-200 bg-zinc-50/70 p-8 text-center\">\n      <div className=\"mx-auto flex h-11 w-11 items-center justify-center rounded-full bg-zinc-100 text-zinc-500\">\n        <Handshake className=\"h-5 w-5\" />\n      </div>\n      <h3 className=\"mt-3 font-heading text-base font-semibold text-zinc-900\">\n        Nenhuma rodada registrada\n      </h3>\n      <p className=\"mt-1 text-sm text-zinc-500\">\n        Registre a primeira rodada para iniciar os termos e o fluxo de decisão.\n      </p>\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        className=\"mt-4 h-8 rounded-full text-xs\"\n        onClick={onStart}\n      >\n        <Plus className=\"mr-1.5 h-3.5 w-3.5\" />\n        Registrar primeira rodada\n      </Button>\n    </div>\n  );\n}\n\nfunction NegotiationRoundForm({\n  mode,\n  seed,\n  isSaving,\n  errorMessage,\n  onCancel,\n  onSave,\n}: {\n  mode: \"create\" | \"edit\";\n  seed: RoundFormSeed;\n  isSaving: boolean;\n  errorMessage: string | null;\n  onCancel: () => void;\n  onSave: (payload: RoundFormPayload) => Promise<void> | void;\n}) {\n  const [draft, setDraft] = useState<RoundFormSeed>(seed);\n  const [fieldError, setFieldError] = useState<string | null>(null);\n\n  const requiresTerms = isTermsRequired(draft.type);\n  const isInternal = draft.type === \"internal\" || draft.visibility === \"internal\";\n\n  const submit = async (event: React.FormEvent) => {\n    event.preventDefault();\n    setFieldError(null);\n\n    if (requiresTerms) {\n      const monthly = toInputNumber(draft.monthlyValue);\n      const setup = toInputNumber(draft.setupValue);\n      const term = toInputNumber(draft.termMonths);\n\n      if (monthly < 0 || monthly > 999999) {\n        setFieldError(\"Valor mensal inválido.\");\n        return;\n      }\n      if (setup < 0 || setup > 999999) {\n        setFieldError(\"Valor de setup inválido.\");\n        return;\n      }\n      if (term < 1 || term > 36) {\n        setFieldError(\"Prazo deve estar entre 1 e 36 meses.\");\n        return;\n      }\n    }\n\n    if (\n      draft.lifecycleStatus === \"rejected\" &&\n      draft.rejectedReason.trim().length < 5\n    ) {\n      setFieldError(\"Informe motivo de rejeição com pelo menos 5 caracteres.\");\n      return;\n    }\n\n    if (\n      (draft.lifecycleStatus === \"sent\" || draft.lifecycleStatus === \"awaiting\") &&\n      draft.visibility === \"internal\"\n    ) {\n      setFieldError(\"Rodadas internas não podem ser marcadas como enviadas.\");\n      return;\n    }\n\n    if (draft.notes.trim().length > 0 && draft.notes.trim().length < MIN_NOTES_LENGTH) {\n      setFieldError(`Observações devem ter no mínimo ${MIN_NOTES_LENGTH} caracteres.`);\n      return;\n    }\n\n    const payload: RoundFormPayload = {\n      type: draft.type,\n      actorRole: draft.actorRole,\n      visibility: draft.visibility,\n      lifecycleStatus: draft.lifecycleStatus,\n      monthlyValue: requiresTerms ? toInputNumber(draft.monthlyValue) : 0,\n      setupValue: requiresTerms ? toInputNumber(draft.setupValue) : 0,\n      termMonths: requiresTerms ? toInputNumber(draft.termMonths) : 12,\n      notes: draft.notes.trim(),\n      conditions: draft.conditionsText\n        .split(\",\")\n        .map((condition) => condition.trim())\n        .filter(Boolean),\n      rejectedReason: draft.lifecycleStatus === \"rejected\" ? draft.rejectedReason.trim() : undefined,\n    };\n\n    await onSave(payload);\n  };\n\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-4 shadow-sm\">\n      <div className=\"mb-3 flex items-center justify-between\">\n        <div>\n          <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">\n            {mode === \"create\" ? \"Nova rodada\" : \"Editar rodada\"}\n          </h3>\n          <p className=\"text-xs text-zinc-500\">\n            Defina tipo, status, termos e condições com validação antes de salvar.\n          </p>\n        </div>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-7 rounded-full px-2.5 text-xs\"\n          onClick={onCancel}\n        >\n          Cancelar\n        </Button>\n      </div>\n\n      <form className=\"space-y-3\" onSubmit={submit}>\n        <div className=\"grid grid-cols-1 gap-3 md:grid-cols-2\">\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Tipo da rodada\n            </Label>\n            <Select\n              value={draft.type}\n              onValueChange={(value) => {\n                const nextType = value as NegotiationType;\n                setDraft((prev) => ({\n                  ...prev,\n                  type: nextType,\n                  actorRole: nextType === \"counter\" ? \"client\" : \"team\",\n                  visibility: nextType === \"internal\" ? \"internal\" : prev.visibility,\n                  lifecycleStatus:\n                    nextType === \"internal\" ? \"draft\" : prev.lifecycleStatus,\n                }));\n              }}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {roundTypeOptions.map((option) => (\n                  <SelectItem key={option.id} value={option.id}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Status operacional\n            </Label>\n            <Select\n              value={draft.lifecycleStatus}\n              onValueChange={(value) =>\n                setDraft((prev) => ({\n                  ...prev,\n                  lifecycleStatus: value as RoundLifecycleStatus,\n                }))\n              }\n              disabled={isInternal}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {lifecycleOptions.map((option) => (\n                  <SelectItem key={option.id} value={option.id}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 gap-3 md:grid-cols-2\">\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Origem\n            </Label>\n            <Select\n              value={draft.actorRole}\n              onValueChange={(value) =>\n                setDraft((prev) => ({\n                  ...prev,\n                  actorRole: value as RoundActorRole,\n                }))\n              }\n              disabled={draft.type === \"counter\"}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"team\">Time interno</SelectItem>\n                <SelectItem value=\"client\">Cliente</SelectItem>\n                <SelectItem value=\"system\">Sistema</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Visibilidade\n            </Label>\n            <Select\n              value={draft.visibility}\n              onValueChange={(value) =>\n                setDraft((prev) => ({\n                  ...prev,\n                  visibility: value as RoundVisibility,\n                  lifecycleStatus:\n                    value === \"internal\" ? \"draft\" : prev.lifecycleStatus,\n                }))\n              }\n              disabled={draft.type === \"internal\"}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"client\">Visível ao cliente</SelectItem>\n                <SelectItem value=\"internal\">Interna</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        {requiresTerms ? (\n          <div className=\"grid grid-cols-1 gap-3 md:grid-cols-3\">\n            <div>\n              <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n                Mensal\n              </Label>\n              <Input\n                type=\"number\"\n                min={0}\n                max={999999}\n                value={draft.monthlyValue}\n                onChange={(event) =>\n                  setDraft((prev) => ({ ...prev, monthlyValue: event.target.value }))\n                }\n                className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n                Setup\n              </Label>\n              <Input\n                type=\"number\"\n                min={0}\n                max={999999}\n                value={draft.setupValue}\n                onChange={(event) =>\n                  setDraft((prev) => ({ ...prev, setupValue: event.target.value }))\n                }\n                className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n                Prazo (meses)\n              </Label>\n              <Input\n                type=\"number\"\n                min={1}\n                max={36}\n                value={draft.termMonths}\n                onChange={(event) =>\n                  setDraft((prev) => ({ ...prev, termMonths: event.target.value }))\n                }\n                className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n                placeholder=\"12\"\n              />\n            </div>\n          </div>\n        ) : null}\n\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Condições (separe por vírgula)\n          </Label>\n          <Input\n            value={draft.conditionsText}\n            onChange={(event) =>\n              setDraft((prev) => ({ ...prev, conditionsText: event.target.value }))\n            }\n            className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n            placeholder=\"Ex.: Setup reduzido, carência de 15 dias\"\n          />\n        </div>\n\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Observações\n          </Label>\n          <Textarea\n            value={draft.notes}\n            onChange={(event) =>\n              setDraft((prev) => ({ ...prev, notes: event.target.value }))\n            }\n            className=\"mt-1 min-h-[86px] resize-none rounded-lg border-zinc-200 text-xs\"\n            placeholder=\"Contexto da rodada e próximos pontos de negociação...\"\n          />\n        </div>\n\n        {draft.lifecycleStatus === \"rejected\" ? (\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Motivo da rejeição\n            </Label>\n            <Input\n              value={draft.rejectedReason}\n              onChange={(event) =>\n                setDraft((prev) => ({ ...prev, rejectedReason: event.target.value }))\n              }\n              className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n              placeholder=\"Ex.: Cliente não aprovou condição de setup\"\n            />\n          </div>\n        ) : null}\n\n        {fieldError ? (\n          <p className=\"text-xs text-red-600\">{fieldError}</p>\n        ) : null}\n        {errorMessage ? <p className=\"text-xs text-red-600\">{errorMessage}</p> : null}\n\n        <div className=\"flex justify-end gap-2 pt-1\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-8 rounded-full px-3 text-xs\"\n            onClick={onCancel}\n          >\n            Fechar\n          </Button>\n          <Button\n            type=\"submit\"\n            size=\"sm\"\n            className=\"h-8 rounded-full bg-zinc-900 px-3 text-xs text-white hover:bg-zinc-800\"\n            disabled={isSaving}\n          >\n            {isSaving ? (\n              <>\n                <Loader2 className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" />\n                Salvando...\n              </>\n            ) : mode === \"create\" ? (\n              \"Salvar rodada\"\n            ) : (\n              \"Salvar alterações\"\n            )}\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}