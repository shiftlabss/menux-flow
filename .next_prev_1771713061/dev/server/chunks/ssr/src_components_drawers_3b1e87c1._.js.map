{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/components/drawers/stage-fields/dynamic-field-renderer.tsx"],"sourcesContent":["\"use client\";\n\nimport { cn } from \"@/lib/utils\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Check, Loader2, X } from \"lucide-react\";\nimport type { StageField, StageFieldValue } from \"@/lib/mock-stage-fields\";\n\ntype FieldSaveState = \"idle\" | \"saving\" | \"saved\" | \"error\";\n\ninterface DynamicFieldRendererProps {\n  field: StageField;\n  value: StageFieldValue;\n  onChange: (fieldId: string, value: StageFieldValue) => void;\n  disabled?: boolean;\n  error?: string;\n  saveState?: FieldSaveState;\n}\n\nexport function DynamicFieldRenderer({\n  field,\n  value,\n  onChange,\n  disabled = false,\n  error,\n  saveState = \"idle\",\n}: DynamicFieldRendererProps) {\n  const handleChange = (val: StageFieldValue) => {\n    onChange(field.id, val);\n  };\n\n  return (\n    <div>\n      <div className=\"mb-1.5 flex items-center justify-between gap-2\">\n        <Label className=\"font-heading text-[10px] font-bold uppercase tracking-wider text-zinc-400\">\n          {field.label} {field.required && <span className=\"text-red-500\">*</span>}\n        </Label>\n        {saveState === \"saving\" && (\n          <span className=\"inline-flex items-center gap-1 text-[10px] text-zinc-400\">\n            <Loader2 className=\"h-3 w-3 animate-spin\" />\n            Salvando...\n          </span>\n        )}\n        {saveState === \"saved\" && (\n          <span className=\"inline-flex items-center gap-1 text-[10px] text-emerald-600\">\n            <Check className=\"h-3 w-3\" />\n            Salvo\n          </span>\n        )}\n        {saveState === \"error\" && (\n          <span className=\"text-[10px] text-red-600\">Falha ao salvar</span>\n        )}\n      </div>\n\n      <div className=\"mt-1.5\">\n        {renderFieldInput(field, value, handleChange, disabled, error)}\n      </div>\n\n      {error && <p className=\"mt-1 text-[10px] text-red-600\">{error}</p>}\n      {!error && field.helperText && (\n        <p className=\"mt-1 text-[9px] text-zinc-400\">{field.helperText}</p>\n      )}\n      {!error && field.description && !field.helperText && (\n        <p className=\"mt-1 text-[9px] text-zinc-400\">{field.description}</p>\n      )}\n    </div>\n  );\n}\n\nfunction renderFieldInput(\n  field: StageField,\n  value: StageFieldValue,\n  onChange: (val: StageFieldValue) => void,\n  disabled: boolean,\n  error?: string,\n) {\n  const errorClasses = error ? \"border-red-300 focus:ring-red-200 focus-visible:ring-red-200\" : \"\";\n  const baseInputClasses = cn(\n    \"h-9 rounded-lg border-zinc-200 font-body text-xs focus:ring-brand/10\",\n    errorClasses,\n  );\n\n  switch (field.type) {\n    case \"select\":\n      return (\n        <Select\n          value={typeof value === \"string\" ? value : \"\"}\n          onValueChange={(val) => onChange(val)}\n          disabled={disabled}\n        >\n          <SelectTrigger className={cn(\"h-9 w-full rounded-lg border-zinc-200 font-body text-xs focus:ring-brand/10\", errorClasses)}>\n            <SelectValue placeholder=\"Selecione...\" />\n          </SelectTrigger>\n          <SelectContent>\n            {field.options?.map((opt) => (\n              <SelectItem key={opt.value} value={opt.value} className=\"text-xs\">\n                {opt.label}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      );\n\n    case \"multiselect\": {\n      const selectedValues = Array.isArray(value) ? value : [];\n      return (\n        <div className=\"space-y-2\">\n          <div className=\"flex flex-wrap gap-1\">\n            {selectedValues.map((val) => {\n              const opt = field.options?.find((o) => o.value === val);\n              return (\n                <Badge\n                  key={val}\n                  variant=\"secondary\"\n                  className=\"gap-1 rounded-full px-2 py-0.5 text-[10px]\"\n                >\n                  {opt?.label || val}\n                  {!disabled && (\n                    <button\n                      type=\"button\"\n                      onClick={() => onChange(selectedValues.filter((v) => v !== val))}\n                      className=\"ml-0.5 hover:text-red-600\"\n                    >\n                      <X className=\"h-2.5 w-2.5\" />\n                    </button>\n                  )}\n                </Badge>\n              );\n            })}\n          </div>\n          <Select\n            value=\"\"\n            onValueChange={(val) => {\n              if (!selectedValues.includes(val)) {\n                onChange([...selectedValues, val]);\n              }\n            }}\n            disabled={disabled}\n          >\n            <SelectTrigger className={cn(\"h-9 w-full rounded-lg border-zinc-200 font-body text-xs focus:ring-brand/10\", errorClasses)}>\n              <SelectValue placeholder=\"Adicionar...\" />\n            </SelectTrigger>\n            <SelectContent>\n              {field.options\n                ?.filter((opt) => !selectedValues.includes(opt.value))\n                .map((opt) => (\n                  <SelectItem key={opt.value} value={opt.value} className=\"text-xs\">\n                    {opt.label}\n                  </SelectItem>\n                ))}\n            </SelectContent>\n          </Select>\n        </div>\n      );\n    }\n\n    case \"textarea\":\n      return (\n        <Textarea\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          className={cn(\n            \"min-h-[86px] resize-none rounded-lg border border-zinc-200 px-3 py-2 text-xs placeholder:text-zinc-400 focus-visible:ring-2 focus-visible:ring-brand/10\",\n            errorClasses,\n          )}\n          placeholder={field.placeholder}\n          disabled={disabled}\n        />\n      );\n\n    case \"boolean\":\n      return (\n        <div className=\"flex items-center gap-2\">\n          <Switch\n            checked={!!value}\n            onCheckedChange={(checked) => onChange(checked)}\n            disabled={disabled}\n          />\n          <span className=\"text-xs text-zinc-600\">{value ? \"Sim\" : \"Não\"}</span>\n        </div>\n      );\n\n    case \"currency\":\n      return (\n        <div className=\"relative\">\n          <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-xs text-zinc-400\">R$</span>\n          <Input\n            type=\"text\"\n            inputMode=\"decimal\"\n            value={value != null ? String(value) : \"\"}\n            onChange={(e) => {\n              const raw = e.target.value.replace(/[^\\d.,]/g, \"\");\n              onChange(raw);\n            }}\n            placeholder={field.placeholder || \"0,00\"}\n            className={cn(baseInputClasses, \"pl-9\")}\n            disabled={disabled}\n          />\n        </div>\n      );\n\n    case \"percentage\":\n      return (\n        <div className=\"relative\">\n          <Input\n            type=\"number\"\n            inputMode=\"decimal\"\n            value={value != null ? String(value) : \"\"}\n            onChange={(e) => onChange(e.target.value ? Number(e.target.value) : null)}\n            placeholder={field.placeholder || \"0\"}\n            className={cn(baseInputClasses, \"pr-8\")}\n            disabled={disabled}\n            min={field.validationRules?.min}\n            max={field.validationRules?.max}\n          />\n          <span className=\"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-zinc-400\">%</span>\n        </div>\n      );\n\n    case \"url\":\n      return (\n        <Input\n          type=\"url\"\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={field.placeholder || \"https://...\"}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"email\":\n      return (\n        <Input\n          type=\"email\"\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={field.placeholder || \"email@exemplo.com\"}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"phone\":\n      return (\n        <Input\n          type=\"tel\"\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={field.placeholder || \"(00) 00000-0000\"}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"date\":\n      return (\n        <Input\n          type=\"date\"\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"time\":\n      return (\n        <Input\n          type=\"time\"\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"datetime\":\n      return (\n        <Input\n          type=\"datetime-local\"\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"integer\":\n      return (\n        <Input\n          type=\"number\"\n          inputMode=\"numeric\"\n          step=\"1\"\n          value={value != null ? String(value) : \"\"}\n          onChange={(e) => onChange(e.target.value ? parseInt(e.target.value, 10) : null)}\n          placeholder={field.placeholder}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"number\":\n      return (\n        <Input\n          type=\"number\"\n          inputMode=\"decimal\"\n          value={value != null ? String(value) : \"\"}\n          onChange={(e) => onChange(e.target.value ? Number(e.target.value) : null)}\n          placeholder={field.placeholder}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    case \"file\":\n      return (\n        <div className=\"flex items-center gap-2\">\n          <Input\n            type=\"file\"\n            onChange={() => onChange(\"arquivo_anexado\")}\n            className={cn(baseInputClasses, \"cursor-pointer file:mr-2 file:rounded-md file:border-0 file:bg-zinc-100 file:px-2 file:py-1 file:text-[10px] file:font-medium file:text-zinc-700\")}\n            disabled={disabled}\n          />\n        </div>\n      );\n\n    case \"user\":\n    case \"contact\":\n      return (\n        <Input\n          type=\"text\"\n          value={typeof value === \"string\" ? value : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={field.placeholder || (field.type === \"user\" ? \"Nome do usuário\" : \"Nome do contato\")}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n\n    default:\n      return (\n        <Input\n          type=\"text\"\n          value={typeof value === \"string\" ? value : value != null ? String(value) : \"\"}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={field.placeholder}\n          className={baseInputClasses}\n          disabled={disabled}\n        />\n      );\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAOA;AAAA;AAAA;AAfA;;;;;;;;;;AA6BO,SAAS,qBAAqB,EACnC,KAAK,EACL,KAAK,EACL,QAAQ,EACR,WAAW,KAAK,EAChB,KAAK,EACL,YAAY,MAAM,EACQ;IAC1B,MAAM,eAAe,CAAC;QACpB,SAAS,MAAM,EAAE,EAAE;IACrB;IAEA,qBACE,8OAAC;;0BACC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,0IAAK;wBAAC,WAAU;;4BACd,MAAM,KAAK;4BAAC;4BAAE,MAAM,QAAQ,kBAAI,8OAAC;gCAAK,WAAU;0CAAe;;;;;;;;;;;;oBAEjE,cAAc,0BACb,8OAAC;wBAAK,WAAU;;0CACd,8OAAC,4NAAO;gCAAC,WAAU;;;;;;4BAAyB;;;;;;;oBAI/C,cAAc,yBACb,8OAAC;wBAAK,WAAU;;0CACd,8OAAC,6MAAK;gCAAC,WAAU;;;;;;4BAAY;;;;;;;oBAIhC,cAAc,yBACb,8OAAC;wBAAK,WAAU;kCAA2B;;;;;;;;;;;;0BAI/C,8OAAC;gBAAI,WAAU;0BACZ,iBAAiB,OAAO,OAAO,cAAc,UAAU;;;;;;YAGzD,uBAAS,8OAAC;gBAAE,WAAU;0BAAiC;;;;;;YACvD,CAAC,SAAS,MAAM,UAAU,kBACzB,8OAAC;gBAAE,WAAU;0BAAiC,MAAM,UAAU;;;;;;YAE/D,CAAC,SAAS,MAAM,WAAW,IAAI,CAAC,MAAM,UAAU,kBAC/C,8OAAC;gBAAE,WAAU;0BAAiC,MAAM,WAAW;;;;;;;;;;;;AAIvE;AAEA,SAAS,iBACP,KAAiB,EACjB,KAAsB,EACtB,QAAwC,EACxC,QAAiB,EACjB,KAAc;IAEd,MAAM,eAAe,QAAQ,iEAAiE;IAC9F,MAAM,mBAAmB,IAAA,yHAAE,EACzB,wEACA;IAGF,OAAQ,MAAM,IAAI;QAChB,KAAK;YACH,qBACE,8OAAC,4IAAM;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,eAAe,CAAC,MAAQ,SAAS;gBACjC,UAAU;;kCAEV,8OAAC,mJAAa;wBAAC,WAAW,IAAA,yHAAE,EAAC,+EAA+E;kCAC1G,cAAA,8OAAC,iJAAW;4BAAC,aAAY;;;;;;;;;;;kCAE3B,8OAAC,mJAAa;kCACX,MAAM,OAAO,EAAE,IAAI,CAAC,oBACnB,8OAAC,gJAAU;gCAAiB,OAAO,IAAI,KAAK;gCAAE,WAAU;0CACrD,IAAI,KAAK;+BADK,IAAI,KAAK;;;;;;;;;;;;;;;;QAQpC,KAAK;YAAe;gBAClB,MAAM,iBAAiB,MAAM,OAAO,CAAC,SAAS,QAAQ,EAAE;gBACxD,qBACE,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAI,WAAU;sCACZ,eAAe,GAAG,CAAC,CAAC;gCACnB,MAAM,MAAM,MAAM,OAAO,EAAE,KAAK,CAAC,IAAM,EAAE,KAAK,KAAK;gCACnD,qBACE,8OAAC,0IAAK;oCAEJ,SAAQ;oCACR,WAAU;;wCAET,KAAK,SAAS;wCACd,CAAC,0BACA,8OAAC;4CACC,MAAK;4CACL,SAAS,IAAM,SAAS,eAAe,MAAM,CAAC,CAAC,IAAM,MAAM;4CAC3D,WAAU;sDAEV,cAAA,8OAAC,iMAAC;gDAAC,WAAU;;;;;;;;;;;;mCAXZ;;;;;4BAgBX;;;;;;sCAEF,8OAAC,4IAAM;4BACL,OAAM;4BACN,eAAe,CAAC;gCACd,IAAI,CAAC,eAAe,QAAQ,CAAC,MAAM;oCACjC,SAAS;2CAAI;wCAAgB;qCAAI;gCACnC;4BACF;4BACA,UAAU;;8CAEV,8OAAC,mJAAa;oCAAC,WAAW,IAAA,yHAAE,EAAC,+EAA+E;8CAC1G,cAAA,8OAAC,iJAAW;wCAAC,aAAY;;;;;;;;;;;8CAE3B,8OAAC,mJAAa;8CACX,MAAM,OAAO,EACV,OAAO,CAAC,MAAQ,CAAC,eAAe,QAAQ,CAAC,IAAI,KAAK,GACnD,IAAI,CAAC,oBACJ,8OAAC,gJAAU;4CAAiB,OAAO,IAAI,KAAK;4CAAE,WAAU;sDACrD,IAAI,KAAK;2CADK,IAAI,KAAK;;;;;;;;;;;;;;;;;;;;;;YAQxC;QAEA,KAAK;YACH,qBACE,8OAAC,gJAAQ;gBACP,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,WAAW,IAAA,yHAAE,EACX,2JACA;gBAEF,aAAa,MAAM,WAAW;gBAC9B,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,4IAAM;wBACL,SAAS,CAAC,CAAC;wBACX,iBAAiB,CAAC,UAAY,SAAS;wBACvC,UAAU;;;;;;kCAEZ,8OAAC;wBAAK,WAAU;kCAAyB,QAAQ,QAAQ;;;;;;;;;;;;QAI/D,KAAK;YACH,qBACE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAK,WAAU;kCAAiE;;;;;;kCACjF,8OAAC,0IAAK;wBACJ,MAAK;wBACL,WAAU;wBACV,OAAO,SAAS,OAAO,OAAO,SAAS;wBACvC,UAAU,CAAC;4BACT,MAAM,MAAM,EAAE,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,YAAY;4BAC/C,SAAS;wBACX;wBACA,aAAa,MAAM,WAAW,IAAI;wBAClC,WAAW,IAAA,yHAAE,EAAC,kBAAkB;wBAChC,UAAU;;;;;;;;;;;;QAKlB,KAAK;YACH,qBACE,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,0IAAK;wBACJ,MAAK;wBACL,WAAU;wBACV,OAAO,SAAS,OAAO,OAAO,SAAS;wBACvC,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK,GAAG,OAAO,EAAE,MAAM,CAAC,KAAK,IAAI;wBACpE,aAAa,MAAM,WAAW,IAAI;wBAClC,WAAW,IAAA,yHAAE,EAAC,kBAAkB;wBAChC,UAAU;wBACV,KAAK,MAAM,eAAe,EAAE;wBAC5B,KAAK,MAAM,eAAe,EAAE;;;;;;kCAE9B,8OAAC;wBAAK,WAAU;kCAAkE;;;;;;;;;;;;QAIxF,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,aAAa,MAAM,WAAW,IAAI;gBAClC,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,aAAa,MAAM,WAAW,IAAI;gBAClC,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,aAAa,MAAM,WAAW,IAAI;gBAClC,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,WAAU;gBACV,MAAK;gBACL,OAAO,SAAS,OAAO,OAAO,SAAS;gBACvC,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK,GAAG,SAAS,EAAE,MAAM,CAAC,KAAK,EAAE,MAAM;gBAC1E,aAAa,MAAM,WAAW;gBAC9B,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,WAAU;gBACV,OAAO,SAAS,OAAO,OAAO,SAAS;gBACvC,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK,GAAG,OAAO,EAAE,MAAM,CAAC,KAAK,IAAI;gBACpE,aAAa,MAAM,WAAW;gBAC9B,WAAW;gBACX,UAAU;;;;;;QAIhB,KAAK;YACH,qBACE,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC,0IAAK;oBACJ,MAAK;oBACL,UAAU,IAAM,SAAS;oBACzB,WAAW,IAAA,yHAAE,EAAC,kBAAkB;oBAChC,UAAU;;;;;;;;;;;QAKlB,KAAK;QACL,KAAK;YACH,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ;gBAC3C,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,aAAa,MAAM,WAAW,IAAI,CAAC,MAAM,IAAI,KAAK,SAAS,oBAAoB,iBAAiB;gBAChG,WAAW;gBACX,UAAU;;;;;;QAIhB;YACE,qBACE,8OAAC,0IAAK;gBACJ,MAAK;gBACL,OAAO,OAAO,UAAU,WAAW,QAAQ,SAAS,OAAO,OAAO,SAAS;gBAC3E,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,aAAa,MAAM,WAAW;gBAC9B,WAAW;gBACX,UAAU;;;;;;IAGlB;AACF"}},
    {"offset": {"line": 547, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/components/drawers/stage-fields/new-field-modal.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useMemo } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  DialogClose,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandEmpty,\n  CommandGroup,\n  CommandInput,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport {\n  Plus,\n  X,\n  Check,\n  ChevronsUpDown,\n  Loader2,\n  Type,\n  Hash,\n  List,\n  Calendar,\n  CheckSquare,\n  AlignLeft,\n  Mail,\n  Phone,\n  Link as LinkIcon,\n  Percent,\n  DollarSign,\n  AlertCircle,\n  Eye,\n  Clock,\n  User,\n  FileText,\n  ToggleLeft,\n  Users\n} from \"lucide-react\";\nimport {\n  fieldTypeLabels,\n  fieldTypeDescriptions,\n  type FieldType,\n  type StageField,\n  type FieldValidationRules,\n} from \"@/lib/mock-stage-fields\";\nimport { DynamicFieldRenderer } from \"./dynamic-field-renderer\";\nimport { cn } from \"@/lib/utils\";\n\ninterface NewFieldModalProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  stageId: string;\n  stageName: string;\n  onSave: (field: Omit<StageField, \"id\" | \"order\" | \"isActive\" | \"stageId\">) => void;\n}\n\nconst typesRequiringOptions: FieldType[] = [\"select\", \"multiselect\"];\n\nconst fieldTypeIcons: Record<FieldType, React.ElementType> = {\n  text: Type,\n  textarea: AlignLeft,\n  number: Hash,\n  integer: Hash,\n  currency: DollarSign,\n  percentage: Percent,\n  url: LinkIcon,\n  email: Mail,\n  phone: Phone,\n  date: Calendar,\n  datetime: Calendar,\n  time: Clock,\n  select: List,\n  multiselect: CheckSquare,\n  boolean: ToggleLeft,\n  user: User,\n  contact: Users,\n  file: FileText,\n};\n\nexport function NewFieldModal({\n  open,\n  onOpenChange,\n  stageId,\n  stageName,\n  onSave,\n}: NewFieldModalProps) {\n  const [label, setLabel] = useState(\"\");\n  const [type, setType] = useState<FieldType>(\"text\");\n  const [openTypePopover, setOpenTypePopover] = useState(false);\n  const [required, setRequired] = useState(false);\n  const [description, setDescription] = useState(\"\");\n  const [placeholder, setPlaceholder] = useState(\"\");\n  const [options, setOptions] = useState<{ label: string; value: string }[]>([]);\n  const [newOptionLabel, setNewOptionLabel] = useState(\"\");\n  const [validationRules, setValidationRules] = useState<FieldValidationRules>({});\n  const [isSaving, setIsSaving] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  const needsOptions = typesRequiringOptions.includes(type);\n\n  const key = useMemo(() => {\n    return label\n      .toLowerCase()\n      .normalize(\"NFD\")\n      .replace(/[\\u0300-\\u036f]/g, \"\")\n      .replace(/[^a-z0-9]+/g, \"_\")\n      .replace(/^_|_$/g, \"\");\n  }, [label]);\n\n  const previewField: StageField = useMemo(() => ({\n    id: \"preview\",\n    stageId,\n    key: key || \"preview\",\n    label: label || \"Nome do campo\",\n    type,\n    required,\n    order: 0,\n    description,\n    placeholder,\n    options: needsOptions ? options : undefined,\n    validationRules: Object.keys(validationRules).length > 0 ? validationRules : undefined,\n    isActive: true,\n  }), [label, type, required, description, placeholder, options, validationRules, stageId, key, needsOptions]);\n\n  const handleAddOption = () => {\n    const trimmed = newOptionLabel.trim();\n    if (!trimmed) return;\n    const value = trimmed\n      .toLowerCase()\n      .normalize(\"NFD\")\n      .replace(/[\\u0300-\\u036f]/g, \"\")\n      .replace(/[^a-z0-9]+/g, \"_\");\n    if (options.some((o) => o.value === value)) return;\n    setOptions([...options, { label: trimmed, value }]);\n    setNewOptionLabel(\"\");\n  };\n\n  const handleRemoveOption = (value: string) => {\n    setOptions(options.filter((o) => o.value !== value));\n  };\n\n  const validate = (): boolean => {\n    const nextErrors: Record<string, string> = {};\n    if (!label.trim()) nextErrors.label = \"Nome do campo é obrigatório.\";\n    if (!type) nextErrors.type = \"Tipo é obrigatório.\";\n    if (needsOptions && options.length === 0) {\n      nextErrors.options = \"Adicione pelo menos uma opção.\";\n    }\n    setErrors(nextErrors);\n    return Object.keys(nextErrors).length === 0;\n  };\n\n  const handleSave = () => {\n    if (!validate()) return;\n    setIsSaving(true);\n\n    // Simulate async save\n    setTimeout(() => {\n      onSave({\n        key,\n        label: label.trim(),\n        type,\n        required,\n        description: description.trim() || undefined,\n        placeholder: placeholder.trim() || undefined,\n        helperText: description.trim() || undefined,\n        options: needsOptions ? options : undefined,\n      });\n      resetForm();\n      setIsSaving(false);\n    }, 500);\n  };\n\n  const resetForm = () => {\n    setLabel(\"\");\n    setType(\"text\");\n    setRequired(false);\n    setDescription(\"\");\n    setPlaceholder(\"\");\n    setOptions([]);\n    setNewOptionLabel(\"\");\n    setValidationRules({});\n    setErrors({});\n  };\n\n  const handleClose = (open: boolean) => {\n    if (!open) resetForm();\n    onOpenChange(open);\n  };\n\n  const TypeIcon = fieldTypeIcons[type] || Type;\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"max-h-[90vh] w-full sm:max-w-4xl flex-col gap-0 p-0 overflow-hidden bg-white border-zinc-200/50 shadow-2xl sm:rounded-2xl\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between border-b border-zinc-100 bg-white/50 px-6 py-4 backdrop-blur-sm\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex h-10 w-10 items-center justify-center rounded-xl bg-brand/5 border border-brand/10 text-brand shadow-sm\">\n              <Plus className=\"h-5 w-5\" />\n            </div>\n            <div>\n              <DialogTitle className=\"text-base font-semibold text-zinc-900\">\n                Novo Campo Personalizado\n              </DialogTitle>\n              <p className=\"text-xs text-zinc-500\">\n                Adicionando em <span className=\"font-medium text-zinc-700\">{stageName}</span>\n              </p>\n            </div>\n          </div>\n          <DialogClose asChild>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 text-zinc-400 hover:text-zinc-600\">\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </DialogClose>\n        </div>\n\n        <div className=\"flex flex-1 overflow-hidden\">\n          {/* Main Form Content - Scrollable */}\n          <div className=\"flex-1 overflow-y-auto p-6 lg:p-10 scrollbar-thin scrollbar-thumb-zinc-200 scrollbar-track-transparent\">\n            <div className=\"space-y-10 max-w-2xl mx-auto\">\n              \n              {/* Informações Básicas Section */}\n              <section className=\"space-y-6\">\n                <div>\n                  <h3 className=\"text-base font-semibold text-zinc-900\">Informações Básicas</h3>\n                  <p className=\"text-sm text-zinc-500 mt-0.5\">Defina o nome principal e o formato de dados que este campo irá receber no card.</p>\n                </div>\n\n                <div className=\"space-y-6\">\n                  {/* Nome do Campo */}\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-sm font-semibold text-zinc-900 flex items-center gap-1.5\">\n                      Nome do Campo <span className=\"text-red-500 text-xs\">*</span>\n                    </Label>\n                    <Input\n                      value={label}\n                      onChange={(e) => {\n                        setLabel(e.target.value);\n                        if (errors.label) setErrors((prev) => { const n = { ...prev }; delete n.label; return n; });\n                      }}\n                      placeholder=\"Ex: Data de follow-up\"\n                      className={cn(\n                        \"h-10 bg-white transition-all hover:bg-zinc-50 focus:bg-white text-sm shadow-sm\",\n                        errors.label ? \"border-red-300 focus-visible:ring-red-100\" : \"border-zinc-200 focus-visible:ring-brand/15\"\n                      )}\n                    />\n                    {errors.label ? (\n                      <p className=\"flex items-center gap-1.5 text-[11px] font-medium text-red-600 mt-1\">\n                        <AlertCircle className=\"h-3.5 w-3.5\" /> {errors.label}\n                      </p>\n                    ) : (\n                      key && <p className=\"text-[11px] text-zinc-400 font-mono mt-1\">ID interno: {key}</p>\n                    )}\n                  </div>\n\n                  {/* Tipo de Dado */}\n                  <div className=\"space-y-2\">\n                    <Label className=\"text-sm font-semibold text-zinc-900 flex items-center gap-1.5\">\n                      Tipo de Dado <span className=\"text-red-500 text-xs\">*</span>\n                    </Label>\n                    <Popover open={openTypePopover} onOpenChange={setOpenTypePopover}>\n                      <PopoverTrigger asChild>\n                        <Button\n                          variant=\"outline\"\n                          role=\"combobox\"\n                          aria-expanded={openTypePopover}\n                          className=\"w-full justify-between h-auto py-2.5 px-3.5 bg-white border-zinc-200 focus:ring-brand/15 transition-all hover:bg-zinc-50 hover:border-zinc-300 font-normal shadow-sm group\"\n                        >\n                          <div className=\"flex items-center gap-3 text-left\">\n                            <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-zinc-50 border border-zinc-200 shadow-xs text-zinc-600 group-hover:text-brand transition-colors\">\n                              <TypeIcon className=\"h-4 w-4\" />\n                            </div>\n                            <div className=\"flex flex-col\">\n                              <span className=\"text-sm font-semibold text-zinc-900\">{fieldTypeLabels[type]}</span>\n                              <span className=\"text-xs text-zinc-500 truncate\">{fieldTypeDescriptions[type]}</span>\n                            </div>\n                          </div>\n                          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50 text-zinc-500\" />\n                        </Button>\n                      </PopoverTrigger>\n                      <PopoverContent className=\"w-(--radix-popover-trigger-width) p-0 shadow-xl border-zinc-200/80 rounded-xl\" align=\"start\">\n                        <Command className=\"max-h-[380px]\">\n                          <CommandInput placeholder=\"Buscar tipo de campo...\" className=\"h-10 text-sm\" />\n                          <CommandList className=\"max-h-[330px] scrollbar-thin scrollbar-thumb-zinc-200\">\n                            <CommandEmpty className=\"py-6 text-center text-sm text-zinc-500\">Nenhum tipo encontrado.</CommandEmpty>\n                            \n                            <CommandGroup heading=\"Texto e Números\" className=\"px-1.5 pt-1.5 pb-0\">\n                              {[\"text\", \"textarea\", \"number\", \"currency\", \"percentage\", \"integer\"].map((t) => {\n                                const Icon = fieldTypeIcons[t as FieldType];\n                                return (\n                                  <CommandItem\n                                    key={t}\n                                    value={`${fieldTypeLabels[t as FieldType]} ${fieldTypeDescriptions[t as FieldType]}`}\n                                    onSelect={() => {\n                                      setType(t as FieldType);\n                                      setOptions([]);\n                                      setValidationRules({});\n                                      setOpenTypePopover(false);\n                                    }}\n                                    className=\"flex items-start gap-3 rounded-md px-2 py-2 cursor-pointer mb-1 data-[selected=true]:bg-zinc-100/80\"\n                                  >\n                                    <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-white border border-zinc-200/60 shadow-xs text-zinc-500 mt-0.5\">\n                                      <Icon className=\"h-4 w-4\" />\n                                    </div>\n                                    <div className=\"flex flex-col flex-1\">\n                                      <span className=\"text-sm font-semibold text-zinc-900\">{fieldTypeLabels[t as FieldType]}</span>\n                                      <span className=\"text-xs text-zinc-500 leading-tight\">{fieldTypeDescriptions[t as FieldType]}</span>\n                                    </div>\n                                    {type === t && (\n                                      <Check className=\"ml-auto h-4 w-4 text-brand mt-2\" />\n                                    )}\n                                  </CommandItem>\n                                );\n                              })}\n                            </CommandGroup>\n\n                            <CommandGroup heading=\"Seleção\" className=\"px-1.5 py-0\">\n                              {[\"select\", \"multiselect\", \"boolean\", \"date\", \"datetime\"].map((t) => {\n                                const Icon = fieldTypeIcons[t as FieldType];\n                                return (\n                                  <CommandItem\n                                    key={t}\n                                    value={`${fieldTypeLabels[t as FieldType]} ${fieldTypeDescriptions[t as FieldType]}`}\n                                    onSelect={() => {\n                                      setType(t as FieldType);\n                                      setOptions([]);\n                                      setValidationRules({});\n                                      setOpenTypePopover(false);\n                                    }}\n                                    className=\"flex items-start gap-3 rounded-md px-2 py-2 cursor-pointer mb-1 data-[selected=true]:bg-zinc-100/80\"\n                                  >\n                                    <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-white border border-zinc-200/60 shadow-xs text-zinc-500 mt-0.5\">\n                                      <Icon className=\"h-4 w-4\" />\n                                    </div>\n                                    <div className=\"flex flex-col flex-1\">\n                                      <span className=\"text-sm font-semibold text-zinc-900\">{fieldTypeLabels[t as FieldType]}</span>\n                                      <span className=\"text-xs text-zinc-500 leading-tight\">{fieldTypeDescriptions[t as FieldType]}</span>\n                                    </div>\n                                    {type === t && (\n                                      <Check className=\"ml-auto h-4 w-4 text-brand mt-2\" />\n                                    )}\n                                  </CommandItem>\n                                );\n                              })}\n                            </CommandGroup>\n\n                            <CommandGroup heading=\"Contato e Especial\" className=\"px-1.5 pb-1.5 pt-0\">\n                              {[\"email\", \"phone\", \"url\", \"file\"].map((t) => {\n                                const Icon = fieldTypeIcons[t as FieldType];\n                                return (\n                                  <CommandItem\n                                    key={t}\n                                    value={`${fieldTypeLabels[t as FieldType]} ${fieldTypeDescriptions[t as FieldType]}`}\n                                    onSelect={() => {\n                                      setType(t as FieldType);\n                                      setOptions([]);\n                                      setValidationRules({});\n                                      setOpenTypePopover(false);\n                                    }}\n                                    className=\"flex items-start gap-3 rounded-md px-2 py-2 cursor-pointer mb-1 data-[selected=true]:bg-zinc-100/80\"\n                                  >\n                                    <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg bg-white border border-zinc-200/60 shadow-xs text-zinc-500 mt-0.5\">\n                                      <Icon className=\"h-4 w-4\" />\n                                    </div>\n                                    <div className=\"flex flex-col flex-1\">\n                                      <span className=\"text-sm font-semibold text-zinc-900\">{fieldTypeLabels[t as FieldType]}</span>\n                                      <span className=\"text-xs text-zinc-500 leading-tight\">{fieldTypeDescriptions[t as FieldType]}</span>\n                                    </div>\n                                    {type === t && (\n                                      <Check className=\"ml-auto h-4 w-4 text-brand mt-2\" />\n                                    )}\n                                  </CommandItem>\n                                );\n                              })}\n                            </CommandGroup>\n\n                          </CommandList>\n                        </Command>\n                      </PopoverContent>\n                    </Popover>\n                  </div>\n\n                  {/* Campo Obrigatório */}\n                  <div className=\"flex items-center justify-between p-4 rounded-xl border border-zinc-200 bg-zinc-50/50 hover:bg-zinc-50 transition-colors\">\n                    <div className=\"space-y-0.5\">\n                      <div className=\"flex items-center gap-2\">\n                        <Label className=\"text-sm font-semibold text-zinc-900 cursor-pointer\" htmlFor=\"required-switch\">Campo Obrigatório</Label>\n                        <Badge variant=\"secondary\" className=\"h-5 px-1.5 text-[10px] font-semibold text-brand bg-brand/5 border-brand/20 uppercase tracking-wider hidden sm:inline-flex\">Required</Badge>\n                      </div>\n                      <p className=\"text-xs text-zinc-500\">O card não avançará para a próxima etapa se este campo estiver vazio.</p>\n                    </div>\n                    <Switch id=\"required-switch\" checked={required} onCheckedChange={setRequired} className=\"data-[state=checked]:bg-brand\" />\n                  </div>\n                </div>\n              </section>\n\n              <hr className=\"border-t border-zinc-100\" />\n\n              {/* Aparência e Configuração Section */}\n              <section className=\"space-y-6\">\n                <div>\n                  <h3 className=\"text-base font-semibold text-zinc-900\">Aparência e Configuração</h3>\n                  <p className=\"text-sm text-zinc-500 mt-0.5\">Ajuste como o campo será exibido e preenchido pela equipe.</p>\n                </div>\n\n                <div className=\"space-y-6\">\n                  {/* Options Configuration */}\n                  {needsOptions && (\n                    <div className=\"space-y-4 pb-6 border-b border-zinc-100/80\">\n                      <Label className=\"text-sm font-semibold text-zinc-900 flex items-center gap-1.5\">\n                        Opções de seleção <span className=\"text-red-500 text-xs\">*</span>\n                      </Label>\n\n                      <div className=\"flex gap-2\">\n                        <Input\n                          value={newOptionLabel}\n                          onChange={(e) => setNewOptionLabel(e.target.value)}\n                          placeholder=\"Digite uma opção e pressione Enter\"\n                          className=\"h-10 flex-1 bg-white border-zinc-200 focus:ring-brand/15 text-sm shadow-sm transition-all\"\n                          onKeyDown={(e) => { if (e.key === \"Enter\") { e.preventDefault(); handleAddOption(); } }}\n                        />\n                        <Button\n                          type=\"button\"\n                          size=\"sm\"\n                          variant=\"secondary\"\n                          onClick={handleAddOption}\n                          disabled={!newOptionLabel.trim()}\n                          className=\"h-10 px-4 bg-zinc-100 text-zinc-700 hover:bg-zinc-200 shadow-sm transition-all\"\n                        >\n                          <Plus className=\"mr-1.5 h-4 w-4\" /> Adicionar\n                        </Button>\n                      </div>\n\n                      <div className=\"min-h-[60px] rounded-xl border border-dashed border-zinc-200 bg-zinc-50/50 p-3 transition-colors\">\n                        {options.length > 0 ? (\n                          <div className=\"flex flex-wrap gap-2\">\n                            {options.map((opt) => (\n                              <Badge\n                                key={opt.value}\n                                variant=\"outline\"\n                                className=\"gap-1.5 rounded-lg px-2.5 py-1.5 text-xs font-semibold border-zinc-200/80 bg-white text-zinc-700 shadow-sm hover:border-zinc-300 transition-colors\"\n                              >\n                                {opt.label}\n                                <button\n                                  type=\"button\"\n                                  onClick={() => handleRemoveOption(opt.value)}\n                                  className=\"ml-1 rounded-full p-0.5 text-zinc-400 hover:bg-red-50 hover:text-red-600 transition-colors\"\n                                >\n                                  <X className=\"h-3.5 w-3.5\" />\n                                </button>\n                              </Badge>\n                            ))}\n                          </div>\n                        ) : (\n                          <div className=\"flex h-full items-center justify-center py-4 text-sm font-medium text-zinc-400\">\n                            Nenhuma opção adicionada ainda.\n                          </div>\n                        )}\n                      </div>\n                      {errors.options && <p className=\"text-[11px] font-medium text-red-600 mt-1\">{errors.options}</p>}\n                    </div>\n                  )}\n\n                  <div className=\"grid gap-6 sm:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-sm font-semibold text-zinc-900\">Placeholder</Label>\n                      <Input\n                        value={placeholder}\n                        onChange={(e) => setPlaceholder(e.target.value)}\n                        placeholder=\"Texto de fundo vazio\"\n                        className=\"h-10 bg-white border-zinc-200 focus:ring-brand/15 text-sm shadow-sm transition-all\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label className=\"text-sm font-semibold text-zinc-900\">Texto de Ajuda</Label>\n                      <Input\n                        value={description}\n                        onChange={(e) => setDescription(e.target.value)}\n                        placeholder=\"Dica exibida abaixo do campo\"\n                        className=\"h-10 bg-white border-zinc-200 focus:ring-brand/15 text-sm shadow-sm transition-all\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </section>\n            </div>\n          </div>\n\n          {/* Sidebar / Preview (Desktop) or Bottom (Mobile) */}\n          <div className=\"w-80 border-l border-zinc-100 bg-zinc-50/50 hidden md:flex flex-col\">\n            <div className=\"p-4 border-b border-zinc-100 bg-white/50\">\n              <div className=\"flex items-center gap-2 text-zinc-500\">\n                <Eye className=\"h-4 w-4\" />\n                <span className=\"text-xs font-semibold uppercase tracking-wider\">Pré-visualização</span>\n              </div>\n            </div>\n            <div className=\"flex-1 p-6 flex flex-col items-center justify-center\">\n              <div className=\"w-full space-y-2 rounded-xl border border-zinc-200 bg-white p-4 shadow-sm\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-[10px] text-zinc-400 font-medium\">Como aparecerá no card</span>\n                </div>\n                <DynamicFieldRenderer\n                  field={previewField}\n                  value={null}\n                  onChange={() => { }}\n                  disabled={false}\n                />\n              </div>\n              <p className=\"mt-4 text-center text-[10px] text-zinc-400 max-w-[200px]\">\n                Esta é uma representação visual de como o campo será exibido para sua equipe.\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"flex items-center justify-between border-t border-zinc-100 bg-white px-6 py-4\">\n          <Button\n            variant=\"ghost\"\n            type=\"button\"\n            onClick={() => handleClose(false)}\n            className=\"text-zinc-500 hover:text-zinc-900\"\n          >\n            Cancelar\n          </Button>\n          <Button\n            onClick={handleSave}\n            disabled={isSaving}\n            className=\"bg-zinc-900 text-white hover:bg-black shadow-lg shadow-zinc-900/10 min-w-[140px]\"\n          >\n            {isSaving ? (\n              <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n            ) : (\n              <Plus className=\"mr-2 h-4 w-4\" />\n            )}\n            Criar campo\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1814, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/components/drawers/stage-fields/stage-fields-panel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useMemo, useCallback } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  LayoutList,\n  Check,\n  Loader2,\n  AlertTriangle,\n  Plus,\n  Eye,\n  Activity,\n  ChevronDown,\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Popover,\n  PopoverContent,\n  PopoverTrigger,\n} from \"@/components/ui/popover\";\nimport {\n  Command,\n  CommandGroup,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport type { PipelineStage } from \"@/types\";\nimport {\n  useStageFieldsStore,\n  useViewStageFields,\n  useViewStageValues,\n  useRequiredProgress,\n} from \"@/stores/stage-fields-store\";\nimport { DynamicFieldRenderer } from \"./dynamic-field-renderer\";\nimport { NewFieldModal } from \"./new-field-modal\";\n\n// ===== Types =====\n\ntype BannerVariant = \"success\" | \"error\" | \"info\" | \"warning\";\n\ninterface InlineBanner {\n  message: string;\n  variant: BannerVariant;\n}\n\ninterface StageFieldsPanelProps {\n  opportunityId: string;\n  currentStage: PipelineStage;\n  stages: { id: string; label: string }[];\n  initialValues?: Record<string, string | number | boolean | string[] | null | undefined>;\n  isLocked: boolean;\n  onStageChange: (newStage: PipelineStage) => boolean | void;\n  nextStage: { id: string; label: string } | null;\n  canCreateFields?: boolean;\n  advanceBlockedReason?: string | null;\n}\n\n// ===== InlineStatusBanner (local) =====\n\nfunction InlineStatusBanner({\n  banner,\n  onDismiss,\n}: {\n  banner: InlineBanner;\n  onDismiss: () => void;\n}) {\n  useEffect(() => {\n    if (banner.variant === \"success\" || banner.variant === \"info\") {\n      const timer = setTimeout(onDismiss, 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [banner, onDismiss]);\n\n  const variantStyles: Record<BannerVariant, string> = {\n    success: \"bg-status-success/10 text-status-success border-status-success/20\",\n    error: \"bg-status-danger/10 text-status-danger border-status-danger/20\",\n    info: \"bg-brand/10 text-brand border-brand/20\",\n    warning: \"bg-status-warning/10 text-status-warning border-status-warning/20\",\n  };\n\n  const icons: Record<BannerVariant, React.ReactNode> = {\n    success: <Check className=\"h-3.5 w-3.5 shrink-0\" />,\n    error: <AlertTriangle className=\"h-3.5 w-3.5 shrink-0\" />,\n    info: <Activity className=\"h-3.5 w-3.5 shrink-0\" />,\n    warning: <AlertTriangle className=\"h-3.5 w-3.5 shrink-0\" />,\n  };\n\n  return (\n    <div\n      className={`flex items-center gap-2 rounded-[10px] border px-3 py-2 font-body text-xs font-medium animate-in fade-in slide-in-from-top-1 duration-200 ${variantStyles[banner.variant]}`}\n      role={banner.variant === \"error\" ? \"alert\" : \"status\"}\n      aria-live={banner.variant === \"error\" ? \"assertive\" : \"polite\"}\n    >\n      {icons[banner.variant]}\n      <span className=\"flex-1\">{banner.message}</span>\n      <button\n        onClick={onDismiss}\n        className=\"ml-auto shrink-0 opacity-70 hover:opacity-100\"\n        aria-label=\"Fechar\"\n      >\n        ×\n      </button>\n    </div>\n  );\n}\n\n// ===== PremiumCard (local lightweight version) =====\n\nfunction PanelCard({\n  title,\n  description,\n  headerAction,\n  children,\n}: {\n  title: string;\n  description: string;\n  headerAction?: React.ReactNode;\n  children: React.ReactNode;\n}) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 8 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.25, delay: 0.1 }}\n      className=\"rounded-2xl border border-zinc-200/80 bg-white p-5 shadow-sm\"\n    >\n      <div className=\"mb-4 flex items-start justify-between gap-2\">\n        <div className=\"flex items-center gap-2.5\">\n          <div className=\"flex h-8 w-8 items-center justify-center rounded-xl bg-zinc-100 text-zinc-600\">\n            <LayoutList className=\"h-4 w-4\" />\n          </div>\n          <div>\n            <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">{title}</h3>\n            <p className=\"text-[11px] text-zinc-500\">{description}</p>\n          </div>\n        </div>\n        {headerAction}\n      </div>\n      <div className=\"space-y-4\">{children}</div>\n    </motion.div>\n  );\n}\n\n// ===== Main Component =====\n\nexport function StageFieldsPanel({\n  opportunityId,\n  currentStage,\n  stages,\n  initialValues,\n  isLocked,\n  onStageChange,\n  canCreateFields = false,\n  advanceBlockedReason = null,\n}: StageFieldsPanelProps) {\n  const store = useStageFieldsStore();\n  const fields = useViewStageFields();\n  const values = useViewStageValues();\n  const progress = useRequiredProgress();\n\n  // Initialize store when opportunity opens/changes\n  useEffect(() => {\n    store.initForOpportunity(opportunityId, currentStage, initialValues);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [opportunityId, currentStage]);\n\n  // Sync when external stage changes (e.g. from stage bar)\n  useEffect(() => {\n    if (store.opportunityStage !== currentStage) {\n      store.initForOpportunity(opportunityId, currentStage, initialValues);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [currentStage]);\n\n  const handleFieldChange = useCallback(\n    (fieldId: string, value: string | number | boolean | string[] | null | undefined) => {\n      if (isLocked || store.isChangingStage) return;\n      store.updateFieldValue(fieldId, value);\n    },\n    [isLocked, store],\n  );\n\n  const handleSave = useCallback(() => {\n    if (isLocked) return;\n    store.saveAllFields();\n  }, [isLocked, store]);\n\n  const handleCreateField = useCallback(\n    (fieldData: Parameters<typeof store.addFieldDefinition>[1]) => {\n      if (!store.opportunityStage) return;\n      store.addFieldDefinition(store.opportunityStage, fieldData);\n    },\n    [store],\n  );\n\n  const currentStageName = useMemo(() => {\n    return stages.find((s) => s.id === store.opportunityStage)?.label ?? \"Etapa\";\n  }, [stages, store.opportunityStage]);\n\n  // Split fields: required first, then optional\n  const requiredFields = useMemo(() => fields.filter((f) => f.required), [fields]);\n  const optionalFields = useMemo(() => fields.filter((f) => !f.required), [fields]);\n\n  const isEditable = !isLocked && !store.isChangingStage;\n  const hasAdvanceBlockedReason = Boolean(advanceBlockedReason && advanceBlockedReason.trim().length > 0);\n\n  return (\n    <>\n      <div className=\"sticky top-4\">\n        <PanelCard\n          title=\"Campos da etapa\"\n          description=\"Preencha para destravar avanço e fechamento.\"\n          headerAction={\n            <Badge\n              variant=\"outline\"\n              className=\"rounded-full border-zinc-200 bg-zinc-50 text-[11px] text-zinc-700\"\n            >\n              {currentStageName}\n            </Badge>\n          }\n        >\n          {/* ── Controls row: Etapa Atual + Novo campo ── */}\n          <div className=\"flex items-center gap-2\">\n            <div className=\"flex-1\">\n              <Popover>\n                <div className=\"group relative w-full\">\n                  <div className=\"absolute -top-2 left-2 z-10 bg-white px-1 text-[10px] font-semibold tracking-wide text-zinc-500\">\n                    Etapa atual\n                  </div>\n                  <PopoverTrigger asChild>\n                    <Button\n                      variant=\"outline\"\n                      role=\"combobox\"\n                      className=\"h-11 w-full justify-between rounded-xl border-zinc-200 bg-white px-3 font-normal text-zinc-900 shadow-sm transition-all hover:border-brand/40 hover:bg-zinc-50 focus:border-brand/40 focus:ring-2 focus:ring-brand/10 disabled:opacity-70\"\n                      disabled={store.isChangingStage}\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        {store.isChangingStage ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin text-brand\" />\n                        ) : (\n                          <span className=\"flex h-5 w-5 items-center justify-center rounded-full bg-brand/10 text-brand\">\n                            <Activity className=\"h-3 w-3\" />\n                          </span>\n                        )}\n                        <span className=\"text-sm font-semibold\">\n                          {store.isChangingStage ? \"Alterando etapa...\" : currentStageName}\n                        </span>\n                      </div>\n                      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n                    </Button>\n                  </PopoverTrigger>\n                </div>\n                <PopoverContent className=\"w-[280px] p-0 rounded-2xl shadow-xl border-zinc-100\" align=\"start\">\n                  <Command>\n                    <CommandList className=\"max-h-[300px] p-1.5\">\n                      <div className=\"px-2 py-1.5 text-[10px] font-semibold uppercase tracking-wider text-zinc-400\">\n                        Alterar etapa da oportunidade\n                      </div>\n                      <CommandGroup>\n                        {stages.map((s, index) => {\n                          const isCurrent = s.id === store.opportunityStage;\n                          const currentIndex = stages.findIndex(st => st.id === store.opportunityStage);\n                          const isPassed = index < currentIndex;\n\n                          return (\n                            <CommandItem\n                              key={s.id}\n                              value={s.label}\n                              onSelect={() => {\n                                if (isCurrent) return;\n                                store.updateOpportunityStage(s.id as PipelineStage, onStageChange);\n                              }}\n                              className={cn(\n                                \"group flex items-center gap-3 rounded-xl px-3 py-2.5 text-xs transition-colors cursor-pointer\",\n                                isCurrent ? \"bg-zinc-50\" : \"hover:bg-zinc-50\"\n                              )}\n                            >\n                              {/* Status Indicator */}\n                              <div className={cn(\n                                \"flex h-2 w-2 shrink-0 rounded-full\",\n                                isPassed ? \"bg-brand/40\" :\n                                  isCurrent ? \"bg-brand ring-2 ring-brand/20\" :\n                                    \"bg-zinc-200\"\n                              )} />\n\n                              <span className={cn(\n                                \"flex-1 truncate font-medium\",\n                                isCurrent ? \"text-zinc-900\" : \"text-zinc-600\"\n                              )}>\n                                {s.label}\n                              </span>\n\n                              {isCurrent && (\n                                <Badge\n                                  variant=\"secondary\"\n                                  className=\"ml-auto h-5 rounded-full bg-brand/10 px-1.5 text-[9px] font-semibold text-brand\"\n                                >\n                                  Atual\n                                </Badge>\n                              )}\n                            </CommandItem>\n                          );\n                        })}\n                      </CommandGroup>\n                    </CommandList>\n                  </Command>\n                </PopoverContent>\n              </Popover>\n            </div>\n            {canCreateFields && (\n              <Button\n                size=\"sm\"\n                className=\"h-11 rounded-xl bg-zinc-900 px-4 text-sm font-medium text-white shadow-sm transition-all hover:bg-black hover:shadow-md\"\n                onClick={() => store.setNewFieldModalOpen(true)}\n              >\n                <Plus className=\"mr-1.5 h-4 w-4\" />\n                Novo campo\n              </Button>\n            )}\n          </div>\n\n          {/* ── Store banner ── */}\n          <AnimatePresence>\n            {store.banner && (\n              <motion.div\n                initial={{ opacity: 0, height: 0 }}\n                animate={{ opacity: 1, height: \"auto\" }}\n                exit={{ opacity: 0, height: 0 }}\n                className=\"overflow-hidden\"\n              >\n                <InlineStatusBanner\n                  banner={store.banner}\n                  onDismiss={() => store.setBanner(null)}\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n\n\n          {/* ── Missing required fields warning ── */}\n          {progress.missingFields.length > 0 && !store.isChangingStage && (\n            <div className=\"rounded-xl border border-amber-200 bg-amber-50 px-3 py-2\">\n              <p className=\"text-[11px] font-semibold text-amber-700\">Pendências para avanço</p>\n              <ul className=\"mt-1 space-y-1 text-[11px] text-amber-700\">\n                {progress.missingFields.map((field) => (\n                  <li key={field.id}>• {field.label}</li>\n                ))}\n              </ul>\n            </div>\n          )}\n\n          {hasAdvanceBlockedReason && !store.isChangingStage && (\n            <div className=\"rounded-xl border border-amber-200 bg-amber-50 px-3 py-2\">\n              <p className=\"text-[11px] font-semibold text-amber-700\">Avanço bloqueado</p>\n              <p className=\"mt-1 text-[11px] text-amber-700\">{advanceBlockedReason}</p>\n            </div>\n          )}\n\n          {/* ── Fields ── */}\n          {fields.length > 0 ? (\n            <div className=\"space-y-4\">\n              {/* Required fields first */}\n              {requiredFields.map((field) => (\n                <DynamicFieldRenderer\n                  key={field.id}\n                  field={field}\n                  value={values[field.id]}\n                  onChange={handleFieldChange}\n                  disabled={!isEditable}\n                  error={store.fieldErrors[field.id]}\n                  saveState={store.fieldSaveStates[field.id] || \"idle\"}\n                />\n              ))}\n\n              {/* Optional fields */}\n              {optionalFields.length > 0 && requiredFields.length > 0 && (\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"h-px flex-1 bg-zinc-100\" />\n                  <span className=\"text-[9px] font-medium uppercase tracking-wider text-zinc-400\">\n                    Opcionais\n                  </span>\n                  <div className=\"h-px flex-1 bg-zinc-100\" />\n                </div>\n              )}\n\n              {optionalFields.map((field) => (\n                <DynamicFieldRenderer\n                  key={field.id}\n                  field={field}\n                  value={values[field.id]}\n                  onChange={handleFieldChange}\n                  disabled={!isEditable}\n                  error={store.fieldErrors[field.id]}\n                  saveState={store.fieldSaveStates[field.id] || \"idle\"}\n                />\n              ))}\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center justify-center rounded-xl border border-dashed border-zinc-200 bg-zinc-50/50 py-8 text-center\">\n              <LayoutList className=\"mb-2 h-8 w-8 text-zinc-200\" />\n              <p className=\"font-heading text-xs font-medium text-zinc-400\">\n                Esta etapa não possui campos configurados\n              </p>\n              {canCreateFields && (\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  className=\"mt-3 h-7 rounded-full px-3 text-[10px]\"\n                  onClick={() => store.setNewFieldModalOpen(true)}\n                >\n                  <Plus className=\"mr-1 h-3 w-3\" />\n                  Criar primeiro campo\n                </Button>\n              )}\n            </div>\n          )}\n\n          {/* ── Action buttons ── */}\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"h-9 rounded-xl px-4 text-xs font-semibold shadow-sm hover:bg-zinc-50 hover:text-zinc-900\"\n              onClick={handleSave}\n              disabled={isLocked || store.isSaving || store.isChangingStage || fields.length === 0}\n            >\n              {store.isSaving ? (\n                <Loader2 className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" />\n              ) : (\n                <Check className=\"mr-1.5 h-3.5 w-3.5\" />\n              )}\n              {store.isSaving ? \"Salvando...\" : \"Salvar campos\"}\n            </Button>\n          </div>\n        </PanelCard>\n      </div>\n\n      {/* ── New Field Modal ── */}\n      <NewFieldModal\n        open={store.isNewFieldModalOpen}\n        onOpenChange={store.setNewFieldModalOpen}\n        stageId={store.opportunityStage || \"\"}\n        stageName={currentStageName}\n        onSave={handleCreateField}\n      />\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AACA;AAKA;AAOA;AAMA;AACA;AApCA;;;;;;;;;;;;;AA2DA,yCAAyC;AAEzC,SAAS,mBAAmB,EAC1B,MAAM,EACN,SAAS,EAIV;IACC,IAAA,kNAAS,EAAC;QACR,IAAI,OAAO,OAAO,KAAK,aAAa,OAAO,OAAO,KAAK,QAAQ;YAC7D,MAAM,QAAQ,WAAW,WAAW;YACpC,OAAO,IAAM,aAAa;QAC5B;IACF,GAAG;QAAC;QAAQ;KAAU;IAEtB,MAAM,gBAA+C;QACnD,SAAS;QACT,OAAO;QACP,MAAM;QACN,SAAS;IACX;IAEA,MAAM,QAAgD;QACpD,uBAAS,8OAAC,6MAAK;YAAC,WAAU;;;;;;QAC1B,qBAAO,8OAAC,yOAAa;YAAC,WAAU;;;;;;QAChC,oBAAM,8OAAC,sNAAQ;YAAC,WAAU;;;;;;QAC1B,uBAAS,8OAAC,yOAAa;YAAC,WAAU;;;;;;IACpC;IAEA,qBACE,8OAAC;QACC,WAAW,CAAC,0IAA0I,EAAE,aAAa,CAAC,OAAO,OAAO,CAAC,EAAE;QACvL,MAAM,OAAO,OAAO,KAAK,UAAU,UAAU;QAC7C,aAAW,OAAO,OAAO,KAAK,UAAU,cAAc;;YAErD,KAAK,CAAC,OAAO,OAAO,CAAC;0BACtB,8OAAC;gBAAK,WAAU;0BAAU,OAAO,OAAO;;;;;;0BACxC,8OAAC;gBACC,SAAS;gBACT,WAAU;gBACV,cAAW;0BACZ;;;;;;;;;;;;AAKP;AAEA,sDAAsD;AAEtD,SAAS,UAAU,EACjB,KAAK,EACL,WAAW,EACX,YAAY,EACZ,QAAQ,EAMT;IACC,qBACE,8OAAC,oMAAM,CAAC,GAAG;QACT,SAAS;YAAE,SAAS;YAAG,GAAG;QAAE;QAC5B,SAAS;YAAE,SAAS;YAAG,GAAG;QAAE;QAC5B,YAAY;YAAE,UAAU;YAAM,OAAO;QAAI;QACzC,WAAU;;0BAEV,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;0CACb,cAAA,8OAAC,gOAAU;oCAAC,WAAU;;;;;;;;;;;0CAExB,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAoD;;;;;;kDAClE,8OAAC;wCAAE,WAAU;kDAA6B;;;;;;;;;;;;;;;;;;oBAG7C;;;;;;;0BAEH,8OAAC;gBAAI,WAAU;0BAAa;;;;;;;;;;;;AAGlC;AAIO,SAAS,iBAAiB,EAC/B,aAAa,EACb,YAAY,EACZ,MAAM,EACN,aAAa,EACb,QAAQ,EACR,aAAa,EACb,kBAAkB,KAAK,EACvB,uBAAuB,IAAI,EACL;IACtB,MAAM,QAAQ,IAAA,gKAAmB;IACjC,MAAM,SAAS,IAAA,+JAAkB;IACjC,MAAM,SAAS,IAAA,+JAAkB;IACjC,MAAM,WAAW,IAAA,gKAAmB;IAEpC,kDAAkD;IAClD,IAAA,kNAAS,EAAC;QACR,MAAM,kBAAkB,CAAC,eAAe,cAAc;IACtD,uDAAuD;IACzD,GAAG;QAAC;QAAe;KAAa;IAEhC,yDAAyD;IACzD,IAAA,kNAAS,EAAC;QACR,IAAI,MAAM,gBAAgB,KAAK,cAAc;YAC3C,MAAM,kBAAkB,CAAC,eAAe,cAAc;QACxD;IACA,uDAAuD;IACzD,GAAG;QAAC;KAAa;IAEjB,MAAM,oBAAoB,IAAA,oNAAW,EACnC,CAAC,SAAiB;QAChB,IAAI,YAAY,MAAM,eAAe,EAAE;QACvC,MAAM,gBAAgB,CAAC,SAAS;IAClC,GACA;QAAC;QAAU;KAAM;IAGnB,MAAM,aAAa,IAAA,oNAAW,EAAC;QAC7B,IAAI,UAAU;QACd,MAAM,aAAa;IACrB,GAAG;QAAC;QAAU;KAAM;IAEpB,MAAM,oBAAoB,IAAA,oNAAW,EACnC,CAAC;QACC,IAAI,CAAC,MAAM,gBAAgB,EAAE;QAC7B,MAAM,kBAAkB,CAAC,MAAM,gBAAgB,EAAE;IACnD,GACA;QAAC;KAAM;IAGT,MAAM,mBAAmB,IAAA,gNAAO,EAAC;QAC/B,OAAO,OAAO,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,MAAM,gBAAgB,GAAG,SAAS;IACvE,GAAG;QAAC;QAAQ,MAAM,gBAAgB;KAAC;IAEnC,8CAA8C;IAC9C,MAAM,iBAAiB,IAAA,gNAAO,EAAC,IAAM,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,QAAQ,GAAG;QAAC;KAAO;IAC/E,MAAM,iBAAiB,IAAA,gNAAO,EAAC,IAAM,OAAO,MAAM,CAAC,CAAC,IAAM,CAAC,EAAE,QAAQ,GAAG;QAAC;KAAO;IAEhF,MAAM,aAAa,CAAC,YAAY,CAAC,MAAM,eAAe;IACtD,MAAM,0BAA0B,QAAQ,wBAAwB,qBAAqB,IAAI,GAAG,MAAM,GAAG;IAErG,qBACE;;0BACE,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC;oBACC,OAAM;oBACN,aAAY;oBACZ,4BACE,8OAAC,0IAAK;wBACJ,SAAQ;wBACR,WAAU;kCAET;;;;;;;sCAKL,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAI,WAAU;8CACb,cAAA,8OAAC,8IAAO;;0DACN,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAI,WAAU;kEAAkG;;;;;;kEAGjH,8OAAC,qJAAc;wDAAC,OAAO;kEACrB,cAAA,8OAAC,4IAAM;4DACL,SAAQ;4DACR,MAAK;4DACL,WAAU;4DACV,UAAU,MAAM,eAAe;;8EAE/B,8OAAC;oEAAI,WAAU;;wEACZ,MAAM,eAAe,iBACpB,8OAAC,4NAAO;4EAAC,WAAU;;;;;iGAEnB,8OAAC;4EAAK,WAAU;sFACd,cAAA,8OAAC,sNAAQ;gFAAC,WAAU;;;;;;;;;;;sFAGxB,8OAAC;4EAAK,WAAU;sFACb,MAAM,eAAe,GAAG,uBAAuB;;;;;;;;;;;;8EAGpD,8OAAC,mOAAW;oEAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;0DAI7B,8OAAC,qJAAc;gDAAC,WAAU;gDAAsD,OAAM;0DACpF,cAAA,8OAAC,8IAAO;8DACN,cAAA,8OAAC,kJAAW;wDAAC,WAAU;;0EACrB,8OAAC;gEAAI,WAAU;0EAA+E;;;;;;0EAG9F,8OAAC,mJAAY;0EACV,OAAO,GAAG,CAAC,CAAC,GAAG;oEACd,MAAM,YAAY,EAAE,EAAE,KAAK,MAAM,gBAAgB;oEACjD,MAAM,eAAe,OAAO,SAAS,CAAC,CAAA,KAAM,GAAG,EAAE,KAAK,MAAM,gBAAgB;oEAC5E,MAAM,WAAW,QAAQ;oEAEzB,qBACE,8OAAC,kJAAW;wEAEV,OAAO,EAAE,KAAK;wEACd,UAAU;4EACR,IAAI,WAAW;4EACf,MAAM,sBAAsB,CAAC,EAAE,EAAE,EAAmB;wEACtD;wEACA,WAAW,IAAA,yHAAE,EACX,iGACA,YAAY,eAAe;;0FAI7B,8OAAC;gFAAI,WAAW,IAAA,yHAAE,EAChB,sCACA,WAAW,gBACT,YAAY,kCACV;;;;;;0FAGN,8OAAC;gFAAK,WAAW,IAAA,yHAAE,EACjB,+BACA,YAAY,kBAAkB;0FAE7B,EAAE,KAAK;;;;;;4EAGT,2BACC,8OAAC,0IAAK;gFACJ,SAAQ;gFACR,WAAU;0FACX;;;;;;;uEA9BE,EAAE,EAAE;;;;;gEAoCf;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;gCAOX,iCACC,8OAAC,4IAAM;oCACL,MAAK;oCACL,WAAU;oCACV,SAAS,IAAM,MAAM,oBAAoB,CAAC;;sDAE1C,8OAAC,0MAAI;4CAAC,WAAU;;;;;;wCAAmB;;;;;;;;;;;;;sCAOzC,8OAAC,4MAAe;sCACb,MAAM,MAAM,kBACX,8OAAC,oMAAM,CAAC,GAAG;gCACT,SAAS;oCAAE,SAAS;oCAAG,QAAQ;gCAAE;gCACjC,SAAS;oCAAE,SAAS;oCAAG,QAAQ;gCAAO;gCACtC,MAAM;oCAAE,SAAS;oCAAG,QAAQ;gCAAE;gCAC9B,WAAU;0CAEV,cAAA,8OAAC;oCACC,QAAQ,MAAM,MAAM;oCACpB,WAAW,IAAM,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;;wBASxC,SAAS,aAAa,CAAC,MAAM,GAAG,KAAK,CAAC,MAAM,eAAe,kBAC1D,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAE,WAAU;8CAA2C;;;;;;8CACxD,8OAAC;oCAAG,WAAU;8CACX,SAAS,aAAa,CAAC,GAAG,CAAC,CAAC,sBAC3B,8OAAC;;gDAAkB;gDAAG,MAAM,KAAK;;2CAAxB,MAAM,EAAE;;;;;;;;;;;;;;;;wBAMxB,2BAA2B,CAAC,MAAM,eAAe,kBAChD,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAE,WAAU;8CAA2C;;;;;;8CACxD,8OAAC;oCAAE,WAAU;8CAAmC;;;;;;;;;;;;wBAKnD,OAAO,MAAM,GAAG,kBACf,8OAAC;4BAAI,WAAU;;gCAEZ,eAAe,GAAG,CAAC,CAAC,sBACnB,8OAAC,wMAAoB;wCAEnB,OAAO;wCACP,OAAO,MAAM,CAAC,MAAM,EAAE,CAAC;wCACvB,UAAU;wCACV,UAAU,CAAC;wCACX,OAAO,MAAM,WAAW,CAAC,MAAM,EAAE,CAAC;wCAClC,WAAW,MAAM,eAAe,CAAC,MAAM,EAAE,CAAC,IAAI;uCANzC,MAAM,EAAE;;;;;gCAWhB,eAAe,MAAM,GAAG,KAAK,eAAe,MAAM,GAAG,mBACpD,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;;;;;sDACf,8OAAC;4CAAK,WAAU;sDAAgE;;;;;;sDAGhF,8OAAC;4CAAI,WAAU;;;;;;;;;;;;gCAIlB,eAAe,GAAG,CAAC,CAAC,sBACnB,8OAAC,wMAAoB;wCAEnB,OAAO;wCACP,OAAO,MAAM,CAAC,MAAM,EAAE,CAAC;wCACvB,UAAU;wCACV,UAAU,CAAC;wCACX,OAAO,MAAM,WAAW,CAAC,MAAM,EAAE,CAAC;wCAClC,WAAW,MAAM,eAAe,CAAC,MAAM,EAAE,CAAC,IAAI;uCANzC,MAAM,EAAE;;;;;;;;;;iDAWnB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC,gOAAU;oCAAC,WAAU;;;;;;8CACtB,8OAAC;oCAAE,WAAU;8CAAiD;;;;;;gCAG7D,iCACC,8OAAC,4IAAM;oCACL,MAAK;oCACL,SAAQ;oCACR,WAAU;oCACV,SAAS,IAAM,MAAM,oBAAoB,CAAC;;sDAE1C,8OAAC,0MAAI;4CAAC,WAAU;;;;;;wCAAiB;;;;;;;;;;;;;sCAQzC,8OAAC;4BAAI,WAAU;sCACb,cAAA,8OAAC,4IAAM;gCACL,MAAK;gCACL,SAAQ;gCACR,WAAU;gCACV,SAAS;gCACT,UAAU,YAAY,MAAM,QAAQ,IAAI,MAAM,eAAe,IAAI,OAAO,MAAM,KAAK;;oCAElF,MAAM,QAAQ,iBACb,8OAAC,4NAAO;wCAAC,WAAU;;;;;6DAEnB,8OAAC,6MAAK;wCAAC,WAAU;;;;;;oCAElB,MAAM,QAAQ,GAAG,gBAAgB;;;;;;;;;;;;;;;;;;;;;;;0BAO1C,8OAAC,0LAAa;gBACZ,MAAM,MAAM,mBAAmB;gBAC/B,cAAc,MAAM,oBAAoB;gBACxC,SAAS,MAAM,gBAAgB,IAAI;gBACnC,WAAW;gBACX,QAAQ;;;;;;;;AAIhB"}},
    {"offset": {"line": 2556, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/components/drawers/stage-fields/index.ts"],"sourcesContent":["export { StageFieldsPanel } from \"./stage-fields-panel\";\nexport { DynamicFieldRenderer } from \"./dynamic-field-renderer\";\nexport { NewFieldModal } from \"./new-field-modal\";\n"],"names":[],"mappings":";AAAA;AACA;AACA"}},
    {"offset": {"line": 2567, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/components/drawers/lead-negotiation-tab.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport {\n  Plus,\n  ChevronDown,\n  ChevronUp,\n  Download,\n  Handshake,\n  Clock3,\n  Send,\n  CheckCircle2,\n  XCircle,\n  Pencil,\n  Trash2,\n  GitCompareArrows,\n  CalendarClock,\n  Copy,\n  Loader2,\n  BadgeCheck,\n  ArrowRight,\n  FileText,\n} from \"lucide-react\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { cn } from \"@/lib/utils\";\n\nimport type { NegotiationRound, NegotiationType } from \"@/types\";\nimport { mockNegotiationRounds } from \"@/lib/mock-data\";\n\ntype RoundLifecycleStatus = \"draft\" | \"sent\" | \"awaiting\" | \"accepted\" | \"rejected\";\ntype RoundVisibility = \"client\" | \"internal\";\ntype RoundActorRole = \"team\" | \"client\" | \"system\";\ntype BannerType = \"success\" | \"error\" | \"warning\" | \"info\";\ntype RowAction =\n  | \"send\"\n  | \"awaiting\"\n  | \"accept\"\n  | \"reject\"\n  | \"set-current\"\n  | \"delete\"\n  | \"save-edit\"\n  | \"save-create\";\n\ninterface NegotiationRoundItem extends NegotiationRound {\n  lifecycleStatus: RoundLifecycleStatus;\n  visibility: RoundVisibility;\n  actorRole: RoundActorRole;\n  sentAt?: string;\n  acceptedAt?: string;\n  rejectedAt?: string;\n  rejectedReason?: string;\n  updatedAt?: string;\n}\n\ninterface NegotiationTermsState {\n  sourceRoundId: string;\n  monthlyValue: number;\n  setupValue: number;\n  termMonths: number;\n  totalValue: number;\n  updatedAt: string;\n  updatedBy: string;\n  sourceStatus: RoundLifecycleStatus;\n  sourceVisibility: RoundVisibility;\n}\n\ninterface InlineBanner {\n  type: BannerType;\n  message: string;\n}\n\ninterface NextStepDraft {\n  action: string;\n  dueAt: string;\n  channel: \"call\" | \"whatsapp\" | \"email\" | \"meeting\" | \"visit\";\n  ownerId: string;\n}\n\ninterface RoundFormPayload {\n  type: NegotiationType;\n  actorRole: RoundActorRole;\n  visibility: RoundVisibility;\n  lifecycleStatus: RoundLifecycleStatus;\n  monthlyValue: number;\n  setupValue: number;\n  termMonths: number;\n  notes: string;\n  conditions: string[];\n  rejectedReason?: string;\n}\n\ninterface RoundFormSeed {\n  type: NegotiationType;\n  actorRole: RoundActorRole;\n  visibility: RoundVisibility;\n  lifecycleStatus: RoundLifecycleStatus;\n  monthlyValue: string;\n  setupValue: string;\n  termMonths: string;\n  notes: string;\n  conditionsText: string;\n  rejectedReason: string;\n}\n\nconst LOGGED_USER = {\n  id: \"u1\",\n  name: \"Maria Silva\",\n};\n\nconst TEAM_OWNERS = [\n  { id: \"u1\", name: \"Maria Silva\" },\n  { id: \"u2\", name: \"Pedro Santos\" },\n  { id: \"u3\", name: \"Julia Fernandes\" },\n];\n\nconst ROUND_EDIT_WINDOW_HOURS = 24;\nconst MIN_NOTES_LENGTH = 10;\n\nconst roundTypeMeta: Record<\n  NegotiationType,\n  {\n    label: string;\n    badgeClass: string;\n    icon: typeof FileText;\n  }\n> = {\n  proposal: {\n    label: \"Proposta\",\n    badgeClass: \"border-blue-200 bg-blue-50 text-blue-700\",\n    icon: FileText,\n  },\n  counter: {\n    label: \"Contra proposta\",\n    badgeClass: \"border-amber-200 bg-amber-50 text-amber-700\",\n    icon: ArrowRight,\n  },\n  internal: {\n    label: \"Ajuste interno\",\n    badgeClass: \"border-zinc-200 bg-zinc-100 text-zinc-700\",\n    icon: Handshake,\n  },\n  agreement: {\n    label: \"Fechamento\",\n    badgeClass: \"border-emerald-200 bg-emerald-50 text-emerald-700\",\n    icon: BadgeCheck,\n  },\n};\n\nconst lifecycleMeta: Record<\n  RoundLifecycleStatus,\n  {\n    label: string;\n    chipClass: string;\n  }\n> = {\n  draft: { label: \"Rascunho\", chipClass: \"border-zinc-200 bg-zinc-100 text-zinc-600\" },\n  sent: { label: \"Enviada\", chipClass: \"border-sky-200 bg-sky-50 text-sky-700\" },\n  awaiting: { label: \"Aguardando cliente\", chipClass: \"border-violet-200 bg-violet-50 text-violet-700\" },\n  accepted: { label: \"Aceita\", chipClass: \"border-emerald-200 bg-emerald-50 text-emerald-700\" },\n  rejected: { label: \"Rejeitada\", chipClass: \"border-red-200 bg-red-50 text-red-700\" },\n};\n\nconst visibilityMeta: Record<\n  RoundVisibility,\n  { label: string; chipClass: string }\n> = {\n  client: { label: \"Visível ao cliente\", chipClass: \"border-zinc-200 bg-zinc-50 text-zinc-600\" },\n  internal: { label: \"Interna\", chipClass: \"border-zinc-200 bg-zinc-100 text-zinc-500\" },\n};\n\nconst channelOptions: Array<{ id: NextStepDraft[\"channel\"]; label: string }> = [\n  { id: \"call\", label: \"Ligação\" },\n  { id: \"whatsapp\", label: \"WhatsApp\" },\n  { id: \"email\", label: \"E-mail\" },\n  { id: \"meeting\", label: \"Reunião\" },\n  { id: \"visit\", label: \"Visita\" },\n];\n\nconst roundTypeOptions: Array<{ id: NegotiationType; label: string }> = [\n  { id: \"proposal\", label: \"Proposta do time\" },\n  { id: \"counter\", label: \"Contra proposta do cliente\" },\n  { id: \"internal\", label: \"Ajuste interno\" },\n  { id: \"agreement\", label: \"Fechamento\" },\n];\n\nconst lifecycleOptions: Array<{ id: RoundLifecycleStatus; label: string }> = [\n  { id: \"draft\", label: \"Rascunho\" },\n  { id: \"sent\", label: \"Enviada ao cliente\" },\n  { id: \"awaiting\", label: \"Aguardando resposta\" },\n  { id: \"accepted\", label: \"Aceita\" },\n  { id: \"rejected\", label: \"Rejeitada\" },\n];\n\nconst formatCurrency = (value: number) =>\n  new Intl.NumberFormat(\"pt-BR\", {\n    style: \"currency\",\n    currency: \"BRL\",\n  }).format(value);\n\nconst toDateTimeLabel = (dateIso?: string) => {\n  if (!dateIso) return \"Sem data\";\n  const date = new Date(dateIso);\n  if (Number.isNaN(date.getTime())) return \"Sem data\";\n  return format(date, \"dd MMM, HH:mm\", { locale: ptBR });\n};\n\nconst toInputNumber = (raw: string) => {\n  const parsed = Number(raw);\n  if (Number.isNaN(parsed)) return 0;\n  return parsed;\n};\n\nconst calcTotalValue = (monthlyValue: number, setupValue: number, termMonths: number) =>\n  monthlyValue * termMonths + setupValue;\n\nconst isTermsRequired = (type: NegotiationType) =>\n  type === \"proposal\" || type === \"counter\" || type === \"agreement\";\n\nconst isTeamOfferCandidate = (round: NegotiationRoundItem) =>\n  (round.type === \"proposal\" || round.type === \"agreement\") &&\n  round.actorRole === \"team\" &&\n  round.visibility === \"client\";\n\nconst isRoundEditable = (round: NegotiationRoundItem) => {\n  if (round.authorId !== LOGGED_USER.id) return false;\n  if (round.lifecycleStatus !== \"draft\") return false;\n  const createdAt = new Date(round.createdAt).getTime();\n  if (Number.isNaN(createdAt)) return false;\n  return Date.now() - createdAt <= ROUND_EDIT_WINDOW_HOURS * 60 * 60 * 1000;\n};\n\nconst isRoundDeletable = (round: NegotiationRoundItem) =>\n  isRoundEditable(round) && !round.isFinal;\n\nconst createRoundId = () => `round-${Date.now()}-${Math.floor(Math.random() * 999)}`;\n\nconst nowIso = () => new Date().toISOString();\n\nfunction downloadTextFile(fileName: string, content: string) {\n  if (typeof window === \"undefined\") return;\n  const blob = new Blob([content], { type: \"text/plain;charset=utf-8\" });\n  const objectUrl = URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = objectUrl;\n  link.download = fileName;\n  document.body.append(link);\n  link.click();\n  link.remove();\n  URL.revokeObjectURL(objectUrl);\n}\n\nfunction buildInitialRounds(): NegotiationRoundItem[] {\n  return mockNegotiationRounds.map((round) => {\n    if (round.type === \"counter\") {\n      return {\n        ...round,\n        actorRole: \"client\",\n        visibility: \"client\",\n        lifecycleStatus: \"awaiting\",\n        sentAt: round.createdAt,\n      };\n    }\n\n    if (round.type === \"internal\") {\n      return {\n        ...round,\n        actorRole: \"team\",\n        visibility: \"internal\",\n        lifecycleStatus: \"draft\",\n      };\n    }\n\n    if (round.type === \"agreement\") {\n      return {\n        ...round,\n        actorRole: \"team\",\n        visibility: \"client\",\n        lifecycleStatus: \"accepted\",\n        sentAt: round.createdAt,\n        acceptedAt: round.createdAt,\n        isFinal: true,\n      };\n    }\n\n    return {\n      ...round,\n      actorRole: \"team\",\n      visibility: \"client\",\n      lifecycleStatus: \"sent\",\n      sentAt: round.createdAt,\n    };\n  });\n}\n\nfunction deriveCurrentTermsRoundId(rounds: NegotiationRoundItem[]) {\n  const ordered = [...rounds].sort(\n    (a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime(),\n  );\n  const accepted = [...ordered].reverse().find(\n    (round) => isTeamOfferCandidate(round) && round.lifecycleStatus === \"accepted\",\n  );\n  if (accepted) return accepted.id;\n\n  const sentOrAwaiting = [...ordered].reverse().find(\n    (round) =>\n      isTeamOfferCandidate(round) &&\n      (round.lifecycleStatus === \"sent\" || round.lifecycleStatus === \"awaiting\"),\n  );\n  return sentOrAwaiting?.id ?? null;\n}\n\nfunction deriveNegotiationStatus(\n  rounds: NegotiationRoundItem[],\n  currentTermsRoundId: string | null,\n) {\n  if (rounds.length === 0) {\n    return {\n      label: \"Não iniciada\",\n      description: \"Nenhuma rodada registrada até agora.\",\n      tone: \"neutral\" as const,\n    };\n  }\n\n  const accepted = rounds.find((round) => round.lifecycleStatus === \"accepted\");\n  if (accepted) {\n    return {\n      label: \"Aceita\",\n      description: \"Rodada aceita pelo cliente. Pronta para fechamento.\",\n      tone: \"success\" as const,\n    };\n  }\n\n  const currentRound = rounds.find((round) => round.id === currentTermsRoundId);\n  if (currentRound?.lifecycleStatus === \"awaiting\" || currentRound?.lifecycleStatus === \"sent\") {\n    return {\n      label: \"Aguardando cliente\",\n      description: `Aguardando resposta da rodada vigente enviada em ${toDateTimeLabel(currentRound.sentAt)}.`,\n      tone: \"warning\" as const,\n    };\n  }\n\n  return {\n    label: \"Em negociação\",\n    description: \"Negociação ativa com ajustes internos e respostas em andamento.\",\n    tone: \"info\" as const,\n  };\n}\n\nfunction toRoundFormSeed(round?: NegotiationRoundItem): RoundFormSeed {\n  if (!round) {\n    return {\n      type: \"proposal\",\n      actorRole: \"team\",\n      visibility: \"client\",\n      lifecycleStatus: \"draft\",\n      monthlyValue: \"\",\n      setupValue: \"\",\n      termMonths: \"12\",\n      notes: \"\",\n      conditionsText: \"\",\n      rejectedReason: \"\",\n    };\n  }\n\n  return {\n    type: round.type,\n    actorRole: round.actorRole,\n    visibility: round.visibility,\n    lifecycleStatus: round.lifecycleStatus,\n    monthlyValue: String(round.monthlyValue ?? \"\"),\n    setupValue: String(round.setupValue ?? \"\"),\n    termMonths: String(round.termMonths ?? 12),\n    notes: round.details ?? \"\",\n    conditionsText: round.conditions.join(\", \"),\n    rejectedReason: round.rejectedReason ?? \"\",\n  };\n}\n\nfunction extractTerms(round: NegotiationRoundItem | null): NegotiationTermsState | null {\n  if (!round) return null;\n  if (!isTermsRequired(round.type)) return null;\n  const monthlyValue = round.monthlyValue ?? 0;\n  const setupValue = round.setupValue ?? 0;\n  const termMonths = round.termMonths ?? 12;\n  return {\n    sourceRoundId: round.id,\n    monthlyValue,\n    setupValue,\n    termMonths,\n    totalValue: calcTotalValue(monthlyValue, setupValue, termMonths),\n    updatedAt: round.updatedAt ?? round.createdAt,\n    updatedBy: round.authorName,\n    sourceStatus: round.lifecycleStatus,\n    sourceVisibility: round.visibility,\n  };\n}\n\nfunction buildSummaryText(\n  dealTitle: string,\n  terms: NegotiationTermsState,\n  rounds: NegotiationRoundItem[],\n) {\n  const relevantRounds = rounds.filter(\n    (round) => round.visibility === \"client\" && round.type !== \"internal\",\n  );\n\n  const lines = relevantRounds.map((round, index) => {\n    const typeLabel = roundTypeMeta[round.type].label;\n    const statusLabel = lifecycleMeta[round.lifecycleStatus].label;\n    return `${index + 1}. ${typeLabel} | ${statusLabel} | Mensal ${formatCurrency(\n      round.monthlyValue ?? 0,\n    )} | Setup ${formatCurrency(round.setupValue ?? 0)} | ${round.termMonths ?? 12} meses`;\n  });\n\n  return [\n    `Resumo de negociação - ${dealTitle}`,\n    \"\",\n    \"Termos vigentes\",\n    `Mensal: ${formatCurrency(terms.monthlyValue)}`,\n    `Setup: ${formatCurrency(terms.setupValue)}`,\n    `Prazo: ${terms.termMonths} meses`,\n    `Valor total: ${formatCurrency(terms.totalValue)}`,\n    `Origem: rodada ${terms.sourceRoundId}`,\n    `Atualizado por: ${terms.updatedBy} em ${toDateTimeLabel(terms.updatedAt)}`,\n    \"\",\n    \"Rodadas relevantes para cliente\",\n    ...lines,\n  ].join(\"\\n\");\n}\n\ninterface NegotiationTabProps {\n  dealId: string;\n  dealTitle: string;\n}\n\nexport function NegotiationTab({ dealId, dealTitle }: NegotiationTabProps) {\n  const initialRounds = useMemo(() => buildInitialRounds(), []);\n  const [rounds, setRounds] = useState<NegotiationRoundItem[]>(initialRounds);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [formMode, setFormMode] = useState<\"create\" | \"edit\">(\"create\");\n  const [formSeed, setFormSeed] = useState<RoundFormSeed>(toRoundFormSeed());\n  const [editingRoundId, setEditingRoundId] = useState<string | null>(null);\n  const [isSavingRound, setIsSavingRound] = useState(false);\n  const [formError, setFormError] = useState<string | null>(null);\n\n  const [currentTermsRoundId, setCurrentTermsRoundId] = useState<string | null>(\n    deriveCurrentTermsRoundId(initialRounds),\n  );\n  const [rowActionLoading, setRowActionLoading] = useState<Record<string, RowAction | null>>({});\n\n  const [banner, setBanner] = useState<InlineBanner | null>(null);\n\n  const [isExporting, setIsExporting] = useState(false);\n  const [exportError, setExportError] = useState<string | null>(null);\n  const [exportSummaryText, setExportSummaryText] = useState<string | null>(null);\n\n  const [nextStep, setNextStep] = useState<NextStepDraft>({\n    action: \"Validar retorno do cliente sobre a proposta vigente\",\n    dueAt: \"\",\n    channel: \"whatsapp\",\n    ownerId: LOGGED_USER.id,\n  });\n  const [nextStepState, setNextStepState] = useState<\"idle\" | \"saving\" | \"saved\" | \"error\">(\n    \"idle\",\n  );\n  const [nextStepError, setNextStepError] = useState<string | null>(null);\n  const [highlightRoundId, setHighlightRoundId] = useState<string | null>(null);\n  const [highlightNextStep, setHighlightNextStep] = useState(false);\n\n  const orderedRounds = useMemo(\n    () =>\n      [...rounds].sort(\n        (a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime(),\n      ),\n    [rounds],\n  );\n\n  const currentTermsRound = useMemo(\n    () => orderedRounds.find((round) => round.id === currentTermsRoundId) ?? null,\n    [orderedRounds, currentTermsRoundId],\n  );\n  const currentTermsRoundNumber = useMemo(() => {\n    if (!currentTermsRound) return null;\n    const index = orderedRounds.findIndex((round) => round.id === currentTermsRound.id);\n    return index >= 0 ? index + 1 : null;\n  }, [currentTermsRound, orderedRounds]);\n\n  const currentTerms = useMemo(() => extractTerms(currentTermsRound), [currentTermsRound]);\n\n  const latestTeamOffer = useMemo(\n    () => [...orderedRounds].reverse().find((round) => isTeamOfferCandidate(round)) ?? null,\n    [orderedRounds],\n  );\n\n  const latestClientCounter = useMemo(\n    () => [...orderedRounds].reverse().find((round) => round.type === \"counter\") ?? null,\n    [orderedRounds],\n  );\n\n  const negotiationStatus = useMemo(\n    () => deriveNegotiationStatus(orderedRounds, currentTermsRoundId),\n    [orderedRounds, currentTermsRoundId],\n  );\n\n  const runRowAction = async (\n    roundId: string,\n    action: RowAction,\n    callback: () => void,\n    onErrorMessage: string,\n  ) => {\n    setRowActionLoading((prev) => ({ ...prev, [roundId]: action }));\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 220));\n      callback();\n    } catch {\n      setBanner({\n        type: \"error\",\n        message: onErrorMessage,\n      });\n    } finally {\n      setRowActionLoading((prev) => ({ ...prev, [roundId]: null }));\n    }\n  };\n\n  const pushBanner = (next: InlineBanner) => {\n    setBanner(next);\n    window.setTimeout(() => setBanner(null), 2200);\n  };\n\n  const pulseRound = (roundId: string) => {\n    setHighlightRoundId(roundId);\n    window.setTimeout(() => {\n      setHighlightRoundId((prev) => (prev === roundId ? null : prev));\n    }, 1800);\n  };\n\n  const scrollToRound = (roundId: string) => {\n    const target = document.querySelector(`[data-round-anchor=\"${roundId}\"]`);\n    if (target instanceof HTMLElement) {\n      target.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n      pulseRound(roundId);\n    }\n  };\n\n  const focusNextStepCard = () => {\n    const target = document.querySelector('[data-next-step-card=\"true\"]');\n    if (target instanceof HTMLElement) {\n      target.scrollIntoView({ behavior: \"smooth\", block: \"center\" });\n      setHighlightNextStep(true);\n      window.setTimeout(() => setHighlightNextStep(false), 1600);\n    }\n  };\n\n  const openCreateRound = (sourceRound?: NegotiationRoundItem | null) => {\n    const baseSeed = toRoundFormSeed(sourceRound ?? undefined);\n    setFormMode(\"create\");\n    setEditingRoundId(null);\n    setFormError(null);\n    setFormSeed({\n      ...baseSeed,\n      type: sourceRound?.type === \"counter\" ? \"proposal\" : baseSeed.type,\n      actorRole: \"team\",\n      visibility: sourceRound?.visibility === \"internal\" ? \"client\" : baseSeed.visibility,\n      lifecycleStatus: \"draft\",\n      rejectedReason: \"\",\n    });\n    setIsFormOpen(true);\n  };\n\n  const openEditRound = (round: NegotiationRoundItem) => {\n    if (!isRoundEditable(round)) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Você só pode editar rodadas próprias em rascunho dentro da janela de 24h.\",\n      });\n      return;\n    }\n    setFormMode(\"edit\");\n    setEditingRoundId(round.id);\n    setFormError(null);\n    setFormSeed(toRoundFormSeed(round));\n    setIsFormOpen(true);\n  };\n\n  const closeForm = () => {\n    setIsFormOpen(false);\n    setFormError(null);\n    setEditingRoundId(null);\n    setFormSeed(toRoundFormSeed());\n  };\n\n  const handleSaveRound = async (payload: RoundFormPayload) => {\n    setIsSavingRound(true);\n    setFormError(null);\n\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 250));\n\n      if (formMode === \"edit\" && editingRoundId) {\n        setRounds((prev) =>\n          prev.map((round) => {\n            if (round.id !== editingRoundId) return round;\n            const totalValue = calcTotalValue(\n              payload.monthlyValue,\n              payload.setupValue,\n              payload.termMonths,\n            );\n            return {\n              ...round,\n              type: payload.type,\n              actorRole: payload.actorRole,\n              visibility: payload.visibility,\n              lifecycleStatus: payload.lifecycleStatus,\n              monthlyValue: payload.monthlyValue,\n              setupValue: payload.setupValue,\n              termMonths: payload.termMonths,\n              totalValue,\n              conditions: payload.conditions,\n              details: payload.notes,\n              rejectedReason: payload.lifecycleStatus === \"rejected\" ? payload.rejectedReason : undefined,\n              sentAt:\n                payload.lifecycleStatus === \"sent\" ||\n                payload.lifecycleStatus === \"awaiting\" ||\n                payload.lifecycleStatus === \"accepted\"\n                  ? round.sentAt ?? nowIso()\n                  : undefined,\n              acceptedAt:\n                payload.lifecycleStatus === \"accepted\"\n                  ? round.acceptedAt ?? nowIso()\n                  : undefined,\n              rejectedAt:\n                payload.lifecycleStatus === \"rejected\"\n                  ? round.rejectedAt ?? nowIso()\n                  : undefined,\n              updatedAt: nowIso(),\n            };\n          }),\n        );\n\n        const shouldPromoteTerms =\n          payload.lifecycleStatus === \"accepted\" &&\n          payload.actorRole === \"team\" &&\n          payload.visibility === \"client\" &&\n          (payload.type === \"proposal\" || payload.type === \"agreement\");\n\n        if (shouldPromoteTerms) {\n          setCurrentTermsRoundId(editingRoundId);\n          pulseRound(editingRoundId);\n        }\n\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada atualizada com sucesso.\",\n        });\n      } else {\n        const createdAt = nowIso();\n        const totalValue = calcTotalValue(\n          payload.monthlyValue,\n          payload.setupValue,\n          payload.termMonths,\n        );\n        const newRound: NegotiationRoundItem = {\n          id: createRoundId(),\n          type: payload.type,\n          authorId: payload.actorRole === \"team\" ? LOGGED_USER.id : \"client-user\",\n          authorName:\n            payload.actorRole === \"team\"\n              ? `${LOGGED_USER.name} - Equipe`\n              : \"Cliente - Cliente\",\n          actorRole: payload.actorRole,\n          visibility: payload.visibility,\n          lifecycleStatus: payload.lifecycleStatus,\n          createdAt,\n          monthlyValue: payload.monthlyValue,\n          setupValue: payload.setupValue,\n          termMonths: payload.termMonths,\n          totalValue,\n          conditions: payload.conditions,\n          details: payload.notes,\n          rejectedReason:\n            payload.lifecycleStatus === \"rejected\" ? payload.rejectedReason : undefined,\n          sentAt:\n            payload.lifecycleStatus === \"sent\" ||\n            payload.lifecycleStatus === \"awaiting\" ||\n            payload.lifecycleStatus === \"accepted\"\n              ? createdAt\n              : undefined,\n          acceptedAt: payload.lifecycleStatus === \"accepted\" ? createdAt : undefined,\n          rejectedAt: payload.lifecycleStatus === \"rejected\" ? createdAt : undefined,\n          status: \"active\",\n        };\n\n        setRounds((prev) => [...prev, newRound]);\n\n        if (newRound.lifecycleStatus === \"accepted\" && isTeamOfferCandidate(newRound)) {\n          setCurrentTermsRoundId(newRound.id);\n          pulseRound(newRound.id);\n        }\n\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada registrada. Histórico e resumo atualizados.\",\n        });\n      }\n\n      closeForm();\n    } catch {\n      setFormError(\"Não consegui salvar a rodada. Revise os campos e tente novamente.\");\n    } finally {\n      setIsSavingRound(false);\n    }\n  };\n\n  const handleMarkRoundSent = async (round: NegotiationRoundItem) => {\n    if (!isTeamOfferCandidate(round)) {\n      pushBanner({ type: \"warning\", message: \"Somente propostas visíveis ao cliente podem ser enviadas.\" });\n      return;\n    }\n    if (round.lifecycleStatus !== \"draft\") {\n      pushBanner({ type: \"warning\", message: \"Apenas rodadas em rascunho podem ser enviadas.\" });\n      return;\n    }\n    if (!window.confirm(\"Confirmar envio desta rodada ao cliente?\")) return;\n\n    await runRowAction(\n      round.id,\n      \"send\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"sent\",\n                  sentAt: nowIso(),\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada enviada ao cliente e pronta para acompanhamento.\",\n        });\n      },\n      \"Não consegui marcar a rodada como enviada.\",\n    );\n  };\n\n  const handleMarkRoundAwaiting = async (round: NegotiationRoundItem) => {\n    if (round.lifecycleStatus !== \"sent\") return;\n\n    await runRowAction(\n      round.id,\n      \"awaiting\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"awaiting\",\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        pushBanner({\n          type: \"info\",\n          message: \"Status atualizado para aguardando resposta do cliente.\",\n        });\n      },\n      \"Não consegui atualizar o status da rodada.\",\n    );\n  };\n\n  const handleMarkRoundAccepted = async (round: NegotiationRoundItem) => {\n    if (!window.confirm(\"Confirmar esta rodada como aceita?\")) return;\n\n    await runRowAction(\n      round.id,\n      \"accept\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"accepted\",\n                  acceptedAt: nowIso(),\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        if (isTeamOfferCandidate(round)) {\n          setCurrentTermsRoundId(round.id);\n          pulseRound(round.id);\n        }\n        pushBanner({\n          type: \"success\",\n          message: isTeamOfferCandidate(round)\n            ? \"Rodada aceita e promovida para termos vigentes.\"\n            : \"Rodada aceita com sucesso.\",\n        });\n      },\n      \"Não consegui marcar a rodada como aceita.\",\n    );\n  };\n\n  const handleMarkRoundRejected = async (round: NegotiationRoundItem) => {\n    const reason = window.prompt(\"Informe o motivo da rejeição (mínimo 5 caracteres):\");\n    if (!reason || reason.trim().length < 5) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Motivo obrigatório para rejeitar a rodada.\",\n      });\n      return;\n    }\n\n    await runRowAction(\n      round.id,\n      \"reject\",\n      () => {\n        setRounds((prev) =>\n          prev.map((item) =>\n            item.id === round.id\n              ? {\n                  ...item,\n                  lifecycleStatus: \"rejected\",\n                  rejectedAt: nowIso(),\n                  rejectedReason: reason.trim(),\n                  updatedAt: nowIso(),\n                }\n              : item,\n          ),\n        );\n        pushBanner({\n          type: \"warning\",\n          message: \"Rodada marcada como rejeitada.\",\n        });\n      },\n      \"Não consegui rejeitar a rodada.\",\n    );\n  };\n\n  const handleSetCurrentTerms = async (round: NegotiationRoundItem) => {\n    if (!isTeamOfferCandidate(round)) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Somente proposta do time visível ao cliente pode virar termo vigente.\",\n      });\n      return;\n    }\n\n    await runRowAction(\n      round.id,\n      \"set-current\",\n      () => {\n        setCurrentTermsRoundId(round.id);\n        pulseRound(round.id);\n        pushBanner({\n          type: \"success\",\n          message: `Rodada ${round.id} definida como fonte dos termos vigentes.`,\n        });\n      },\n      \"Não consegui definir os termos vigentes desta rodada.\",\n    );\n  };\n\n  const handleDeleteRound = async (round: NegotiationRoundItem) => {\n    if (!isRoundDeletable(round)) {\n      pushBanner({\n        type: \"warning\",\n        message: \"Você só pode excluir rodadas próprias em rascunho dentro da janela permitida.\",\n      });\n      return;\n    }\n    if (!window.confirm(\"Excluir esta rodada? Esta ação remove o item do histórico.\")) return;\n\n    await runRowAction(\n      round.id,\n      \"delete\",\n      () => {\n        setRounds((prev) => {\n          const nextRounds = prev.filter((item) => item.id !== round.id);\n          if (currentTermsRoundId === round.id) {\n            setCurrentTermsRoundId(deriveCurrentTermsRoundId(nextRounds));\n          }\n          return nextRounds;\n        });\n        pushBanner({\n          type: \"success\",\n          message: \"Rodada excluída com sucesso.\",\n        });\n      },\n      \"Não consegui excluir a rodada.\",\n    );\n  };\n\n  const handleExportSummary = async () => {\n    if (!currentTerms) {\n      setExportError(\"Export bloqueado. Defina termos vigentes antes de exportar.\");\n      pushBanner({\n        type: \"warning\",\n        message: \"Defina os termos vigentes para gerar um resumo confiável.\",\n      });\n      return;\n    }\n\n    setIsExporting(true);\n    setExportError(null);\n\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 260));\n      const summaryText = buildSummaryText(dealTitle, currentTerms, orderedRounds);\n      setExportSummaryText(summaryText);\n      downloadTextFile(`negociacao-${dealId}.txt`, summaryText);\n      pushBanner({\n        type: \"success\",\n        message: \"Resumo exportado com base nos termos vigentes.\",\n      });\n    } catch {\n      setExportError(\"Não consegui gerar o resumo. Tente novamente.\");\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  const handleCopySummary = async () => {\n    if (!exportSummaryText) return;\n    try {\n      if (navigator.clipboard?.writeText) {\n        await navigator.clipboard.writeText(exportSummaryText);\n      } else {\n        const textarea = document.createElement(\"textarea\");\n        textarea.value = exportSummaryText;\n        document.body.append(textarea);\n        textarea.select();\n        document.execCommand(\"copy\");\n        textarea.remove();\n      }\n      pushBanner({\n        type: \"success\",\n        message: \"Resumo copiado para a área de transferência.\",\n      });\n    } catch {\n      pushBanner({\n        type: \"error\",\n        message: \"Não consegui copiar o resumo.\",\n      });\n    }\n  };\n\n  const handleSaveNextStep = async () => {\n    setNextStepState(\"saving\");\n    setNextStepError(null);\n\n    if (nextStep.action.trim().length < 4) {\n      setNextStepState(\"error\");\n      setNextStepError(\"Defina uma ação objetiva para o próximo passo.\");\n      return;\n    }\n\n    if (!nextStep.dueAt) {\n      setNextStepState(\"error\");\n      setNextStepError(\"Defina a data para o próximo passo.\");\n      return;\n    }\n\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 220));\n      setNextStepState(\"saved\");\n      pushBanner({\n        type: \"success\",\n        message: \"Próximo passo salvo com sucesso.\",\n      });\n      window.setTimeout(() => setNextStepState(\"idle\"), 1600);\n    } catch {\n      setNextStepState(\"error\");\n      setNextStepError(\"Não consegui salvar o próximo passo. Tente novamente.\");\n    }\n  };\n\n  const handleOpenClientReturn = () => {\n    setFormMode(\"create\");\n    setEditingRoundId(null);\n    setFormError(null);\n    setFormSeed({\n      type: \"counter\",\n      actorRole: \"client\",\n      visibility: \"client\",\n      lifecycleStatus: \"awaiting\",\n      monthlyValue: String(\n        latestClientCounter?.monthlyValue ?? currentTerms?.monthlyValue ?? latestTeamOffer?.monthlyValue ?? 0,\n      ),\n      setupValue: String(\n        latestClientCounter?.setupValue ?? currentTerms?.setupValue ?? latestTeamOffer?.setupValue ?? 0,\n      ),\n      termMonths: String(\n        latestClientCounter?.termMonths ?? currentTerms?.termMonths ?? latestTeamOffer?.termMonths ?? 12,\n      ),\n      notes: \"\",\n      conditionsText: \"\",\n      rejectedReason: \"\",\n    });\n    setIsFormOpen(true);\n  };\n\n  const statusToneClass =\n    negotiationStatus.tone === \"success\"\n      ? \"border-emerald-200 bg-emerald-50 text-emerald-700\"\n      : negotiationStatus.tone === \"warning\"\n        ? \"border-amber-200 bg-amber-50 text-amber-700\"\n        : negotiationStatus.tone === \"info\"\n          ? \"border-sky-200 bg-sky-50 text-sky-700\"\n          : \"border-zinc-200 bg-zinc-100 text-zinc-600\";\n\n  return (\n    <div className=\"space-y-5\" data-deal-id={dealId}>\n      <header className=\"space-y-4 border-b border-zinc-100 pb-4\">\n        <div className=\"flex flex-wrap items-start justify-between gap-3\">\n          <div className=\"space-y-1\">\n            <div className=\"flex items-center gap-2\">\n              <div className=\"flex h-8 w-8 items-center justify-center rounded-lg border border-violet-200 bg-violet-50 text-violet-700\">\n                <Handshake className=\"h-4 w-4\" />\n              </div>\n              <h2 className=\"font-heading text-lg font-semibold text-zinc-900\">Negociação</h2>\n            </div>\n            <p className=\"pl-10 text-sm text-zinc-500\">\n              Rodadas, termos vigentes e próximo passo em uma única execução.\n            </p>\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"h-8 gap-1.5 rounded-full text-xs\"\n              onClick={handleExportSummary}\n              disabled={isExporting}\n            >\n              {isExporting ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <Download className=\"h-3.5 w-3.5\" />}\n              {isExporting ? \"Gerando...\" : \"Exportar resumo\"}\n            </Button>\n            <Button\n              size=\"sm\"\n              className=\"h-8 gap-1.5 rounded-full bg-zinc-900 text-xs text-white hover:bg-zinc-800\"\n              onClick={() => openCreateRound(latestTeamOffer)}\n            >\n              <Plus className=\"h-3.5 w-3.5\" />\n              Nova rodada\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"flex flex-wrap items-center justify-between gap-2\">\n          <div className={cn(\"inline-flex items-center gap-2 rounded-full border px-2.5 py-1 text-[11px] font-medium\", statusToneClass)}>\n            <Clock3 className=\"h-3.5 w-3.5\" />\n            {negotiationStatus.label}\n          </div>\n          <p className=\"text-xs text-zinc-500\">{negotiationStatus.description}</p>\n        </div>\n      </header>\n\n      {banner ? (\n        <div\n          className={cn(\n            \"rounded-lg border px-3 py-2 text-xs font-medium\",\n            banner.type === \"success\" && \"border-emerald-200 bg-emerald-50 text-emerald-700\",\n            banner.type === \"error\" && \"border-red-200 bg-red-50 text-red-700\",\n            banner.type === \"warning\" && \"border-amber-200 bg-amber-50 text-amber-700\",\n            banner.type === \"info\" && \"border-sky-200 bg-sky-50 text-sky-700\",\n          )}\n          role=\"status\"\n        >\n          {banner.message}\n        </div>\n      ) : null}\n\n      <div className=\"grid grid-cols-1 items-start gap-5 lg:grid-cols-12\">\n        <div className=\"space-y-4 lg:col-span-8 lg:min-h-[calc(100vh-24rem)] lg:space-y-3\">\n          <AnimatePresence>\n            {isFormOpen && (\n              <motion.div\n                initial={{ opacity: 0, y: -8 }}\n                animate={{ opacity: 1, y: 0 }}\n                exit={{ opacity: 0, y: -6 }}\n                transition={{ duration: 0.16 }}\n              >\n                <NegotiationRoundForm\n                  mode={formMode}\n                  seed={formSeed}\n                  isSaving={isSavingRound}\n                  errorMessage={formError}\n                  onCancel={closeForm}\n                  onSave={handleSaveRound}\n                />\n              </motion.div>\n            )}\n          </AnimatePresence>\n\n          {orderedRounds.length === 0 ? (\n            <EmptyState onStart={() => openCreateRound()} />\n          ) : (\n            <div className=\"relative space-y-2.5 rounded-2xl border border-zinc-200 bg-white p-3\">\n              <div className=\"absolute bottom-3 left-[1.35rem] top-3 w-px bg-zinc-200\" />\n\n              {orderedRounds.map((round, index) => (\n                <NegotiationRoundCard\n                  key={round.id}\n                  round={round}\n                  displayIndex={index + 1}\n                  isCurrentTerms={round.id === currentTermsRoundId}\n                  isLast={index === orderedRounds.length - 1}\n                  isHighlighted={highlightRoundId === round.id}\n                  loadingAction={rowActionLoading[round.id] ?? null}\n                  onEdit={openEditRound}\n                  onDelete={handleDeleteRound}\n                  onSend={handleMarkRoundSent}\n                  onAwaiting={handleMarkRoundAwaiting}\n                  onAccept={handleMarkRoundAccepted}\n                  onReject={handleMarkRoundRejected}\n                  onSetCurrent={handleSetCurrentTerms}\n                  onCreateFromRound={(item) => openCreateRound(item)}\n                />\n              ))}\n            </div>\n          )}\n\n          <NegotiationExecutionCard\n            hasRounds={orderedRounds.length > 0}\n            hasCurrentTerms={Boolean(currentTerms)}\n            sourceRound={currentTermsRound}\n            hasClientCounter={Boolean(latestClientCounter)}\n            nextStep={nextStep}\n            onCreateRound={() => openCreateRound(latestTeamOffer ?? currentTermsRound)}\n            onExport={handleExportSummary}\n            onRegisterClientReturn={handleOpenClientReturn}\n            onFocusNextStep={focusNextStepCard}\n            isExporting={isExporting}\n          />\n        </div>\n\n        <div className=\"space-y-4 lg:col-span-4 lg:sticky lg:top-4 lg:self-start\">\n          <CurrentTermsCard\n            terms={currentTerms}\n            sourceRound={currentTermsRound}\n            sourceRoundNumber={currentTermsRoundNumber}\n            onJumpToSourceRound={scrollToRound}\n            onCreateFromCurrent={() => openCreateRound(currentTermsRound)}\n          />\n\n          <NegotiationComparisonCard\n            currentOfferRound={currentTermsRound ?? latestTeamOffer}\n            lastClientCounter={latestClientCounter}\n          />\n\n          <NextStepCard\n            draft={nextStep}\n            saveState={nextStepState}\n            errorMessage={nextStepError}\n            onChange={setNextStep}\n            onSave={handleSaveNextStep}\n            highlighted={highlightNextStep}\n          />\n\n          <div className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n            <div className=\"space-y-1\">\n              <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Resumo para envio</h3>\n              <p className=\"text-xs text-zinc-500\">\n                O export usa os termos vigentes e ignora rodadas internas por padrão.\n              </p>\n            </div>\n\n            <div className=\"mt-3 flex flex-wrap items-center gap-2\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"h-8 gap-1.5 rounded-full text-xs\"\n                onClick={handleExportSummary}\n                disabled={isExporting}\n              >\n                {isExporting ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <Download className=\"h-3.5 w-3.5\" />}\n                Exportar\n              </Button>\n              <Button\n                type=\"button\"\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-8 gap-1.5 rounded-full text-xs text-zinc-600 hover:bg-zinc-100\"\n                onClick={handleCopySummary}\n                disabled={!exportSummaryText}\n              >\n                <Copy className=\"h-3.5 w-3.5\" />\n                Copiar texto\n              </Button>\n            </div>\n\n            {exportError ? (\n              <p className=\"mt-2 text-xs text-red-600\">{exportError}</p>\n            ) : null}\n            {exportSummaryText ? (\n              <p className=\"mt-2 text-xs text-emerald-700\">Resumo pronto para compartilhamento.</p>\n            ) : null}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction CurrentTermsCard({\n  terms,\n  sourceRound,\n  sourceRoundNumber,\n  onJumpToSourceRound,\n  onCreateFromCurrent,\n}: {\n  terms: NegotiationTermsState | null;\n  sourceRound: NegotiationRoundItem | null;\n  sourceRoundNumber: number | null;\n  onJumpToSourceRound: (roundId: string) => void;\n  onCreateFromCurrent: () => void;\n}) {\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n      <div className=\"space-y-1\">\n        <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Termos vigentes</h3>\n        <p className=\"text-xs text-zinc-500\">\n          Fonte de verdade para resumo e decisão de fechamento.\n        </p>\n      </div>\n\n      {!terms || !sourceRound ? (\n        <div className=\"mt-4 rounded-xl border border-dashed border-zinc-200 bg-zinc-50 p-3\">\n          <p className=\"text-xs text-zinc-600\">\n            Ainda não existem termos vigentes. Defina uma rodada do time como vigente.\n          </p>\n        </div>\n      ) : (\n        <div className=\"mt-4 space-y-3\">\n          <div className=\"grid grid-cols-2 gap-2\">\n            <StatCard label=\"Mensal\" value={formatCurrency(terms.monthlyValue)} />\n            <StatCard label=\"Setup\" value={formatCurrency(terms.setupValue)} />\n            <StatCard label=\"Prazo\" value={`${terms.termMonths} meses`} />\n            <StatCard label=\"Total\" value={formatCurrency(terms.totalValue)} />\n          </div>\n\n          <div className=\"flex flex-wrap items-center gap-2 text-[11px]\">\n            <button\n              type=\"button\"\n              onClick={() => onJumpToSourceRound(sourceRound.id)}\n              className=\"inline-flex h-6 items-center rounded-full border border-zinc-200 bg-zinc-100 px-2 text-[11px] font-medium text-zinc-700 transition-colors hover:border-brand/30 hover:text-brand\"\n            >\n              Rodada fonte: {sourceRoundNumber ? `Rodada ${sourceRoundNumber}` : sourceRound.id}\n            </button>\n            <Badge className={cn(\"border\", lifecycleMeta[sourceRound.lifecycleStatus].chipClass)}>\n              {lifecycleMeta[sourceRound.lifecycleStatus].label}\n            </Badge>\n            <Badge className={cn(\"border\", visibilityMeta[sourceRound.visibility].chipClass)}>\n              {visibilityMeta[sourceRound.visibility].label}\n            </Badge>\n          </div>\n\n          <p className=\"text-[11px] text-zinc-500\">\n            Atualizado por {terms.updatedBy} em {toDateTimeLabel(terms.updatedAt)}.\n          </p>\n        </div>\n      )}\n\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        size=\"sm\"\n        className=\"mt-4 h-8 w-full gap-1.5 rounded-full text-xs\"\n        onClick={onCreateFromCurrent}\n      >\n        <Plus className=\"h-3.5 w-3.5\" />\n        Nova rodada baseada na última oferta\n      </Button>\n    </div>\n  );\n}\n\nfunction StatCard({ label, value }: { label: string; value: string }) {\n  return (\n    <div className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-2.5\">\n      <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">{label}</p>\n      <p className=\"mt-1 text-sm font-semibold text-zinc-900\">{value}</p>\n    </div>\n  );\n}\n\nfunction NegotiationComparisonCard({\n  currentOfferRound,\n  lastClientCounter,\n}: {\n  currentOfferRound: NegotiationRoundItem | null;\n  lastClientCounter: NegotiationRoundItem | null;\n}) {\n  const deltaMonthly =\n    (lastClientCounter?.monthlyValue ?? 0) - (currentOfferRound?.monthlyValue ?? 0);\n  const deltaSetup =\n    (lastClientCounter?.setupValue ?? 0) - (currentOfferRound?.setupValue ?? 0);\n\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n      <div className=\"flex items-center gap-2\">\n        <GitCompareArrows className=\"h-4 w-4 text-zinc-500\" />\n        <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Comparador de negociação</h3>\n      </div>\n\n      <div className=\"mt-3 space-y-2\">\n        <div className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-3\">\n          <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">\n            Nossa última oferta\n          </p>\n          <p className=\"mt-1 text-sm font-semibold text-zinc-900\">\n            {currentOfferRound ? formatCurrency(currentOfferRound.monthlyValue ?? 0) : \"--\"} /mês\n          </p>\n          <p className=\"text-[11px] text-zinc-500\">\n            Setup {currentOfferRound ? formatCurrency(currentOfferRound.setupValue ?? 0) : \"--\"}\n          </p>\n        </div>\n\n        <div className=\"rounded-xl border border-amber-200 bg-amber-50/70 p-3\">\n          <p className=\"text-[10px] font-semibold uppercase tracking-wide text-amber-700\">\n            Última contra proposta do cliente\n          </p>\n          <p className=\"mt-1 text-sm font-semibold text-amber-900\">\n            {lastClientCounter ? formatCurrency(lastClientCounter.monthlyValue ?? 0) : \"--\"} /mês\n          </p>\n          <p className=\"text-[11px] text-amber-700\">\n            Setup {lastClientCounter ? formatCurrency(lastClientCounter.setupValue ?? 0) : \"--\"}\n          </p>\n        </div>\n      </div>\n\n      {currentOfferRound && lastClientCounter ? (\n        <div className=\"mt-3 grid grid-cols-2 gap-2\">\n          <div className=\"rounded-xl border border-zinc-200 bg-white p-2.5\">\n            <p className=\"text-[10px] uppercase tracking-wide text-zinc-500\">Delta mensal</p>\n            <p className={cn(\"mt-1 text-sm font-semibold\", deltaMonthly <= 0 ? \"text-emerald-700\" : \"text-amber-700\")}>\n              {deltaMonthly > 0 ? \"+\" : \"\"}\n              {formatCurrency(deltaMonthly)}\n            </p>\n          </div>\n          <div className=\"rounded-xl border border-zinc-200 bg-white p-2.5\">\n            <p className=\"text-[10px] uppercase tracking-wide text-zinc-500\">Delta setup</p>\n            <p className={cn(\"mt-1 text-sm font-semibold\", deltaSetup <= 0 ? \"text-emerald-700\" : \"text-amber-700\")}>\n              {deltaSetup > 0 ? \"+\" : \"\"}\n              {formatCurrency(deltaSetup)}\n            </p>\n          </div>\n        </div>\n      ) : (\n        <p className=\"mt-3 text-xs text-zinc-500\">\n          Registre ao menos uma proposta do time e uma contra proposta do cliente para comparar.\n        </p>\n      )}\n    </div>\n  );\n}\n\nfunction NextStepCard({\n  draft,\n  saveState,\n  errorMessage,\n  onChange,\n  onSave,\n  highlighted,\n}: {\n  draft: NextStepDraft;\n  saveState: \"idle\" | \"saving\" | \"saved\" | \"error\";\n  errorMessage: string | null;\n  onChange: (draft: NextStepDraft) => void;\n  onSave: () => void;\n  highlighted: boolean;\n}) {\n  return (\n    <div\n      className={cn(\n        \"rounded-2xl border border-zinc-200 bg-white p-4 transition-all duration-200\",\n        highlighted && \"ring-2 ring-brand/30\",\n      )}\n      data-next-step-card=\"true\"\n    >\n      <div className=\"flex items-center gap-2\">\n        <CalendarClock className=\"h-4 w-4 text-zinc-500\" />\n        <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Próximo passo</h3>\n      </div>\n      <p className=\"mt-1 text-xs text-zinc-500\">\n        Defina ação, data, canal e responsável para manter a negociação no ritmo.\n      </p>\n\n      <div className=\"mt-3 space-y-3\">\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Ação\n          </Label>\n          <Input\n            value={draft.action}\n            onChange={(event) => onChange({ ...draft, action: event.target.value })}\n            className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n            placeholder=\"Ex.: Ligar para validar objeção de setup\"\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-2\">\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Data\n            </Label>\n            <Input\n              type=\"date\"\n              value={draft.dueAt}\n              onChange={(event) => onChange({ ...draft, dueAt: event.target.value })}\n              className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n            />\n          </div>\n\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Canal\n            </Label>\n            <Select\n              value={draft.channel}\n              onValueChange={(value) =>\n                onChange({ ...draft, channel: value as NextStepDraft[\"channel\"] })\n              }\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {channelOptions.map((channel) => (\n                  <SelectItem key={channel.id} value={channel.id}>\n                    {channel.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Responsável\n          </Label>\n          <Select\n            value={draft.ownerId}\n            onValueChange={(value) => onChange({ ...draft, ownerId: value })}\n          >\n            <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n              <SelectValue />\n            </SelectTrigger>\n            <SelectContent>\n              {TEAM_OWNERS.map((owner) => (\n                <SelectItem key={owner.id} value={owner.id}>\n                  {owner.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          className=\"h-8 w-full rounded-full bg-zinc-900 text-xs text-white hover:bg-zinc-800\"\n          onClick={onSave}\n          disabled={saveState === \"saving\"}\n        >\n          {saveState === \"saving\" ? (\n            <>\n              <Loader2 className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" />\n              Salvando...\n            </>\n          ) : (\n            \"Salvar próximo passo\"\n          )}\n        </Button>\n\n        {saveState === \"saved\" ? (\n          <p className=\"text-xs text-emerald-700\">Próximo passo salvo.</p>\n        ) : null}\n        {saveState === \"error\" && errorMessage ? (\n          <p className=\"text-xs text-red-600\">{errorMessage}</p>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n\nfunction NegotiationExecutionCard({\n  hasRounds,\n  hasCurrentTerms,\n  sourceRound,\n  hasClientCounter,\n  nextStep,\n  onCreateRound,\n  onExport,\n  onRegisterClientReturn,\n  onFocusNextStep,\n  isExporting,\n}: {\n  hasRounds: boolean;\n  hasCurrentTerms: boolean;\n  sourceRound: NegotiationRoundItem | null;\n  hasClientCounter: boolean;\n  nextStep: NextStepDraft;\n  onCreateRound: () => void;\n  onExport: () => void;\n  onRegisterClientReturn: () => void;\n  onFocusNextStep: () => void;\n  isExporting: boolean;\n}) {\n  const nextStepReady = nextStep.action.trim().length >= 4 && Boolean(nextStep.dueAt);\n  const dueAtDate = nextStep.dueAt ? new Date(`${nextStep.dueAt}T00:00:00`) : null;\n  const dueAtLabel =\n    dueAtDate && !Number.isNaN(dueAtDate.getTime())\n      ? format(dueAtDate, \"dd MMM\", { locale: ptBR })\n      : \"Sem data\";\n  const sourceSent =\n    sourceRound?.visibility === \"client\" &&\n    (sourceRound.lifecycleStatus === \"sent\" ||\n      sourceRound.lifecycleStatus === \"awaiting\" ||\n      sourceRound.lifecycleStatus === \"accepted\");\n\n  const checklistItems = [\n    {\n      id: \"terms\",\n      label: \"Termos vigentes definidos\",\n      done: hasCurrentTerms,\n    },\n    {\n      id: \"source\",\n      label: \"Rodada vigente enviada ao cliente\",\n      done: sourceSent,\n    },\n    {\n      id: \"counter\",\n      label: \"Retorno do cliente registrado\",\n      done: hasClientCounter,\n    },\n    {\n      id: \"next-step\",\n      label: \"Próximo passo com data\",\n      done: nextStepReady,\n    },\n  ];\n\n  return (\n    <section className=\"rounded-2xl border border-zinc-200 bg-white p-4\">\n      <div className=\"flex flex-wrap items-start justify-between gap-2\">\n        <div>\n          <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">Execução da negociação</h3>\n          <p className=\"mt-1 text-xs text-zinc-500\">\n            Fechamento visual da timeline com checklist e ações rápidas da rodada vigente.\n          </p>\n        </div>\n        {!hasRounds ? (\n          <Badge className=\"border-zinc-200 bg-zinc-100 text-[10px] text-zinc-600\">Sem rodadas</Badge>\n        ) : null}\n      </div>\n\n      <div className=\"mt-3 rounded-xl border border-zinc-200 bg-zinc-50/80 p-3\">\n        <div className=\"flex items-center justify-between gap-2\">\n          <p className=\"text-xs font-medium text-zinc-800\">Próximo passo</p>\n          <button\n            type=\"button\"\n            className=\"text-[11px] font-medium text-brand transition-colors hover:text-brand/80\"\n            onClick={onFocusNextStep}\n          >\n            Editar\n          </button>\n        </div>\n        <p className=\"mt-1 text-xs text-zinc-600\">\n          {nextStepReady\n            ? `${nextStep.action} · ${dueAtLabel} · ${\n                channelOptions.find((channel) => channel.id === nextStep.channel)?.label ?? \"Canal\"\n              }`\n            : \"Defina ação, data e canal para não perder o timing da negociação.\"}\n        </p>\n      </div>\n\n      <div className=\"mt-3 grid gap-2 sm:grid-cols-2\">\n        {checklistItems.map((item) => (\n          <div\n            key={item.id}\n            className={cn(\n              \"flex items-center gap-2 rounded-lg border px-2.5 py-2\",\n              item.done\n                ? \"border-emerald-200 bg-emerald-50 text-emerald-700\"\n                : \"border-zinc-200 bg-zinc-50 text-zinc-600\",\n            )}\n          >\n            {item.done ? (\n              <CheckCircle2 className=\"h-3.5 w-3.5\" />\n            ) : (\n              <Clock3 className=\"h-3.5 w-3.5\" />\n            )}\n            <span className=\"text-[11px] font-medium\">{item.label}</span>\n          </div>\n        ))}\n      </div>\n\n      <div className=\"mt-3 flex flex-wrap items-center gap-2\">\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          className=\"h-8 rounded-full bg-zinc-900 px-3 text-xs text-white hover:bg-zinc-800\"\n          onClick={onCreateRound}\n        >\n          <Plus className=\"mr-1.5 h-3.5 w-3.5\" />\n          Nova rodada\n        </Button>\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          variant=\"outline\"\n          className=\"h-8 rounded-full px-3 text-xs\"\n          onClick={onRegisterClientReturn}\n        >\n          Registrar retorno do cliente\n        </Button>\n        <Button\n          type=\"button\"\n          size=\"sm\"\n          variant=\"outline\"\n          className=\"h-8 rounded-full px-3 text-xs\"\n          onClick={onExport}\n          disabled={isExporting}\n        >\n          {isExporting ? <Loader2 className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" /> : <Download className=\"mr-1.5 h-3.5 w-3.5\" />}\n          Exportar resumo\n        </Button>\n      </div>\n    </section>\n  );\n}\n\nfunction NegotiationRoundCard({\n  round,\n  displayIndex,\n  isCurrentTerms,\n  isLast,\n  isHighlighted,\n  loadingAction,\n  onEdit,\n  onDelete,\n  onSend,\n  onAwaiting,\n  onAccept,\n  onReject,\n  onSetCurrent,\n  onCreateFromRound,\n}: {\n  round: NegotiationRoundItem;\n  displayIndex: number;\n  isCurrentTerms: boolean;\n  isLast: boolean;\n  isHighlighted: boolean;\n  loadingAction: RowAction | null;\n  onEdit: (round: NegotiationRoundItem) => void;\n  onDelete: (round: NegotiationRoundItem) => void;\n  onSend: (round: NegotiationRoundItem) => void;\n  onAwaiting: (round: NegotiationRoundItem) => void;\n  onAccept: (round: NegotiationRoundItem) => void;\n  onReject: (round: NegotiationRoundItem) => void;\n  onSetCurrent: (round: NegotiationRoundItem) => void;\n  onCreateFromRound: (round: NegotiationRoundItem) => void;\n}) {\n  const [expanded, setExpanded] = useState(isLast);\n  const typeMeta = roundTypeMeta[round.type];\n  const TypeIcon = typeMeta.icon;\n\n  const canSend = isTeamOfferCandidate(round) && round.lifecycleStatus === \"draft\";\n  const canAwaiting = round.lifecycleStatus === \"sent\";\n  const canAccept = round.lifecycleStatus === \"sent\" || round.lifecycleStatus === \"awaiting\";\n  const canReject = round.lifecycleStatus === \"sent\" || round.lifecycleStatus === \"awaiting\";\n  const canSetCurrent = isTeamOfferCandidate(round) && round.lifecycleStatus !== \"draft\";\n  const canEdit = isRoundEditable(round);\n  const canDelete = isRoundDeletable(round);\n\n  return (\n    <div className=\"relative pl-6\" data-round-anchor={round.id}>\n      <div\n        className={cn(\n          \"absolute left-3 top-5 h-6 w-6 -translate-x-1/2 rounded-full border-2 bg-white\",\n          isCurrentTerms ? \"border-brand\" : \"border-zinc-300\",\n        )}\n      >\n        <div\n          className={cn(\n            \"absolute left-1/2 top-1/2 h-2 w-2 -translate-x-1/2 -translate-y-1/2 rounded-full\",\n            isCurrentTerms ? \"bg-brand\" : \"bg-zinc-300\",\n          )}\n        />\n      </div>\n\n      <motion.div\n        layout\n        className={cn(\n          \"rounded-xl border bg-white shadow-sm transition-all duration-200\",\n          expanded && \"ring-1 ring-zinc-200\",\n          isHighlighted && \"border-brand/50 ring-2 ring-brand/20\",\n        )}\n      >\n        <button\n          type=\"button\"\n          className=\"flex w-full items-center gap-3 p-3 text-left\"\n          onClick={() => setExpanded((prev) => !prev)}\n        >\n          <div className={cn(\"flex h-8 w-8 shrink-0 items-center justify-center rounded-lg border\", typeMeta.badgeClass)}>\n            <TypeIcon className=\"h-4 w-4\" />\n          </div>\n\n          <div className=\"min-w-0 flex-1 space-y-1\">\n            <div className=\"flex flex-wrap items-center gap-1.5\">\n              <span className=\"text-[11px] font-bold uppercase tracking-wide text-zinc-500\">\n                Rodada {displayIndex}\n              </span>\n              <Badge className={cn(\"border text-[10px]\", typeMeta.badgeClass)}>{typeMeta.label}</Badge>\n              <Badge className={cn(\"border text-[10px]\", lifecycleMeta[round.lifecycleStatus].chipClass)}>\n                {lifecycleMeta[round.lifecycleStatus].label}\n              </Badge>\n              <Badge className={cn(\"border text-[10px]\", visibilityMeta[round.visibility].chipClass)}>\n                {visibilityMeta[round.visibility].label}\n              </Badge>\n              {isCurrentTerms ? (\n                <Badge className=\"border-emerald-200 bg-emerald-50 text-[10px] text-emerald-700\">\n                  Fonte dos termos vigentes\n                </Badge>\n              ) : null}\n            </div>\n\n            <div className=\"flex flex-wrap items-center gap-2.5 text-xs text-zinc-600\">\n              <span className=\"font-medium text-zinc-800\">{round.authorName}</span>\n              <span>{formatCurrency(round.monthlyValue ?? 0)} /mês</span>\n              <span>Setup {formatCurrency(round.setupValue ?? 0)}</span>\n              <span className=\"text-zinc-500\">{round.termMonths ?? 12} meses</span>\n            </div>\n            <div className=\"text-[11px] text-zinc-400\">\n              Criada em {toDateTimeLabel(round.createdAt)}\n              {round.sentAt ? ` · Enviada em ${toDateTimeLabel(round.sentAt)}` : \"\"}\n            </div>\n          </div>\n\n          {expanded ? <ChevronUp className=\"h-4 w-4 text-zinc-400\" /> : <ChevronDown className=\"h-4 w-4 text-zinc-400\" />}\n        </button>\n\n        <AnimatePresence>\n          {expanded && (\n            <motion.div\n              initial={{ opacity: 0, height: 0 }}\n              animate={{ opacity: 1, height: \"auto\" }}\n              exit={{ opacity: 0, height: 0 }}\n              transition={{ duration: 0.16 }}\n              className=\"overflow-hidden\"\n            >\n              <div className=\"space-y-3 px-3 pb-3 pt-0\">\n                <Separator />\n\n                {isTermsRequired(round.type) ? (\n                  <div className=\"grid grid-cols-1 gap-2 sm:grid-cols-2\">\n                    <StatCard label=\"Mensal\" value={formatCurrency(round.monthlyValue ?? 0)} />\n                    <StatCard label=\"Setup\" value={formatCurrency(round.setupValue ?? 0)} />\n                    <StatCard label=\"Prazo\" value={`${round.termMonths ?? 12} meses`} />\n                    <StatCard label=\"Total\" value={formatCurrency(round.totalValue ?? 0)} />\n                  </div>\n                ) : (\n                  <div className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-3 text-xs text-zinc-600\">\n                    Ajuste interno sem alteração direta de termos vigentes.\n                  </div>\n                )}\n\n                {round.conditions.length > 0 ? (\n                  <div className=\"space-y-2\">\n                    <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">Condições</p>\n                    <div className=\"flex flex-wrap gap-1.5\">\n                      {round.conditions.slice(0, 3).map((condition) => (\n                        <Badge\n                          key={`${round.id}-${condition}`}\n                          className=\"border-zinc-200 bg-zinc-100 text-[10px] font-normal text-zinc-700\"\n                        >\n                          {condition}\n                        </Badge>\n                      ))}\n                      {round.conditions.length > 3 ? (\n                        <Badge className=\"border-zinc-200 bg-zinc-100 text-[10px] font-normal text-zinc-700\">\n                          +{round.conditions.length - 3}\n                        </Badge>\n                      ) : null}\n                    </div>\n                  </div>\n                ) : null}\n\n                {round.details ? (\n                  <div className=\"space-y-1.5\">\n                    <p className=\"text-[10px] font-semibold uppercase tracking-wide text-zinc-500\">Observações</p>\n                    <p className=\"rounded-xl border border-zinc-200 bg-zinc-50/80 p-3 text-xs text-zinc-700\">\n                      {round.details}\n                    </p>\n                  </div>\n                ) : null}\n\n                {round.rejectedReason ? (\n                  <p className=\"rounded-lg border border-red-200 bg-red-50 px-2.5 py-2 text-xs text-red-700\">\n                    Motivo da rejeição: {round.rejectedReason}\n                  </p>\n                ) : null}\n\n                <div className=\"flex flex-wrap items-center gap-1.5\">\n                  <ActionButton\n                    label=\"Marcar enviada\"\n                    icon={Send}\n                    visible={canSend}\n                    loading={loadingAction === \"send\"}\n                    onClick={() => onSend(round)}\n                  />\n                  <ActionButton\n                    label=\"Aguardando\"\n                    icon={Clock3}\n                    visible={canAwaiting}\n                    loading={loadingAction === \"awaiting\"}\n                    onClick={() => onAwaiting(round)}\n                  />\n                  <ActionButton\n                    label=\"Aceita\"\n                    icon={CheckCircle2}\n                    visible={canAccept}\n                    loading={loadingAction === \"accept\"}\n                    onClick={() => onAccept(round)}\n                  />\n                  <ActionButton\n                    label=\"Rejeitar\"\n                    icon={XCircle}\n                    visible={canReject}\n                    loading={loadingAction === \"reject\"}\n                    onClick={() => onReject(round)}\n                  />\n                  <ActionButton\n                    label=\"Definir vigente\"\n                    icon={BadgeCheck}\n                    visible={canSetCurrent && !isCurrentTerms}\n                    loading={loadingAction === \"set-current\"}\n                    onClick={() => onSetCurrent(round)}\n                  />\n                  <ActionButton\n                    label=\"Nova rodada\"\n                    icon={Plus}\n                    visible\n                    loading={false}\n                    onClick={() => onCreateFromRound(round)}\n                  />\n                  <ActionButton\n                    label=\"Editar\"\n                    icon={Pencil}\n                    visible={canEdit}\n                    loading={loadingAction === \"save-edit\"}\n                    onClick={() => onEdit(round)}\n                  />\n                  <ActionButton\n                    label=\"Excluir\"\n                    icon={Trash2}\n                    visible={canDelete}\n                    loading={loadingAction === \"delete\"}\n                    onClick={() => onDelete(round)}\n                  />\n                </div>\n              </div>\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </motion.div>\n    </div>\n  );\n}\n\nfunction ActionButton({\n  label,\n  icon: Icon,\n  visible,\n  loading,\n  onClick,\n}: {\n  label: string;\n  icon: typeof Send;\n  visible: boolean;\n  loading: boolean;\n  onClick: () => void;\n}) {\n  if (!visible) return null;\n\n  return (\n    <Button\n      type=\"button\"\n      size=\"sm\"\n      variant=\"outline\"\n      className=\"h-7 gap-1.5 rounded-full px-2.5 text-[11px]\"\n      onClick={onClick}\n      disabled={loading}\n    >\n      {loading ? <Loader2 className=\"h-3.5 w-3.5 animate-spin\" /> : <Icon className=\"h-3.5 w-3.5\" />}\n      {label}\n    </Button>\n  );\n}\n\nfunction EmptyState({ onStart }: { onStart: () => void }) {\n  return (\n    <div className=\"rounded-2xl border border-dashed border-zinc-200 bg-zinc-50/70 p-8 text-center\">\n      <div className=\"mx-auto flex h-11 w-11 items-center justify-center rounded-full bg-zinc-100 text-zinc-500\">\n        <Handshake className=\"h-5 w-5\" />\n      </div>\n      <h3 className=\"mt-3 font-heading text-base font-semibold text-zinc-900\">\n        Nenhuma rodada registrada\n      </h3>\n      <p className=\"mt-1 text-sm text-zinc-500\">\n        Registre a primeira rodada para iniciar os termos e o fluxo de decisão.\n      </p>\n      <Button\n        type=\"button\"\n        variant=\"outline\"\n        className=\"mt-4 h-8 rounded-full text-xs\"\n        onClick={onStart}\n      >\n        <Plus className=\"mr-1.5 h-3.5 w-3.5\" />\n        Registrar primeira rodada\n      </Button>\n    </div>\n  );\n}\n\nfunction NegotiationRoundForm({\n  mode,\n  seed,\n  isSaving,\n  errorMessage,\n  onCancel,\n  onSave,\n}: {\n  mode: \"create\" | \"edit\";\n  seed: RoundFormSeed;\n  isSaving: boolean;\n  errorMessage: string | null;\n  onCancel: () => void;\n  onSave: (payload: RoundFormPayload) => Promise<void> | void;\n}) {\n  const [draft, setDraft] = useState<RoundFormSeed>(seed);\n  const [fieldError, setFieldError] = useState<string | null>(null);\n\n  const requiresTerms = isTermsRequired(draft.type);\n  const isInternal = draft.type === \"internal\" || draft.visibility === \"internal\";\n\n  const submit = async (event: React.FormEvent) => {\n    event.preventDefault();\n    setFieldError(null);\n\n    if (requiresTerms) {\n      const monthly = toInputNumber(draft.monthlyValue);\n      const setup = toInputNumber(draft.setupValue);\n      const term = toInputNumber(draft.termMonths);\n\n      if (monthly < 0 || monthly > 999999) {\n        setFieldError(\"Valor mensal inválido.\");\n        return;\n      }\n      if (setup < 0 || setup > 999999) {\n        setFieldError(\"Valor de setup inválido.\");\n        return;\n      }\n      if (term < 1 || term > 36) {\n        setFieldError(\"Prazo deve estar entre 1 e 36 meses.\");\n        return;\n      }\n    }\n\n    if (\n      draft.lifecycleStatus === \"rejected\" &&\n      draft.rejectedReason.trim().length < 5\n    ) {\n      setFieldError(\"Informe motivo de rejeição com pelo menos 5 caracteres.\");\n      return;\n    }\n\n    if (\n      (draft.lifecycleStatus === \"sent\" || draft.lifecycleStatus === \"awaiting\") &&\n      draft.visibility === \"internal\"\n    ) {\n      setFieldError(\"Rodadas internas não podem ser marcadas como enviadas.\");\n      return;\n    }\n\n    if (draft.notes.trim().length > 0 && draft.notes.trim().length < MIN_NOTES_LENGTH) {\n      setFieldError(`Observações devem ter no mínimo ${MIN_NOTES_LENGTH} caracteres.`);\n      return;\n    }\n\n    const payload: RoundFormPayload = {\n      type: draft.type,\n      actorRole: draft.actorRole,\n      visibility: draft.visibility,\n      lifecycleStatus: draft.lifecycleStatus,\n      monthlyValue: requiresTerms ? toInputNumber(draft.monthlyValue) : 0,\n      setupValue: requiresTerms ? toInputNumber(draft.setupValue) : 0,\n      termMonths: requiresTerms ? toInputNumber(draft.termMonths) : 12,\n      notes: draft.notes.trim(),\n      conditions: draft.conditionsText\n        .split(\",\")\n        .map((condition) => condition.trim())\n        .filter(Boolean),\n      rejectedReason: draft.lifecycleStatus === \"rejected\" ? draft.rejectedReason.trim() : undefined,\n    };\n\n    await onSave(payload);\n  };\n\n  return (\n    <div className=\"rounded-2xl border border-zinc-200 bg-white p-4 shadow-sm\">\n      <div className=\"mb-3 flex items-center justify-between\">\n        <div>\n          <h3 className=\"font-heading text-sm font-semibold text-zinc-900\">\n            {mode === \"create\" ? \"Nova rodada\" : \"Editar rodada\"}\n          </h3>\n          <p className=\"text-xs text-zinc-500\">\n            Defina tipo, status, termos e condições com validação antes de salvar.\n          </p>\n        </div>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-7 rounded-full px-2.5 text-xs\"\n          onClick={onCancel}\n        >\n          Cancelar\n        </Button>\n      </div>\n\n      <form className=\"space-y-3\" onSubmit={submit}>\n        <div className=\"grid grid-cols-1 gap-3 md:grid-cols-2\">\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Tipo da rodada\n            </Label>\n            <Select\n              value={draft.type}\n              onValueChange={(value) => {\n                const nextType = value as NegotiationType;\n                setDraft((prev) => ({\n                  ...prev,\n                  type: nextType,\n                  actorRole: nextType === \"counter\" ? \"client\" : \"team\",\n                  visibility: nextType === \"internal\" ? \"internal\" : prev.visibility,\n                  lifecycleStatus:\n                    nextType === \"internal\" ? \"draft\" : prev.lifecycleStatus,\n                }));\n              }}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {roundTypeOptions.map((option) => (\n                  <SelectItem key={option.id} value={option.id}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Status operacional\n            </Label>\n            <Select\n              value={draft.lifecycleStatus}\n              onValueChange={(value) =>\n                setDraft((prev) => ({\n                  ...prev,\n                  lifecycleStatus: value as RoundLifecycleStatus,\n                }))\n              }\n              disabled={isInternal}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {lifecycleOptions.map((option) => (\n                  <SelectItem key={option.id} value={option.id}>\n                    {option.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 gap-3 md:grid-cols-2\">\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Origem\n            </Label>\n            <Select\n              value={draft.actorRole}\n              onValueChange={(value) =>\n                setDraft((prev) => ({\n                  ...prev,\n                  actorRole: value as RoundActorRole,\n                }))\n              }\n              disabled={draft.type === \"counter\"}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"team\">Time interno</SelectItem>\n                <SelectItem value=\"client\">Cliente</SelectItem>\n                <SelectItem value=\"system\">Sistema</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Visibilidade\n            </Label>\n            <Select\n              value={draft.visibility}\n              onValueChange={(value) =>\n                setDraft((prev) => ({\n                  ...prev,\n                  visibility: value as RoundVisibility,\n                  lifecycleStatus:\n                    value === \"internal\" ? \"draft\" : prev.lifecycleStatus,\n                }))\n              }\n              disabled={draft.type === \"internal\"}\n            >\n              <SelectTrigger className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"client\">Visível ao cliente</SelectItem>\n                <SelectItem value=\"internal\">Interna</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n\n        {requiresTerms ? (\n          <div className=\"grid grid-cols-1 gap-3 md:grid-cols-3\">\n            <div>\n              <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n                Mensal\n              </Label>\n              <Input\n                type=\"number\"\n                min={0}\n                max={999999}\n                value={draft.monthlyValue}\n                onChange={(event) =>\n                  setDraft((prev) => ({ ...prev, monthlyValue: event.target.value }))\n                }\n                className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n                Setup\n              </Label>\n              <Input\n                type=\"number\"\n                min={0}\n                max={999999}\n                value={draft.setupValue}\n                onChange={(event) =>\n                  setDraft((prev) => ({ ...prev, setupValue: event.target.value }))\n                }\n                className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n                placeholder=\"0\"\n              />\n            </div>\n            <div>\n              <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n                Prazo (meses)\n              </Label>\n              <Input\n                type=\"number\"\n                min={1}\n                max={36}\n                value={draft.termMonths}\n                onChange={(event) =>\n                  setDraft((prev) => ({ ...prev, termMonths: event.target.value }))\n                }\n                className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n                placeholder=\"12\"\n              />\n            </div>\n          </div>\n        ) : null}\n\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Condições (separe por vírgula)\n          </Label>\n          <Input\n            value={draft.conditionsText}\n            onChange={(event) =>\n              setDraft((prev) => ({ ...prev, conditionsText: event.target.value }))\n            }\n            className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n            placeholder=\"Ex.: Setup reduzido, carência de 15 dias\"\n          />\n        </div>\n\n        <div>\n          <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n            Observações\n          </Label>\n          <Textarea\n            value={draft.notes}\n            onChange={(event) =>\n              setDraft((prev) => ({ ...prev, notes: event.target.value }))\n            }\n            className=\"mt-1 min-h-[86px] resize-none rounded-lg border-zinc-200 text-xs\"\n            placeholder=\"Contexto da rodada e próximos pontos de negociação...\"\n          />\n        </div>\n\n        {draft.lifecycleStatus === \"rejected\" ? (\n          <div>\n            <Label className=\"text-[10px] font-semibold uppercase tracking-wider text-zinc-500\">\n              Motivo da rejeição\n            </Label>\n            <Input\n              value={draft.rejectedReason}\n              onChange={(event) =>\n                setDraft((prev) => ({ ...prev, rejectedReason: event.target.value }))\n              }\n              className=\"mt-1 h-9 rounded-lg border-zinc-200 text-xs\"\n              placeholder=\"Ex.: Cliente não aprovou condição de setup\"\n            />\n          </div>\n        ) : null}\n\n        {fieldError ? (\n          <p className=\"text-xs text-red-600\">{fieldError}</p>\n        ) : null}\n        {errorMessage ? <p className=\"text-xs text-red-600\">{errorMessage}</p> : null}\n\n        <div className=\"flex justify-end gap-2 pt-1\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"h-8 rounded-full px-3 text-xs\"\n            onClick={onCancel}\n          >\n            Fechar\n          </Button>\n          <Button\n            type=\"submit\"\n            size=\"sm\"\n            className=\"h-8 rounded-full bg-zinc-900 px-3 text-xs text-white hover:bg-zinc-800\"\n            disabled={isSaving}\n          >\n            {isSaving ? (\n              <>\n                <Loader2 className=\"mr-1.5 h-3.5 w-3.5 animate-spin\" />\n                Salvando...\n              </>\n            ) : mode === \"create\" ? (\n              \"Salvar rodada\"\n            ) : (\n              \"Salvar alterações\"\n            )}\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5943, "column": 0}, "map": {"version":3,"sources":["file:///Users/fernandocalado/Desktop/menux-flow/src/components/drawers/client-card-drawer.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useEffect, useMemo } from \"react\";\nimport {\n  X,\n  Mail,\n  Phone,\n  Building2,\n  User,\n  Calendar,\n  Heart,\n  AlertTriangle,\n  XCircle,\n  Clock,\n  MoreHorizontal,\n  DollarSign,\n  Tag,\n  Plus,\n  Trash2,\n  Shield,\n  Check,\n  Pencil,\n  MapPin,\n  FileText,\n  TrendingUp,\n  Activity,\n  ArrowRight,\n  Users,\n  LogIn,\n  ThumbsUp,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { InlineFeedback } from \"@/components/ui/inline-feedback\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { PhoneInput } from \"@/components/ui/masked-inputs\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useUIStore } from \"@/stores/ui-store\";\nimport type { Contact, HealthScore, ClientStage } from \"@/types\";\nimport { calculateHealthScore, RESTAURANT_POSITIONS } from \"@/lib/business-rules\";\nimport { useClientStore } from \"@/stores/client-store\";\n\n// ── Health config ───────────────────────────────────────────────────────────\nconst healthConfig: Record<\n  HealthScore,\n  { label: string; color: string; bgColor: string; icon: React.ReactNode; numericScore: number }\n> = {\n  good: {\n    label: \"Saudavel\",\n    color: \"text-status-success\",\n    bgColor: \"bg-status-success-light\",\n    icon: <Heart className=\"h-4 w-4 fill-current text-status-success\" />,\n    numericScore: 85,\n  },\n  warning: {\n    label: \"Atencao\",\n    color: \"text-status-warning\",\n    bgColor: \"bg-status-warning-light\",\n    icon: <AlertTriangle className=\"h-4 w-4 text-status-warning\" />,\n    numericScore: 55,\n  },\n  critical: {\n    label: \"Critico\",\n    color: \"text-status-danger\",\n    bgColor: \"bg-status-danger-light\",\n    icon: <XCircle className=\"h-4 w-4 text-status-danger\" />,\n    numericScore: 20,\n  },\n};\n\n// ── Client Stage config ─────────────────────────────────────────────────────\nconst clientStageConfig: { id: ClientStage; label: string }[] = [\n  { id: \"onboarding\", label: \"Onboarding\" },\n  { id: \"implantacao\", label: \"Implantacao\" },\n  { id: \"acompanhamento\", label: \"Acompanhamento\" },\n  { id: \"retencao\", label: \"Retencao\" },\n  { id: \"churn\", label: \"Churn\" },\n];\n\n// ── Mock data ───────────────────────────────────────────────────────────────\nconst mockClient = {\n  id: \"1\",\n  companyName: \"Restaurante Panoramico\",\n  cnpj: \"12.345.678/0001-00\",\n  razaoSocial: \"Restaurante Panoramico Ltda ME\",\n  endereco: \"Av. Paulista, 1000 - Bela Vista, Sao Paulo - SP\",\n  telefoneEmpresa: \"(11) 3456-7890\",\n  emailEmpresa: \"contato@panoramico.com\",\n  stage: \"acompanhamento\" as ClientStage,\n  healthScore: \"good\" as HealthScore,\n  monthlyRevenue: 2500,\n  contractStart: \"2025-06-01\",\n  contractEnd: \"2026-06-01\",\n  responsibleId: \"u1\",\n  responsibleName: \"Maria Silva\",\n  tags: [\"food-service\", \"restaurante\", \"premium\"],\n  lastInteraction: \"2026-02-03\",\n  groupName: \"Grupo Panoramico\",\n  notes: \"Cliente com excelente engajamento. Acompanhar renovacao do contrato em junho.\",\n};\n\nconst mockContacts: Contact[] = [\n  {\n    id: \"c1\",\n    clientId: \"client-mock\",\n    nome: \"Ana Costa\",\n    email: \"ana@panoramico.com\",\n    telefone: \"(11) 99999-0001\",\n    cargo: \"diretor\",\n    personalidade: \"Visionária e estratégica, gosta de entender o impacto no negócio como um todo.\",\n    isDecisionMaker: true,\n  },\n  {\n    id: \"c2\",\n    clientId: \"client-mock\",\n    nome: \"Bruno Oliveira\",\n    email: \"bruno@panoramico.com\",\n    telefone: \"(11) 99999-0002\",\n    cargo: \"gerente\",\n    personalidade: \"Prático e focado em eficiência operacional. Valoriza facilidade de uso.\",\n    isDecisionMaker: false,\n  },\n];\n\nfunction getCargoLabel(value: string): string {\n  return RESTAURANT_POSITIONS.find((p) => p.value === value)?.label ?? value;\n}\n\nfunction getPatentScore(cargo: string): number {\n  return RESTAURANT_POSITIONS.find((p) => p.value === cargo)?.patentScore ?? 0;\n}\n\nconst mockTeamMembers = [\n  { id: \"u1\", name: \"Maria Silva\", avatar: \"\" },\n  { id: \"u2\", name: \"Pedro Santos\", avatar: \"\" },\n  { id: \"u3\", name: \"Julia Fernandes\", avatar: \"\" },\n  { id: \"u4\", name: \"Rafael Costa\", avatar: \"\" },\n];\n\nconst mockMrrHistory = [\n  { month: \"Set\", value: 1800 },\n  { month: \"Out\", value: 2000 },\n  { month: \"Nov\", value: 2200 },\n  { month: \"Dez\", value: 2300 },\n  { month: \"Jan\", value: 2500 },\n  { month: \"Fev\", value: 2500 },\n];\n\nconst mockMetrics = {\n  usageScore: 82,\n  daysSinceLastLogin: 2,\n  npsScore: 9,\n};\n\nconst mockTimeline = [\n  {\n    id: \"t1\",\n    type: \"created\",\n    message: \"Cliente criado a partir de oportunidade ganha\",\n    user: \"Maria Silva\",\n    date: \"01/06/2025 10:00\",\n  },\n  {\n    id: \"t2\",\n    type: \"stage-change\",\n    message: \"Movido de Onboarding para Implantacao\",\n    user: \"Maria Silva\",\n    date: \"15/06/2025 14:30\",\n  },\n  {\n    id: \"t3\",\n    type: \"stage-change\",\n    message: \"Movido de Implantacao para Acompanhamento\",\n    user: \"Maria Silva\",\n    date: \"01/08/2025 09:00\",\n  },\n  {\n    id: \"t4\",\n    type: \"activity\",\n    message: \"Reuniao trimestral de acompanhamento realizada\",\n    user: \"Maria Silva\",\n    date: \"01/11/2025 15:00\",\n  },\n  {\n    id: \"t5\",\n    type: \"value-change\",\n    message: \"MRR alterado de R$ 2.000 para R$ 2.500 (upsell)\",\n    user: \"Pedro Santos\",\n    date: \"15/01/2026 11:30\",\n  },\n  {\n    id: \"t6\",\n    type: \"health-change\",\n    message: \"Health score atualizado para Saudavel\",\n    user: \"Sistema\",\n    date: \"03/02/2026 08:00\",\n  },\n];\n\nconst churnReasons = [\n  \"Preco muito alto\",\n  \"Nao utiliza o produto\",\n  \"Mudou para concorrente\",\n  \"Empresa fechou\",\n  \"Insatisfacao com suporte\",\n  \"Falta de funcionalidades\",\n  \"Outro\",\n];\n\nfunction formatCurrency(value: number) {\n  return new Intl.NumberFormat(\"pt-BR\", {\n    style: \"currency\",\n    currency: \"BRL\",\n    minimumFractionDigits: 0,\n  }).format(value);\n}\n\nfunction getTimelineIcon(type: string) {\n  switch (type) {\n    case \"created\":\n      return <Plus className=\"h-3.5 w-3.5\" />;\n    case \"activity\":\n      return <Calendar className=\"h-3.5 w-3.5\" />;\n    case \"stage-change\":\n      return <ArrowRight className=\"h-3.5 w-3.5\" />;\n    case \"note\":\n      return <FileText className=\"h-3.5 w-3.5\" />;\n    case \"tag-added\":\n      return <Tag className=\"h-3.5 w-3.5\" />;\n    case \"value-change\":\n      return <DollarSign className=\"h-3.5 w-3.5\" />;\n    case \"health-change\":\n      return <Heart className=\"h-3.5 w-3.5\" />;\n    default:\n      return <Clock className=\"h-3.5 w-3.5\" />;\n  }\n}\n\n// ── Editable Field Row ──────────────────────────────────────────────────────\nfunction EditableField({\n  icon,\n  label,\n  value,\n  onSave,\n  type = \"text\",\n}: {\n  icon: React.ReactNode;\n  label: string;\n  value: string;\n  onSave: (val: string) => void;\n  type?: string;\n}) {\n  const [editing, setEditing] = useState(false);\n  const [draft, setDraft] = useState(value);\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (editing && inputRef.current) {\n      inputRef.current.focus();\n      inputRef.current.select();\n    }\n  }, [editing]);\n\n  function handleSave() {\n    setEditing(false);\n    if (draft !== value) onSave(draft);\n  }\n\n  return (\n    <div className=\"flex items-center gap-3 rounded-[15px] border border-zinc-100 p-3 transition-colors hover:border-zinc-200\">\n      <div className=\"flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-zinc-100 text-zinc-500\">\n        {icon}\n      </div>\n      <div className=\"flex-1\">\n        <p className=\"font-body text-xs text-zinc-500\">{label}</p>\n        {editing ? (\n          <Input\n            ref={inputRef}\n            type={type}\n            value={draft}\n            onChange={(e) => setDraft(e.target.value)}\n            onBlur={handleSave}\n            onKeyDown={(e) => {\n              if (e.key === \"Enter\") handleSave();\n              if (e.key === \"Escape\") {\n                setDraft(value);\n                setEditing(false);\n              }\n            }}\n            className=\"mt-0.5 h-7 rounded-[10px] border-zinc-200 font-body text-sm\"\n          />\n        ) : (\n          <p\n            onClick={() => {\n              setDraft(value);\n              setEditing(true);\n            }}\n            className=\"mt-0.5 cursor-pointer rounded-lg px-1 py-0.5 font-body text-sm font-medium text-black transition-colors hover:bg-zinc-50\"\n            title=\"Clique para editar\"\n          >\n            {value || \"--\"}\n          </p>\n        )}\n      </div>\n      {!editing && (\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          className=\"h-7 w-7 shrink-0 text-zinc-300 hover:text-zinc-500\"\n          onClick={() => {\n            setDraft(value);\n            setEditing(true);\n          }}\n        >\n          <Pencil className=\"h-3.5 w-3.5\" />\n        </Button>\n      )}\n    </div>\n  );\n}\n\n// ── Client Stage Selector ───────────────────────────────────────────────────\nfunction ClientStageSelector({\n  currentStage,\n  onStageChange,\n}: {\n  currentStage: ClientStage;\n  onStageChange: (stage: ClientStage) => void;\n}) {\n  const currentIndex = clientStageConfig.findIndex((s) => s.id === currentStage);\n\n  return (\n    <div className=\"flex items-center gap-1\">\n      {clientStageConfig.map((stage, i) => {\n        const isActive = stage.id === currentStage;\n        const isPast = i < currentIndex;\n        const isChurn = stage.id === \"churn\";\n\n        return (\n          <button\n            key={stage.id}\n            onClick={() => onStageChange(stage.id)}\n            className={`flex items-center gap-1 rounded-full px-3 py-1.5 font-body text-xs font-medium transition-all ${\n              isActive\n                ? isChurn\n                  ? \"bg-status-danger text-white shadow-sm\"\n                  : \"bg-brand text-white shadow-sm\"\n                : isPast\n                  ? \"bg-brand/10 text-brand\"\n                  : \"bg-zinc-100 text-zinc-400 hover:bg-zinc-200 hover:text-zinc-600\"\n            }`}\n          >\n            {isPast && <Check className=\"h-3 w-3\" />}\n            {stage.label}\n          </button>\n        );\n      })}\n    </div>\n  );\n}\n\n// ── Owner Selector ──────────────────────────────────────────────────────────\nfunction OwnerSelector({\n  currentId,\n  currentName,\n  teamMembers,\n  onReassign,\n}: {\n  currentId: string;\n  currentName: string;\n  teamMembers: { id: string; name: string; avatar: string }[];\n  onReassign: (id: string, name: string) => void;\n}) {\n  const initials = currentName\n    .split(\" \")\n    .map((n) => n[0])\n    .join(\"\")\n    .slice(0, 2)\n    .toUpperCase();\n\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <button className=\"flex items-center gap-2 rounded-full px-2 py-1 transition-colors hover:bg-zinc-100\">\n          <div className=\"flex h-7 w-7 items-center justify-center rounded-full bg-brand text-xs font-bold text-white\">\n            {initials}\n          </div>\n          <span className=\"font-body text-sm font-medium text-black\">\n            {currentName}\n          </span>\n          <Pencil className=\"h-3 w-3 text-zinc-400\" />\n        </button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"start\" className=\"rounded-[15px]\">\n        {teamMembers.map((member) => (\n          <DropdownMenuItem\n            key={member.id}\n            onClick={() => onReassign(member.id, member.name)}\n            className=\"flex items-center gap-2\"\n          >\n            <div className=\"flex h-6 w-6 items-center justify-center rounded-full bg-zinc-200 text-[10px] font-bold text-zinc-600\">\n              {member.name\n                .split(\" \")\n                .map((n) => n[0])\n                .join(\"\")\n                .slice(0, 2)\n                .toUpperCase()}\n            </div>\n            <span className=\"font-body text-sm\">{member.name}</span>\n            {member.id === currentId && (\n              <Check className=\"ml-auto h-4 w-4 text-brand\" />\n            )}\n          </DropdownMenuItem>\n        ))}\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\n// ── Contact Card ────────────────────────────────────────────────────────────\nfunction ContactCard({\n  contact,\n  onEdit,\n  onDelete,\n  onToggleDecisionMaker,\n}: {\n  contact: (typeof mockContacts)[0];\n  onEdit: () => void;\n  onDelete: () => void;\n  onToggleDecisionMaker: () => void;\n}) {\n  return (\n    <div className=\"group flex items-stretch rounded-[15px] border border-zinc-200\">\n      {/* Decision-maker toggle — left side */}\n      <button\n        type=\"button\"\n        onClick={onToggleDecisionMaker}\n        className={`flex w-10 shrink-0 items-center justify-center rounded-l-[15px] border-r transition-colors ${\n          contact.isDecisionMaker\n            ? \"border-brand/20 bg-brand/10 text-brand\"\n            : \"border-zinc-200 bg-zinc-50/50 text-zinc-300 hover:bg-zinc-100 hover:text-zinc-400\"\n        }`}\n        aria-label={contact.isDecisionMaker ? \"Remover como decisor\" : \"Marcar como decisor\"}\n        title={contact.isDecisionMaker ? \"Decisor (clique para remover)\" : \"Marcar como decisor\"}\n      >\n        <Shield className=\"h-4 w-4\" />\n      </button>\n\n      {/* Card content */}\n      <div className=\"flex flex-1 items-start justify-between p-4\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-zinc-100\">\n            <User className=\"h-5 w-5 text-zinc-500\" />\n          </div>\n          <div>\n            <div className=\"flex items-center gap-2\">\n              <p className=\"font-heading text-sm font-semibold text-black\">\n                {contact.nome}\n              </p>\n              {contact.isDecisionMaker && (\n                <Badge className=\"gap-1 rounded-[10px] bg-brand/10 text-brand font-body text-[10px]\">\n                  <Shield className=\"h-3 w-3\" />\n                  Decisor\n                </Badge>\n              )}\n            </div>\n            <p className=\"font-body text-xs text-zinc-500\">{getCargoLabel(contact.cargo)}</p>\n            <div className=\"mt-1.5 flex items-center gap-3\">\n              <span className=\"flex items-center gap-1 font-body text-xs text-zinc-500\">\n                <Mail className=\"h-3 w-3\" />\n                {contact.email}\n              </span>\n              <span className=\"flex items-center gap-1 font-body text-xs text-zinc-500\">\n                <Phone className=\"h-3 w-3\" />\n                {contact.telefone}\n              </span>\n            </div>\n            {contact.personalidade && (\n              <p className=\"mt-1.5 font-body text-xs italic text-zinc-400\">\n                &ldquo;{contact.personalidade}&rdquo;\n              </p>\n            )}\n          </div>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-7 w-7 text-zinc-400 hover:text-zinc-600\"\n            onClick={onEdit}\n          >\n            <Pencil className=\"h-3.5 w-3.5\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-7 w-7 text-zinc-400 hover:text-status-danger\"\n            onClick={onDelete}\n          >\n            <Trash2 className=\"h-3.5 w-3.5\" />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ── MRR Mini Bar Chart ──────────────────────────────────────────────────────\nfunction MrrChart({\n  data,\n}: {\n  data: { month: string; value: number }[];\n}) {\n  const maxValue = Math.max(...data.map((d) => d.value));\n\n  return (\n    <div className=\"rounded-[15px] border border-zinc-100 p-4\">\n      <h4 className=\"mb-3 font-heading text-sm font-semibold text-black\">\n        MRR - Ultimos 6 Meses\n      </h4>\n      <div className=\"flex items-end gap-2\" style={{ height: 120 }}>\n        {data.map((d, i) => {\n          const heightPercent = (d.value / maxValue) * 100;\n          const isLast = i === data.length - 1;\n          return (\n            <div key={d.month} className=\"flex flex-1 flex-col items-center gap-1\">\n              <span className=\"font-body text-[10px] font-medium text-zinc-500\">\n                {formatCurrency(d.value)}\n              </span>\n              <div\n                className={`w-full rounded-t-lg transition-all ${\n                  isLast ? \"bg-brand\" : \"bg-brand/20\"\n                }`}\n                style={{ height: `${heightPercent}%`, minHeight: 8 }}\n              />\n              <span className=\"font-body text-xs text-zinc-400\">{d.month}</span>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\n// ── Metric Card ─────────────────────────────────────────────────────────────\nfunction MetricCard({\n  icon,\n  label,\n  value,\n  suffix,\n  color = \"text-black\",\n}: {\n  icon: React.ReactNode;\n  label: string;\n  value: string | number;\n  suffix?: string;\n  color?: string;\n}) {\n  return (\n    <div className=\"flex items-center gap-3 rounded-[15px] border border-zinc-100 p-4\">\n      <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-zinc-100 text-zinc-500\">\n        {icon}\n      </div>\n      <div>\n        <p className=\"font-body text-xs text-zinc-500\">{label}</p>\n        <p className={`font-heading text-lg font-bold ${color}`}>\n          {value}\n          {suffix && (\n            <span className=\"ml-0.5 font-body text-xs font-normal text-zinc-400\">\n              {suffix}\n            </span>\n          )}\n        </p>\n      </div>\n    </div>\n  );\n}\n\n// ── Churn Modal ─────────────────────────────────────────────────────────────\nfunction ChurnModal({\n  open,\n  onClose,\n  onConfirm,\n}: {\n  open: boolean;\n  onClose: () => void;\n  onConfirm: (reason: string, notes: string) => void;\n}) {\n  const [reason, setReason] = useState(\"\");\n  const [churnNotes, setChurnNotes] = useState(\"\");\n\n  function handleSubmit() {\n    onConfirm(reason, churnNotes);\n    setReason(\"\");\n    setChurnNotes(\"\");\n    onClose();\n  }\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-[480px] rounded-[20px] p-8\">\n        <DialogHeader>\n          <div className=\"flex items-center gap-3\">\n            <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-status-danger-light\">\n              <XCircle className=\"h-5 w-5 text-status-danger\" />\n            </div>\n            <DialogTitle className=\"font-heading text-xl font-semibold text-black\">\n              Registrar Churn\n            </DialogTitle>\n          </div>\n        </DialogHeader>\n\n        <div className=\"mt-4 space-y-4\">\n          <div className=\"space-y-2\">\n            <Label className=\"font-body text-sm text-zinc-600\">\n              Motivo do Churn\n            </Label>\n            <Select value={reason} onValueChange={setReason}>\n              <SelectTrigger className=\"h-10 rounded-[15px] font-body text-sm\">\n                <SelectValue placeholder=\"Selecione o motivo\" />\n              </SelectTrigger>\n              <SelectContent className=\"rounded-[15px]\">\n                {churnReasons.map((r) => (\n                  <SelectItem key={r} value={r}>\n                    {r}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"font-body text-sm text-zinc-600\">\n              Observacoes\n            </Label>\n            <Textarea\n              value={churnNotes}\n              onChange={(e) => setChurnNotes(e.target.value)}\n              className=\"min-h-[100px] rounded-[15px] font-body text-sm\"\n              placeholder=\"Descreva os detalhes do churn...\"\n            />\n          </div>\n        </div>\n\n        <DialogFooter className=\"mt-6\">\n          <Button\n            variant=\"secondary\"\n            onClick={onClose}\n            className=\"rounded-full font-heading text-sm\"\n          >\n            Cancelar\n          </Button>\n          <Button\n            onClick={handleSubmit}\n            disabled={!reason}\n            className=\"rounded-full bg-status-danger font-heading text-sm text-white hover:bg-status-danger/90\"\n          >\n            Registrar Churn\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// ── Main Component ──────────────────────────────────────────────────────────\nexport function ClientCardDrawer() {\n  const { drawerType, drawerData, closeDrawer, openModal } = useUIStore();\n  const isOpen = drawerType === \"client-card\";\n  const selectedClientId = drawerData?.id as string | undefined;\n  const clients = useClientStore((state) => state.clients);\n  const selectedClient = useMemo(\n    () => clients.find((client) => client.id === selectedClientId),\n    [clients, selectedClientId]\n  );\n  const resolvedClient = useMemo(\n    () =>\n      selectedClient\n        ? {\n            ...mockClient,\n            id: selectedClient.id,\n            companyName: selectedClient.companyName,\n            cnpj: selectedClient.cnpj,\n            razaoSocial: selectedClient.companyName,\n            telefoneEmpresa: selectedClient.contactPhone,\n            emailEmpresa: selectedClient.contactEmail,\n            stage: selectedClient.stage,\n            healthScore: selectedClient.healthScore,\n            monthlyRevenue: selectedClient.monthlyRevenue,\n            contractStart: selectedClient.contractStart,\n            contractEnd: selectedClient.contractEnd,\n            responsibleId: selectedClient.responsibleId,\n            responsibleName: selectedClient.responsibleName,\n            tags: selectedClient.tags,\n            lastInteraction: selectedClient.lastInteraction,\n            notes: \"\",\n          }\n        : mockClient,\n    [selectedClient]\n  );\n  // Health Score calculado dinamicamente\n  const computedHealth = calculateHealthScore(resolvedClient);\n  const health = {\n    ...healthConfig[computedHealth.category],\n    numericScore: computedHealth.numericScore,\n  };\n\n  // State\n  const [stage, setStage] = useState<ClientStage>(resolvedClient.stage);\n  const [responsibleId, setResponsibleId] = useState(resolvedClient.responsibleId);\n  const [responsibleName, setResponsibleName] = useState(resolvedClient.responsibleName);\n  const [notes, setNotes] = useState(resolvedClient.notes);\n  const [tags, setTags] = useState(() => [...resolvedClient.tags]);\n  const [newTag, setNewTag] = useState(\"\");\n  const [contacts, setContacts] = useState(mockContacts);\n  const sortedContacts = useMemo(\n    () => [...contacts].sort((a, b) => getPatentScore(b.cargo) - getPatentScore(a.cargo)),\n    [contacts],\n  );\n  const [showChurnModal, setShowChurnModal] = useState(false);\n\n  // Company editable fields\n  const [cnpj, setCnpj] = useState(resolvedClient.cnpj);\n  const [razaoSocial, setRazaoSocial] = useState(resolvedClient.razaoSocial);\n  const [endereco, setEndereco] = useState(resolvedClient.endereco);\n  const [telefoneEmpresa, setTelefoneEmpresa] = useState(resolvedClient.telefoneEmpresa);\n  const [emailEmpresa, setEmailEmpresa] = useState(resolvedClient.emailEmpresa);\n\n  // Contact form\n  const [showAddContact, setShowAddContact] = useState(false);\n  const [newContact, setNewContact] = useState({\n    nome: \"\",\n    email: \"\",\n    telefone: \"\",\n    cargo: \"\",\n    personalidade: \"\",\n  });\n\n  // Inline feedback\n  const [inlineFeedback, setInlineFeedback] = useState<{ type: \"success\" | \"error\" | \"warning\" | \"info\"; message: string } | null>(null);\n\n  // Contact edit\n  const [editingContactId, setEditingContactId] = useState<string | null>(null);\n  const [editContact, setEditContact] = useState({\n    nome: \"\",\n    email: \"\",\n    telefone: \"\",\n    cargo: \"\",\n    personalidade: \"\",\n  });\n\n  function handleAddTag() {\n    if (newTag.trim() && !tags.includes(newTag.trim().toLowerCase())) {\n      setTags([...tags, newTag.trim().toLowerCase()]);\n      setNewTag(\"\");\n    }\n  }\n\n  function handleRemoveTag(tag: string) {\n    setTags(tags.filter((t) => t !== tag));\n  }\n\n  function handleAddContact() {\n    if (newContact.nome.trim()) {\n      setContacts([\n        ...contacts,\n        {\n          id: `c${Date.now()}`,\n          clientId: \"client-mock\",\n          ...newContact,\n          isDecisionMaker: false,\n        },\n      ]);\n      setNewContact({ nome: \"\", email: \"\", telefone: \"\", cargo: \"\", personalidade: \"\" });\n      setShowAddContact(false);\n    }\n  }\n\n  function handleDeleteContact(id: string) {\n    setContacts(contacts.filter((c) => c.id !== id));\n  }\n\n  function handleToggleDecisionMaker(id: string) {\n    setContacts(\n      contacts.map((c) =>\n        c.id === id ? { ...c, isDecisionMaker: !c.isDecisionMaker } : c\n      )\n    );\n  }\n\n  function handleStartEditContact(contact: (typeof mockContacts)[0]) {\n    setEditingContactId(contact.id);\n    setEditContact({\n      nome: contact.nome,\n      email: contact.email,\n      telefone: contact.telefone,\n      cargo: contact.cargo,\n      personalidade: contact.personalidade ?? \"\",\n    });\n  }\n\n  function handleSaveEditContact() {\n    if (editingContactId && editContact.nome.trim()) {\n      setContacts(\n        contacts.map((c) =>\n          c.id === editingContactId ? { ...c, ...editContact } : c\n        )\n      );\n      setEditingContactId(null);\n      setEditContact({ nome: \"\", email: \"\", telefone: \"\", cargo: \"\", personalidade: \"\" });\n    }\n  }\n\n  return (\n    <>\n      <Sheet open={isOpen} onOpenChange={() => closeDrawer()}>\n        <SheetContent\n          side=\"right\"\n          className=\"w-full overflow-y-auto border-l border-zinc-200 p-0 sm:w-[720px] sm:max-w-[720px]\"\n          showCloseButton={false}\n        >\n          {/* ── Header ──────────────────────────────────────────────── */}\n          <SheetHeader className=\"sticky top-0 z-10 border-b border-zinc-200 bg-white px-6 py-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-3\">\n                  <SheetTitle className=\"font-heading text-xl font-semibold text-black\">\n                    {resolvedClient.companyName}\n                  </SheetTitle>\n                  {/* Health Score Badge */}\n                  <div\n                    className={`inline-flex items-center gap-1.5 rounded-[10px] px-3 py-1.5 font-heading text-sm font-bold ${health.bgColor} ${health.color}`}\n                  >\n                    {health.icon}\n                    {health.label}\n                    <span className=\"ml-1 text-xs font-normal opacity-70\">\n                      ({health.numericScore})\n                    </span>\n                  </div>\n                  {/* Group Badge */}\n                  {resolvedClient.groupName && (\n                    <Badge className=\"gap-1 rounded-[10px] bg-zinc-100 text-zinc-600 font-body text-xs\">\n                      <Users className=\"h-3 w-3\" />\n                      {resolvedClient.groupName}\n                    </Badge>\n                  )}\n                </div>\n                <p className=\"mt-0.5 font-body text-sm text-zinc-500\">\n                  CNPJ: {resolvedClient.cnpj}\n                </p>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Button\n                  onClick={() => setShowChurnModal(true)}\n                  variant=\"destructive\"\n                  className=\"rounded-full font-heading text-sm\"\n                >\n                  Registrar Churn\n                </Button>\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"text-zinc-400\">\n                      <MoreHorizontal className=\"h-5 w-5\" />\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\" className=\"rounded-[15px]\">\n                    <DropdownMenuItem onClick={() => openModal(\"new-activity\")}>\n                      Nova atividade\n                    </DropdownMenuItem>\n                    <DropdownMenuItem onClick={() => openModal(\"new-activity\")}>\n                      Registrar interacao\n                    </DropdownMenuItem>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem\n                      className=\"text-status-danger\"\n                      onClick={() => openModal(\"confirm-deactivate\")}\n                    >\n                      Desativar cliente\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"text-zinc-400\"\n                  onClick={() => closeDrawer()}\n                >\n                  <X className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* Stage Selector */}\n            <div className=\"mt-3 overflow-x-auto\">\n              <ClientStageSelector currentStage={stage} onStageChange={setStage} />\n            </div>\n\n            {/* Owner row */}\n            <div className=\"mt-3 flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"flex items-center gap-2\">\n                  <DollarSign className=\"h-4 w-4 text-zinc-400\" />\n                  <span className=\"font-body text-sm text-zinc-600\">\n                    MRR: <strong className=\"text-black\">{formatCurrency(resolvedClient.monthlyRevenue)}</strong>\n                  </span>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Calendar className=\"h-4 w-4 text-zinc-400\" />\n                  <span className=\"font-body text-sm text-zinc-600\">\n                    Contrato: <strong className=\"text-black\">{new Date(resolvedClient.contractStart).toLocaleDateString(\"pt-BR\")}</strong>\n                  </span>\n                </div>\n              </div>\n              <OwnerSelector\n                currentId={responsibleId}\n                currentName={responsibleName}\n                teamMembers={mockTeamMembers}\n                onReassign={(id, name) => {\n                  setResponsibleId(id);\n                  setResponsibleName(name);\n                }}\n              />\n            </div>\n          </SheetHeader>\n\n          {/* ── Body ────────────────────────────────────────────────── */}\n          <div className=\"p-6\">\n            {inlineFeedback && (\n              <div className=\"mb-4\">\n                <InlineFeedback\n                  type={inlineFeedback.type}\n                  message={inlineFeedback.message}\n                  compact\n                  onClose={() => setInlineFeedback(null)}\n                />\n              </div>\n            )}\n            <Tabs defaultValue=\"resumo\">\n              <TabsList className=\"w-full border-b border-zinc-200 bg-transparent p-0\">\n                {[\n                  { value: \"resumo\", label: \"Resumo\" },\n                  { value: \"empresa\", label: \"Empresa\" },\n                  { value: \"contatos\", label: \"Contatos\" },\n                  { value: \"metricas\", label: \"Metricas\" },\n                  { value: \"tags\", label: \"Tags\" },\n                  { value: \"historico\", label: \"Historico\" },\n                ].map((tab) => (\n                  <TabsTrigger\n                    key={tab.value}\n                    value={tab.value}\n                    className=\"rounded-none border-b-2 border-transparent px-4 py-2.5 font-body text-sm data-[state=active]:border-brand data-[state=active]:text-brand\"\n                  >\n                    {tab.label}\n                  </TabsTrigger>\n                ))}\n              </TabsList>\n\n              {/* ── Tab: Resumo ─────────────────────────────────────── */}\n              <TabsContent value=\"resumo\" className=\"mt-6\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <InfoRow\n                    icon={<DollarSign className=\"h-4 w-4\" />}\n                    label=\"Receita Mensal\"\n                  >\n                    <span className=\"font-body text-sm font-medium text-black\">\n                      {formatCurrency(resolvedClient.monthlyRevenue)}/mes\n                    </span>\n                  </InfoRow>\n                  <InfoRow\n                    icon={<User className=\"h-4 w-4\" />}\n                    label=\"Responsavel\"\n                  >\n                    <span className=\"font-body text-sm font-medium text-black\">\n                      {responsibleName}\n                    </span>\n                  </InfoRow>\n                  <InfoRow\n                    icon={<Calendar className=\"h-4 w-4\" />}\n                    label=\"Inicio do Contrato\"\n                  >\n                    <span className=\"font-body text-sm font-medium text-black\">\n                      {new Date(resolvedClient.contractStart).toLocaleDateString(\"pt-BR\")}\n                    </span>\n                  </InfoRow>\n                  <InfoRow\n                    icon={<Clock className=\"h-4 w-4\" />}\n                    label=\"Ultima Interacao\"\n                  >\n                    <span className=\"font-body text-sm font-medium text-black\">\n                      {resolvedClient.lastInteraction\n                        ? new Date(resolvedClient.lastInteraction).toLocaleDateString(\"pt-BR\")\n                        : \"--\"}\n                    </span>\n                  </InfoRow>\n                </div>\n\n                {/* Tags preview */}\n                <div className=\"mt-4 flex flex-wrap items-center gap-2\">\n                  <Tag className=\"h-4 w-4 text-zinc-400\" />\n                  {tags.map((tag) => (\n                    <Badge\n                      key={tag}\n                      variant=\"outline\"\n                      className=\"rounded-[10px] font-body text-xs\"\n                    >\n                      {tag}\n                    </Badge>\n                  ))}\n                </div>\n\n                {/* Notes */}\n                <Separator className=\"my-6\" />\n                <div>\n                  <h3 className=\"mb-3 font-heading text-base font-semibold text-black\">\n                    Anotacoes\n                  </h3>\n                  <Textarea\n                    value={notes}\n                    onChange={(e) => setNotes(e.target.value)}\n                    className=\"min-h-[100px] rounded-[15px] font-body text-sm\"\n                    placeholder=\"Adicione anotacoes sobre este cliente...\"\n                  />\n                </div>\n              </TabsContent>\n\n              {/* ── Tab: Empresa ────────────────────────────────────── */}\n              <TabsContent value=\"empresa\" className=\"mt-6\">\n                <div className=\"space-y-4\">\n                  <EditableField\n                    icon={<Building2 className=\"h-4 w-4\" />}\n                    label=\"CNPJ\"\n                    value={cnpj}\n                    onSave={setCnpj}\n                  />\n                  <EditableField\n                    icon={<FileText className=\"h-4 w-4\" />}\n                    label=\"Razao Social\"\n                    value={razaoSocial}\n                    onSave={setRazaoSocial}\n                  />\n                  <EditableField\n                    icon={<MapPin className=\"h-4 w-4\" />}\n                    label=\"Endereco\"\n                    value={endereco}\n                    onSave={setEndereco}\n                  />\n                  <EditableField\n                    icon={<Phone className=\"h-4 w-4\" />}\n                    label=\"Telefone\"\n                    value={telefoneEmpresa}\n                    onSave={setTelefoneEmpresa}\n                  />\n                  <EditableField\n                    icon={<Mail className=\"h-4 w-4\" />}\n                    label=\"E-mail\"\n                    value={emailEmpresa}\n                    onSave={setEmailEmpresa}\n                  />\n                </div>\n              </TabsContent>\n\n              {/* ── Tab: Contatos ───────────────────────────────────── */}\n              <TabsContent value=\"contatos\" className=\"mt-6\">\n                <div className=\"mb-4 flex items-center justify-between\">\n                  <h3 className=\"font-heading text-base font-semibold text-black\">\n                    Contatos ({sortedContacts.length})\n                  </h3>\n                  <Button\n                    onClick={() => setShowAddContact(true)}\n                    className=\"rounded-full bg-brand font-heading text-sm text-white hover:bg-brand/90\"\n                    size=\"sm\"\n                  >\n                    <Plus className=\"mr-1.5 h-4 w-4\" />\n                    Adicionar\n                  </Button>\n                </div>\n\n                {showAddContact && (\n                  <div className=\"mb-4 space-y-3 rounded-[15px] border border-zinc-200 p-4\">\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      <div>\n                        <Label className=\"font-body text-xs text-zinc-500\">Nome</Label>\n                        <Input\n                          value={newContact.nome}\n                          onChange={(e) =>\n                            setNewContact({ ...newContact, nome: e.target.value })\n                          }\n                          className=\"mt-1 h-9 rounded-[15px] font-body text-sm\"\n                          placeholder=\"Nome do contato\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"font-body text-xs text-zinc-500\">Cargo</Label>\n                        <Select\n                          value={newContact.cargo}\n                          onValueChange={(value) =>\n                            setNewContact({ ...newContact, cargo: value })\n                          }\n                        >\n                          <SelectTrigger className=\"mt-1 h-9 w-full rounded-[15px] border-zinc-200 font-body text-sm\">\n                            <SelectValue placeholder=\"Selecione o cargo\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {RESTAURANT_POSITIONS.map((pos) => (\n                              <SelectItem key={pos.value} value={pos.value}>\n                                {pos.label}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                      <div>\n                        <Label className=\"font-body text-xs text-zinc-500\">E-mail</Label>\n                        <Input\n                          type=\"email\"\n                          value={newContact.email}\n                          onChange={(e) =>\n                            setNewContact({ ...newContact, email: e.target.value })\n                          }\n                          className=\"mt-1 h-9 rounded-[15px] font-body text-sm\"\n                          placeholder=\"email@empresa.com\"\n                        />\n                      </div>\n                      <div>\n                        <Label className=\"font-body text-xs text-zinc-500\">Telefone</Label>\n                        <PhoneInput\n                          value={newContact.telefone}\n                          onValueChange={(raw) =>\n                            setNewContact({ ...newContact, telefone: raw })\n                          }\n                          className=\"mt-1 h-9 rounded-[15px] font-body text-sm\"\n                        />\n                      </div>\n                    </div>\n                    <div>\n                      <Label className=\"font-body text-xs text-zinc-500\">Personalidade</Label>\n                      <Textarea\n                        value={newContact.personalidade}\n                        onChange={(e) =>\n                          setNewContact({ ...newContact, personalidade: e.target.value })\n                        }\n                        className=\"mt-1 min-h-[60px] rounded-[15px] font-body text-sm\"\n                        placeholder=\"Ex: Direto e objetivo, prefere reuniões curtas...\"\n                      />\n                    </div>\n                    <div className=\"flex justify-end gap-2\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"rounded-full font-heading text-sm\"\n                        onClick={() => setShowAddContact(false)}\n                      >\n                        Cancelar\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        className=\"rounded-full bg-brand font-heading text-sm text-white hover:bg-brand/90\"\n                        onClick={handleAddContact}\n                      >\n                        Salvar\n                      </Button>\n                    </div>\n                  </div>\n                )}\n\n                <div className=\"space-y-3\">\n                  {sortedContacts.map((contact) =>\n                    editingContactId === contact.id ? (\n                      <div\n                        key={contact.id}\n                        className=\"space-y-3 rounded-[15px] border border-brand/30 bg-brand-light/10 p-4\"\n                      >\n                        <div className=\"grid grid-cols-2 gap-3\">\n                          <div>\n                            <Label className=\"font-body text-xs text-zinc-500\">Nome</Label>\n                            <Input\n                              value={editContact.nome}\n                              onChange={(e) =>\n                                setEditContact({ ...editContact, nome: e.target.value })\n                              }\n                              className=\"mt-1 h-9 rounded-[15px] font-body text-sm\"\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"font-body text-xs text-zinc-500\">Cargo</Label>\n                            <Select\n                              value={editContact.cargo}\n                              onValueChange={(value) =>\n                                setEditContact({ ...editContact, cargo: value })\n                              }\n                            >\n                              <SelectTrigger className=\"mt-1 h-9 w-full rounded-[15px] border-zinc-200 font-body text-sm\">\n                                <SelectValue placeholder=\"Selecione o cargo\" />\n                              </SelectTrigger>\n                              <SelectContent>\n                                {RESTAURANT_POSITIONS.map((pos) => (\n                                  <SelectItem key={pos.value} value={pos.value}>\n                                    {pos.label}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </div>\n                          <div>\n                            <Label className=\"font-body text-xs text-zinc-500\">E-mail</Label>\n                            <Input\n                              type=\"email\"\n                              value={editContact.email}\n                              onChange={(e) =>\n                                setEditContact({ ...editContact, email: e.target.value })\n                              }\n                              className=\"mt-1 h-9 rounded-[15px] font-body text-sm\"\n                            />\n                          </div>\n                          <div>\n                            <Label className=\"font-body text-xs text-zinc-500\">Telefone</Label>\n                            <PhoneInput\n                              value={editContact.telefone}\n                              onValueChange={(raw) =>\n                                setEditContact({ ...editContact, telefone: raw })\n                              }\n                              className=\"mt-1 h-9 rounded-[15px] font-body text-sm\"\n                            />\n                          </div>\n                        </div>\n                        <div>\n                          <Label className=\"font-body text-xs text-zinc-500\">Personalidade</Label>\n                          <Textarea\n                            value={editContact.personalidade}\n                            onChange={(e) =>\n                              setEditContact({ ...editContact, personalidade: e.target.value })\n                            }\n                            className=\"mt-1 min-h-[60px] rounded-[15px] font-body text-sm\"\n                            placeholder=\"Ex: Direto e objetivo, prefere reuniões curtas...\"\n                          />\n                        </div>\n                        <div className=\"flex justify-end gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"rounded-full font-heading text-sm\"\n                            onClick={() => {\n                              setEditingContactId(null);\n                              setEditContact({ nome: \"\", email: \"\", telefone: \"\", cargo: \"\", personalidade: \"\" });\n                            }}\n                          >\n                            Cancelar\n                          </Button>\n                          <Button\n                            size=\"sm\"\n                            className=\"rounded-full bg-brand font-heading text-sm text-white hover:bg-brand/90\"\n                            onClick={handleSaveEditContact}\n                          >\n                            Salvar\n                          </Button>\n                        </div>\n                      </div>\n                    ) : (\n                      <ContactCard\n                        key={contact.id}\n                        contact={contact}\n                        onEdit={() => handleStartEditContact(contact)}\n                        onDelete={() => handleDeleteContact(contact.id)}\n                        onToggleDecisionMaker={() => handleToggleDecisionMaker(contact.id)}\n                      />\n                    )\n                  )}\n                </div>\n              </TabsContent>\n\n              {/* ── Tab: Metricas ───────────────────────────────────── */}\n              <TabsContent value=\"metricas\" className=\"mt-6\">\n                <div className=\"space-y-4\">\n                  {/* MRR Chart */}\n                  <MrrChart data={mockMrrHistory} />\n\n                  {/* Metric Cards */}\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <MetricCard\n                      icon={<Activity className=\"h-5 w-5\" />}\n                      label=\"Score de Uso\"\n                      value={mockMetrics.usageScore}\n                      suffix=\"/100\"\n                      color={\n                        mockMetrics.usageScore >= 70\n                          ? \"text-status-success\"\n                          : mockMetrics.usageScore >= 40\n                            ? \"text-status-warning\"\n                            : \"text-status-danger\"\n                      }\n                    />\n                    <MetricCard\n                      icon={<LogIn className=\"h-5 w-5\" />}\n                      label=\"Dias Desde Ultimo Login\"\n                      value={mockMetrics.daysSinceLastLogin}\n                      suffix={mockMetrics.daysSinceLastLogin === 1 ? \"dia\" : \"dias\"}\n                      color={\n                        mockMetrics.daysSinceLastLogin <= 3\n                          ? \"text-status-success\"\n                          : mockMetrics.daysSinceLastLogin <= 7\n                            ? \"text-status-warning\"\n                            : \"text-status-danger\"\n                      }\n                    />\n                    <MetricCard\n                      icon={<ThumbsUp className=\"h-5 w-5\" />}\n                      label=\"NPS Score\"\n                      value={mockMetrics.npsScore}\n                      suffix=\"/10\"\n                      color={\n                        mockMetrics.npsScore >= 8\n                          ? \"text-status-success\"\n                          : mockMetrics.npsScore >= 6\n                            ? \"text-status-warning\"\n                            : \"text-status-danger\"\n                      }\n                    />\n                    <MetricCard\n                      icon={<TrendingUp className=\"h-5 w-5\" />}\n                      label=\"Crescimento MRR\"\n                      value=\"+39%\"\n                      color=\"text-status-success\"\n                    />\n                  </div>\n                </div>\n              </TabsContent>\n\n              {/* ── Tab: Tags ───────────────────────────────────────── */}\n              <TabsContent value=\"tags\" className=\"mt-6\">\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center gap-2\">\n                    <Input\n                      value={newTag}\n                      onChange={(e) => setNewTag(e.target.value)}\n                      onKeyDown={(e) => {\n                        if (e.key === \"Enter\") {\n                          e.preventDefault();\n                          handleAddTag();\n                        }\n                      }}\n                      placeholder=\"Digite uma nova tag...\"\n                      className=\"h-9 flex-1 rounded-[15px] font-body text-sm\"\n                    />\n                    <Button\n                      onClick={handleAddTag}\n                      className=\"rounded-full bg-brand font-heading text-sm text-white hover:bg-brand/90\"\n                      size=\"sm\"\n                    >\n                      <Plus className=\"mr-1 h-4 w-4\" />\n                      Adicionar\n                    </Button>\n                  </div>\n\n                  <div className=\"flex flex-wrap gap-2\">\n                    {tags.map((tag) => (\n                      <Badge\n                        key={tag}\n                        variant=\"outline\"\n                        className=\"gap-1.5 rounded-[10px] py-1.5 pr-1.5 font-body text-sm\"\n                      >\n                        {tag}\n                        <button\n                          onClick={() => handleRemoveTag(tag)}\n                          className=\"rounded-full p-0.5 transition-colors hover:bg-zinc-200\"\n                        >\n                          <X className=\"h-3 w-3 text-zinc-400\" />\n                        </button>\n                      </Badge>\n                    ))}\n                  </div>\n\n                  {tags.length === 0 && (\n                    <p className=\"py-8 text-center font-body text-sm text-zinc-400\">\n                      Nenhuma tag adicionada\n                    </p>\n                  )}\n                </div>\n              </TabsContent>\n\n              {/* ── Tab: Historico ───────────────────────────────────── */}\n              <TabsContent value=\"historico\" className=\"mt-6\">\n                <div className=\"relative space-y-0\">\n                  {mockTimeline.map((event, i) => (\n                    <div key={event.id} className=\"relative flex gap-4 pb-6\">\n                      {i < mockTimeline.length - 1 && (\n                        <div className=\"absolute left-[15px] top-8 h-full w-px bg-zinc-200\" />\n                      )}\n                      <div className=\"relative z-10 flex h-8 w-8 shrink-0 items-center justify-center rounded-full bg-zinc-100 text-zinc-500\">\n                        {getTimelineIcon(event.type)}\n                      </div>\n                      <div className=\"flex-1 pt-0.5\">\n                        <p className=\"font-body text-sm text-black\">\n                          {event.message}\n                        </p>\n                        <p className=\"font-body text-xs text-zinc-400\">\n                          {event.user} -- {event.date}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </TabsContent>\n            </Tabs>\n          </div>\n        </SheetContent>\n      </Sheet>\n\n      {/* Churn Modal */}\n      <ChurnModal\n        open={showChurnModal}\n        onClose={() => setShowChurnModal(false)}\n        onConfirm={(reason, churnNotes) => {\n          setStage(\"churn\");\n          setInlineFeedback({\n            type: \"success\",\n            message: `Churn registrado! Motivo: ${reason}.${churnNotes ? ` Observacoes: ${churnNotes}.` : \"\"} O cliente foi marcado como churn.`,\n          });\n        }}\n      />\n    </>\n  );\n}\n\n// ── Shared sub-components ───────────────────────────────────────────────────\nfunction InfoRow({\n  icon,\n  label,\n  children,\n}: {\n  icon: React.ReactNode;\n  label: string;\n  children: React.ReactNode;\n}) {\n  return (\n    <div className=\"flex items-center gap-3\">\n      <div className=\"flex h-8 w-8 items-center justify-center rounded-full bg-zinc-100 text-zinc-500\">\n        {icon}\n      </div>\n      <div>\n        <p className=\"font-body text-xs text-zinc-500\">{label}</p>\n        {children}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}